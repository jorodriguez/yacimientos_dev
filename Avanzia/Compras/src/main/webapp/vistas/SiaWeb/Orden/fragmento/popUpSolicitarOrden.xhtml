<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                >

    <!-- Inicia popup modificar Ítem -->
    <div class="modal fade" id="dialogoModItemOCS" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog" style="width: 90%;">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">#{ordenCompraBean.operacionItem} Ítem</h4>
                </div>

                <h:form id="frmItemOrden">
                    <div class="modal-body">
                        <div  class="row">
                            <h:message  for="" style="display: block;" infoClass="alert alert-success" warnClass="alert alert-warning"
                                        errorClass="alert alert-danger" fatalClass="alert alert-danger"  />
                        </div>
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="card panel-default col-lg-12" >   
                                    <ui:fragment rendered="#{ordenCompraBean.ordenActual.multiproyecto eq 'False'}">
                                        <div class="form-group col-lg-12" >
                                            <div class="col-lg-12" style="margin-bottom: 0px;" >                                        
                                                <div class="card panel-primary" id="PanelArtFre"> 
                                                    <div class="card-heading" onclick="colapsarPanel('artFrecImg', 'collapsePanelArtFre');">
                                                        <h3 class="card-title">
                                                            <strong>Articulos Frecuentes</strong>
                                                        </h3>
                                                        <span class="pull-right clickable panel-collapsed"><i id="artFrecImg" class="glyphicon glyphicon-plus"></i></span>                                                    
                                                    </div>
                                                    <div id="collapsePanelArtFre" class="card-collapse collapse">
                                                        <div class="card-body">
                                                            <!--<!-- rowSelectListener="#{ordenCompraBean.seleccionarArtFrecuente}" -->
                                                            <ui:fragment rendered="#{!(ordenCompraBean.itemActual.invArticulo.id gt 0)}">
                                                                <p:dataTable size="small" stripedRows="true" showGridlines="true" value="#{ordenCompraBean.articulosFrecuentes}" var="artF"
                                                                               rowStyleClass="table table-bordered table-striped"
                                                                               rows="10" paginator="true"  
                                                                               paginatorPosition="bottom" 
                                                                               selectionMode="single"
                                                                               >
                                                                    <p:column style="text-align: left;">
                                                                        <h:outputText value="#{artF.numParte} - #{artF.nombre.length() > 200 ? artF.nombre.substring(0,200) : artF.nombre}" 
                                                                                      title="#{artF.nombre}"/>
                                                                    </p:column>                                                
                                                                </p:dataTable>
                                                            </ui:fragment>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>


                                            <div class="form-group col-lg-12" style="margin-bottom: 0px;" > 
                                                <div class="card panel-primary" id="panelBusquedaAvanzada"> 
                                                    <div class="card-heading"  onclick="colapsarPanel('busAvaImg', 'collapsePanelBusquedaAvanzada');">
                                                        <h3 class="card-title">                                                        
                                                            <strong>Búsqueda Asistida</strong>
                                                        </h3>
                                                        <span class="pull-right clickable panel-collapsed"><i id="busAvaImg" class="glyphicon glyphicon-plus"></i></span>                                                    
                                                    </div>
                                                    <div id="collapsePanelBusquedaAvanzada" class="card-collapse collapse">
                                                        <div class="card-body">
                                                            <ui:fragment rendered="#{!(ordenCompraBean.itemActual.invArticulo.id gt 0)}">
                                                                <div class="form-group col-lg-12" style="margin-bottom: 0px;" >
                                                                    <ui:repeat value="#{ordenCompraBean.categoriasSeleccionadas}" var="dataCat"
                                                                               varStatus="indice">
                                                                        <p:commandLink  style="padding-left: 2%;"
                                                                                          action="#{ordenCompraBean.seleccionarCategoriaCabecera(event)}"
                                                                                          styleClass="text text-primary">
                                                                            <i class="glyphicon glyphicon-arrow-right"
                                                                               style="display: #{ordenCompraBean.categoriasSeleccionadas.size() gt 0} ? 'block' : 'none'"></i>
                                                                            #{dataCat.nombre} 
                                                                            <f:param name="indiceCatSel" value="#{indice.index}"/>
                                                                        </p:commandLink>
                                                                    </ui:repeat>
                                                                </div>                                                        

                                                                <div class="col-lg-12" id="tablaCategorias">
                                                                    <!<!-- rowSelectListener="#{ordenCompraBean.seleccionarCategoria}" -->
                                                                    <p:dataTable size="small" stripedRows="true" showGridlines="true" value="#{ordenCompraBean.listaCatPrin}" var="dataArt"
                                                                                   rowStyleClass="table table-bordered table-striped"
                                                                                   rows="20" paginator="true"  
                                                                                   paginatorPosition="bottom" 
                                                                                   selectionMode="single"
                                                                                   >
                                                                        <p:column headerText="Código" style="width: 10%;">
                                                                            <h:outputText value="#{dataArt.codigo}"/>
                                                                        </p:column>
                                                                        <p:column headerText="Nombre" style="text-align: left;">
                                                                            <h:outputText value="#{dataArt.nombre}"/>
                                                                        </p:column>                                                
                                                                    </p:dataTable>
                                                                </div>                                                                                                                  
                                                                <div class="form-group col-lg-12" style="margin-top: 10px; margin-bottom: 10px;" >
                                                                    <strong><h:outputText style="padding-top: 3px;" class="col-lg-1 control-label" value="Filtro:" /></strong>
                                                                    <div class="col-lg-9">  
                                                                        <!<!-- textChangeListener="#{ordenCompraBean.traerArticulosItemsListener}" -->
                                                                        <p:autoComplete id="idBusquedaAvArticulos"                                                                 
                                                                                             value="#{ordenCompraBean.articuloTx}"                                                                                              
                                                                                             styleClass="campoFiltro"                                                                                         
                                                                                             style="margin: 0px 0 0 0px; width: 100%; height: 25px; background-color: #d9edf7; border: 1px solid #ccc; border-radius: 4px; box-shadow: 0 1px 1px rgba(0, 0, 0, 0.075) inset;">                                                                                                                                                                        
                                                                        </p:autoComplete>
                                                                    </div>
                                                                    <div class="col-lg-2">                                                                                    
                                                                        <strong><h:outputText
                                                                                value="#{ordenCompraBean.articulosResultadoBqda.size()} Artículos"/>
                                                                        </strong>

                                                                    </div>
                                                                </div>
                                                                <div class="form-group col-lg-12">
                                                                    <div class="col-lg-12" id="tablaResBusquedaAv">
                                                                        <!<!-- rowSelectListener="#{ordenCompraBean.seleccionarResultadoBA}"> -->
                                                                        <p:dataTable size="small" stripedRows="true" showGridlines="true" value="#{ordenCompraBean.articulosResultadoBqda}" var="dataRBA"
                                                                                       id="tablaResBusquedaAvTABLE"                                                                                   
                                                                                       rowStyleClass="table table-bordered table-striped"
                                                                                       rows="20" paginator="true"  
                                                                                       paginatorPosition="bottom" 
                                                                                       selectionMode="single">
                                                                                       
                                                                            <p:column headerText="Código" style="width: 15%;" styleClass="resultadoBdaCodigo">
                                                                                <h:outputText value="#{dataRBA.value.numParte}"/>
                                                                            </p:column>
                                                                            <p:column headerText="Nombre" style="text-align: left; width: 85%" styleClass="resultadoBdaNombre">
                                                                                <h:outputText value="#{dataRBA.value.nombre}"/>
                                                                            </p:column> 
                                                                            <p:ajax event="page" process="@this" oncomplete="marcarBusquedaOrden();"></ace:ajax>
                                                                        </p:dataTable>
                                                                    </div>                 
                                                                </div>
                                                            </ui:fragment>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div> 
                                    </ui:fragment>

                                    <ui:fragment rendered="#{ordenCompraBean.itemActual.invArticulo.id gt 0 or ordenCompraBean.itemActual.id gt 0}">
                                        <div class="row" style="margin-top: 10px;" >
                                            <div class="col-lg-6" >
                                                <ui:fragment rendered="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C'}">
                                                    <div class="form-group col-lg-12">
                                                        <h:outputText value="Presupuesto:" styleClass="control-label col-lg-2"/>
                                                        <div class="col-lg-10">
                                                            <h:selectOneMenu styleClass="form-control" 
                                                                             readonly="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C'}"
                                                                             disabled="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C'}"
                                                                             value="#{ordenCompraBean.itemActual.ocPresupuesto.id}" 
                                                                             >
                                                                <f:selectItem itemLabel="#{ordenCompraBean.itemActual.ocPresupuesto.nombre}" itemValue="#{ordenCompraBean.itemActual.ocPresupuesto.id}"/>                                                                
                                                            </h:selectOneMenu>
                                                        </div>
                                                    </div>
                                                    <div class="form-group col-lg-12">
                                                        <h:outputText value="Año pres:" styleClass="control-label col-lg-2"/>
                                                        <div class="col-lg-10">
                                                            <h:selectOneMenu styleClass="form-control" 
                                                                             readonly="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C'}"
                                                                             disabled="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C'}"
                                                                             value="#{ordenCompraBean.itemActual.anioPresupuesto}" 
                                                                             >
                                                                <f:selectItem itemLabel="Año #{ordenCompraBean.itemActual.anioPresupuesto}" itemValue="#{ordenCompraBean.itemActual.anioPresupuesto}"/>
                                                            </h:selectOneMenu>
                                                        </div>
                                                    </div>
                                                    <div class="form-group col-lg-12">
                                                        <h:outputText value="Mes pres:" styleClass="control-label col-lg-2"/>
                                                        <div class="col-lg-10">
                                                            <h:selectOneMenu styleClass="form-control" 
                                                                             readonly="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C'}"
                                                                             disabled="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C'}"
                                                                             value="#{ordenCompraBean.itemActual.mesPresupuesto}" 
                                                                             >
                                                                <f:selectItem itemLabel="Mes #{ordenCompraBean.itemActual.mesPresupuesto}" itemValue="#{ordenCompraBean.itemActual.mesPresupuesto}"/>
                                                            </h:selectOneMenu>
                                                        </div>
                                                    </div>
                                                    <div class="form-group col-lg-12">
                                                        <h:outputText value="Actividad petrolera:" styleClass="control-label col-lg-2"/>
                                                        <div class="col-lg-10">
                                                            <h:selectOneMenu styleClass="form-control" 
                                                                             readonly="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C'}"
                                                                             disabled="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C'}"
                                                                             value="#{ordenCompraBean.itemActual.ocActividadPetrolera.id}" 
                                                                             >
                                                                <f:selectItem itemLabel="Seleccione . . . " itemValue="0"/>
                                                                <f:selectItems value="#{ordenCompraBean.listaMapa.get('actividad')}"/>
                                                                <f:ajax event="valueChange" render="@this idProyecto idTipoTarea nombreTipoObra nombreSubTarea" 
                                                                        listener="#{ordenCompraBean.seleccionarActividad}"/>
                                                            </h:selectOneMenu>
                                                        </div>
                                                    </div>

                                                    <ui:fragment rendered="#{ordenCompraBean.ordenActual.tipo eq 'PS' or ordenCompraBean.ordenActual.apCampo.tipo eq 'C'}">
                                                        <div class="form-group col-lg-12">
                                                            <h:outputText value="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C' ? 'SubActividad:' : 'Tipo Tarea:' }" styleClass="control-label col-lg-2"/>
                                                            <div class="col-lg-10">
                                                                <h:selectOneMenu id="idTipoTarea" value="#{ordenCompraBean.itemActual.ocUnidadCosto.id}" styleClass="form-control"
                                                                                 readonly="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C'}"
                                                                                 disabled="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C'}">
                                                                    <f:selectItem itemLabel="Seleccione . . . " itemValue="0"/>
                                                                    <f:selectItems value="#{ordenCompraBean.listaMapa.get('tipoTarea')}"/>
                                                                    <f:ajax render="@this nombreTipoObra nombreSubTarea" listener="#{ordenCompraBean.seleccionarTipoTarea}"/>
                                                                </h:selectOneMenu>
                                                            </div>
                                                        </div>
                                                    </ui:fragment>
                                                </ui:fragment>
                                                <ui:fragment rendered="#{ordenCompraBean.ordenActual.tipo eq 'PS' or ordenCompraBean.ordenActual.apCampo.tipo eq 'C'}">
                                                    <div class="form-group col-lg-12">
                                                        <h:outputText value="Tarea:" styleClass="control-label col-lg-2"/>
                                                        <ui:fragment rendered="#{!ordenCompraBean.ordenActual.multiproyecto}">
                                                            <div class="col-lg-10">
                                                                <h:selectOneMenu id="nombreTipoObra"  value="#{ordenCompraBean.idTarea}" styleClass="form-control"
                                                                                 readonly="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C'}"
                                                                                 disabled="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C'}"
                                                                                 >
                                                                    <f:selectItem itemValue="0" itemLabel="Seleccione . . . " />
                                                                    <f:selectItems value="#{ordenCompraBean.listaMapa.get('tarea')}"/>
                                                                    <f:ajax render="@this nombreSubTarea" listener="#{ordenCompraBean.seleccionarTarea}"/>
                                                                </h:selectOneMenu>
                                                            </div>
                                                        </ui:fragment>
                                                        <ui:fragment rendered="#{ordenCompraBean.ordenActual.multiproyecto}">
                                                            <div class="col-lg-10">
                                                                <h:selectOneMenu id="nombreTipoObraMM"  value="#{ordenCompraBean.idTarea}" styleClass="form-control"
                                                                                 readonly="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C'}"
                                                                                 disabled="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C'}"
                                                                                 >
                                                                    <f:selectItem itemValue="0" itemLabel="#{ordenCompraBean.nombreTareaMulti}" />                                                                    
                                                                </h:selectOneMenu>
                                                            </div>
                                                        </ui:fragment>
                                                    </div>
                                                </ui:fragment>
                                                <ui:fragment rendered="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C'}">
                                                    <div class="form-group col-lg-12">
                                                        <h:outputText value="SubTarea:" styleClass="control-label col-lg-2"/>
                                                        <div class="col-lg-10">
                                                            <h:selectOneMenu id="nombreSubTarea"  value="#{ordenCompraBean.itemActual.ocCodigoSubtarea.id}" styleClass="form-control"
                                                                             readonly="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C'}"
                                                                             disabled="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C'}"
                                                                             >
                                                                <f:selectItem itemValue="0" itemLabel="Seleccione . . . " />
                                                                <f:selectItems value="#{ordenCompraBean.listaMapa.get('subTarea')}"/>
                                                            </h:selectOneMenu>
                                                        </div>
                                                    </div>
                                                </ui:fragment>
                                                <div class="col-lg-12 form-group">
                                                    <div class="input-group col-lg-12">
                                                        <h:outputText styleClass="col-lg-2 control-label" value="Cantidad:" style="margin-top: 5px;"/>  
                                                        <div class="col-lg-3">
                                                            <h:inputText  id="cantidad" styleClass="form-control" value="#{ordenCompraBean.itemActual.cantidad}" 
                                                                          readonly="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C'}">
                                                                <f:convertNumber pattern="#.###" maxFractionDigits="3"/>
                                                            </h:inputText>
                                                        </div>
                                                        <h:outputText styleClass="col-lg-1 control-label" value="P.U.:" style="text-align: right; margin-top: 5px;" /> 
                                                        <div class="col-lg-3">
                                                            <h:inputText id="precioUnitario" styleClass="form-control" value="#{ordenCompraBean.itemActual.precioUnitario}"/>
                                                        </div>                              
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-6 input-group" >
                                                <ui:fragment rendered="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C' and ordenCompraBean.ordenActual.multiproyecto}">
                                                    <div class="form-group col-lg-12">
                                                        <h:outputText value="Proyectos:" styleClass="control-label col-lg-2"/>
                                                        <div class="col-lg-10">                                                            
                                                            <h:outputText value="#{ordenCompraBean.listaItems.get(0).multiProyectos}" styleClass="control-label col-lg-10"/>
                                                        </div>
                                                    </div>
                                                </ui:fragment>
                                                <ui:fragment rendered="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C' and !ordenCompraBean.ordenActual.multiproyecto}">
                                                    <div class="form-group col-lg-12">
                                                        <h:outputText value="Proyecto:" styleClass="control-label col-lg-2"/>
                                                        <div class="col-lg-10">                                                            
                                                            <h:selectOneMenu id="idProyecto" value="#{ordenCompraBean.itemActual.proyectoOt.id}" 
                                                                             readonly="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C'}"
                                                                             disabled="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C'}"
                                                                             styleClass="form-control">
                                                                <f:selectItem itemLabel="Seleccione . . . " itemValue="0"/>
                                                                <f:selectItems value="#{ordenCompraBean.listaMapa.get('proyecto')}"/>
                                                                <f:ajax render="@this idTipoTarea nombreTipoObra nombreSubTarea" listener="#{ordenCompraBean.seleccionarProyecto}"/>
                                                            </h:selectOneMenu>
                                                        </div>
                                                    </div>

                                                </ui:fragment>
                                                <div class="col-lg-12 input-group">
                                                    <div class="form-group">
                                                        <div class="form-group col-lg-12">
                                                            <div class="form-group col-lg-6">
                                                                <h:outputText styleClass="col-lg-2" value="N/P: " /> 
                                                                <div class="col-lg-10">
                                                                    <h:outputLabel id="codigo" value="#{ordenCompraBean.itemActual.invArticulo != null ? ordenCompraBean.itemActual.invArticulo.codigoInt : ordenCompraBean.itemActual.codigo}"/>
                                                                </div>
                                                            </div>
                                                            <div class="form-group col-lg-6">
                                                                <h:outputText styleClass="col-lg-4 control-label" value="Unidad: "/>
                                                                <div class="col-lg-8">
                                                                    <h:outputLabel id="unidad" 
                                                                                   value="#{ordenCompraBean.itemActual.invArticulo != null ? ordenCompraBean.itemActual.invArticulo.unidad.nombre : ordenCompraBean.itemActual.siUnidad.nombre}"/>                                                
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group col-lg-12">
                                                    <h:outputText styleClass="col-lg-2 control-label" value="Artículo:" /> 
                                                    <div class="col-lg-10">
                                                        <h:outputLabel  id="nombre" value="#{ordenCompraBean.itemActual.invArticulo.nombre}"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-10">
                                                <div class="form-group col-lg-10">
                                                    <h:outputText styleClass="col-lg-2 control-label" value="Obs. Navision:" /> 
                                                    <div class="col-lg-10">
                                                        <h:inputTextarea styleClass="form-control" value="#{ordenCompraBean.itemActual.textNav}"/>

                                                    </div>
                                                </div>
                                                <div class="form-group col-lg-10 ">
                                                    <h:outputText styleClass="col-lg-2 control-label" value="Observaciones:" /> 
                                                    <div class="col-lg-10">
                                                        <h:inputTextarea styleClass="form-control" value="#{ordenCompraBean.itemActual.observaciones}"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </ui:fragment>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <h:commandButton value="#{ordenCompraBean.operacionItem}"
                                         styleClass="btn btn-info"
                                         action="#{ordenCompraBean.completarActualizacionItem(actionEvent)}"
                                         onclick="return validaItemOCS('frmItemOrden', '#{ordenCompraBean.ordenActual.tipo}')"
                                         rendered="#{ordenCompraBean.itemActual.invArticulo.id gt 0 or ordenCompraBean.itemActual.id gt 0}"/>
                        <p:commandButton value="Cancelar"
                                           styleClass="btn btn-default"
                                           onclick="cerrarDialogoModal(dialogoModItemOCS);"
                                           title="Cerrar ventana..." 
                                           immediate="true"/>                                    
                    </div>
                </h:form>
            </div>
        </div>
    </div>

    <!-- Items desde otra oc/s -->
    <div class="modal fade" id="dialogoDetalleOCS" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog" style="width: 90%;">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Agregar Items de otra OC/S</h4>
                </div>
                <h:form id="frmDialogoDetalleOCS">
                    <div class="modal-body panel panel-footer">                                
                        <div class="container-fluid">
                            <div class="col-lg-10 col-xs-12">
                                <div class="input-group">
                                    <div class="form-group col-lg-12 col-xs-12">
                                        <div class="col-lg-5 col-xs-12">
                                            <h:inputText  value="#{ordenCompraBean.referencia}" styleClass="form-control"
                                                            />
                                        </div>
                                        <div class="col-lg-4 col-xs-12">
                                            <p:commandLink value="Buscar..." styleClass="btn btn-default"
                                                             action="#{ordenCompraBean.buscarOrdenPorConsecutivoBloque(event)}"/>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <br/>
                        <h:messages id="noEncontroOC" style="color: red; font-family: 'Arial','Helvetica',sans-serif;"/>

                        <div class="container-fluid">
                            <div class="col-lg-6 col-xs-12 panel panel-primary">
                                <h:outputLabel value="OC/S en el sistema"/>
                                <p:panel   >
                                    <h:outputLabel value="OC/S:"/>
                                    <h:outputText  value="#{ordenCompraBean.ordenVO.consecutivo}"/>
                                    <h:outputLabel value="Proveedor:"/>
                                    <h:outputText  value="#{ordenCompraBean.ordenVO.proveedor}"/>
                                </p:panel>
                            </div>
                            <div class="col-lg-6 panel panel-primary">
                                <h:outputLabel  value="OC/S Seleccionada (Actual)"/>
                                <p:panel  >
                                    <h:outputLabel value="OC/S:"/>
                                    <h:outputText  value="#{ordenCompraBean.ordenActual.id}"/>
                                    <h:outputLabel value="Proveedor:"/>
                                    <h:outputText  value="#{ordenCompraBean.ordenActual.referencia}"/>
                                </p:panel>                                
                            </div>
                            <br/>
                        </div>
                        <div class="container-fluid">
                            <h:outputLabel value="Items"/>
                            <p:dataTable size="small" stripedRows="true" showGridlines="true"  value="#{ordenCompraBean.ordenVO.detalleOrden}" 
                                           var="currentRow" >
                                <p:column>
                                    <h:selectBooleanCheckbox value="#{currentRow.selected}"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{currentRow['artNumeroParte']}"/>
                                    <f:facet name="header">
                                        <h:outputText value="Código"/>
                                    </f:facet>
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{currentRow['cantidad']}"/>
                                    <f:facet name="header">
                                        <h:outputText value="Cantidad"/>
                                    </f:facet>
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{currentRow['artUnidad']}"/>
                                    <f:facet name="header">
                                        <h:outputText value="Unidad"/>
                                    </f:facet>
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{currentRow['artDescripcion']}" />
                                    <f:facet name="header">
                                        <h:outputText value="Descripción"/>
                                    </f:facet>
                                </p:column>
                                <p:column rendered="false">
                                    <h:outputText value="#{currentRow['moneda']}"/>
                                    <f:facet name="header">
                                        <h:outputText value="Moneda"/>
                                    </f:facet>
                                </p:column>
                                <p:column style="width: 12%;">
                                    <h:outputText value="#{currentRow['precioUnitario']}">
                                        <f:convertNumber pattern="$ #,##0.00" locale="es-MX"/>
                                    </h:outputText>
                                    <f:facet name="header">
                                        <h:outputText value="Precio Unitario"/>
                                    </f:facet>
                                </p:column>
                                <p:column style="width: 12%;">
                                    <h:outputText value="#{currentRow['importe']}">
                                        <f:convertNumber pattern="$ #,##0.00" locale="es-MX"/>
                                    </h:outputText>
                                    <f:facet name="header">
                                        <h:outputText value="Importe"/>
                                    </f:facet>
                                </p:column>
                            </p:dataTable>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <p:commandLink value="#{msgs['sistema.genera.orden.detalle.pasar']} #{ordenCompraBean.ordenVO.consecutivo}" 
                                       styleClass="btn btn-success"
                                       title="#{msgs['sistema.tooltip.orden.detalle.pasar']}"
                                       rendered="#{ordenCompraBean.ordenVO != null}"
                                       action="#{ordenCompraBean.pasarItemsOrden(actionEvent)}">                                
                        </p:commandLink>
                        <p:commandLink id="btnLimpiar" styleClass="btn btn-default" value="Cerrar"  
                                       action="#{ordenCompraBean.limpiar(event)}"
                                       onclick="$(dialogoDetalleOCS).modal('hide');"/>
                    </div>
                </h:form>
            </div>
        </div>
    </div>
    <!-- Modal Modificar orden-->
    <div class="modal fade" id="dialogoModOCS" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Modificar Orden de compra</h4>
                </div>
                <h:form id="frmModReq">
                    <div class="modal-body panel panel-footer">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="input-group panel panel-default" ><br/>
                                    <div class="form-group col-lg-12" >
                                        <h:outputText styleClass="col-lg-2 control-label" value="Orden:" /> 
                                        <div class="col-lg-10">
                                            <h:outputText styleClass="form-control" value="#{ordenCompraBean.ordenActual.id}"/>
                                        </div>
                                    </div>
                                    <div class="form-group col-lg-12">
                                        <h:outputText styleClass="col-lg-2 control-label" value="Gerencia:" />
                                        <div class="col-lg-10"><h:outputText styleClass="form-control" value="#{ordenCompraBean.ordenActual.gerencia.nombre}" />
                                        </div>
                                    </div>
                                    <div class="form-group col-lg-12" >
                                        <h:outputText styleClass="col-lg-2 control-label" value="ProyectoOT:"/>
                                        <div class="col-lg-10">
                                            <h:outputText styleClass="form-control" value="#{ordenCompraBean.ordenActual.proyectoOt.nombre}"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <b>Modificaciones</b>
                            <div class="col-lg-12">
                                <div class="input-group panel panel-default" ><br/>
                                    <div class="form-group col-lg-12" >
                                        <h:outputText styleClass="col-lg-2 control-label" value="Lugar de entrega:"/>
                                        <div class="col-lg-10">
                                            <h:inputText class="form-control" value="#{ordenCompraBean.ordenActual.destino}"/>
                                        </div>
                                    </div>

                                    <div class="form-group col-lg-12" >
                                        <h:outputText styleClass="col-lg-2 control-label" value="Observaciones al proveedor:"/>
                                        <div class="col-lg-10">
                                            <h:inputTextarea class="form-control" value="#{ordenCompraBean.ordenActual.nota}"/>
                                        </div>
                                    </div>

                                    <div class="form-group col-lg-12" >
                                        <h:outputText styleClass="col-lg-2 control-label" value="Comentarios Internos de la OC/S:"/>
                                        <div class="col-lg-10">
                                            <h:inputTextarea class="form-control" value="#{ordenCompraBean.ordenActual.observaciones}"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>                                    
                    </div>
                    <div class="modal-footer">
                        <p:commandButton  value="Actualizar" action="#{ordenCompraBean.completarActualizacionOrden(actionEvent)}"                                                           
                                            styleClass="btn btn-info"/>
                        <p:commandButton  value="Cancelar"
                                            styleClass="btn btn-default"
                                            onclick="$(dialogoModOCS).modal('hide');"
                                            title="Cerrar ventana sin modificar..."/>                                    
                    </div>
                </h:form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="dialogoCargarEts" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Especificación Técnica de Suministros</h4>
                </div>
                <h:form id="form1Ets" >
                    <div class="modal-body panel panel-footer">
                        <div class="row">
                            <div class="col-lg-12 col-xs-12" style="font-size: 1em; margin-top: 10px;">
                                <h:selectOneRadio value="#{ordenCompraBean.opcionSeleccionada}" >
                                    <f:selectItem itemLabel="Traer de requisición" itemValue="EtsRequisicion"/>
                                    <f:selectItem itemLabel="Sistema de Archivo" itemValue="ETSLocal"/>    
                                </h:selectOneRadio>
                            </div>                   
                            <div class="col-lg-12 col-xs-12" style="font-size:12px; margin-top: 10px;">                                                    
                                <!<!-- selectedPanel="#{ordenCompraBean.opcionSeleccionada}" -->
                                <p:panel  style="width: 100%;">
                                    <h:panelGroup id="EtsRequisicion">
                                        <div class="col-lg-12 col-xs-12" style="font-size:12px; margin-top: 10px;">                                                    
                                            <div class="table table-responsive">
                                                <p:dataTable size="small" stripedRows="true" showGridlines="true"  value="#{ordenCompraBean.listaEts}" var="data"
                                                               styleClass="table table-striped">
                                                    <f:facet name="header">
                                                        <h:outputLabel value="Requisición #{ordenCompraBean.ordenVO.requisicion}"/>
                                                    </f:facet>
                                                    <p:column>
                                                        <h:selectBooleanCheckbox value="#{ordenCompraBean.filasSeleccionadas[data['id']]}"/>                                 
                                                    </p:column>   
                                                    <p:column>
                                                        <f:facet name="header">
                                                            <h:outputLabel value="Nombre"/>
                                                        </f:facet>
                                                        <h:outputText value="#{data['siAdjunto'].nombreSinUUID}"/>
                                                    </p:column>
                                                    <p:column>
                                                        <f:facet name="header">
                                                            <h:outputLabel value="Tamaño"/>
                                                        </f:facet>
                                                        <h:outputText  value="#{data['siAdjunto'].peso}"/>
                                                    </p:column>
                                                    <p:column>
                                                        <f:facet name="header">
                                                            <h:outputLabel value="Descripción"/>
                                                        </f:facet>
                                                        <h:outputText value="#{data['siAdjunto'].descripcion}"/>
                                                    </p:column>
                                                    <p:column>
                                                        <h:outputLink   styleClass="link"
                                                                        target="_blank"  
                                                                        id="abrirReq"
                                                                        title="Click aqui para abrir el archivo..." 
                                                                        value="/Compras/AbrirArchivo?ZWZ2W=#{data['siAdjunto'].id}&amp;ZWZ3W=#{data['siAdjunto'].uuid}">
                                                            <h:outputText value=" Abrir"/>
                                                        </h:outputLink>
                                                    </p:column>
                                                </p:dataTable> 
                                            </div>
                                        </div>
                                        <div class="col-lg-12 col-xs-12" style="font-size:12px; margin-top: 10px;">                                                    
                                            <h:outputText value="Destino del documento :"/>
                                            <h:selectOneMenu value="#{ordenCompraBean.idCategoriaSelccionada}">
                                                <f:selectItems value="#{ordenCompraBean.listaCategoriaEts}" />
                                            </h:selectOneMenu>                        
                                            <p:commandButton value="Adjuntar lo seleccionado" 
                                                               action="#{ordenCompraBean.guardarSeleccionEts(event)}"                                                           
                                                               styleClass="btn btn-default"
                                                               />
                                            <p:commandButton 
                                                value="Adjuntar todo" 
                                                action="#{ordenCompraBean.guardarTodoEts(event)}" 
                                                styleClass="btn btn-default"/>
                                        </div>
                                    </h:panelGroup>
                                    <h:panelGroup id="ETSLocal">
                                        <div class="col-lg-12 col-xs-12" style="font-size:12px; margin-top: 10px;">                                                    
                                            <h:outputText value="Destino :"/>
                                            <h:selectOneMenu value="#{ordenCompraBean.idCategoriaSelccionada}" >
                                                <f:selectItems value="#{ordenCompraBean.listaCategoriaEts}" />
                                            </h:selectOneMenu>                       
                                        </div>
                                        <div class="col-lg-12 col-xs-12" style="font-size:12px; margin-top: 10px;">   
                                            <h:outputText value="No se permiten los siguientes caracteres en el nombre del Archivo:" 
                                                            style=" font-size: 12px; font-weight: bold;" 
                                                            rendered="#{ordenCompraBean.idCategoriaSelccionada != -1}"/>
                                            <h:outputText value="#{ordenCompraBean.simbolos}" 
                                                            style="color: red; font-size: 12px; font-weight: bold; alignment-adjust: central;" 
                                                            rendered="#{ordenCompraBean.idCategoriaSelccionada != -1}"/>
                                        </div>
                                        <div class="col-lg-12 col-xs-12" style="font-size:12px; margin-top: 10px;">                                                                                            
                                            <h:outputText value="Clasificación:"/>
                                            <p:fileUpload id="fileEntryComp" 
                                                           styleClass="btn btn-default"
                                                           label="Archivo"
                                                           listener="#{ordenCompraBean.uploadFile}"/>
                                            <h:commandButton  styleClass="btn btn-default" id="uploadFile" value="Subir"/>
                                        </div>
                                    </h:panelGroup>
                                </p:panel>
                            </div>
                            <div class="col-lg-12 col-xs-12" style="font-size:12px; margin-top: 10px;">   
                                <div class="col-lg-12 col-xs-12">
                                    <div class="table table-responsive">
                                        <p:dataTable size="small" stripedRows="true" showGridlines="true"  value="#{ordenCompraBean.listaOcOrdenEts}" var="ets"
                                                       styleClass="table table-striped">
                                            <p:column >
                                                <f:facet name="header"><h:outputLabel value="Categoría"/></f:facet>
                                                <h:outputText value="#{ets.categoria}"/>
                                            </p:column>         
                                            <p:column>
                                                <f:facet name="header">
                                                    <h:outputLabel value="Nombre"/>
                                                </f:facet>
                                                <h:outputText value="#{ets.nombreSinUUID}"/>
                                            </p:column>
                                            <p:column>
                                                <f:facet name="header">
                                                    <h:outputLabel value="Tamaño"/>
                                                </f:facet>
                                                <h:outputText  value="#{ets.peso}"/>
                                            </p:column>
                                            <p:column>                                        
                                                <h:outputLink styleClass="link"
                                                              id="abrir"
                                                              target="_blank" 
                                                              title="Click aqui para abrir el archivo..." 
                                                              value="/Compras/AbrirArchivo?ZWZ2W=#{ets.id}&amp;ZWZ3W=#{ets.uuid}">
                                                    <h:outputText value=" Abrir"/>
                                                </h:outputLink>                                        
                                            </p:column>
                                            <p:column>                                                                                    
                                                <p:commandLink id="eliminar" value="Eliminar"
                                                                 styleClass="link"                                                     
                                                                 action="#{ordenCompraBean.eliminarEtsOrden(actionEvent)}" 
                                                                 title="Click aqui para eliminar el archivo..." 
                                                                 onclick="if (!confirm('Está seguro de eliminar el archivo #{ets.nombreSinUUID} ...? '))
                                                                             return false;">
                                                    <f:param name="idRelacionEliminar" value="#{ets['idEtsOrden']}" />
                                                </p:commandLink>                                        
                                            </p:column>
                                        </p:dataTable> 
                                    </div>
                                </div>
                            </div>
                        </div>                               
                    </div>
                    <div class="modal-footer">
                        <p:commandButton  value="Cerrar"
                                            styleClass="btn btn-default"
                                            onclick="$(dialogoCargarEts).modal('hide');"
                                            title="Cerrar ventana sin modificar..."/>                                    
                    </div>
                </h:form>
            </div>
        </div>
    </div>
    <!-- agregar item convenio-->
    <div class="modal fade" id="dialogoItemConvenio" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog" style="width: 90%;">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Agregar Items de convenios</h4>
                </div>
                <h:form id="frmDialogoItemConvenio">
                    <div class="modal-body panel panel-footer">                                
                        <div class="row">
                            <div class="col-lg-12" id="tablaResBusquedaAv">
                                <!<!-- rowSelectListener="#{ordenCompraBean.seleccionarArticuloConvenio}" -->
                                <p:dataTable size="small" stripedRows="true" showGridlines="true" value="#{ordenCompraBean.listaConvenioArticuloVo}" var="data"
                                               id="tblArticuloConvenio"                                                                                   
                                               rowStyleClass="table table-bordered table-striped"
                                               rows="20" paginator="true"  
                                               paginatorPosition="bottom" 
                                               selectionMode="single"
                                               >
                                    <p:column headerText="Código" styleClass="resultadoBdaCodigo">
                                        <h:outputText value="#{data.codigoInt}"/>
                                    </p:column>
                                    <p:column headerText="Contrato" style="width: 15%;">
                                        <h:outputText value="#{data.convenio}"/>
                                    </p:column>
                                    <p:column headerText="Nombre" style="text-align: left; width: 85%" styleClass="resultadoBdaNombre">
                                        <h:outputText value="#{data.nombre}"/>
                                    </p:column> 
                                </p:dataTable>
                            </div>                 
                        </div>
                        <div  class="row" >
                            <div class="col-lg-6" >
                                <ui:fragment rendered="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C'}">
                                    <div class="form-group col-lg-12">
                                        <h:outputText value="Actividad petrolera:" styleClass="control-label col-lg-2"/>
                                        <div class="col-lg-10">
                                            <h:selectOneMenu styleClass="form-control" value="#{ordenCompraBean.itemActual.ocActividadPetrolera.id}" 
                                                             >
                                                <f:selectItem itemLabel="Seleccione . . . " itemValue="0"/>
                                                <f:selectItems value="#{ordenCompraBean.listaMapa.get('actividad')}"/>
                                                <f:ajax event="valueChange" render="@this idProyecto idTipoTarea nombreTipoObra nombreSubTarea" 
                                                        listener="#{ordenCompraBean.seleccionarActividad}"/>
                                            </h:selectOneMenu>
                                        </div>
                                    </div>
                                    <div class="form-group col-lg-12">
                                        <h:outputText value="Proyecto:" styleClass="control-label col-lg-2"/>
                                        <div class="col-lg-10">                                                            
                                            <h:selectOneMenu id="idProyecto" value="#{ordenCompraBean.itemActual.proyectoOt.id}" styleClass="form-control">
                                                <f:selectItem itemLabel="Seleccione . . . " itemValue="0"/>
                                                <f:selectItems value="#{ordenCompraBean.listaMapa.get('proyecto')}"/>
                                                <f:ajax render="@this idTipoTarea nombreTipoObra nombreSubTarea" listener="#{ordenCompraBean.seleccionarProyecto}"/>
                                            </h:selectOneMenu>
                                        </div>
                                    </div>
                                    <ui:fragment rendered="#{ordenCompraBean.ordenActual.tipo eq 'PS'}">
                                        <div class="form-group col-lg-12">
                                            <h:outputText value="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C' ? 'SubActividad:' : 'Tipo Tarea:' }" styleClass="control-label col-lg-2"/>
                                            <div class="col-lg-10">
                                                <h:selectOneMenu id="idTipoTarea" value="#{ordenCompraBean.itemActual.ocUnidadCosto.id}" styleClass="form-control"
                                                                 >
                                                    <f:selectItem itemLabel="Seleccione . . . " itemValue="0"/>
                                                    <f:selectItems value="#{ordenCompraBean.listaMapa.get('tipoTarea')}"/>
                                                    <f:ajax render="@this nombreTipoObra nombreSubTarea" listener="#{ordenCompraBean.seleccionarTipoTarea}"/>
                                                </h:selectOneMenu>
                                            </div>
                                        </div>
                                    </ui:fragment>
                                </ui:fragment>
                                <ui:fragment rendered="#{ordenCompraBean.ordenActual.tipo eq 'PS'}">
                                    <div class="form-group col-lg-12">
                                        <h:outputText value="Tarea:" styleClass="control-label col-lg-2"/>
                                        <div class="col-lg-10">
                                            <h:selectOneMenu id="nombreTipoObra"  value="#{ordenCompraBean.idTarea}" styleClass="form-control">
                                                <f:selectItem itemValue="0" itemLabel="Seleccione . . . " />
                                                <f:selectItems value="#{ordenCompraBean.listaMapa.get('tarea')}"/>
                                                <f:ajax render="@this nombreSubTarea" listener="#{ordenCompraBean.seleccionarTarea}"/>
                                            </h:selectOneMenu>
                                        </div>
                                    </div>
                                </ui:fragment>
                                <ui:fragment rendered="#{ordenCompraBean.ordenActual.apCampo.tipo eq 'C' and ordenCompraBean.ordenActual.tipo eq 'PS'}">
                                    <div class="form-group col-lg-12">
                                        <h:outputText value="SubTarea:" styleClass="control-label col-lg-2"/>
                                        <div class="col-lg-10">
                                            <h:selectOneMenu id="nombreSubTarea"  value="#{ordenCompraBean.itemActual.ocSubTarea.id}" styleClass="form-control">
                                                <f:selectItem itemValue="0" itemLabel="Seleccione . . . " />
                                                <f:selectItems value="#{ordenCompraBean.listaMapa.get('subTarea')}"/>
                                            </h:selectOneMenu>
                                        </div>
                                    </div>
                                </ui:fragment>
                                <div class="col-lg-12 form-group">
                                    <div class="input-group col-lg-12">
                                        <h:outputText styleClass="col-lg-2 control-label" value="Cantidad:" style="margin-top: 5px;"/>  
                                        <div class="col-lg-3">
                                            <h:inputText  id="cantidad" styleClass="form-control" value="#{ordenCompraBean.itemActual.cantidad}"/>
                                        </div>
                                        <h:outputText styleClass="col-lg-1" value="P.U.:" style="text-align: right; margin-top: 5px;" /> 
                                        <div class="col-lg-3">
                                            <h:outputText id="precioUnitario" styleClass="form-control" value="#{ordenCompraBean.itemActual.precioUnitario}"/>
                                        </div>                                                                      
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 input-group" >
                                <div class="col-lg-12 input-group">
                                    <div class="form-group">
                                        <div class="form-group col-lg-12">
                                            <div class="form-group col-lg-6">
                                                <h:outputText styleClass="col-lg-2" value="N/P: " /> 
                                                <div class="col-lg-10">
                                                    <h:outputLabel id="codigo" value="#{ordenCompraBean.itemActual.invArticulo.codigoInt}"/>
                                                </div>
                                            </div>
                                            <div class="form-group col-lg-6">
                                                <h:outputText styleClass="col-lg-4 control-label" value="Unidad: "/>
                                                <div class="col-lg-8">
                                                    <h:outputLabel id="unidad" 
                                                                   value="#{ordenCompraBean.itemActual.invArticulo.unidad.nombre}"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group col-lg-12">
                                    <h:outputText styleClass="col-lg-2 control-label" value="Artículo:" /> 
                                    <div class="col-lg-10">
                                        <h:outputLabel  id="nombre" value="#{ordenCompraBean.itemActual.invArticulo.nombre}"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-10">
                                <div class="form-group col-lg-10">
                                    <h:outputText styleClass="col-lg-2 control-label" value="Obs. Navision:" /> 
                                    <div class="col-lg-10">
                                        <h:inputTextarea styleClass="form-control" value="#{ordenCompraBean.itemActual.textNav}"/>

                                    </div>
                                </div>
                                <div class="form-group col-lg-10 ">
                                    <h:outputText styleClass="col-lg-2 control-label" value="Observaciones:" /> 
                                    <div class="col-lg-10">
                                        <h:inputTextarea styleClass="form-control" value="#{ordenCompraBean.itemActual.observaciones}"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <h:commandButton styleClass="btn btn-info" value="Guardar"
                                         action="#{ordenCompraBean.completarAgregarItemConvenio(actionEvent)}"/>
                        <h:commandButton value="Cancelar" styleClass="btn btn-default"
                                         action="#{ordenCompraBean.cerrarAgregarItemConvenio(actionEvent)}"
                                         title="Cerrar ventana..."  immediate="true"/>                                    
                    </div>
                </h:form>
            </div>
        </div>
    </div>
</ui:composition>
