<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"

      xmlns:h="http://xmlns.jcp.org/jsf/html">

    <body>

        <ui:composition template="./../templates/template.xhtml">
            <ui:define name="tituloPagina">
                Requisiciones en espera
            </ui:define>
            <ui:define name="contenido">        
                <!--MOTIVO REQ ESOERA-->
                <div class="modal fade" id="dialogoMsgEsperaReq" data-backdrop="static" data-keyboard="false">
                    <div class="modal-dialog" style="width: 70%;">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">Mensaje requisición en espera</h4>
                            </div>

                            <h:form id="frmMsgEsperaRecep">
                                <div class="modal-body">                                    
                                    <div class="row">
                                        <div class="form-group panel">
                                            <h:outputLabel class="col-12 control-label" value="Escriba el mensaje"/>
                                            <div class="col-12">
                                                <h:inputTextarea  id="motivoCancelo" cols="80"  
                                                                  value="#{requisicionBean.msgEspera}" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <p:commandButton id="buttonAceptarMsgEspera"
                                                     value="Aceptar"
                                                     styleClass="btn btn-info"
                                                     action="#{requisicionBean.guardarMsgEspera}"
                                                     onclick="return validaCancelar('frmMsgEsperaRecep', 'motivoCancelo', 'La operación guardara el mensaje. ¿Está seguro?', 'Es necesario agregar el mensaje.')"/>
                                    <p:commandButton id="buttonCancelarMsgEspera"
                                                     value="Cancelar"
                                                     styleClass="btn btn-default"
                                                     onclick="cerrarDialogoModal(dialogoMsgEsperaReq);"                                                           
                                                     title="Cerrar ventana..." />

                                </div>
                            </h:form>
                        </div>
                    </div>
                </div>

                <!--ADD Adjunto-->
                <div class="modal fade" id="dialogoAdjuntoEsperaReq" data-backdrop="static" data-keyboard="false">
                    <div class="modal-dialog" style="width: 70%;">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">Adjuntar archivo a requisición en espera</h4>
                            </div>

                            <h:form id="frmAdjuntoEsperaRecep">
                                <div class="modal-body">                                    
                                    <div class="row">
                                        <div class="col-12 col-xs-12" style="font-size:12px; margin-top: 10px;">                                                    
                                            <h:outputText styleClass="col-12 col-xs-12 control-label" value="Busca un archivo en tu computadora, luego presiona el boton Subir para enviar los datos al servidor."/>
                                            <h:outputText styleClass="col-6 col-xs-12 control-label" value="No se permiten los siguientes caracteres en el nombre del Archivo:" style=" font-size: 12px; font-weight: bold;" />
                                            <h:outputText styleClass="col-6 col-xs-12 control-label" value="&acute; ! ¡ &ldquo; &rdquo; # $ % &amp;  / \ = ¿ ? ' &lsquo; &rsquo;  &gt; &lt; { } [ ]" style="color: red; font-size: 12px; font-weight: bold; text-align: left;" />
                                        </div>
                                        <div class="col-12 col-xs-12" style="font-size:12px; margin-top: 10px;">                                                    
                                            <p:fileUpload id="fileEntryComp" 
                                                          label="Archivo "
                                                          listener="#{cargaEtsBean.uploadFileEspera}"
                                                          styleClass="col-11 col-xs-12 btn btn-default"/>
                                            <p:commandButton id="uploadFileEspera" 
                                                             value="Subir" 
                                                             styleClass="col-1 col-xs-12 btn btn-default"
                                                             onclick="#{cargaEtsBean.setRequi(true)}"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">                                    
                                    <p:commandButton id="buttonCancelarAdjuntoEspera"
                                                     value="Cancelar"
                                                     styleClass="btn btn-default"
                                                     onclick="cerrarDialogoModal(dialogoAdjuntoEsperaReq);"                                                           
                                                     title="Cerrar ventana..." />

                                </div>
                            </h:form>
                        </div>
                    </div>
                </div>



                <ui:include src="../Requisiciones/fragmentos/popUpRequisicion.xhtml"/>      

                <h:form id="form1">                    
                    <!--h:outputText id="outputText0" value="Seleccione una requisición de la lista para ver sus Items por favor..."/-->                    
                    <div class="row">
                        <div id="divOperacion" class="btn-group col-8" style="text-align: left; display: none;">                                
                            <div class="col-2">                            
                                <p:commandLink value="Regresar" styleClass="btn btn-default" 
                                               action="#{requisicionBean.limpiarRequisicion}"
                                               onclick="regresar('divTabla', 'divDatos', 'divOperacion', 'divAutoriza')"/>                                                                
                            </div>
                            <div class="col-3">                            
                                <p:commandLink value="Activar Requisición" styleClass="btn btn-default" 
                                               action="#{requisicionBean.activarRequisicion}"
                                               title="Clic aquí para reactivar la requisición..."
                                               onclick="return confirmar('form1', '¿Está usted seguro de querer reactivar la requisición? ');"/>                                                                
                            </div>
                            <div class="col-3">                            
                                <p:commandLink value="Agregar mensaje" styleClass="btn btn-default" 
                                               action="#{requisicionBean.abrirMsgEspera}"
                                               title="Clic aquí para agregar comentario a espera de la requisición..."
                                               />                                                                
                            </div>
                            <div class="col-3">                            
                                <p:commandLink value="Adjuntar Archivo" styleClass="btn btn-default" 
                                               action="#{requisicionBean.abrirAdjuntoEspera}"
                                               title="Clic aquí para adjuntar un archivo a la espera de la requisición..."
                                               />                                                                
                            </div>
                        </div>                            
                        <div id="divAutorizaa" class="form-group col-9" style="text-align: center;">

                        </div>

                    </div>                        
                    <div id="divTabla" class="container-fluid"> 
                        <div>
                            <span id="msgAsignaRequisicion" style="color: red;" class="textoRojo"></span>
                        </div>
                        <div>
                            <h:message for="msgAsignaRequisicion" style="color: red;" infoClass="infoMessage" errorClass="errorMessage" />
                        </div>
                        <div class="row">
                            <div class="col-12">
                                <div class="table table-responsive">

                                    <p:dataTable size="small" stripedRows="true" showGridlines="true" id="dataTableEnEspera" 
                                                 value="#{requisicionBean.requisicionesEnEspera}" 
                                                 var="currentRow" styleClass="table table-striped">

                                        <p:column headerText="Código" style="text-align: center; width: 10%;">
                                            <h:outputText value="#{currentRow['consecutivo']}"/>                                            
                                        </p:column>                        
                                        <p:column headerText="Solicita">
                                            <h:outputText value="#{currentRow['solicita']}"/>                                            
                                        </p:column>
                                        <p:column headerText="Gerencia" style="text-align: center; width: 15%;" filterBy="#{currentRow.gerencia}" filterMatchMode="contains">
                                            <h:outputText value="#{currentRow['gerencia']}"/>                                            
                                        </p:column>
                                        <p:column headerText="Referencia">
                                            <h:outputText value="#{currentRow['referencia']}"/>                                            
                                        </p:column>
                                        <p:column headerText="Solicitada" style="text-align: center; width: 5%;">
                                            <h:outputText value="#{currentRow['fechaSolicitada']}">
                                                <f:convertDateTime dateStyle="default" type="date"/>
                                            </h:outputText>                                            
                                        </p:column>
                                        <p:column headerText="Requerida" style="text-align: center; width: 5%;">
                                            <h:outputText value="#{currentRow['fechaRequerida']}">
                                                <f:convertDateTime dateStyle="default" type="date"/>
                                            </h:outputText>                                            
                                        </p:column>
                                        <p:column headerText="Prioridad" style="text-align: center; width: 5%;">
                                            <h:outputText value="#{currentRow['prioridad']}"/>                                            
                                        </p:column>
                                        <p:column style="text-align: center; width: 5%;">
                                            <p:commandLink value="Seleccionar" style="color: blue" 
                                                           action="#{requisicionBean.seleccionarRequisicion(currentRow.id)}"
                                                           title="Clic aquí para ver los items de la requisición..."
                                                           onclick="$('#msgAsignaRequisicion').text('');
                                                                   return true;"
                                                           process="@this" update="form1:tbReqEsp form1.lblReq">
                                            </p:commandLink>                                            
                                        </p:column>
                                    </p:dataTable>


                                </div>
                            </div>  
                        </div>   
                        <!-- aqui va el panel oculto de mas informacion de la requisición -->
                    </div>

                    <div id="divDatos" style="display: none;">
                        <div class="col-5" style="padding-top: 5px;">
                            <h:outputText value="Más información de la requisición: "/>
                            <h:outputText id="lblReq" value="#{requisicionBean.requisicionActual.consecutivo}" style="font-weight:  bold;"/>
                        </div><br/>
                        <div class="container-fluid">
                            <p:tabView id="tbReqEsp" activeIndex="0">
                                <p:tab title="Más información">
                                    <ui:include src="../Requisiciones/fragmentos/masInfoNoAccion.xhtml"/>
                                </p:tab>
                                <p:tab title="ETS">
                                    <ui:include src="../Requisiciones/verETS.xhtml"/>
                                </p:tab>
                                <p:tab title="Estatus">
                                    <ui:include src="../Requisiciones/verEstatus.xhtml"/>
                                </p:tab>
                                <p:tab title="Devoluciones">
                                    <ui:include src="../Requisiciones/verDevoluciones.xhtml"/>
                                </p:tab> 
                                <p:tab title="En Espera">
                                    <ui:include src="../Requisiciones/verEnEspera.xhtml"/>
                                </p:tab>
                            </p:tabView>                            
                        </div>                      
                    </div>
                </h:form>
            </ui:define>
        </ui:composition>
    </body>
</html>
