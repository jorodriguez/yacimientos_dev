<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                >
    <!-- Modal Panel para mostrar el detalle de la factura-->
    <div class="modal fade" id="dialogoConsultaFactura" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog" style="width: 70%;">
            <h:form id="frmConsFactura">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Datos de la factura</h4>
                    </div>
                    <div class="modal-body card-body">
                        <div class="form-group col-12">                            
                            <p:tabView  style="font-size: 0.9em;">
                                <p:tab title="Datos generales" >
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="form-group">
                                                <h:outputLabel value="Folio" class="control-label col-12"/>
                                                <div class="col-10">
                                                    <h:outputText value="#{exportarFacturaBean.facturaVo.folio}"/>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <h:outputLabel value="Concepto" class="control-label col-12"/>
                                                <div class="col-10">
                                                    <h:outputText value="#{exportarFacturaBean.facturaVo.concepto}"/>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <h:outputLabel value="Monto" class="control-label col-12"/>
                                                <div class="col-10">
                                                    <h:outputText value="#{exportarFacturaBean.facturaVo.monto}">
                                                        <f:convertNumber groupingUsed="true" maxFractionDigits="4" type="currency"
                                                                         pattern="#,###.0000"/>
                                                    </h:outputText>
                                                    #{exportarFacturaBean.facturaVo.moneda}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="form-group">
                                                <h:outputLabel value="Proveedor" class="control-label col-12"/>
                                                <div class="col-12">
                                                    <h:outputText value="#{exportarFacturaBean.facturaVo.proveedor}"/>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <h:outputLabel value="Emisión" class="control-label col-10"/>
                                                <div class="col-12">
                                                    <h:outputText value="#{exportarFacturaBean.facturaVo.fechaEmision}">
                                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                                    </h:outputText>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <h:outputLabel value="Carta CN" class="control-label col-12"/>
                                                <div class="col-12">
                                                    <h:outputLabel value="No CN" style="font-style: italic;" 
                                                                   rendered="#{exportarFacturaBean.facturaVo.idAdjunto eq 0}"/>
                                                    <h:outputLink   style="color: blue;"
                                                                    rendered="#{exportarFacturaBean.facturaVo.uuId ne null}"
                                                                    target="_blank"  
                                                                    id="abrirReq"
                                                                    title="Click aqui para abrir el archivo..." 
                                                                    value="/Compras/AbrirArchivo?ZWZ2W=#{exportarFacturaBean.facturaVo.idAdjunto}&amp;ZWZ3W=#{exportarFacturaBean.facturaVo.uuId}">
                                                        <h:outputText value=" Abrir"/>
                                                    </h:outputLink>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </p:tab>
                                <p:tab title="Partidas">
                                    <p:dataTable size="small" stripedRows="true" showGridlines="true" value="#{exportarFacturaBean.facturaVo.detalleFactura}" var="dataDetFac"
                                                   >
                                        <f:facet name="header">Partidas facturadas</f:facet>
                                        <p:column headerText="Descripción" style="text-align: justify">
                                            #{dataDetFac.descripcion}
                                        </p:column>
                                        <p:column headerText="Cantidad">
                                            #{dataDetFac.cantidad}
                                        </p:column>
                                        <p:column headerText="Precio">
                                            <h:outputText value="#{dataDetFac.precio}">
                                                <f:convertNumber groupingUsed="true" maxFractionDigits="4" type="currency"
                                                                 pattern="#,###.0000"/>
                                            </h:outputText>
                                        </p:column>
                                        <p:column headerText="Importe">
                                            <h:outputText value="#{dataDetFac.importe}" style="#{empty dataDetFac.descripcion ? 'font-size: 1.2em; font-weight: bold;' :''}">
                                                <f:convertNumber groupingUsed="true" maxFractionDigits="4" type="currency"
                                                                 pattern="#,###.0000"/>
                                            </h:outputText>
                                        </p:column>
                                    </p:dataTable>
                                </p:tab>                                
                                <p:tab title="Evidencias / Soportes">
                                    <p:dataTable size="small" stripedRows="true" showGridlines="true" value="#{exportarFacturaBean.listaArchivosFactura}" var="dataFac">
                                        <p:column headerText="Tipo">
                                            #{dataFac.tipo}
                                        </p:column>
                                        <p:column headerText="Nombre">
                                            #{dataFac.adjuntoVo.nombre}
                                        </p:column>
                                        <p:column >
                                            <h:outputLink   style="color: blue;"
                                                            target="_blank"  
                                                            id="abrirReq"
                                                            title="Click aqui para abrir el archivo..." 
                                                            value="/Compras/AbrirArchivo?ZWZ2W=#{dataFac.adjuntoVo.id}&amp;ZWZ3W=#{dataFac.adjuntoVo.uuid}">
                                                <h:outputText value=" Abrir"/>
                                            </h:outputLink>
                                        </p:column>
                                    </p:dataTable>
                                </p:tab>
                                <p:tab title="Contenido Nacional">
                                    <p:dataTable size="small" stripedRows="true" showGridlines="true" value="#{exportarFacturaBean.contenidoNacional}" var="dataCN">
                                        <p:column headerText="Código">
                                            #{dataCN.codigoCatalogoHidro}
                                        </p:column>
                                        <p:column headerText="Descripción de bienes y/o servicios" >
                                            <p style="#{dataCN.id gt 0 ? 'text-align: left;' : 'text-align: right; font-weight: bold;'}"> 
                                                <h:outputText value="#{dataCN.nombreCatalogoHidro}" />
                                            </p>
                                        </p:column>
                                        <p:column headerText="Cont. Nac.">                                            
                                            #{dataCN.proporcionContenido}
                                        </p:column>
                                        <p:column headerText="Monto Facturado Acumulado por año"  style="text-align: right;">
                                            <h:outputText value="#{dataCN.montoFacturado}" >
                                                <f:convertNumber groupingUsed="true" maxFractionDigits="4" type="currency"
                                                                 pattern="#,###.0000"/>
                                            </h:outputText>
                                            <b>
                                                <h:outputText rendered="#{dataCN.id eq 0}" value="#{dataCN.totalMontoFacturado}" style="text-align: right;">
                                                    <f:convertNumber groupingUsed="true" maxFractionDigits="4" type="currency"
                                                                     pattern="#,###.0000"/>
                                                </h:outputText>
                                            </b>
                                        </p:column>
                                    </p:dataTable>
                                </p:tab>
                                <p:tab title="Nota(s) de crédito">
                                    <p:dataTable size="small" stripedRows="true" showGridlines="true" value="#{exportarFacturaBean.listaNotaCredito}" var="dataNota">
                                        <p:column headerText="Folio">
                                            #{dataNota.folio}
                                        </p:column>
                                        <p:column headerText="Concepto">
                                            #{dataNota.concepto}
                                        </p:column>
                                        <p:column headerText="Monto CN">
                                            <h:outputText value="#{dataNota.monto}">
                                                <f:convertNumber groupingUsed="true" maxFractionDigits="4" type="currency"
                                                                 pattern="#,###.0000"/>
                                            </h:outputText>
                                        </p:column>
                                        <p:column>
                                            <p:commandLink action="#{exportarFacturaBean.seleccionarNotaCredito(dataNota.id)}"
                                                           process="@this" update="frmNotaCre">
                                                <i class="fa fa-cog text-primary"/>
                                            </p:commandLink>
                                        </p:column>
                                    </p:dataTable>
                                </p:tab>
                            </p:tabView>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <p:commandLink value="Cerrar" class="btn btn-default"  onclick="$(dialogoConsultaFactura).modal('hide');"/>
                    </div>
                </div>
            </h:form>
        </div>
    </div>
    <!-- Modal Panel para mostrar el detalle de la factura-->
    <div class="modal fade" id="dialogoNotaCredito" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog">
            <h:form id="frmNotaCre">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Archivos Nota de Crédito</h4>
                    </div>
                    <div class="modal-body">
                        <p:dataTable size="small" stripedRows="true" showGridlines="true" value="#{exportarFacturaBean.listaArchivosNotaCredito}" var="dataNota"
                                       >
                            <p:column headerText="Tipo">
                                #{dataNota.tipo}
                            </p:column>
                            <p:column headerText="Nombre">
                                #{dataNota.adjuntoVo.nombre}
                            </p:column>
                            <p:column >
                                <h:outputLink   style="color: blue;"
                                                target="_blank"  
                                                id="abrirReq"
                                                title="Click aqui para abrir el archivo..." 
                                                value="/Compras/AbrirArchivo?ZWZ2W=#{dataNota.adjuntoVo.id}&amp;ZWZ3W=#{dataNota.adjuntoVo.uuid}">
                                    <h:outputText value=" Abrir"/>
                                </h:outputLink>
                            </p:column>
                        </p:dataTable>
                    </div>
                    <div class="modal-footer">
                        <p:commandLink value="Cerrar" class="btn btn-default"  onclick="$(dialogoNotaCredito).modal('hide');"/>
                    </div>
                </div>
            </h:form>
        </div>
    </div>
</ui:composition>