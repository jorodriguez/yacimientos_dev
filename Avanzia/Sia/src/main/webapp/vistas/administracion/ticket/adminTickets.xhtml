<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"  
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <body>

        <ui:composition template="./../../../WEB-INF/facelets/templates/templateGrupos.xhtml">
            <h:panelGroup  rendered="#{empty sesion.usuario}" styleClass="altura">
                <ui:include src="./../../../login.xhtml"/>
            </h:panelGroup>
            <ui:define name="contenido">
                <div id="page">
                    <div class="row">
                        <ui:include src="../menuAdministracion.xhtml" rendered="#{not empty sesion.usuario}" />
                    </div>
                    <div class="col-lg-12 col-xs-12">
                        <div class="col-lg-4"></div>
                        <div class="col-lg-6">
                            <h2 class="page-header">Administración de Tickets</h2>
                        </div>
                    </div>
                    <h:form id="frmTickets">
                        <div class="form-row">
                            <div class="col-lg-11"></div>
                            <div class="col-lg-1">
                                <h:commandLink actionListener="#{administracionTicketBean.refrescarTickets(event)}" 
                                               class="btn btn-primary"                                                        
                                               >
                                    <i class="glyphicon glyphicon-refresh"/>                                        
                                </h:commandLink>
                            </div>
                        </div>                        
                        <div class="form-row">
                            <div class="col-lg-12">
                                <p:dataTable value="#{administracionTicketBean.incidencias}" var="dataInc"
                                               paginator="true"  paginatorAlwaysVisible="true" paginatorPosition="bottom"
                                               rows="10">
                                    <p:column headerText="Código">
                                        <h:outputText value="#{dataInc.codigo}"/>
                                    </p:column>
                                    <p:column headerText="Nivel">
                                        <h:outputText value="#{dataInc.codigoNivel}"/>
                                    </p:column>
                                    <p:column headerText="Título" style="width: 10%;">
                                        <h:outputText value="#{dataInc.titulo}"/>
                                    </p:column>
                                    <p:column headerText="Descripción" styleClass="text-left" style="text-align: left;">
                                        <h:outputText value="#{dataInc.descripcion}" />
                                    </p:column>
                                    <p:column headerText="Fecha" styleClass="text-left">
                                        <h:outputText value="#{dataInc.fechaGenero}">
                                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Hora" styleClass="text-left">
                                        <h:outputText value="#{dataInc.horaGenero}"/>
                                    </p:column>
                                    <p:column headerText="Asig.">
                                        <span class="fa fa-dot-circle-o #{empty dataInc.asignado ? 'text-danger' : 'text-primary'}"
                                              title="#{empty dataInc.asignado ? 'Sin asignar' : 'Asignado'}"/>
                                    </p:column>
                                    <p:column>
                                        <h:commandLink actionListener="#{administracionTicketBean.mostrarAdjuntos(e)}"
                                                       title="Mostrar datos ticket">
                                            <i class="fa fa-eye text-primary"></i>
                                            <f:param name="idTicket" value="#{dataInc.idIncidencia}"/>
                                        </h:commandLink>					
                                    </p:column>
                                    <p:column>
                                        <h:commandLink actionListener="#{administracionTicketBean.inicioAsignarTickect(e)}"
                                                       title="Asignar el ticket" >
                                            <i class="fa fa-user text-primary"></i>
                                            <f:param name="idTicket" value="#{dataInc.idIncidencia}"/>
                                        </h:commandLink>					
                                    </p:column>
                                    <p:column>
                                        <h:commandLink actionListener="#{administracionTicketBean.inicioEscalarTicket(e)}"
                                                       title="Escalar el ticket" rendered="#{dataInc.idEstado eq 1220 and dataInc.codigoNivel eq '1N'
                                                                                             and dataInc.escalado eq false}">
                                            <i class="fa fa-arrow-up text-primary"></i>
                                            <f:param name="idTicket" value="#{dataInc.idIncidencia}"/>
                                        </h:commandLink>					
                                    </p:column>
                                    <p:column>
                                        <h:commandLink actionListener="#{administracionTicketBean.inicioFinalizarTickect(e)}"
                                                       title="Finalizar el ticket" rendered="#{dataInc.idEstado eq 1220 }">
                                            <i class="fa fa-check text-primary"></i>
                                            <f:param name="idTicket" value="#{dataInc.idIncidencia}"/>
                                        </h:commandLink>					
                                    </p:column>
                                </p:dataTable>
                            </div>
                        </div>
                    </h:form>

                    <div class="modal fade" id="dialogoAdjuntosTickt" data-backdrop="static" data-keyboard="false">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4 class="modal-title">Datos de Ticket # #{administracionTicketBean.incidenciaVo.codigo}</h4>
                                </div>
                                <h:form id="frmArchTick">
                                    <div class="modal-body">
                                        <div class="form-row">
                                            <div class="col-lg-6">
                                                <div class="form-group">
                                                    <h:outputLabel value="Generó:" styleClass="control-label"/> 
                                                    <div >
                                                        <h:outputText value="#{administracionTicketBean.incidenciaVo.genero}"/>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <h:outputLabel value="F. Generó:" styleClass="control-label"/> 
                                                    <div >
                                                        <h:outputText value="#{administracionTicketBean.incidenciaVo.fechaGenero}">
                                                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                                                        </h:outputText>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <h:outputLabel value="Categoría: " styleClass="control-label"/> 
                                                    <div >
                                                        <h:outputText value="#{administracionTicketBean.incidenciaVo.categoriaIncidencia}"/>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <h:outputLabel value="Código" styleClass="control-label"/> 
                                                    <div >
                                                        <h:outputText value="#{administracionTicketBean.incidenciaVo.codigoCategoria}"/>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-6">
                                                <div class="form-group">
                                                    <h:outputLabel value="Título:" styleClass="control-label"/> 
                                                    <div >
                                                        <h:outputText value="#{administracionTicketBean.incidenciaVo.titulo}"/>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <h:outputLabel value="Descripción:" styleClass="control-label"/> 
                                                    <div >
                                                        <h:outputText value="#{administracionTicketBean.incidenciaVo.descripcion}"/>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <h:outputLabel value="Asignado" styleClass="control-label"/> 
                                                    <div >
                                                        <h:outputText value="#{administracionTicketBean.incidenciaVo.asignado}"/>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <h:outputLabel value="Nivel" styleClass="control-label"/> 
                                                    <div >
                                                        <h:outputText value="#{administracionTicketBean.incidenciaVo.nivel}"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <p:dataTable value="#{administracionTicketBean.incidenciasAdjunto}" var="dataAdj"
                                                           rowIndexVar="index">
                                                <p:column headerText="Evidencia">
                                                    <h:outputLink target="_blank"  
                                                                  value="/Sia/AbrirArchivo?ZWZ2W=#{dataAdj.id}&amp;ZWZ3W=#{dataAdj.uuid}">
                                                        <h:outputText value="#{dataAdj.nombre}" styleClass="text-primary"/>
                                                    </h:outputLink>
                                                </p:column>
                                            </p:dataTable>
                                        </div>                                    
                                    </div>
                                    <div class="modal-footer">
                                        <h:commandLink value="Cancelar" immediate="true"
                                                       styleClass="btn btn-default"
                                                       onclick="$(dialogoAdjuntosTickt).modal('hide');"
                                                       title="Cerrar ventana de asignar de tickets..."/>
                                    </div>
                                </h:form>
                            </div>
                        </div>
                    </div>
                    <div class="modal fade" id="dialogoAsignarTickt" data-backdrop="static" data-keyboard="false">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4 class="modal-title">Asignar Tickets</h4>
                                </div>
                                <h:form id="frmAsigTick">
                                    <div class="modal-body">
                                        <div class="form-row">
                                            <h:outputLabel value="Usuario:*"/>
                                            <h:selectOneMenu value="#{administracionTicketBean.idAsignado}" styleClass="form-control">
                                                <f:selectItems value="#{administracionTicketBean.asignados}"/>
                                            </h:selectOneMenu>
                                        </div>                                    
                                    </div>
                                    <div class="modal-footer">
                                        <h:commandLink value="Cancelar" immediate="true"
                                                       styleClass="btn btn-default"
                                                       onclick="$(dialogoAsignarTickt).modal('hide');"
                                                       title="Cerrar ventana de asignar de tickets..."/>
                                        <h:commandLink value="Guardar y enviar"
                                                       styleClass="btn btn-primary"
                                                       actionListener="#{administracionTicketBean.asignarTickect(e)}"
                                                       title="Asignar de tickets..."/>
                                    </div>
                                </h:form>
                            </div>
                        </div>
                    </div>
                    <div class="modal fade" id="dialogoFinalizarTickt" data-backdrop="static" data-keyboard="false">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4 class="modal-title">Finalizar Tickets</h4>
                                </div>
                                <h:form id="frmFinTick">
                                    <div class="modal-body">
                                        <div class="form-row">
                                            <h:outputLabel value="Solución:*"/>
                                            <h:inputTextarea id="txtSol" value="#{administracionTicketBean.solucion}" styleClass="form-control"
                                                             rows="5">                                            
                                            </h:inputTextarea>
                                            <h:message for="txtSol" errorClass="text-danger"/>
                                        </div>  
                                        <div class="form-row">
                                            <h:outputText class="control-label" value="Tiempo:"/>
                                            <div >
                                                <h:selectOneMenu value="#{administracionTicketBean.duracion}"
                                                                 styleClass="form-control">
                                                    <f:selectItem itemLabel="15" itemValue="15"/>
                                                    <f:selectItem itemLabel="30" itemValue="30"/>
                                                    <f:selectItem itemLabel="45" itemValue="45"/>
                                                    <f:selectItem itemLabel="60" itemValue="60"/>
                                                    <f:selectItem itemLabel="75" itemValue="75"/>
                                                    <f:selectItem itemLabel="90" itemValue="90"/>
                                                    <f:selectItem itemLabel="105" itemValue="105"/>
                                                    <f:selectItem itemLabel="120" itemValue="120"/>
                                                    <f:selectItem itemLabel="135" itemValue="135"/>
                                                    <f:selectItem itemLabel="150" itemValue="150"/>
                                                    <f:selectItem itemLabel="165" itemValue="165"/>
                                                    <f:selectItem itemLabel="180" itemValue="180"/>
                                                </h:selectOneMenu>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <h:commandLink value="Cancelar" immediate="true"
                                                       styleClass="btn btn-default"
                                                       onclick="$(dialogoFinalizarTickt).modal('hide');"
                                                       title="Cerrar ventana de finalizar de tickets..."/>
                                        <h:commandLink value="Guardar y enviar"
                                                       styleClass="btn btn-primary"
                                                       actionListener="#{administracionTicketBean.finalizarTickect(e)}"
                                                       title="Finalizar de tickets..."/>
                                    </div>
                                </h:form>
                            </div>
                        </div>
                    </div>

                    <div class="modal fade" id="dialogoEscalarTickt" data-backdrop="static" data-keyboard="false">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4 class="modal-title">Escalar Ticket</h4>
                                </div>
                                <h:form id="frmEscTick">
                                    <div class="modal-body">
                                        <div class="form-row">
                                            <h:outputLabel value="Motivo:*"/>
                                            <h:inputTextarea id="txtMot" value="#{administracionTicketBean.incidenciaVo.motivoEscala}"
                                                             rows="5" styleClass="form-control"
                                                             required="true" requiredMessage="Es necesarioa agregar un motivo"/>
                                            <h:message for="txtMot" errorClass="text-danger small"/>
                                        </div>                                    
                                    </div>
                                    <div class="modal-footer">
                                        <h:commandLink value="Cancelar" immediate="true"
                                                       styleClass="btn btn-default"
                                                       onclick="$(dialogoEscalarTickt).modal('hide');"
                                                       title="Cerrar ventana de escalar ticket ..."/>
                                        <h:commandLink value="Escalar"
                                                       styleClass="btn btn-primary"
                                                       actionListener="#{administracionTicketBean.escalarTickect(e)}"
                                                       title="Escalar ticket ..."/>
                                    </div>
                                </h:form>
                            </div>
                        </div>
                    </div>
                </div>
            </ui:define>
        </ui:composition>

    </body>
</html>
