<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"       
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      >
    <body>
        <ui:composition template="./../../../WEB-INF/facelets/templates/templateGrupos.xhtml">
            <h:panelGroup  rendered="#{empty sesion.usuario}" styleClass="altura">
                <ui:include src="./../../../login.xhtml"/>
            </h:panelGroup>
            <ui:define name="contenido">
                <div id="page">
                    <div class="row">
                        <ui:include src="../menuAdministracion.xhtml" rendered="#{not empty sesion.usuario}" />
                    </div>
                    <div class="row"> 
                        <h:form id="frmRelPro" rendered="#{not empty sesion.usuario}" styleClass="textoIzquierda">
                            <div class="col-lg-12">
                                <div class="col-lg-4"></div>
                                <div class="col-lg-6">
                                    <h2 class="page-header">#{msgs['sia.proveedor.compania.titulo']}</h2>
                                </div>
                            </div>
                            <div class="col-lg-12 col-xs-12">
                                <h:outputLabel value="#{msgs['orden.proveedor']}"/>
                                <p:inputText id="autocomplete"
                                               size="40"            
                                               onclick="autocompletar(this, 'hidenDes', 'frmRelPro');">
                                </p:inputText>
                                <h:inputHidden id="hidenDes" value="#{proveedorBean.idProveedor}"/>  
                                <h:commandLink value="#{msgs['sistema.aceptar']}" id="btnFiltro" 
                                               actionListener="#{proveedorBean.buscarCompaniaPorProveedor(event)}"
                                               style="display: none;"/>
                            </div>
                            <h:messages style="color: red;"/>
                            <div class="col-lg-12 col-xs-12">
                                <p:tabView >
                                    <p:tab title="Datos" >
                                        <div class="col-lg-12">
                                            <div class="col-lg-2">
                                                <p:commandLink value="Modificar datos" styleClass="btn btn-primary" style="color: white; font-weight: bold;"
                                                                 onclick="mostrarDialogoModificarProveedor('dialogoProveedor', 'frmProveedor', 'btnCerrar', 'btnGuardar', 'proveedor');"
                                                                 rendered="#{proveedorBean.proveedorVo ne null}"/>
                                            </div>
                                            <div class="col-lg-2">
                                                <h:commandLink value="Enviar contraseña" styleClass="btn btn-primary"
                                                               style="color: white; font-weight: bold;"
                                                               onclick="$(dialogoCambiarPassProveedor).modal('show');"
                                                               rendered="#{proveedorBean.proveedorVo ne null}"/>
                                            </div>

                                        </div>

                                        <p:panelGrid columns="2">
                                            <h:outputText value="Nombre"/>
                                            <h:outputLabel value="#{proveedorBean.proveedorVo.nombre}"/>
                                            <h:outputText value="País"/>
                                            <h:outputLabel value="#{proveedorBean.proveedorVo.pais}"/>
                                            <h:outputText value="Estado"/>
                                            <h:outputLabel  value="#{proveedorBean.proveedorVo.estado}"/>
                                            <h:outputText value="Ciduad"/>
                                            <h:outputLabel  value="#{proveedorBean.proveedorVo.ciudad}"/>
                                            <h:outputText value="Colonia"/>
                                            <h:outputLabel  value="#{proveedorBean.proveedorVo.colonia}"/>
                                            <h:outputText value="Calle"/>
                                            <h:outputLabel  value="#{proveedorBean.proveedorVo.calle}"/>
                                            <h:outputText value="Número"/>
                                            <h:outputLabel  value="#{proveedorBean.proveedorVo.numero}"/>
                                            <h:outputText value="Código"/>
                                            <h:outputLabel  value="#{proveedorBean.proveedorVo.codigoPostal}"/>					    
                                        </p:panelGrid>
                                    </p:tab>
                                    <p:tab title="Compania">
                                        <h:panelGrid columns="3">
                                            <h:panelGrid columns="2">
                                                <h:outputLabel value="#{msgs['presupuesto.nuevos.campoCompania']}"/>
                                                <p:selectOneMenu value="#{proveedorBean.rfcCompania}">
                                                    <f:selectItems value="#{proveedorBean.listaCompaniaPorUsuario}"/>
                                                </p:selectOneMenu>
                                            </h:panelGrid>
                                            <h:panelGrid columns="2">
                                                <h:outputLabel value="#{msgs['sia.proveedor.referencia']} "/>
                                                <p:inputText value="#{proveedorBean.numeroReferencia}" size="10" id="numRef"/>
                                            </h:panelGrid>
                                            <p:panelGrid columns="1">
                                                <h:commandLink title="#{msgs['sia.proveedor.agregar.relacion.tooltip']}" value="#{msgs['sistema.guardar']}" 
                                                               actionListener="#{proveedorBean.agregarRelacion(event)}"
                                                               styleClass="btn btn-info" onclick="return validaAgregarRelacion();">
                                                </h:commandLink>
                                            </p:panelGrid>
                                        </h:panelGrid>
                                        <p:panelGrid id="pnlGriTitulo"  style="text-align: center;">
                                            <h:outputLabel  id="cjNombreProveedor" />
                                            <p:dataTable value="#{proveedorBean.listaCompaniaPorPorveedor}" var="cp">
                                                <p:column headerText="#{msgs['sia.proveedor.rfc']}">
                                                    <h:outputLabel value="#{cp.rfcCompania}"/>
                                                </p:column>
                                                <p:column headerText="#{msgs['presupuesto.nuevos.campoCompania']}">
                                                    <h:outputLabel value="#{cp.nombre}"/>
                                                </p:column>
                                                <p:column headerText="#{msgs['sia.proveedor.referencia']}">
                                                    <h:inputText value="#{cp.numeroReferencia}" rendered="#{cp.editar}"/>
                                                    <h:outputLabel value="#{cp.numeroReferencia}" rendered="#{cp.editar eq false}"/>
                                                </p:column>
                                                <p:column headerText="">
                                                    <p:commandLink value="#{msgs['presupuesto.nuevos.modificar']}" style="color: blue; "
                                                                     actionListener="#{proveedorBean.modificar(event)}"
                                                                     rendered="#{cp.editar eq false}">
                                                    </p:commandLink>
                                                    <p:panelGrid columns="2" >
                                                        <h:commandLink value="#{msgs['sistema.guardar']}" style="color: blue; "
                                                                       actionListener="#{proveedorBean.guardar(event)}" 
                                                                       onclick="return confirmar('#{msgs['sia.proveedor.mensaje.guardar.confirmar']}');"
                                                                       rendered="#{cp.editar}"/> 
                                                        <p:commandLink value="#{msgs['sistema.cancelar']}" style="color: blue; "
                                                                         actionListener="#{proveedorBean.cancelar(event)}"
                                                                         rendered="#{cp.editar}"/>
                                                    </p:panelGrid>
                                                </p:column>
                                                <p:column >
                                                    <h:commandLink value="#{msgs['sistema.eliminar']}" style="color: blue;"
                                                                   actionListener="#{proveedorBean.eliminar(event)}"
                                                                   >
                                                    </h:commandLink>
                                                </p:column>
                                            </p:dataTable>
                                        </p:panelGrid>
                                    </p:tab>
                                    <p:tab title="Contáctos">
                                        <p:panelGrid rendered="#{proveedorBean.idProveedor gt 0}">
                                            <h:commandLink title="Agregar contacto"  
                                                           onclick="mostrarDialogoContacto('dialogoContacto', 'frmAgregarConta', 'btnCerrar', 'btnGuardar');"
                                                           styleClass="btn btn-default">
                                                <p:graphicImage url="./resources/imagenes/button_create.png" 
                                                                  styleClass="imagenSinBorde"/>
                                            </h:commandLink>
                                            <p:commandLink value="Agregar contacto" 
                                                             onclick="mostrarDialogoContacto('dialogoContacto', 'frmAgregarConta', 'btnCerrar', 'btnGuardar');"
                                                             styleClass="linkPequenio" />
                                        </p:panelGrid>
                                        <br/>
                                        <p:dataTable value="#{proveedorBean.listaContactoPorPorveedor}" var="cp">
                                            <f:facet name="header">Contactos</f:facet>
                                            <p:column headerText="Nombre">
                                                <h:inputText value="#{cp.nombre}" rendered="#{cp.editar}"/>
                                                <h:outputLabel value="#{cp.nombre}" rendered="#{cp.editar eq false}"/>
                                            </p:column>
                                            <p:column headerText="Teléfono">
                                                <h:inputText value="#{cp.telefono}" rendered="#{cp.editar}"/>
                                                <h:outputText value="#{cp.telefono}" rendered="#{cp.editar eq false}"/>
                                            </p:column>
                                            <p:column headerText="Correo">
                                                <h:inputTextarea cols="55" value="#{cp.correo}" rendered="#{cp.editar}"/>
                                                <h:outputText  value="#{cp.correo}" rendered="#{cp.editar eq false}"/>
                                            </p:column>
                                            <p:column>
                                                <p:commandLink value="#{msgs['presupuesto.nuevos.modificar']}" style="color: blue; "
                                                                 actionListener="#{proveedorBean.modificarContacto(event)}"
                                                                 rendered="#{cp.editar eq false}">
                                                    <f:param name="idContacto" value="#{cp.idContactoProveedor}"/>
                                                </p:commandLink>     
                                                <p:panelGrid columns="2" >
                                                    <h:commandLink value="#{msgs['sistema.guardar']}" style="color: blue; "
                                                                   actionListener="#{proveedorBean.completarModificarContacto(event)}" 
                                                                   onclick="return confirmar('La operación va a cambiar los datos del contacto. ¿está seguro?');"
                                                                   rendered="#{cp.editar}"/> 
                                                    <p:commandLink value="#{msgs['sistema.cancelar']}" style="color: blue; "
                                                                     actionListener="#{proveedorBean.cancelarModificarContacto(event)}"
                                                                     rendered="#{cp.editar}"/>
                                                </p:panelGrid>
                                            </p:column>
                                            <p:column>
                                                <p:commandLink value="#{msgs['sistema.eliminar']}" style="color: blue;"
                                                                 actionListener="#{proveedorBean.eliminarContacto(event)}">
                                                    <f:param name="contacto" value="#{cp.idContactoProveedor}"/>
                                                </p:commandLink>
                                            </p:column>
                                        </p:dataTable>

                                    </p:tab>
                                </p:tabView>
                            </div>
                        </h:form>
                        <div id="dialogoContacto" style="display: none;" title="Agregar contacto">
                            <h:form id="frmAgregarConta">
                                <p:panelGrid columns="2">
                                    <h:outputText value="Nombre: *"/>    
                                    <p:inputText size="50" value="#{proveedorBean.contacto}" required="true" requiredMessage="Es necesario agregar el nombre"/>
                                    <h:outputText value="Teléfono: "/>    
                                    <p:inputText size="50" value="#{proveedorBean.telefono}" />
                                    <h:outputText value="Correo: *"/>    
                                    <p:inputText  id="correo" size="50" value="#{proveedorBean.correo}" required="true" requiredMessage="Es necesario agregar el correo"
                                                    />
                                </p:panelGrid>
                                <h:outputText value="*Si hay más de un correo, separarlo por comas." style="font-size: small; color: maroon;"/>

                                <h:commandLink  id="btnGuardar" styleClass="btn btn-info" style="display: none;" 
                                                actionListener="#{proveedorBean.agregarContacto(event)}"/>
                                <h:commandButton id="btnCerrar" style="display: none;" actionListener="#{proveedorBean.cancelarAgregarContacto(event)}"
                                                 immediate="true"/>
                            </h:form>
                        </div>
                        <!-- Datos del proveedor -->
                        <div id="dialogoProveedor" style="display: none;" title="Datos del proveedor">
                            <h:form id="frmProveedor">
                                <p:panelGrid columns="2" >
                                    <h:outputText value="Nombre: *"/>
                                    <p:inputText id="proveedor" value="#{proveedorBean.proveedorVo.nombre}" size="40"/>
                                    <h:outputText value="País:"/>
                                    <p:inputText  value="#{proveedorBean.proveedorVo.pais}" size="40"/>
                                    <h:outputText value="Estado:"/>
                                    <p:inputText  value="#{proveedorBean.proveedorVo.estado}" size="40"/>
                                    <h:outputText value="Ciduad:"/>
                                    <p:inputText  value="#{proveedorBean.proveedorVo.ciudad}" size="40"/>
                                    <h:outputText value="Colonia:"/>
                                    <p:inputText  value="#{proveedorBean.proveedorVo.colonia}" size="40"/>
                                    <h:outputText value="Calle:"/>
                                    <p:inputText  value="#{proveedorBean.proveedorVo.calle}" size="40"/>
                                    <h:outputText value="Número:"/>
                                    <p:inputText  value="#{proveedorBean.proveedorVo.numero}" size="40"/>
                                    <h:outputText value="Código:"/>
                                    <p:inputText  value="#{proveedorBean.proveedorVo.codigoPostal}" size="40"/>				    
                                    <h:outputText value="CCN:"/>
                                    <h:selectBooleanCheckbox value="#{proveedorBean.proveedorVo.carta}" />
                                    <h:outputText value="REPSE:"/>
                                    <h:selectBooleanCheckbox value="#{proveedorBean.proveedorVo.repse}" />
                                </p:panelGrid>			    
                                <h:commandLink id="btnGuardar" styleClass="btn btn-info" style="display: none;" 
                                               actionListener="#{proveedorBean.modificarDatosProveedor(event)}"/>
                                <h:commandButton id="btnCerrar" style="display: none;" immediate="true"/>
                            </h:form>
                        </div>
                    </div>
                </div>
                <!--  -->
                <div class="modal fade" id="dialogoCambiarPassProveedor">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                </button>
                                <h4 class="modal-title">Enviar contraseña</h4>
                            </div>
                            <h:form id="frmCambioPass">
                                <div class="modal-body">
                                    <div class="form-row">
                                        <small><b>*La contraseña se enviará todos los contactos del proveedor.</b></small>
                                    </div>
                                    <div class="form-row">
                                        <div class="table table-responsive">
                                            <p:dataTable value="#{proveedorBean.listaContactoPorPorveedor}" var="cp">
                                                <f:facet name="header">Contactos</f:facet>
                                                <p:column headerText="Nombre">
                                                    <h:outputLabel value="#{cp.nombre}"/>
                                                </p:column>
                                                <p:column headerText="Correo">
                                                    <h:outputText  value="#{cp.correo}"/>
                                                </p:column>
                                            </p:dataTable>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <h:commandLink class="btn btn-primary" actionListener="#{proveedorBean.enviarContraseña(event)}">
                                        <b>Enviar contraseña</b>
                                    </h:commandLink>
                                    <h:commandLink class="btn btn-default" onclick="$(dialogoCambiarPassProveedor).modal('hide');"
                                                   value="Cerrar">                                
                                    </h:commandLink>
                                </div>
                            </h:form>
                        </div>
                    </div>
                </div>
            </ui:define>


        </ui:composition>

    </body>
</html>
