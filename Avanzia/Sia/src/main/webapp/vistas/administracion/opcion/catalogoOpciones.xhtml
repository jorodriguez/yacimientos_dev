<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html" 
      xmlns:my="http://www.mytags.com/schema/mytags"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <h:body>
        <ui:composition  template="./../../../WEB-INF/facelets/templates/templateGrupos.xhtml">
            <h:panelGroup  rendered="#{empty sesion.usuario}" styleClass="altura">
		<ui:include src="./../../../login.xhtml"/>
	    </h:panelGroup>
	    <ui:define name="contenido">
		<div id="page">
		    <div class="row">
			<ui:include src="./../menuAdministracion.xhtml" rendered="#{not empty sesion.usuario}" />
		    </div>
		    <div class="row">
			<h:form rendered="#{not empty sesion.usuario}" styleClass="textoIzquierda" >
			    <center><h:messages errorClass="mensaje" infoClass="mensaje"/></center>  
			    <div class="col-lg-12">
				<div class="col-lg-4"></div>
				<div class="col-lg-6">
				    <h2 class="page-header">Catálogo de Opciones</h2>
				</div>
			    </div>

			    <div class="col-lg-12 col-xs-12">
				<p:card id="principal"> 
				    <f:facet name="west" >  
                                        <!--hideRootNode="false"
						      hideNavigation="false"
						      imageDir="./xmlhttp/css/xp/css-images/" >-->
					<h:panelGrid id="panelGridArbolOpciones" style="float: left; margin-left: 50px; "  >
					    <p:tree value="#{arbolOpcionesBean.arbolOpciones}" 
						      var="node">
						      
						<p:treeNode  transient="true">
						    <h:panelGroup style="display: inline"></h:panelGroup>
						    <f:facet name="content">  
							<p:commandLink   action="#{arbolOpcionesBean.recorrerArbol(node.userObject.text,node.userObject.idArchivo)}" rendered="#{node.userObject.idArchivo == 1 or node.userObject.idArchivo == 2}" >
							    <h:outputText value="#{node.userObject.text}"/>
							</p:commandLink >
							<h:outputText value="#{node.userObject.text}" rendered="#{node.userObject.text eq 'Modulos' or node.userObject.idArchivo == 3}" />
						    </f:facet>
						</p:treeNode>
					    </p:tree>
					</h:panelGrid>
				    </f:facet> 
				    <f:facet name="center"> 

					<p:dataTable id="Opciones" rows="10" 
						       styleClass="table table-bordered table-striped"
						       value="#{opcionBean.opcionesFiltradasInTabla}" var="currentRow" 
						       >
					<!-->    <my:dataGrid id="dataGridOpcion" rows="20"  value="#{arbolOpcionesBean.filtrarTabla()}" showPaginator="true" textoResultado="Mostrando opciones del " textoPagina="página" textoDe="de" >
					    <!-->    <p:column>  
						<f:facet name="header" >  
						    <h:selectBooleanCheckbox class="todos" id="idSelectTodo" 
									     onchange="seleccionarTodo('todos', 'seleccion')" parent="" />      
						</f:facet>
						<center>   
						    <h:selectBooleanCheckbox value="#{currentRow.selected}" class="seleccion"/> 
						</center>
					    </p:column>
					    <my:column columnName="nombre" headerValue="Nombre"
						       itemValue="#{currentRow.nombre}" isColumSort="true"/>
					    <p:column>
						<f:facet name="header">
						    <h:outputText value="Página"/>
						</f:facet>
						<h:outputText value="#{currentRow['pagina']}" />
					    </p:column>
					    <p:column>
						<h:commandLink value="Modificar" actionListener="#{opcionBean.mostrarPopupActualizar(actionEvent)}" styleClass="link" />
					    </p:column>
					    <p:column>
						<h:commandLink value="Eliminar" actionListener="#{opcionBean.mostrarPopupEliminar(actionEvent)}" styleClass="link" />
					    </p:column>
					</p:dataTable>
					


					<p:panelGrid columns="3" >
					    <p:panelGrid style="text-align: right" > 
						<p:commandLink type="submit" value="+" title="Crear Módulo" action="#{opcionBean.mostrarPopupCrearModulo(actionEvent)}" styleClass="btn btn-default" />  
					    </p:panelGrid>
					    <p:panelGrid columns="3" style="text-align: right">

						<p:selectOneMenu id="allRoles"  valueChangeListener="#{opcionBean.cargarRolSelecionado}" style="width: 150px"    value="#{opcionBean.nombreRolSeleccionado}"> 
						    <f:selectItem itemLabel="Seleccione..." itemValue="-1" /> 
						    <f:selectItems value="#{opcionBean.allRolListItem}" />
						</p:selectOneMenu>
						<p:commandButton title="Añadir Nuevo Rol" style="text-align: center" value="Añadir Rol" onclick="return validaRol('seleccion');" actionListener="#{opcionBean.addRol(actionEvent)}"/>
						<p:commandLink type="submit" value="+" title="Crear Rol" action="#{opcionBean.mostrarPopupCrearRol(actionEvent)}" styleClass="btn btn-default" /> 
					    </p:panelGrid>
					    <p:panelGrid columns="1"  style="text-align: right" >
						<p:commandLink type="submit" title="Crear Opción" action="#{opcionBean.mostrarPopupCrearOpcion(actionEvent)}" styleClass="btn btn-default" immediate="true">
						    <p:graphicImage url="resources/imagenes/button_create.png" alt="Crear Opción" styleClass="imagenSinBorde" width="16px" height="16px" />
						</p:commandLink>
						<p:commandLink value="Crear Opción" styleClass="linkPequenio" action="#{opcionBean.mostrarPopupCrearOpcion(actionEvent)}" />
					    </p:panelGrid>  
					</p:panelGrid >
				    </f:facet>
				</p:panel>

			    </div>
			</h:form>

			<h:form>
			    <my:panelPopup tituloPanel="Crear Opción" mostrarPanel="#{opcionBean.modalRenderedCrearOpcion}" conBoton="false" >
				<center><h:messages errorClass="mensaje" infoClass="mensaje"/></center>
				<p:panelGrid columns="2">
				    <h:outputLabel value="Módulo: " />
				    <h:outputText id="nombreModuloSeleccionado" value="#{opcionBean.nombreModuloSeleccionado}" style="width: 200px" styleClass="f11" />
				</p:panelGrid>
				<p:panelGrid columns="3">
				    <h:outputLabel value="Rol: "/>
				    <p:selectOneMenu id="idRol" value="#{opcionBean.nombreRolSeleccionado}" valueChangeListener="#{opcionBean.cargarRol}" style="width: 150px" disabled="#{!opcionBean.disableSiRol}"  > 
					<f:selectItem itemLabel="Seleccione..." itemValue="-1" />   
					<f:selectItems value="#{opcionBean.rolListItem}" />
				    </p:selectOneMenu> 
				    <p:selectBooleanCheckbox  title="sin rol" value="#{opcionBean.disableSiRol}" >
					<f:ajax event="change" rendered="idRol"/>
				    </p:selectBooleanCheckbox>
				    <h:outputLabel value="Opcion: "/>
				    <p:selectOneMenu value="#{opcionBean.nombreSiOpcionSeleccionada}"  valueChangeListener="#{opcionBean.cargarOpcionSelcionada}"  id="SiOpcion" disabled="#{!opcionBean.disableSiOpcion}" >
					<f:selectItem itemLabel="Seleccione..." itemValue="-1" />
					<f:selectItems value="#{opcionBean.opcionListItem}" /> 
				    </p:selectOneMenu>
				    <p:selectBooleanCheckbox  title="sin opcion padre" value="#{opcionBean.disableSiOpcion}" >
					<f:ajax event="change" rendered="SiOpcion"/>
				    </p:selectBooleanCheckbox>
				</p:panelGrid>
				<p:panelGrid columns="2">
				    <h:outputLabel value="Nombre: "/>
				    <p:inputText id="nombreOpcion" value="#{opcionBean.nombreOpcion}" style="width: 200px" styleClass="f11" maxlength="64"/>
				    <h:outputLabel value="Direción o Página: "/>
				    <p:inputText id="paginaOpcion" value="#{opcionBean.paginaOpcion}" style="width: 200px" styleClass="f11" maxlength="64" disabled="#{!opcionBean.disableSiOpcion}"/>      
				    <h:outputLabel value="Estatus Contar: "/>
				    <p:inputText id="estausContar" value="#{opcionBean.estatusContar}" style="width: 200px" styleClass="f11" maxlength="64" />   
				</p:panelGrid>
				<br />

				<center>
				    <p:panelGrid columns="2">
					<p:commandButton value="Crear" actionListener="#{opcionBean.crearOpcion(actionEvent)}" styleClass="btn btn-info" >
					    <f:ajax execute="principal"/>
					</p:commandButton>
					<p:commandButton value="Cancelar" actionListener="#{opcionBean.cancelarCrearOpcion(actionEvent)}" styleClass="btn btn-default"/>        
				    </p:panelGrid>                        
				</center>
			    </my:panelPopup>
			</h:form>        

			<h:form>
			    <my:panelPopup tituloPanel="Actualizar Opción" mostrarPanel="#{genericPanelPopup.modalRenderedActualizar}" conBoton="false">
				<center><h:messages errorClass="mensaje" infoClass="mensaje"/></center>  
				<table width="300px" cellpadding="0" cellspacing="0">
				    <tr>
					<td align="right"><h:outputLabel value="Nombre: "/></td>
					<td><p:inputText id="nombreOpcion" value="#{opcionBean.nombreOpcion}" style="width: 200px" styleClass="f11" maxlength="64"/></td>
				    </tr>
				    <tr>
					<td align="right"><h:outputLabel value="Página "/></td>
					<td><p:inputText id="rutaOpcion" value="#{opcionBean.paginaOpcion}" style="width: 200px" styleClass="f11" maxlength="64" /></td>
				    </tr>
				</table>
				<center>
				    <p:panelGrid columns="2">
					<p:commandButton value="Actualizar" actionListener="#{opcionBean.actualizarOpcion(actionEvent)}" styleClass="btn btn-info"/>
					<p:commandButton value="Cancelar" actionListener="#{opcionBean.cancelarActualizarOpcion(actionEvent)}" styleClass="btn btn-default"/>        
				    </p:panelGrid>                        
				</center>
			    </my:panelPopup>
			</h:form>

			<h:form>
			    <my:panelPopup tituloPanel="Eliminar Opcion" mostrarPanel="#{genericPanelPopup.modalRenderedEliminar}" conBoton="false">
				<center><h:messages errorClass="mensaje" infoClass="mensaje"/></center>  
				<p:panelGrid columns="3">
				    <h:outputText value="Está seguro que desea eliminar la Opción " />
				    <h:outputText value="#{opcionBean.opcionSeleccionada.nombre}" style="font-weight: bold;" />
				    <h:outputText value="?" />
				</p:panelGrid>

				<center>
				    <p:panelGrid columns="2">
					<p:commandButton value="Confirmar" actionListener="#{opcionBean.eliminarOpcion(actionEvent)}" styleClass="btn btn-info"/>
					<p:commandButton value="Cancelar" actionListener="#{opcionBean.cancelarEliminarOpcion(actionEvent)}" styleClass="btn btn-default"/>        
				    </p:panelGrid>                        
				</center>
			    </my:panelPopup>
			</h:form>

			<h:form>
			    <my:panelPopup tituloPanel="Crear Módulo" mostrarPanel="#{opcionBean.mrPopupCrearModulo}" conBoton="false" >
				<center><h:messages errorClass="mensaje" infoClass="mensaje"/></center>  

				<p:panelGrid columns="2" >
				    <p:panelGrid columns="2" >
					<h:outputLabel value="Nombre: " />
					<h:outputText value="*" styleClass="textoRojo" />
				    </p:panelGrid>
				    <p:panelGrid columns="2">
					<p:inputText id="nombreModulo" value="#{opcionBean.nombreOpcion}" maxlength="32" required="true" requiredMessage="Nombre es requerido" style="width: 200px" styleClass="f11" />                                
					<h:message for="nombreModulo" errorClass="errorMessage" infoClass="infoMessage"/>
				    </p:panelGrid>
				    <p:panelGrid columns="2" >
					<h:outputLabel value="Ruta " />
					<h:outputText value="*" styleClass="textoRojo" />
				    </p:panelGrid>
				    <p:panelGrid columns="2">
					<p:inputText id="rutaModulo" value="#{opcionBean.paginaOpcion}" maxlength="64" required="true" requiredMessage="Página es requerido" style="width: 200px" styleClass="f11" />                                
					<h:message for="rutaModulo" errorClass="errorMessage" infoClass="infoMessage"/>
				    </p:panelGrid>                              
				</p:panelGrid>                        

				<center>
				    <p:panelGrid columns="2">
					<p:commandButton value="Crear" actionListener="#{opcionBean.crearModulo(actionEvent)}" styleClass="btn btn-info"/>
					<p:commandButton value="Cancelar" actionListener="#{opcionBean.ocultarPopupCrearModulo(actionEvent)}" immediate="true" styleClass="btn btn-default"/>        
				    </p:panelGrid>                        
				</center>
			    </my:panelPopup>

			</h:form>

			<h:form>
			    <my:panelPopup tituloPanel="Crear Rol" mostrarPanel="#{opcionBean.mrPopupCrearRol}" conBoton="false" >
				<center><h:messages errorClass="mensaje" infoClass="mensaje"/></center>  

				<p:panelGrid columns="2" >
				    <p:panelGrid columns="2" >
					<h:outputLabel value="Nombre: " />
					<h:outputText value="*" styleClass="textoRojo" />
				    </p:panelGrid>
				    <p:panelGrid columns="2">
					<p:inputText id="nombreRol" value="#{opcionBean.nombreOpcion}" maxlength="32" required="true" requiredMessage="Nombre es requerido" style="width: 200px" styleClass="f11" />                                
					<h:message for="nombreRol" errorClass="errorMessage" infoClass="infoMessage"/>
				    </p:panelGrid>
				    <p:panelGrid columns="2" >
					<p:selectOneMenu id="ModulosSeleccion" >
					    <f:selectItem itemLabel="Seleccione..." itemValue="-1" /> 
					    <f:selectItems value="#{opcionBean.allRolListItem}" />
					</p:selectOneMenu>
				    </p:panelGrid>
				    <p:panelGrid columns="2">
					<p:inputText id="rutaModulo" value="#{opcionBean.paginaOpcion}" maxlength="64" required="true" requiredMessage="Página es requerido" style="width: 200px" styleClass="f11" />                                
					<h:message for="rutaModulo" errorClass="errorMessage" infoClass="infoMessage"/>
				    </p:panelGrid>                              
				</p:panelGrid>                        

				<center>
				    <p:panelGrid columns="2">
					<p:commandButton value="Crear" actionListener="#{opcionBean.crearRol(actionEvent)}" styleClass="btn btn-info"/>
					<p:commandButton value="Cancelar" actionListener="#{opcionBean.ocultarPopupCrearRol(actionEvent)}" immediate="true" styleClass="btn btn-default"/>        
				    </p:panelGrid>                        
				</center>
			    </my:panelPopup>

			</h:form>
		    </div>
		</div>
	    </ui:define>
	</ui:composition>
    </h:body>
</html>
