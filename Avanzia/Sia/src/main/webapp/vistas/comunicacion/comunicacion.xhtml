<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"

      xmlns:my="http://www.mytags.com/schema/mytags"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <body>
        <ui:composition>
            <h:panelGroup rendered="#{not empty sesion.usuario}">
                <h:form id="noticiaForm">
                    <br/>
                    <p:panelGrid columns="2"  >
                        <p:commandLink  title="#{msgs['comunicacion.clic.aqui.para']} #{msgs['comunicacion.ir.inicio']}" actionListener="#{noticiaBean.refrescarTodo(event)}" >
                            <p:graphicImage  value="/resources/imagenes/documento.png" styleClass="imagenSinBorde" alt="Inicio"/>
                        </p:commandLink>
                        <p:commandLink styleClass="fNegrita18"  value="Comunicados" title="#{msgs['comunicacion.clic.aqui.para']} #{msgs['comunicacion.ir.inicio']}" actionListener="#{noticiaBean.refrescarTodo(event)}" />
                    </p:panelGrid>
                    <h:panelGroup styleClass="buttonBorde"/>
                    <h:dataTable value="#{noticiaBean.noticias}" var="data" width="583px" cellpadding="0" cellspacing="0" >
                        <p:column>                             
                            <table >
                                <tr>
                                    <td valign="top" >
                                        <p:commandButton  styleClass="dimensionFotoComentario" icon="#{data['usuarioFoto']}" 
                                                          style="width: 40px; height: 28px;"/>
                                    </td>
                                    <td valign="top" width="500px" >
                                        <table>
                                            <tr>
                                                <td>
                                                    <h:commandLink styleClass="fNegrita12" value="#{data['usuarioNombre']}"/>
                                                </td>
                                                <td>
                                                    <h:outputText styleClass="fGris" value=" - "/>  
                                                </td>
                                                <td>
                                                    <h:outputText styleClass="fGris" value="#{data['fechaGenero']}">
                                                        <f:convertDateTime dateStyle="medium" type="date"/>
                                                    </h:outputText>
                                                </td>
                                                <td>
                                                    <h:outputText styleClass="fGris" value="#{data['horaGenero']}">
                                                        <f:convertDateTime pattern="h:mm a" timeStyle="default" type="time"/>
                                                    </h:outputText>
                                                </td>   
                                                <td>
                                                    <h:outputText styleClass="fGris" value=" - "/>  
                                                </td>  
                                                <td>
                                                    <h:outputLabel styleClass="fGris" value="#{data['privacidadNombre']}" 
                                                                   rendered="#{data['privacidadId'] eq 2}"/>  

                                                    <!-- rendered="#{data['privacidadId'] != 2} -->
                                                    <h:commandLink styleClass="fGris" value="Con límites"                                                        
                                                                   rendered="#{data['privacidadId'] != 2}"
                                                                   actionListener="#{noticiaBean.mostrarPopupUsuariosCompartidos(actionEvent)}"
                                                                   title="Usuarios compartidos"> 
                                                        <f:param name="idNoticia" value="#{data['id']}"/>
                                                    </h:commandLink>
                                                </td> 
                                            </tr>
                                        </table>
                                        <h:outputLabel styleClass="fNegrita12"  value="#{data['titulo']}" />
                                        <h:outputText styleClass="f11" value="#{data['mensaje']}" escape="false"/>                                        
                                        <h:outputText styleClass="fGris" value="#{data['mensajeAutomatico']}" escape="false"/>
                                        <ui:repeat value="#{data.listaComentario}" var="comentario">
                                            <div class="panelComentario">                                                
                                                <table>
                                                    <tr>
                                                        <td class="foto">
                                                            <p:commandButton styleClass="dimensionFoto"
                                                                             icon="#{comentario.usuarioFoto}"/>                                                            
                                                        </td>
                                                        <td class="respuesta">
                                                            <h:commandLink styleClass="fNegrita12" value="#{comentario.usuarioNombre}"/>
                                                            <h:outputText styleClass="fGris" value=" - "/> 
                                                            <h:outputText styleClass="f11" value="#{comentario.mensaje}"/>
                                                            <table>
                                                                <tr>
                                                                    <td>
                                                                        <h:outputText styleClass="fGris" value="#{comentario.fechaGenero}">
                                                                            <f:convertDateTime dateStyle="medium" type="date"/>
                                                                        </h:outputText>
                                                                    </td>
                                                                    <td>
                                                                        <h:outputText styleClass="fGris" value="#{comentario.horaGenero}">
                                                                            <f:convertDateTime pattern="h:mm a" timeStyle="default" type="time"/>
                                                                        </h:outputText>
                                                                    </td>   
                                                                    <td>
                                                                        <h:outputText styleClass="fGris" value=" - " />  
                                                                    </td>  
                                                                </tr>
                                                            </table>                                                                

                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </ui:repeat>
                                    </td>
                                </tr>
                            </table>
                            <h:panelGroup styleClass="buttonBorde"/>                            
                        </p:column>
                    </h:dataTable>  
                </h:form>

                <h:form rendered="#{not empty sesion.usuario}">
                    <my:panelPopup tituloPanel="#{msgs['sistema.modificar']} #{msgs['comunicacion.comentario']}"  mostrarPanel="#{noticiaBean.mrPopupModificarComentario}" conBoton="false">
                        <center><h:messages errorClass="mensaje" infoClass="mensaje"/></center>                             
                        <p:panelGrid columns="2">
                            <p:inputTextarea styleClass="textAreaModificarNoticia"  
                                             value="#{noticiaBean.comentarioActual.mensaje}" cols="40" rows="3"/>
                        </p:panelGrid>
                        <br/>
                        <center>
                            <p:panelGrid columns="2">                                
                                <p:commandLink actionListener="#{noticiaBean.modificarComentario(actionEvent)}"  value="#{msgs['sistema.guardar']}" styleClass="compartir"/>        
                                <p:commandLink actionListener="#{noticiaBean.ocultarPopupModificarComentario(actionEvent)}"  value="#{msgs['sistema.cerrar']}" styleClass="btn btn-default"/>        
                            </p:panelGrid>                        
                        </center>
                    </my:panelPopup>
                </h:form>

                <h:form rendered="#{not empty sesion.usuario}">
                    <my:panelPopup tituloPanel="#{msgs['sistema.modificar']} #{msgs['comunicacion.noticia']}"  mostrarPanel="#{noticiaBean.mrPopupModificarNoticia}" conBoton="false">
                        <center><h:messages errorClass="mensaje" infoClass="mensaje"/></center>                             
                        <p:panelGrid columns="2">
                            <p:inputTextarea styleClass="textAreaModificarNoticia" 
                                             value="#{noticiaBean.noticiaActual.mensaje}" cols="40" rows="3"/>
                        </p:panelGrid>
                        <br/>
                        <center>
                            <p:panelGrid columns="2">                                
                                <p:commandLink actionListener="#{noticiaBean.modificarNoticia(actionEvent)}"  value="#{msgs['sistema.guardar']}" styleClass="compartir"/>        
                                <p:commandLink actionListener="#{noticiaBean.ocultarPopupModificarNoticia(actionEvent)}"  value="#{msgs['sistema.cerrar']}" styleClass="btn btn-default"/>        
                            </p:panelGrid>                        
                        </center>
                    </my:panelPopup>
                </h:form>

                <!-- PANEL LIKE'S PERSON -->
                <h:form rendered="#{not empty sesion.usuario}">
                    <my:panelPopup tituloPanel="#{msgs['comunicacion.personas.que.les.gusta.esto']}"  mostrarPanel="#{noticiaBean.mrPopupLikePerson}" conBoton="false">                        
                        <p:panelGrid >
                            <c:forEach items="#{noticiaBean.likes}" var="data" 
                                       >
                                <h:panelGroup style="float: left;width: 200px" >
                                    <p:panelGrid columns="2" >
                                        <p:panelGrid>
                                            <p:commandButton styleClass="dimensionFoto" icon="#{data['fotoUsuario']}"/>
                                        </p:panelGrid>
                                        <p:panelGrid>
                                            <h:outputText styleClass="f12" value="#{data['nombreUsuario']}"/>                                                                                                                                                                                 
                                            <h:outputText  value="#{data['fechaGenero']}" styleClass="fGris" >
                                                <f:convertDateTime dateStyle="medium" type="date"/>
                                            </h:outputText>
                                            <h:outputText value="#{data['horaGenero']}" styleClass="fGris" >
                                                <f:convertDateTime pattern="h:mm a" timeStyle="default" type="time"/>
                                            </h:outputText>
                                        </p:panelGrid>
                                    </p:panelGrid>
                                </h:panelGroup>
                                </c:forEach>
                        </p:panelGrid>
                        <br/>
                        <center>
                            <p:panelGrid columns="2">                                                                    
                                <p:commandLink actionListener="#{noticiaBean.ocultarPopupLikes(actionEvent)}"  value="#{msgs['sistema.cerrar']}" styleClass="btn btn-default"/>        
                            </p:panelGrid>                        
                        </center>
                    </my:panelPopup>
                </h:form>

                <!-- card de compartidos se hizo en otro panle por la razon que podra mostrar grupos-->
                <h:form rendered="#{not empty sesion.usuario}">
                    <my:panelPopup tituloPanel="Compartidos"  mostrarPanel="#{noticiaBean.mrVerCompartidos}" conBoton="false">                        
                        <p:panelGrid  >
                            <c:forEach items="#{noticiaBean.likes}" var="data" >
                                <h:panelGroup style="float: left;width: 200px" >

                                    <p:panelGrid columns="2" >
                                        <p:panelGrid>
                                            <p:commandButton styleClass="dimensionFoto" icon="#{data['foto']}"/>
                                        </p:panelGrid>
                                        <p:panelGrid>
                                            <h:outputText styleClass="f12" value="#{data['nombre']}"/>                                                                                                                                                                                 
                                            <h:outputText  value="#{data['fechaGenero']}" styleClass="fGris" >
                                                <f:convertDateTime dateStyle="medium" type="date"/>
                                            </h:outputText>
                                            <h:outputText value="#{data['horaGenero']}" styleClass="fGris" >
                                                <f:convertDateTime pattern="h:mm a" timeStyle="default" type="time"/>
                                            </h:outputText>
                                        </p:panelGrid>
                                    </p:panelGrid>

                                </h:panelGroup>
                                </c:forEach>
                        </p:panelGrid>
                        <br/>
                        <center>
                            <p:panelGrid columns="2">                                                                    
                                <p:commandLink actionListener="#{noticiaBean.ocultarPopupUsuariosCompartidos(actionEvent)}"  value="#{msgs['sistema.cerrar']}" styleClass="btn btn-default"/>        
                            </p:panelGrid>                        
                        </center>
                    </my:panelPopup>
                </h:form>

                <!-- PANEL ADJUNTAR  -->
                <h:form rendered="#{not empty sesion.usuario}">
                <!--<my:panelPopup tituloPanel="Adjunta un archivo"  mostrarPanel="#{noticiaBean.mrSubirArchivo}" conBoton="false">                        -->
                    <p:dialog id="popup1" style="background: #FFFFFF;" visible="#{noticiaBean.mrSubirArchivo}" draggable="false" modal="true">
                        <f:facet name="header">
                            <h:panelGroup>
                                <!-- h -->                                  <h:outputText value="#{msgs['comunicacion.adjuntar.archivos']}" style="float: left; padding: 4px;text-align: center; vertical-align: middle;font: 11px;color: #484848; font-weight: bold;"/>
                            </h:panelGroup>
                        </f:facet>
                        <f:facet name="body">
                            <p:panelGrid columns="3">
                                <p:fileUpload id="fileEntryr"
                                              listener="#{noticiaBean.subirArchivo}" 
                                              title="#{msgs['sistema.subir.archivo']}"                                                   
                                              />
                                <h:commandButton type="submit" value="#{msgs['sistema.subir']}" > 
                                    <!--<input type="hidden" name="cid" 
                                    value="#{javax.enterprise.context.conversation.id}" /> -->
                                </h:commandButton>
                                <p:commandLink value="#{msgs['sistema.cancelar']}" styleClass="btn btn-default" 
                                               actionListener="#{noticiaBean.ocultarPopupSubirArchivo(event)}" immediate="true"/>
                            </p:panelGrid>
                        </f:facet>
                    </p:dialog>
                </h:form>
                <h:form rendered="#{not empty sesion.usuario}">
                    <my:panelPopup tituloPanel="#{msgs['comunicacion.archivos.adjuntos']}"  mostrarPanel="#{noticiaBean.mrVerAdjuntos}" conBoton="false">                        
                        <center><h:messages errorClass="mensaje" infoClass="mensaje"/></center>  
                        <p:panelGrid columns="2">
                            <my:dataGrid id="adjuntos" with="100%"                                             
                                         value="#{noticiaBean.dataModel}"

                                         >  
                                <p:column rendered="false">                                       
                                    <h:outputText value="#{data['idNoticiaAdjunto']}"/>                                                                              
                                </p:column>
                                <p:column>   
                                    <f:facet name="header" >
                                        <h:outputText value="#{msgs['adjunto.nombre']}"/>
                                    </f:facet>
                                    <h:outputText value="#{data['nombre']}"/>                                                                              
                                </p:column>                                                                        
                                <p:column>   
                                    <f:facet name="header" >
                                        <h:outputText value="#{msgs['sistema.peso']}"/>
                                    </f:facet>
                                    <h:outputText value="#{data['peso']}"/>                                                                              
                                </p:column>
                                <p:column>  
                                    <f:facet name="header" >
                                        <h:outputText value="#{msgs['sistema.fecha']}"/>
                                    </f:facet>
                                    <h:outputText value="#{data['fechaGenero']}" >
                                        <f:convertDateTime pattern="dd/MM/yyyy" />
                                    </h:outputText>
                                </p:column>
                                <p:column>
                                    <f:facet name="header" >
                                        <h:outputText value="#{msgs['sistema.hora']}"/>
                                    </f:facet>
                                    <h:outputText value="#{data['horaGenero']}" >
                                        <f:convertDateTime pattern="h:mm a" timeStyle="default" type="time"/>
                                    </h:outputText>
                                </p:column>
                                <p:column>                                        
                                    <h:commandLink value="#{msgs['sistema.eliminar']}" actionListener="#{noticiaBean.eliminarArchivo(event)}" rendered="#{data['genero'] eq sesion.usuario.id}" 
                                                   onclick="if (!confirm('Está seguro de eliminar el archivo #{data['nombre']} ...? '))
                                                               return false;"/>
                                    <f:param name="idCoNoticiaSiAdjunto" value="#{data['idNoticiaAdjunto']}"/>                                                                                
                                    <f:param name="idArchivo" value="#{data['id']}"/>                                                   
                                </p:column>
                                <p:column>      
                                    <h:outputLink target="_blank"  value="/Sia/AbrirArchivo?ZWZ2W=#{data['id']}&amp;ZWZ3W=#{data['uuid']}">
                                        <h:outputText value="#{msgs['sistema.abrir']}"/>
                                    </h:outputLink>
                                </p:column>
                            </my:dataGrid> 
                        </p:panelGrid>
                        <br/>
                        <center>
                            <p:commandLink value="#{msgs['sistema.cerrar']}" styleClass="btn btn-default" 
                                           actionListener="#{noticiaBean.ocultarPopupVerAdjuntos(actionEvent)}" immediate="true"/>
                        </center>
                    </my:panelPopup>
                </h:form>

            </h:panelGroup>

        </ui:composition>
    </body>
</html>