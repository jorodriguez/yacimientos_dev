<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:c="http://java.sun.com/jsp/jstl/core">

    <h:body>
        <ui:composition template="/vistas/template/template.xhtml">
            <ui:define name="content">
                <h:form id="form1">                    
                    <div class="container">
                        <div class="row">
                            <div class="form-group col-12" >
                                <strong><h:outputText class="col-2 control-label" value="Oficina:"/></strong>
                                <div class="col-10">                                            
                                    <p:selectOneMenu id="idOficina" styleClass="form-control"
                                                     value="#{configuracionBean.oficinaID}">
                                        <f:selectItem itemValue="0" itemLabel="Seleccione . . . "/>
                                        <c:forEach items="#{configuracionBean.oficinas}" var="ofic">
                                            <f:selectItem itemValue="#{ofic.id}" itemLabel="#{ofic.nombre}"/>
                                        </c:forEach>
                                        <p:ajax listener="#{configuracionBean.cambiarValorOficina}" update="form1:rutaOP"/>
                                    </p:selectOneMenu>
                                </div>
                            </div>
                        </div>
                        <div class="table table-responsive">
                            <p:dataTable id="rutaOP" rows="10" 
                                         value="#{configuracionBean.rutas}" var="currentRow" 
                                         size="small" showGridlines="true" paginator="true" paginatorPosition="bottom">                                                                                  
                                <p:column headerText="Id" width="3%">
                                    <h:outputText value="#{currentRow.id}"/>
                                </p:column>                                                        
                                <p:column>
                                    <h:outputText value="#{currentRow.nombre}" title="#{currentRow.etiquetaHorario}"/>
                                    <f:facet name="header">
                                        <h:outputText value="Nombre"/>
                                    </f:facet>
                                </p:column>                                                                                                        
                                <p:column width="5%">
                                    <h:outputText value="#{currentRow.tiempoViaje}"/>
                                    <f:facet name="header">
                                        <h:outputText value="Tiempo"/>
                                    </f:facet>
                                </p:column>  
                                <p:column width="15%">
                                    <h:outputText value="#{currentRow.tipo}"/>
                                    <f:facet name="header">
                                        <h:outputText value="Tipo"/>
                                    </f:facet>
                                </p:column>  
                                <p:column width="3%">
                                    <p:commandLink 
                                        action="#{popupGrBean.goEditRuta(currentRow.id)}"
                                        title="Click aquí para editar la zona..." 
                                        process="@this" update="frmRutas">
                                        <i class="fa fa-edit"></i>
                                    </p:commandLink>
                                </p:column>
                                <p:column width="3%">
                                    <p:commandLink 
                                        action="#{popupGrBean.goEditHorasRuta(currentRow.id)}"                                                            
                                        title="Click aquí para editar horarios de la ruta..." 
                                        process="@this" update="frmEditCodigoHorarios">
                                        <i class="fa fa-clock"></i>
                                    </p:commandLink>
                                </p:column>
                            </p:dataTable>
                            <!-- aqui va el paginador -->
                        </div>                                            
                    </div>
                </h:form>  
                <script>
                    $(document).ready(function () {
//                        startDate();
                    });
                </script>
                <div class="modal fade" id="dialogoRutas" data-backdrop="static" data-keyboard="false" style="color: black;">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">                    
                                <h4 class="modal-title">Registrar trayectos</h4>
                            </div>
                            <h:form id="frmRutas">
                                <div class="modal-body">
                                    <div style="margin-top: 10px;" class="col-12 col-xs-12">
                                        <h:message  for="" style="display: block;" infoClass="alert alert-success" warnClass="alert alert-warning"
                                                    errorClass="alert alert-danger" fatalClass="alert alert-danger"  />
                                    </div>   
                                    <div class="row">
                                        <div id="listRutaZonas" class="col-12 col-xs-12">
                                            <div class="input-group" >
                                                <strong><h:outputText class="col-2 col-xs-12 control-label" value="Zona/Sector: "/></strong>
                                                <div class="col-8 col-xs-12">                                            
                                                    <p:selectOneMenu id="idMapaRuta" 
                                                                     value="#{popupGrBean.rutaZonaID}"                                                               
                                                                     >
                                                        <f:selectItem itemValue="0" itemLabel="Seleccione . . . "/>
                                                        <f:selectItems value="#{popupGrBean.lstZonas}"/>
                                                    </p:selectOneMenu>
                                                </div>                                
                                                <div class="col-2 col-xs-12">
                                                    <p:commandLink id="addRuta"                                         
                                                                   styleClass="btn btn-info btn-lg text-white" 
                                                                   action="#{popupGrBean.guardarZonaRuta()}"
                                                                   process="@form" update="zonaROP idMapaRuta">                                        
                                                        <span class="fa fa-plus"></span>                                         
                                                    </p:commandLink>
                                                </div>
                                            </div>
                                            <div class="form-group col-12 col-xs-12" >                                    
                                                <p:dataTable id="zonaROP" rows="10" 
                                                             value="#{popupGrBean.rutaZonas}" var="currentRow" 
                                                             size="small" showGridlines="true">
                                                    <p:column>
                                                        <h:outputText value="#{currentRow.secuencia}"/>
                                                        <f:facet name="header">
                                                            <h:outputText value="Sec."/>
                                                        </f:facet>
                                                    </p:column>
                                                    <p:column>
                                                        <h:outputText value="#{currentRow.codigo}" title="#{currentRow.zona.descripcion}"/>
                                                        <f:facet name="header">
                                                            <h:outputText value="Código"/>
                                                        </f:facet>
                                                    </p:column>
                                                    <p:column>
                                                        <h:outputText value="#{currentRow.zona.nombre}" title="#{currentRow.zona.descripcion}"/>
                                                        <f:facet name="header">
                                                            <h:outputText value="Nombre"/>
                                                        </f:facet>
                                                    </p:column>
                                                    <p:column>
                                                        <h:outputText value="#{currentRow.fechaGenero}">
                                                            <f:convertDateTime dateStyle="default" type="date"/>
                                                        </h:outputText>
                                                        <f:facet name="header">
                                                            <h:outputText value="Fecha"/>
                                                        </f:facet>
                                                    </p:column>                                                    
                                                    <p:column>
                                                        <f:facet name="header">
                                                            <h:outputText value="Aprobar"/>
                                                        </f:facet>                                                
                                                        <b>Rojo</b>
                                                        <h:selectBooleanCheckbox id="cancelarR"   immediate="true"                                                                                                                                                
                                                                                 value="#{currentRow.cancelasr}" disabled="true"/>                                                
                                                    </p:column>                                            
                                                    <p:column>
                                                        <f:facet name="header">
                                                            <h:outputText value="Cancelar"/>
                                                        </f:facet>                                                                                                
                                                        <b>Negro</b>
                                                        <h:selectBooleanCheckbox id="cancelarN"   immediate="true"                                                                                                                                                
                                                                                 value="#{currentRow.cancelasn}" disabled="true"/>                                                
                                                    </p:column>                                            
                                                    <p:column>
                                                        <h:outputText value="#{currentRow.punto.nombre}" title="#{currentRow.punto.descripcion}"/>
                                                        <f:facet name="header">
                                                            <h:outputText value="P. Seguridad"/>
                                                        </f:facet>
                                                    </p:column>
                                                    <p:column width="3%">                                                   
                                                        <p:commandLink action="#{popupGrBean.goEditZonaRuta(currentRow.id)}"
                                                                       onclick="$(dialogoRutas).modal('show');"
                                                                       process="@this" update="frmRutas">                                        
                                                            <span class="fa fa-edit"></span> 
                                                        </p:commandLink>
                                                    </p:column>
                                                </p:dataTable>
                                            </div>        
                                        </div>
                                        <ui:fragment rendered="#{popupGrBean.rutaZonaVO != null}">
                                            <div id="editRutaZonaID" style="display: none;" class="col-12 col-xs-12">
                                                <div class="form-group col-12 col-xs-12" >
                                                    <div class="visible-lg col-3" ></div>
                                                    <strong><h:outputText class="col-2 col-xs-12 control-label" value="Nombre:"/></strong>
                                                    <div class="col-7 col-xs-12">                                            
                                                        <h:outputText                                             
                                                            styleClass="col-12 col-xs-12 control-label"                                            
                                                            value="#{popupGrBean.rutaZonaVO.zona.nombre}"
                                                            />  
                                                    </div>                                              
                                                </div>
                                                <div class="form-group col-12 col-xs-12" >
                                                    <div class="visible-lg col-3" ></div>
                                                    <strong><h:outputText class="col-2 col-xs-12 control-label" value="P. Seguridad:"/></strong>
                                                    <div class="col-4 col-xs-12">                                            
                                                        <p:selectOneMenu id="idPuntoS" styleClass="form-control"
                                                                         value="#{popupGrBean.rutaZonaVO.idPunto}"                                                               
                                                                         >
                                                            <f:selectItem itemValue="0" itemLabel="Seleccione . . . "/>
                                                            <f:selectItems value="#{popupGrBean.lstPuntos}"/>
                                                        </p:selectOneMenu>
                                                    </div>
                                                    <div class="visible-lg col-3" ></div>
                                                </div>                               
                                                <div class="form-group col-12 col-xs-12" >
                                                    <div class="visible-lg col-3" ></div>
                                                    <div class="col-4 col-xs-12 ">
                                                        <strong><h:outputText class="control-label" value="Aprobar viajes en semaforo rojo:"/></strong>
                                                    </div>
                                                    <div class="col-1 col-xs-12">                                            
                                                        <h:selectBooleanCheckbox                                             
                                                            styleClass="form-control"                                                                                                            
                                                            value="#{popupGrBean.rutaZonaVO.cancelasr}"
                                                            />                                           
                                                    </div>
                                                    <div class="visible-lg col-4" ></div>
                                                </div>     
                                                <div class="form-group col-12 col-xs-12" >
                                                    <div class="visible-lg col-3" ></div>
                                                    <div class="col-4 col-xs-12 ">
                                                        <strong><h:outputText class="control-label" value="Cancela viajes en semaforo negro:"/></strong>
                                                    </div>
                                                    <div class="col-1 col-xs-12" style="text-align: left;">                                            
                                                        <p:selectBooleanCheckbox                                             
                                                            styleClass="form-control"                                                                                                            
                                                            value="#{popupGrBean.rutaZonaVO.cancelasn}"
                                                            />                                           
                                                    </div>
                                                    <div class="visible-lg col-4" ></div>
                                                </div>     
                                                <div class="form-group col-12 col-xs-12" >
                                                    <div class="visible-lg col-3" ></div>
                                                    <strong><h:outputText class="col-2 col-xs-12 control-label" value="Secuencia:"/></strong>
                                                    <div class="col-4 col-xs-12">                                            
                                                        <p:inputText    id="valSecID"
                                                                        styleClass="form-control" maxlength="3" value="#{popupGrBean.rutaZonaVO.secuencia}"
                                                                        required="true" requiredMessage="Agregar la secuencia">                                                
                                                        </p:inputText>  
                                                    </div>      
                                                    <div class="visible-lg col-3" ></div>
                                                </div>
                                                <div class="form-group col-12 col-xs-12" >
                                                    <div class="visible-lg col-3" ></div>
                                                    <strong><h:outputText class="col-2 col-xs-12 control-label" value="Activa:"/></strong>
                                                    <div class="col-4 col-xs-12">                                            
                                                        <h:selectBooleanCheckbox                                             
                                                            styleClass="form-control"                                                                                                            
                                                            value="#{popupGrBean.rutaZonaVO.activa}"
                                                            />                                           
                                                    </div>
                                                    <div class="visible-lg col-3" ></div>
                                                </div>                                                               
                                            </div>
                                        </ui:fragment>
                                    </div>                        
                                </div>
                                <div class="modal-footer"> 
                                    <ui:fragment rendered="#{popupGrBean.rutaZonaVO != null}">
                                        <p:commandButton id="btnGuardarRutaZona"                                           
                                                         value="Guardar"
                                                         styleClass="btn btn-info"
                                                         action="#{popupGrBean.guardarZonaRutaDet}"                            
                                                         title="Click aquí para guardar la zona..." 
                                                         process="@form" update="zonaROP"/>
                                        <p:commandLink immediate="true"
                                                       onclick="$(dialogoRutas).modal('hide');"
                                                       value="Cerrar"
                                                       styleClass="btn btn-default"
                                                       action="#{popupGrBean.backEditZonaRuta(event)}"                            
                                                       title="Cerrar ventana..." 
                                                       />
                                    </ui:fragment>
                                    <ui:fragment rendered="#{popupGrBean.rutaZonaVO == null}">
                                        <p:commandLink immediate="true"
                                                       onclick="$(dialogoRutas).modal('hide');"
                                                       value="Cerrar"
                                                       styleClass="btn btn-default"                            
                                                       title="Cerrar ventana..." 
                                                       />
                                    </ui:fragment>
                                </div>
                            </h:form>
                        </div>
                    </div>
                </div>
                <div class="modal fade" id="dialogoEditRutaCodigosHorarios" data-backdrop="static" data-keyboard="false" style="color: black;">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">                    
                                <h4 class="modal-title">#{popupGrBean.tituloPopUp}</h4>
                            </div>  

                            <h:form id="frmEditCodigoHorarios">
                                <div class="modal-body">
                                    <div style="margin-top: 10px;" class="col-12 col-xs-12">
                                        <h:message  for="" style="display: block;" infoClass="alert alert-success" warnClass="alert alert-warning"
                                                    errorClass="alert alert-danger" fatalClass="alert alert-danger"  />
                                    </div> 
                                    <div class="row">
                                        <div class="col-12 col-xs-12">
                                            <div class="input-group" >                                    
                                                <strong><h:outputText class="col-12 control-label" value="Hora Min:"/></strong>
                                                <div class="input-group">
                                                    <div class="col-3">                                            
                                                        <h:selectOneMenu id="horaSalidaMin" 
                                                                         value="#{popupGrBean.horaMin}"
                                                                         styleClass="form-control"                                                                               
                                                                         >
                                                            <f:selectItems value="#{popupGrBean.listaHorasMin}" />
                                                        </h:selectOneMenu>
                                                    </div>
                                                    <div class="col-3">                                            
                                                        <h:selectOneMenu id="minutoSalidaMin" 
                                                                         styleClass="form-control"
                                                                         value="#{popupGrBean.minutoMin}"
                                                                         >
                                                            <f:selectItems value="#{popupGrBean.listaMinutosMin}" />
                                                        </h:selectOneMenu>                                    
                                                    </div>
                                                    <h:outputText class="col-2 control-label" value="mins."/>                                       
                                                </div>
                                            </div>
                                            <div class="row" >                                    
                                                <strong><h:outputText class="col-12 control-label" value="Hora Max:"/></strong>
                                                <div class="input-group">
                                                    <div class="col-3">                                            
                                                        <h:selectOneMenu id="horaSalidaMax" 
                                                                         value="#{popupGrBean.horaMax}"
                                                                         styleClass="form-control"
                                                                         >
                                                            <f:selectItems value="#{popupGrBean.listaHorasMax}" />
                                                        </h:selectOneMenu>
                                                    </div>
                                                    <div class="col-3">                                            
                                                        <h:selectOneMenu id="minutoSalidaMax" 
                                                                         styleClass="form-control"
                                                                         value="#{popupGrBean.minutoMax}"
                                                                         >
                                                            <f:selectItems value="#{popupGrBean.listaMinutosMax}" />
                                                        </h:selectOneMenu>                                    
                                                    </div>
                                                    <h:outputText class="col-2 control-label" value="mins."/>                                    
                                                </div>  
                                            </div>
                                        </div>
                                    </div>                        
                                </div>
                                <div class="modal-footer">                        
                                    <p:commandButton id="btnGuardarRutaZona"                                           
                                                     value="Guardar"
                                                     styleClass="btn btn-info"
                                                     action="#{popupGrBean.guardarZonaHorarioDet}"                            
                                                     title="Click aquí para guardar horarios de la ruta..." 
                                                     process="@form" update="form1"/>
                                    <p:commandLink immediate="true"
                                                   onclick="$(dialogoEditRutaCodigosHorarios).modal('hide');"
                                                   value="Cerrar"
                                                   styleClass="btn btn-default"
                                                   action="#{popupGrBean.backEditRutaHorarios(event)}"                            
                                                   title="Cerrar ventana..." 
                                                   />                        
                                </div>
                            </h:form>
                        </div>
                    </div>
                </div>
            </ui:define>
        </ui:composition>
    </h:body>
</html>