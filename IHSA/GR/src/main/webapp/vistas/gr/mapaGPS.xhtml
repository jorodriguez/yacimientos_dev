<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"      
      xmlns:h="http://java.sun.com/jsf/html"            
      >    
    <h:body>
        <ui:composition template="/vistas/template/template.xhtml">            
            <ui:define name="content">                 
                <div class="container">
                    <div class="row">
                        <h:form id="frmGPS">
                            <div class="panel panel-primary">
                                <div class="panel-heading">Localizaci√≥n GPS</div>
                                <div class="panel-body" style="background-color: #e7e7e7;">                        
                                    <div id="mapaGPS" style="padding-top: 600px;" ></div>
                                    <script>
                                        //<![CDATA[
                                        var markers;
                                        var waypts = [];
                                        var markersOrg;
                                        var markersDest;
                                        var map;
                                        $(function () {
                                            var directionsService = new google.maps.DirectionsService;
                                            var directionsDisplay = new google.maps.DirectionsRenderer;
                                            var posicion = {lat: 25.6485603, lng: -100.3232};                                            
                                            markersOrg = #{grBean.loadMarkerDataOrg()};
                                            markersDest = #{grBean.loadMarkerDataDes()};

                                            if (markersOrg != null && markersOrg.length > 0 && markersDest != null && markersDest.length > 0) {
                                                map = new google.maps.Map(
                                                        document.getElementById('mapaGPS'),
                                                        {zoom: 3,
                                                            center: posicion,
                                                            zoomControl: true,
                                                            scaleControl: true
                                                        });
                                                directionsDisplay.setMap(map);
                                                
                                                var origen2 = new google.maps.LatLng(markersOrg[0].latCoord, markersOrg[0].lonCoord);
                                                var destino2 = new google.maps.LatLng(markersDest[0].latCoord, markersDest[0].lonCoord);
                                                
                                                markers = #{grBean.loadMarkerData()};
                                                if (markers != null && markers.length > 0) {
                                                    for (i = 0; i < markers.length; i++) {
                                                        var data = markers[i];
                                                        var latLong = new google.maps.LatLng(data.latCoord, data.lonCoord);
                                                        waypts.push({
                                                            location: latLong, 
                                                            stopover: false
                                                        });
                                                    }
                                                }

                                                directionsService.route({
                                                    origin: origen2,
                                                    destination: destino2,
                                                    waypoints: waypts,
                                                    optimizeWaypoints: false,
                                                    travelMode: google.maps.TravelMode.DRIVING,
                                                    provideRouteAlternatives: false
                                                }, function (response, status) {
                                                    if (status === google.maps.DirectionsStatus.OK) {
                                                        directionsDisplay.setDirections(response);                                                        
                                                    } else {
                                                        window.alert('Directions request failed due to ' + status);
                                                    }
                                                });
                                            }
                                        });

                                        //]]>
                                    </script>                         
                                </div>                                
                            </div>
                        </h:form>
                    </div>
                </div>                

                <script>
                    $(document).ready(function () {
                        startDate();
                    });
                </script>

            </ui:define>            
        </ui:composition>
    </h:body>
</html>