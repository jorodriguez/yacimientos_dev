<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
      
      xmlns:f="http://java.sun.com/jsf/core">

    <body>

        <ui:composition template="./../../../../WEB-INF/facelets/templates/templateServiciosGenerales.xhtml">

            <ui:define name="contenido">
                <h:form id="frmFacturaViaje">
                    <br/>
                    <p  class="h3 text-info tituloPagina"> Facturas</p>
                    <br/>
                    <div class="row-fluid" >
                        <h:commandLink value="Regresar" style="padding-left: 20px;" action="/vistas/sgl/viaje/costos/registroCostoViajeAereo" 
                                       class="btn btn-sm btn-default" immediate="true" actionListener="#{gastoViajeBean.regresarPaginaViajes(event)}"/>

                    </div>
                    <br/>
                    <div class="row-fluid">
                        <!-- Viajes -->
                        <p:dataTable  var="data" value="#{gastoViajeBean.listaFactura}"
                                        rows="5" styleClass="dataPaginatorDataTable" 
                                        paginator="true"  showGridlines="true" size="small"
                                        paginatorPosition="bottom" 
                                        rowStyleClass="h6">
                            <f:facet name="header"> Facturas del viaje #{gastoViajeBean.viajeVO.codigo}</f:facet>
                            <p:column headerText="Viajero" styleClass="h5">
                                <h:outputText value="#{data.viajero}"/>
                            </p:column>
                            <p:column headerText="Tipo" styleClass="h5">
                                <h:outputText value="#{data.tipo}"/>
                            </p:column>
                            <p:column headerText="Proveedor" styleClass="h5">
                                <h:outputText value="#{data.proveedor}"/>
                            </p:column>
                            <p:column headerText="Folio" styleClass="h5">
                                <h:outputText  value="#{data.folio}"/>
                            </p:column>
                            <p:column headerText="Monto" styleClass="h5">
                                <h:outputText value="#{data.monto}"/>
                                <h:outputText value=" "/>
                                <h:outputText value="#{data.moneda}"/>
                            </p:column>
                            <p:column headerText="Fecha" styleClass="h5">
                                <h:outputText value="#{data.fechaEmision}">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </h:outputText>
                            </p:column>
                            <p:column>
                                <h:commandLink value="Agregar" rendered="#{data.idFactura eq 0}" class="link" 
					       actionListener="#{gastoViajeBean.agregarFacturaViaje(event)}"
					       onclick="$(gastoViaje).modal('show');">
                                    <f:param name="viajeFactura" value="#{data.idViajeFactura}"/>
                                </h:commandLink>
                            </p:column>
                            <p:column>
                                <h:commandLink rendered="#{data.idFactura gt 0}"  value="Modificar" class="link" 
					       actionListener="#{gastoViajeBean.iniciarModificarFactura(event)}">
                                    <f:param name="factura" value="#{data.idFactura}"/>
                                </h:commandLink>
                            </p:column>
                            <p:column>
                                <h:commandLink rendered="#{data.idFactura gt 0}" value="Eliminar" class="link" 
                                               actionListener="#{gastoViajeBean.eliminarFactura(event)}"
                                               onclick="return confirmar('La operación va eliminar la factura. ¿Está seguro? ');">
                                    <f:param name="factura" value="#{data.idFactura}"/>
                                    <f:param name="viajeFactura" value="#{data.idViajeFactura}"/>
                                </h:commandLink>
                            </p:column>
                            <p:column>
                                <h:outputLink rendered="#{data.idAdjunto gt 0 and data.idFactura gt 0}" 
                                              target="_blank" 
                                              value="/Sia/AbrirArchivo?ZWZ2W=#{data.idAdjunto}&amp;ZWZ3W=#{data.uuId}"
                                              title="#{msgs['sistema.abrir.archivo']}">
                                    <center><h:graphicImage url="#{msgs['sgl.ruta.imagen']}icon_attach.gif" alt="#{msgs['sistema.abrir.archivo']}" /></center>
                                </h:outputLink>

                            </p:column>
                            <p:column>
                                <h:commandLink rendered="#{data.idAdjunto gt 0  and data.idFactura gt 0}" value="Quitar archivo" 
                                               actionListener="#{gastoViajeBean.quitarArchivo(event)}">
                                    <f:param name="adjunto" value="#{data.idAdjunto}"/>
                                    <f:param name="rutaArchivo" value="#{data.urlArchivo}"/>
                                    <f:param name="factura" value="#{data.idFactura}"/>
                                </h:commandLink>
                                <h:commandLink value="Agregr Archivo" class="link" rendered="#{data.idAdjunto eq 0 and data.idFactura gt 0}"
                                               actionListener="#{gastoViajeBean.agregarArchivo(event)}">
                                    <f:param name="factura" value="#{data.idFactura}"/>
                                </h:commandLink>
                            </p:column>
                        </p:dataTable>
                    </div>
                </h:form>
                <h:form>
                    <div class="modal fade" data-backdrop="static" id="archivoFactura">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4 class="modal-title">Agregar archivo</h4>
                                </div>
                                <div class="modal-body">
                                    <h:outputLabel value="Factura: #{gastoViajeBean.id}"/>
                                    <p:panel>
                                        <p:fileUpload  id="fileEntry"  
                                                       listener="#{gastoViajeBean.guardarArchivo}"
                                                       required="true" requiredMessage="Es necesario subir el archivo"/>
                                    </p:panel>
                                </div>
                            </div>
                        </div>
                    </div>
                </h:form>
                <h:form id="frmFactura">
                    <div class="modal fade" data-backdrop="static" id="gastoViaje" >
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4 class="modal-title">Registro de  Gasto</h4>
                                </div>
                                <div class="modal-body">
                                    <div >
                                        <h:outputLabel value="viaje:"/> #{gastoViajeBean.viajeVO.codigo}<br/>
                                        <h:outputLabel value="Responsable:"/> #{gastoViajeBean.viajeVO.responsable}
                                    </div><br/>
                                    <h:panelGrid columns="2" cellpadding="20" cellspacing="20">
                                        <h:outputLabel value="Proveedor: "/>
                                        <h:panelGrid columns="1">
                                            <h:panelGrid columns="3">
                                                <h:inputText id="autocomplete" class="form-control" required="true" requiredMessage="Agregar el proveedor"/>
                                                <h:inputHidden id="hidenDes" value="#{gastoViajeBean.facturaVo.idProveedor}" />
                                                <h:message for="autocomplete" id="msgProv"  class="text-danger"/>
                                            </h:panelGrid>
                                            <h:outputLabel id="nombreProveedor"/>

                                        </h:panelGrid>
                                        <h:outputLabel value="Folio: "/>
                                        <h:panelGrid columns="2">
                                            <h:inputText id="folioGuardar" class="form-control" value="#{gastoViajeBean.facturaVo.folio}" required="true" requiredMessage="Agregar el folio"/>
                                            <h:message for="folioGuardar" id="msgFolioGuardar"  class="text-danger"/>
                                        </h:panelGrid>
                                        <h:outputLabel value="Monto: "/>
                                        <h:panelGrid columns="2">
                                            <h:inputText id="montoGuardar" class="form-control" value="#{gastoViajeBean.facturaVo.monto}" 
                                                         required="true" requiredMessage="Agregar el monto">
                                            </h:inputText>
                                            <h:message for="montoGuardar" id="msgMontoGuardar"  class="text-danger"/>
                                        </h:panelGrid>
                                        <h:outputLabel value="Moneda: "/>
                                        <h:panelGrid columns="2">
                                            <h:selectOneMenu value="#{gastoViajeBean.facturaVo.idMoneda}" class="form-control">
                                                <f:selectItems value="#{gastoViajeBean.listaItem}"/>
                                            </h:selectOneMenu>
                                        </h:panelGrid>
                                        <h:outputLabel value="Concepto: "/>
                                        <h:panelGrid columns="2">
                                            <h:inputTextarea id="conceptoGuardar" cols="45" class="form-control" value="#{gastoViajeBean.facturaVo.concepto}" required="true" requiredMessage="Agregar concepto"/>
                                            <h:message for="conceptoGuardar" id="msgConceptoGuardar"  class="text-danger"/>
                                        </h:panelGrid>
                                        <h:outputLabel value="Observación:"/>
                                        <h:panelGrid columns="2">
                                            <h:inputTextarea cols="45" value="#{gastoViajeBean.facturaVo.observacion}" class="form-control"/>
                                        </h:panelGrid>
                                        <h:outputLabel value="Emision:"/>
                                        <h:panelGrid columns="2">
                                            <p:datePicker id="fechaGuardar" value="#{gastoViajeBean.facturaVo.fechaEmision}" pattern="dd/MM/yyyy"
                                                                required="true" requiredMessage="Agregar la fecha">
                                            </ace:dateTimeEntry>
                                            <h:message for="fechaGuardar" id="msgFechaGuardar"  class="text-danger"/>
                                        </h:panelGrid>
                                    </h:panelGrid>
                                    <h:message for="btnGuardar" class="text-danger"/>
                                </div>
                                <div class="modal-footer">
                                    <h:commandLink value="Cerrar" immediate="true" 
                                                   class="btn btn-default" 
                                                   actionListener="#{gastoViajeBean.cerrarRegistro(event)}"/>
                                    <h:commandLink id="btnGuardar" value="Guardar" class="btn btn-info" 
                                                   actionListener="#{gastoViajeBean.terminarRegistro(event)}"/>
                                </div>
                            </div><!-- /.modal-content -->
                        </div><!-- /.modal-dialog -->
                    </div><!-- /.modal -->
                </h:form>

                <h:form id="frmModFactura">
                    <div class="modal fade" data-backdrop="static" id="modificarGastoViaje" >
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4 class="modal-title">Modificar Factura</h4>
                                </div>
                                <div class="modal-body">
                                    <div >
                                        <h:outputLabel value="viaje:"/> #{gastoViajeBean.viajeVO.codigo}<br/>
                                        <h:outputLabel value="Responsable:"/> #{gastoViajeBean.viajeVO.responsable}
                                    </div><br/>
                                    <h:panelGrid columns="2" cellpadding="20" cellspacing="20">
                                        <h:outputLabel value="Folio: "/>
                                        <h:panelGrid columns="2">
                                            <h:inputText id="folio" class="form-control" value="#{gastoViajeBean.facturaVo.folio}" required="true" requiredMessage="Agregar el folio"/>
                                            <h:message for="folio" id="msgFolio"  class="text-danger"/>
                                        </h:panelGrid>
                                        <h:outputLabel value="Monto: "/>
                                        <h:panelGrid columns="2">
                                            <h:inputText id="monto" class="form-control" value="#{gastoViajeBean.facturaVo.monto}" 
                                                         required="true" requiredMessage="Agregar el monto">
                                            </h:inputText>
                                            <h:message for="monto" id="msgMonto"  class="text-danger"/>
                                        </h:panelGrid>
                                        <h:outputLabel value="Moneda: "/>
                                        <h:panelGrid columns="2">
                                            <h:selectOneMenu value="#{gastoViajeBean.facturaVo.idMoneda}" class="form-control">
                                                <f:selectItems value="#{gastoViajeBean.listaItem}"/>
                                            </h:selectOneMenu>
                                        </h:panelGrid>
                                        <h:outputLabel value="Concepto: "/>
                                        <h:panelGrid columns="2">
                                            <h:inputTextarea id="concepto" cols="45" class="form-control" value="#{gastoViajeBean.facturaVo.concepto}" required="true" requiredMessage="Agregar concepto"/>
                                            <h:message for="concepto" id="msgConcepto"  class="text-danger"/>
                                        </h:panelGrid>
                                        <h:outputLabel value="Observación:"/>
                                        <h:panelGrid columns="2">
                                            <h:inputTextarea cols="45" value="#{gastoViajeBean.facturaVo.observacion}" class="form-control"/>
                                        </h:panelGrid>
                                        <h:outputLabel value="Emision:"/>
                                        <h:panelGrid columns="2">
                                            <p:datePicker id="fechaemision" value="#{gastoViajeBean.facturaVo.fechaEmision}" pattern="dd/MM/yyyy"
                                                                required="true" requiredMessage="Agregar la fecha">
                                            </ace:dateTimeEntry>
                                            <h:message for="fechaemision" id="msgFecha"  class="text-danger"/>
                                        </h:panelGrid>
                                    </h:panelGrid>
                                    <h:message for="btnGuardarr" class="text-danger"/>
                                </div>
                                <div class="modal-footer">
                                    <h:commandLink value="Cerrar" immediate="true" 
                                                   class="btn btn-default" 
                                                   actionListener="#{gastoViajeBean.cerrarModificacionRegistro(event)}"/>
                                    <h:commandLink id="btnGuardarr" value="Guardar" class="btn btn-info" 
                                                   actionListener="#{gastoViajeBean.modificarFactura(event)}"/>
                                </div>
                            </div><!-- /.modal-content -->
                        </div><!-- /.modal-dialog -->
                    </div><!-- /.modal -->
                </h:form>
            </ui:define>

        </ui:composition>

    </body>
</html>
