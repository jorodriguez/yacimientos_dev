<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"

                xmlns:c="http://java.sun.com/jsp/jstl/core"
                >
    <h:form  id="formAprobarSolicitudes">
        <div id="aOficina" >
            <div class="col-12 input-group">
                <div class="col-3">
                    <div class="btn-group col-xs-12">
                        <p:commandLink action="#{aprobarSolicitudViajeBean.aprobar()}" id="AprobarGerente" 
                                       value="Aprobar" class="btn btn-primary text-white"
                                       process="@this formAprobarSolicitudes:viajerosTerrestre" update="formAprobarSolicitudes"/>
                        <p:commandLink action="#{aprobarSolicitudViajeBean.popMotivoCancelar()}" id="cancelarSolicitudes" 
                                       value="Cancelar" class="btn btn-default" process="@this formAprobarSolicitudes:viajerosTerrestre" 
                                       update="frmCancelarSolicitudes"/>
                        <p:commandLink id="addViajeroActionT"  action="#{aprobarSolicitudViajeBean.cargarListaViajeros()}"
                                       value="Agregar"  class="btn btn-info text-white" process="@this formAprobarSolicitudes:viajerosTerrestre"
                                       update="frmAddViajeros"/>
                    </div>
                </div>
                <div class="3"></div>
                <div class="col-5" >
                    <div class="row" style="background-color: #f1dddd; color:red;">
                        Las solicitudes en este color no cumplen las politicas de viajes
                    </div>
                </div>
            </div>
            <div class="table table-responsive">
                <p:dataTable id="viajerosTerrestre" value="#{aprobarSolicitudViajeBean.listSolicitudesVo}" var="via"
                             size="small" showGridlines="true" rowKey="#{via.idSolicitud}">
                    <p:columnGroup type="header">
                        <p:row>
                            <p:column id="hselect" style="border-color: whitesmoke;" width="35">
                                <f:facet name="header">
                                    <p:selectBooleanCheckbox  class="todos" onchange="seleccionarTodo('todos', 'seleccion')"
                                                              id="selectTodo" value="#{aprobarSolicitudViajeBean.selectTodo}"
                                                              >
                                        <p:ajax listener="#{aprobarSolicitudViajeBean.selecionarTodoTer}" update="formAprobarSolicitudes:viajerosTerrestre"/>
                                    </p:selectBooleanCheckbox>
                                </f:facet>
                            </p:column>
                            <p:column id="hCodigo" headerText="Código" width="8%"/>
                            <p:column id="hRuta" headerText="Ruta" width="18%"/>
                            <p:column id="hSolicito" headerText="Solicito" />
                            <p:column id="hsolicitado" headerText="Solicitado" />
                            <p:column id="hSalida" headerText="Salida" />
                            <p:column id="hregreso" headerText="Regreso" />
                            <p:column id="hviajeros" headerText="Viajeros" />
                            <p:column id="hMotAndJust" style="border-color:  whitesmoke;"/>
                        </p:row>
                    </p:columnGroup>
                    <p:column style="font-size: medium; text-align: center; padding: 3px 0px 3px 0px; background-color: #{via.idSolImcumplimiento>0 ? '#f1dddd': ''}; border-color:  whitesmoke;">
                        <p:selectBooleanCheckbox value="#{via.select}" class="seleccion"/>
                    </p:column>
                    <p:column  style="font-size: small; text-align: center; padding: 3px 0px 3px 0px; background-color: #{via.idSolImcumplimiento>0 ? '#f1dddd': ''}; border-color:  whitesmoke;">
                        <h:outputText value="#{via.codigo}" />
                    </p:column>
                    <p:column headerText="Ruta" id="rutaSolicitud"  style="text-align: left;  padding: 3px 0px 3px 0px;  background-color: #{via.idSolImcumplimiento>0 ? '#f1dddd': ''}; border-color:  whitesmoke;">
                        <div class="input-group" title="#{via.idSgTipoEspecifico !=  3 ? 'Terrestre': 'Aéreo'}">
                            <div class="col-md-2">
                                <i class="fa fa-car" style="font-size: 16px; color: #0895d6; display: #{via.idSgTipoEspecifico !=  3 ? 'block': 'none'}"></i>
                                <i class="fa fa-plane" style="font-size: 18px; color: #0895d6; display: #{via.idSgTipoEspecifico ==  3 ? 'block': 'none'}"></i>
                            </div>
                            <div class="col-md-10">
                                <label style="font-size: 14px">#{via.origen} a #{via.destino}</label>
                            </div>
                        </div>
                    </p:column>
                    <p:column headerText="Solicito" id="solicito" style="text-align: left; padding: 3px 0px 3px 0px; background-color: #{via.idSolImcumplimiento>0 ? '#f1dddd': ''}; border-color:  whitesmoke;">
                        <h:outputText id="genero" value="#{via.genero}" title="Persona que genero la solicitud"/>
                    </p:column>
                    <p:column headerText="Solicitado" id="solicitado" style="text-align: left; padding: 3px 0px 3px 0px; background-color: #{via.idSolImcumplimiento>0 ? '#f1dddd': ''}; border-color:  whitesmoke;">
                        <h:outputText id="fmod" value="#{via.fechaModifico}" title="Fecha en que se realizo la solicitud">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:outputText>
                        <label> </label>
                        <h:outputText id="hmod" value="#{via.horaModifico}" title="Fecha en que se realizo la solicitud">
                            <f:convertDateTime pattern="HH:mm "/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Salida" id="salida"  style="text-align: left; padding: 3px 0px 3px 0px; background-color: #{via.idSolImcumplimiento>0 ? '#f1dddd': ''}; border-color:  whitesmoke;">
                        <h:outputText id="fsalida" value="#{via.fechaSalida}" title="Fecha Salida">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:outputText>
                        <label> </label>
                        <h:outputText id="horaSalida" value="#{via.horaSalida}" title="Fecha Salida">
                            <f:convertDateTime pattern="HH:mm "/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Regreso" id="regreso" style="text-align: left; padding: 3px 0px 3px 0px; background-color: #{via.idSolImcumplimiento>0 ? '#f1dddd': ''}; border-color:  whitesmoke;">
                        <h:outputText id="fregreso" value="#{via.fechaRegreso}" rendered="#{via.redondo}" title="Fecha Regreso">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:outputText>
                        <label> </label>
                        <h:outputText id="horaRegreso" value="#{via.horaRegreso}"  rendered="#{via.redondo}" title="Fecha Regreso">
                            <f:convertDateTime pattern="HH:mm "/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Viajeros"  style="text-align: center; padding: 3px 0px  3px 0px; background-color: #{via.idSolImcumplimiento>0 ? '#f1dddd': ''}; border-color:  whitesmoke;">
                        <h:panelGroup>
                            <ui:repeat value="#{via.viajeros}" var="data">
                                <h:outputText value="#{data.idInvitado ==0  ? data.usuario:data.invitado}"  title="viajero"/><br/>
                            </ui:repeat>
                        </h:panelGroup>
                    </p:column>
                    <p:column style="text-align: center; padding: 3px 0px  3px 0px; background-color: #{via.idSolImcumplimiento>0 ? '#f1dddd': ''}; border-color:  whitesmoke;"
                              width="4%">
                        <div title="Detalles">
                            <p:rowExpansion/>
                        </div>
                    </p:column>
                    <p:rowExpansion>
                        <div class="row-fluid" style="background-color: #{via.idSolImcumplimiento>0 ? '#f1dddd': '##f8f8f8'}" id="">                                
                            <div  style="text-align: left; border-right-width: thick; border-right-color: #000; background-color: #{via.idSolImcumplimiento>0 ? '#f1dddd': '#ededee'}; font-size: 14px">
                                <label>Motivo: </label> #{via.motivo} <label>Observación:</label> #{via.observacion}.
                            </div>
                            <div  style="text-align: left;  border-left-width: thin; border-left-color: #000; background-color: #{via.idSolImcumplimiento>0 ? '#f1dddd': '#ededee'};
                                  display: #{via.idSolImcumplimiento>0 ? 'block': 'none'}; font-size: 14px">
                                <label>Justificación: </label> #{via.motivoRetrasoVo.justificacion}
                            </div>
                        </div>
                    </p:rowExpansion>
                </p:dataTable>
            </div>
        </div>
    </h:form>
    <h:form id="frmCancelarSolicitudes">
        <div class="modal fade" id="modalCancelar" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Cancelar Solicitud(es): #{aprobarSolicitudViajeBean.codigos}</h4>
                    </div>
                    <div class="modal-body">
                        <p:inputTextarea  class="col-lg-12 col-xs-12" placeholder="Motivo de cancelacion" id="msjCancelacion" 
                                          value="#{aprobarSolicitudViajeBean.motivo}"                                          
                                          required="true" requiredMessage="Agregar el motivo"/>
                    </div>
                    <div class="modal-footer">                        
                        <p:commandButton  value="Aceptar" action="#{aprobarSolicitudViajeBean.cancelarSolictud()}" id="cancel"
                                          onclick="$(modalCancelar).modal('hide');"
                                          process="@form" update="formAprobarSolicitudes:viajerosTerrestre"/>
                        <button type="button" class="btn btn-default" data-dismiss="modal"
                                onclick="$(modalCancelar).modal('hide');">Cerrar</button>
                    </div>
                </div>
            </div>
        </div>
    </h:form>

    <h:form id="frmJustificarSolicitudes">
        <div class="modal fade" id="modalJustificar" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Justificar Solicitud(es): #{aprobarSolicitudViajeBean.codigos}</h4>
                    </div>
                    <div class="modal-body">
                        <p:inputTextarea  class="col-lg-12 col-xs-12" placeholder="Motivo de cancelacion" id="msjCancelacion" 
                                          value="#{aprobarSolicitudViajeBean.motivo}"
                                          required="true" requiredMessage="Agregar el motivo"/>
                    </div>
                    <div class="modal-footer">
                        <p:commandButton value="Guardar"  action="#{aprobarSolicitudViajeBean.aprobarWhitJustificacion()}" id="apj"
                                         process="@form" update="formAprobarSolicitudes:viajerosTerrestre"/>
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                    </div>
                </div>
            </div>
        </div>
    </h:form>
    <h:form id="frmAddViajeros">
        <div class="modal fade" id="modalAddViajeros" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        Agregar Viajero(s) a solicitud: #{aprobarSolicitudViajeBean.solicitudViajeVO.codigo}
                    </div>
                    <div class="modal-body">
                        <div style="margin-top: 10px;" class="col-lg-12 col-xs-12">
                            <h:message  for="" style="display: block;" infoClass="alert alert-success" warnClass="alert alert-warning"
                                        errorClass="alert alert-danger" fatalClass="alert alert-danger"  />
                        </div>
                        <div class="row">
                            <p:dataTable id="viajerosTerrestrePop" value="#{aprobarSolicitudViajeBean.solicitudViajeVO.viajeros}"
                                         var="via"  size="small" showGridlines="true" lazy="true">
                                <p:column headerText="Viajero" id="viajero" >
                                    <label style="display: #{via.empleado ? 'block' : 'none'}" id="nameViajero">
                                        <span class="fa fa-user" style="color: #0895d6"></span> #{via.usuario}</label>
                                    <label id="nameViajeroinvitado" style="display: #{via.empleado ? 'none' : 'block'}">
                                        <span class="fa fa-user" style="color: #0895d6"></span> #{via.invitado}</label>
                                </p:column>
                                <p:column headerText="Estancia" id="est" width="8%">
                                    <h:selectBooleanCheckbox value="#{via.estanciaB}"/>
                                </p:column>
                                <p:column id="tipo" headerText="Tipo" width="10%">
                                    <h:outputText id="tipocell" value="#{via.empleado ? 'Empleado' :'Invitado'}"/>
                                </p:column>
                                <p:column id="eliminarViajero" width="2%">
                                    <p:commandLink action="#{aprobarSolicitudViajeBean.removeViajeros(via.id, via.idUsuario, via.idInvitado)}"
                                                   title="Quitar viajero" process="@this" update="frmAddViajeros:viajerosTerrestrePop">
                                        <span class="fa fa-trash text-danger"/>
                                    </p:commandLink>
                                </p:column>
                            </p:dataTable>
                        </div>
                        <br/>
                        <div class="row">
                            <p:tabView>
                                <p:tab title="Empleados">
                                    <p:selectOneMenu value="#{aprobarSolicitudViajeBean.idUsuario}">
                                        <f:selectItem itemLabel="Seleccione . . ." itemValue=""/>
                                        <f:selectItems var="item" itemLabel="#{item.nombre}" itemValue="#{item.id}" value="#{aprobarSolicitudViajeBean.usuariosGerenciaVO}"/>
                                        <p:ajax listener="#{aprobarSolicitudViajeBean.addEmpleado()}" update="frmAddViajeros:viajerosTerrestrePop"/>
                                    </p:selectOneMenu>
                                </p:tab>
                                <p:tab title="Invitados">
                                    <p:autoComplete completeMethod="#{aprobarSolicitudViajeBean.invitadoListener}" 
                                                    value="#{aprobarSolicitudViajeBean.invitado}"
                                                    minQueryLength="4" forceSelection="true" size="40" placeholder="Invitado">
                                        <p:ajax listener="#{aprobarSolicitudViajeBean.addInvitado()}" update="@this frmAddViajeros:viajerosTerrestrePop"/>
                                    </p:autoComplete>        

                                </p:tab>
                            </p:tabView>
                        </div>
                    </div>
                    <div class="modal-footer" >
                        <p:commandButton  action="#{aprobarSolicitudViajeBean.addEditOrRemoveViajeros()}" id="agregar"
                                          value="Aceptar" process="@form" update="formAprobarSolicitudes:viajerosTerrestre"/>

                        <button type="button" class="btn btn-default" onclick="$(modalAddViajeros).modal('hide');">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </h:form>    
</ui:composition>
