<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                >
    <script>
        function cambia(section, nuevaSelection) {
            document.getElementById(section).style.display = 'block';
            document.getElementById(nuevaSelection).style.display = 'none';
        }

    </script>
    <!--No todo lo de estilo funciona si se muestran 2 meses-->

    <div style="background-color: transparent;" id="solicitud" >
        <div class="row" id="alertas">
            <div style="font-style: italic; text-align: justify; display: none" class="row alert alert-danger" id="alertSalida">
                <label id="alerta"></label>
            </div>
            <div style="font-style: italic; text-align: justify; display: none" class="row alert alert-danger" id="alertRegreso">
                <label id="alerta2"></label>
            </div>
        </div>
        <div class="row">
            <div class="col-1" style="text-align: left;">
                <label>Empresa:</label>
            </div>
            <div class="col-5">
                <p:selectOneMenu value="#{solicitudViajeBean.rfcEmpresaSeleccionada}" >
                    <f:selectItem itemValue="-1" itemLabel="Seleccionar..."/>
                    <f:selectItems value="#{solicitudViajeBean.listEmpresaByUser}"/>
                    <p:ajax listener="#{solicitudViajeBean.cambiarEmpresa}" />
                </p:selectOneMenu>
            </div>
            <div class="col-4" >
                <div style="font-style: italic; text-align: justify; display: none" id="hrPermitido" class="col-12 alert alert-warning">
                    <label id="labHorario"></label>
                </div>
            </div>
            <div class="col-1" style="text-align: right;">
                <script>
                    var cambioTipo = true;

                    $("[name='tipoRS']").bootstrapSwitch();
                    function redondoSencillo() {
                        $("#reg").slideToggle();
                        var d = document.getElementById("tipoRS").checked;
                        if (d == true) {
                            $('#tipoRS').bootstrapSwitch('labelText', 'Sencillo');
                            ejecutarBoton('formTerrestre', 'tipoDeviajeRS');
                            cambioTipo = true;
                        } else {
                            $('#tipoRS').bootstrapSwitch('labelText', 'Redondo');
                            ejecutarBoton('formTerrestre', 'tipoDeviajeRS');
                            cambioTipo = false;
                        }
                    }
                    ;
                </script>
                <p:commandLink id="tipoDeviajeRS"  action="#{solicitudViajeBean.tipoDeViaje()}"/>
                <p:selectBooleanButton value="#{solicitudViajeBean.cadena}" onLabel="Sencillo" offLabel="Redondo"
                                       onchange="redondoSencillo()">
                    <p:ajax listener="#{solicitudViajeBean.tipoDeViaje()}" update=""/>
                </p:selectBooleanButton>
                <!--input type="checkbox" name="tipoRS" checked="true" data-on-text="Redondo" data-off-text="Sencillo" id="tipoRS" 
                       onchange="redondoSencillo()" class="form-control" data-label-text="Sencillo" data-on-color="primary" 
                       data-off-color="primary" /-->

            </div>

        </div>
        <br/>
        <div class="row">
            <script>
                var destinosActuales;
                function cargarDatos(json, idElement, idGroupT, idGroupA) {
                    var tablaElementos = document.getElementById('tabla-elementos');
                    var index = 0;
                    var newlist = document.getElementById(idElement);
                    while (newlist.hasChildNodes()) {
                        newlist.removeChild(newlist.firstChild);
                    }
                    var nav = navigator.userAgent.toLowerCase();
                    destinosActuales = json;


                    $(json).each(function () {
                        var op = document.createElement('option');
                        op.value = this.label;

                        if (this.type == 1) {
                            op.setAttribute("id", this.value);
                            if (nav.indexOf("chrome") != -1) {
                                if (nav.indexOf("edge") != -1) {
                                    op.setAttribute("label", this.label);
                                } else {
                                    op.setAttribute("label", "Terrestre");
                                }

                            }

                        } else {
                            op.setAttribute("id", this.value);
                            if (nav.indexOf("chrome") != -1) {
                                if (nav.indexOf("edge") != -1) {
                                    op.setAttribute("label", this.label);
                                } else {
                                    op.setAttribute("label", "Aéreo");
                                }

                            }
                        }
                        newlist.appendChild(op);
                        index++;
                    });
                }
                function limpiarDataList() {
                    // var  listOptions= document.getElementById('destinos').children; 
                    var des = document.getElementById('destinoss');
                    $('#destinos').empty();
                    des.value = '';

                }
                function horarios() {
                    var selecc = document.getElementById('destinoss').value;
                    var tp = document.getElementById('destinoss').type;
                    $(destinosActuales).each(function () {
                        if (this.label === selecc) {
                            if (this.type == 1) {
                                document.getElementById('hrPermitido').style.display = "block";
                                document.getElementById('labHorario').innerHTML = 'El horario permitido para esta ruta es: ' + this.horario;
                            } else {
                                document.getElementById("hrPermitido").style.display = "none";
                            }
                        }

                    });
                }
            </script>
            <div class="col-md-4">
                <input type="text" list="oficinasYCiudades" autocomplete="on" class="form-control" 
                       onclick="if (this.value != '') {
                                   this.value = ''
                               }"
                       onchange="ejecutarBoton('formTerrestre', 'selectOrigen');" placeholder="Origen..." id="origenss" name="ori"/>                   
                <datalist id="oficinasYCiudades">
                    <optgroup label="oficinas" id="groupO">
                    </optgroup>
                    <optgroup label="ciudades" id="groupC">
                    </optgroup>
                </datalist> 
                <p:commandLink  action="#{solicitudViajeBean.cambiarOficinaOrigen()}" id="selectOrigen"/>
            </div>
            <div class="col-8"><!--Fecha Salida-->
                <div class="col-12 input-group">
                    <label class="col-2 control-label" >Salida:</label>
                    <div class="col-6">
                        <script>
                            var listFecha;

                            $(function () {
                                var d = document.getElementById("tipoRS").checked;
                                $("#formTerrestre\\:fechaSalida").datepicker({
                                    showButtonPanel: true,
                                    buttonImage: "#{msgs['sgl.ruta.imagen']}cal_button.gif",
                                    buttonImageOnly: true,
                                    numberOfMonths: 2,
                                    dateFormat: "dd/mm/yy",
                                    minDate: new Date(),
                                    autoclose: true,
                                    onSelect: function (date) {
                                        fechaSeleccinadaSalida = date;
                                        console.log(date);
                                    },
                                    onClose: function (selectedDate) {
                                        console.log(d);
                                        validarFechaSalida(selectedDate);

                                        if (cambioTipo === true) {
                                            console.log("llega123");
                                            $("#formTerrestre\\:fechaRegreso").datepicker("option", "minDate", selectedDate);
                                            $("#formTerrestre\\:fechaRegreso").datepicker('show');
                                        }
                                    }
                                });
                            });
                            function validarFechaSalida(d) {
                                var dia = d.substr(0, 2);
                                var mes = d.substr(3, 2);
                                var yy = d.substr(6, 4);
                                var diaSelecc = new Date(yy, mes - 1, dia);
                                var diaActual = new Date();
                                var hrActual = diaActual.getHours();
                                var day = diaSelecc.getDay();
                                var manana = new Date();
                                diaActual.setHours(0, 0, 0, 0);
                                var semanaActual = Math.ceil((((diaActual - new Date(diaActual.getFullYear(), 0, 0)) / 8.64e7) + 1) / 7);
                                var semanaSeleccionada = Math.ceil((((diaSelecc - new Date(diaSelecc.getFullYear(), 0, 0)) / 8.64e7) + 1) / 7);
                                manana.setDate(diaActual.getDate() + 1);
                                manana.setHours(0, 0, 0, 0);
                                console.log("Actual= " + semanaActual + " == semanaSelecionada = " + semanaSeleccionada);

                                if (diaSelecc.getTime() === diaActual.getTime()) {
                                    document.getElementById('alerta')
                                            .innerHTML = 'La fecha de salida es el mismo día, usted debera de Justificar su solicitud';
                                    document.getElementById("alertSalida").style.display = "block";
                                } else {
                                    if (day === 0 || day === 6) {// los día corren del 0 al 6 empenzando en domingo
                                        document.getElementById('alerta')
                                                .innerHTML = 'La fecha de salida es fin de Semana, usted debera de Justificar su solicitud';
                                        document.getElementById("alertSalida").style.display = "block";
                                    } else if (day === 1) {
                                        if (diaActual.getDay() === 5) { //5 
                                            if (semanaSeleccionada === (semanaActual + 1)) {
                                                if (hrActual >= 10) {
                                                    document.getElementById('alerta')
                                                            .innerHTML = 'En base a las políticas de viaje vigentes, debido a que el viaje es para el \n\
                        próximo lunes, y la hora actual ya pasa de las 10:00 AM, debe introducir una justificación para esta solicitud.';
                                                    document.getElementById("alertSalida").style.display = "block";
                                                } else {
                                                    validaFestivo(d);
                                                }
                                            } else {
                                                validaFestivo(d);
                                            }
                                        } else if (diaActual.getDay() === 6 || diaActual.getDay() === 0) {
                                            if (semanaSeleccionada === (semanaActual + 1)) {
                                                document.getElementById('alerta')
                                                        .innerHTML = 'En base a las políticas de viaje vigentes, por ser fin de semana y el viaje es para el próximo lunes, \n\
                        debe introducir una justificación para esta solicitud.';
                                                document.getElementById("alertSalida").style.display = "block";
                                            } else {
                                                validaFestivo(d);
                                            }
                                        } else {
                                            validaFestivo(d);
                                        }

                                    } else {
                                        validaFestivo(d);
                                    }
                                }
                            }

                            function validaFestivo(d) {
                                var validaMañana = true;
                                var dia = d.substr(0, 2);
                                var mes = d.substr(3, 2);
                                var yy = d.substr(6, 4);
                                var manana = new Date();
                                manana.setDate(new Date() + 1);
                                manana.setHours(0, 0, 0, 0);
                                var diaSelecc = new Date(yy, mes - 1, dia);

                                $(listFecha).each(function () {
                                    var festivo = new Date(this.value + "T00:00:00");
                                    if (diaSelecc.getTime() === festivo.getTime()) {
                                        document.getElementById('alerta')
                                                .innerHTML = 'La fecha de salida es un día Festivo, usted debera de Justificar su solicitud';
                                        document.getElementById("alertSalida").style.display = "block";
                                        validaMañana = false;
                                    }
                                });

                                if (validaMañana) {
                                    //se valida que el dia sea igual a mañana y la hora actual menor a las 15hrs
                                    if (diaSelecc.getTime() === manana.getTime()) {
                                        var h = new Date().getHours();
                                        if (h >= 15) {
                                            console.log("llega");
                                            document.getElementById('alerta')
                                                    .innerHTML = 'Ya pasan de las 15:00 hrs, está es la hora maximá para solicitar viaje para el día siguiente, usted debera de Justificar su solicitud';
                                            document.getElementById("alertSalida").style.display = "block";
                                        } else {
                                            document.getElementById('alertSalida').style.display = "none";
                                        }

                                    } else {
                                        document.getElementById('alertSalida').style.display = "none";
                                    }
                                }
                            }

                            function validarFechaRegreso(d) {
                                var validaMañana = true;
                                var dia = d.substr(0, 2);
                                var mes = d.substr(3, 2);
                                var yy = d.substr(6, 4);
                                var diaSelecc = new Date(yy, mes - 1, dia);
                                var diaActual = new Date();
                                var day = diaSelecc.getDay();
                                var manana = new Date();
                                diaActual.setHours(0, 0, 0, 0);
                                manana.setDate(diaActual.getDate() + 1);
                                manana.setHours(0, 0, 0, 0);

                                if (diaSelecc.getTime() === diaActual.getTime()) {
                                    document.getElementById('alerta2')
                                            .innerHTML = 'La fecha de regreso es el mismo día, usted debera de Justificar su solicitud';
                                    document.getElementById("alerta2").style.display = "block";
                                } else {
                                    if (day === 0 || day === 6) {
                                        document.getElementById('alerta2')
                                                .innerHTML = 'La fecha de regreso es fin de Semana, usted debera de Justificar su solicitud';
                                        document.getElementById("alertRegreso").style.display = "block";
                                    } else {
                                        $(listFecha).each(function () {

                                            var festivo = new Date(this.value + "T00:00:00");
                                            if (diaSelecc.getTime() === festivo.getTime()) {
                                                document.getElementById('alerta2')
                                                        .innerHTML = 'La fecha de regreso es un día Festivo,usted debera de Justificar su solicitud';
                                                document.getElementById("alertRegreso").style.display = "block";
                                                validaMañana = false;
                                            } else {
                                                document.getElementById('alertRegreso').style.display = "none";
                                            }
                                        });

                                    }
                                }
                            }

                            function cargarFechas(json) {
                                listFecha = json;
                            }

                        </script>
                        <style>
                            .ui-datepicker-calendar .ui-state-active {
                                background: #6eafbf;
                                -webkit-box-shadow: inset 0px 0px 10px 0px rgba(0, 0, 0, .1);
                                -moz-box-shadow: inset 0px 0px 10px 0px rgba(0, 0, 0, .1);
                                box-shadow: inset 0px 0px 10px 0px rgba(0, 0, 0, .1);
                                color: #e0e0e0;
                                text-shadow: 0px 1px 0px #4d7a85;
                                filter: dropshadow(color=#4d7a85, offx=0, offy=1);
                                border: 1px solid #55838f;
                                position: relative;
                                margin: -1px;
                            }
                            .ui-datepicker-unselectable .ui-state-default {
                                background-image:  url(#{msgs['sgl.ruta.imagen']}flight-status-icon.png);
                            }
                        </style>
                        <h:inputText id="fechaSalida" value="#{solicitudViajeBean.fechaSalida}" styleClass="form-control"> 
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:inputText>
                    </div>                                  
                    <div class="col-3 input-group">
                        <div class="col-6">
                            <p:selectOneMenu id="horaSalida" 
                                             value="#{solicitudViajeBean.horaSalida}"

                                             styleClass="form-control">
                                <f:selectItems value="#{solicitudViajeBean.selectItemHoras}" />
                            </p:selectOneMenu>
                        </div>
                        <div class="col-6">
                            <h:selectOneMenu id="minutoSalida" onchange="validaHoraRuta()" 
                                             value="#{solicitudViajeBean.minutoSalida}"
                                             styleClass="form-control">
                                <f:selectItems value="#{solicitudViajeBean.selectItemMinutos}" />
                            </h:selectOneMenu> 
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <br/>
        <div class="row">
            <div class="col-md-4"> <!--oficina destino--> 
                <input type="text" list="destinos" autocomplete="on" class="form-control" onclick="if (this.value != '') {
                            this.value = ''
                        }"
                       onchange="horarios()"
                       placeholder="Destino..." id="destinoss" name="des" onselect="tipoAereoTerrestre()"/>  
                <p:commandLink  action="#{solicitudViajeBean.cambiarDestino()}" id="selectDestino"/>
                <datalist id="destinos">
                    <optgroup label="oficinas" id="groupDO">
                    </optgroup>
                    <optgroup label="ciudades" id="groupDC">
                    </optgroup>
                </datalist> 
            </div>
            <div class="col-8" id="reg">         <!--Fecha Regreso-->                                                            
                <div class="col-12 col-8 input-group">
                    <label class="col-2 control-label" >Regreso:</label>
                    <div class="col-6">
                        <script>
                            $(function () {
                                $("#formTerrestre\\:fechaRegreso").datepicker({
                                    showButtonPanel: true,
                                    buttonImage: "#{msgs['sgl.ruta.imagen']}cal_button.gif",
                                    buttonImageOnly: true,
                                    dateFormat: "dd/mm/yy",
                                    numberOfMonths: 2,
                                    onSelect: function (date) {
                                        fechaSeleccinadaSalida = date;
                                        validarFechaRegreso(date);
                                    }
                                });
                            });
                        </script>
                        <h:inputText id="fechaRegreso" value="#{solicitudViajeBean.fechaRegreso}" styleClass="form-control" >
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:inputText>
                    </div>
                    <div class="col-3 input-group">
                        <div class="col-6 col-6">
                            <p:selectOneMenu id="horaRegreso" 
                                             value="#{solicitudViajeBean.horaRegreso}"

                                             styleClass="form-control">
                                <f:selectItems value="#{solicitudViajeBean.selectItemHoras}" />
                            </p:selectOneMenu>
                        </div>
                        <div class="col-6">
                            <p:selectOneMenu id="minutoRegreso" 
                                             value="#{solicitudViajeBean.minutoRegreso}"

                                             styleClass="form-control">
                                <f:selectItems value="#{solicitudViajeBean.selectItemMinutos}" />
                            </p:selectOneMenu> 
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <br/>
        <div class="row">
            <div class="col-4">
                <p:selectOneMenu id="sgMotivo"  required="true"
                                 value="#{solicitudViajeBean.idSgMotivo}"

                                 styleClass="form-control">
                    <f:selectItem itemLabel="#{msgs['sgl.solicitudViaje.motivo']}..."
                                  itemValue="-1"/>
                    <f:selectItems value="#{solicitudViajeBean.selectItemSgMotivo}" />
                </p:selectOneMenu>
            </div>
            <div class="col-8">
                <p:inputTextarea id="observacion" value="#{solicitudViajeBean.observacion}" maxlength="256" styleClass="col-12" rows="2"/>
            </div>
        </div>
    </div>

</ui:composition>
