<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"

      >
    <body>
        <ui:composition template="./../../../WEB-INF/facelets/templates/templateServiciosGenerales.xhtml">
            <ui:define name="contenido">
                <h:panelGroup  rendered="#{empty sesion.usuario}" styleClass="altura">
                    <ui:include src="./../../../login.xhtml"/>
                </h:panelGroup> 
                <h:form ><br/>
                    <p class="tituloEncabezado">Detalle de la solicitud de estancia #{estanciaBean.sgSolicitudEstanciaVo.codigo}</p>
                    <h:panelGrid columns="2">
                        <h:panelGrid columns="2">
                            <p:commandLink title="Agregar"  actionListener="#{estanciaBean.regresarSolicitud(event)}"
                                           styleClass="btn btn-default" action="solicitudEstancia">
                                <h:graphicImage url="#{msgs['sgl.ruta.imagen']}button_back.png" 
                                                styleClass="imagenSinBorde"/>
                            </p:commandLink>
                            <p:commandLink value="Regresar a Crear Solicitud de Estancia" styleClass="linkPequenio" action="solicitudEstancia" actionListener="#{estanciaBean.regresarSolicitud(event)}"/>
                        </h:panelGrid>
                        <h:panelGrid columns="2">
                            <p:commandLink title="Agregar integrantes"  actionListener="#{estanciaBean.agregarIntegrantesDetalle(event)}"
                                           styleClass="btn btn-default">
                                <h:graphicImage url="#{msgs['sgl.ruta.imagen']}button_create.png" 
                                                styleClass="imagenSinBorde"/>
                            </p:commandLink>
                            <p:commandLink value="Agregar integrantes" styleClass="linkPequenio" actionListener="#{estanciaBean.agregarIntegrantesDetalle(event)}"/>
                        </h:panelGrid>
                    </h:panelGrid>
                    <br/>
                    <h:panelGrid columns="5">
                        <h:panelGrid columns="2">
                            <h:outputLabel value="Gerencia: "/>
                            <p:inputText value="#{estanciaBean.sgSolicitudEstanciaVo.nombreGerencia}" disabled="true">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </p:inputText>
                        </h:panelGrid>
                        <h:panelGrid columns="2">
                            <h:outputLabel value="Inicio Periodo: "/>
                            <p:inputText value="#{estanciaBean.sgSolicitudEstanciaVo.inicioEstancia}" disabled="true" size="12">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </p:inputText>
                        </h:panelGrid>
                        <h:panelGrid columns="2">
                            <h:outputLabel value="Fin Periodo: "/>
                            <p:inputText value="#{estanciaBean.sgSolicitudEstanciaVo.finEstancia}" disabled="true"  size="12">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </p:inputText>
                        </h:panelGrid>
                        <h:panelGrid columns="2">
                            <h:outputLabel value="Días: "/>
                            <p:inputText value="#{estanciaBean.sgSolicitudEstanciaVo.diasEstancia}" disabled="true" size="5"/>
                        </h:panelGrid>
                        <h:panelGrid columns="2">
                            <h:outputLabel value="Motivo: "/>
                            <p:inputText value="#{estanciaBean.sgSolicitudEstanciaVo.nombreSgMotivo}" disabled="true"/>
                        </h:panelGrid>
                    </h:panelGrid>
                    <h:outputText value="Integrantes de la solicitud" styleClass="fNegrita11"/>
                    <p:dataTable showGridlines="true" size="small"  value="#{estanciaBean.listaDetalleSolicitud}" var="detalle" >
                        <p:column >
                            <f:facet name="header"><h:outputText value="Nombre"/></f:facet>
                            <h:outputText value="#{detalle.usuario}" rendered="#{detalle.idInvitado == 0}"/>
                            <h:outputText value="#{detalle.invitado}" rendered="#{detalle.idInvitado gt 0}"/>
                        </p:column>
                        <p:column>
                            <f:facet name="header"><h:outputText value="Tipo"/></f:facet>
                            <h:outputText value="#{detalle.tipoDetalle}"/>
                        </p:column>  
                        <p:column>
                            <f:facet name="header"><h:outputText value="Descripción"/></f:facet>
                            <h:outputText value="#{detalle.descripcion}"/>
                        </p:column>
                        <p:column>
                            <p:commandLink value="Modificar" styleClass="link" actionListener="#{estanciaBean.modificarUsuarioDetalle(event)}"/>
                        </p:column>                                    
                        <p:column>
                            <p:commandLink value="Eliminar" styleClass="link" actionListener="#{estanciaBean.eliminarUsuarioDetalle(event)}" 
                                           />
                            <p:confirm id="pclCon" header="Confirmar"  message="La operación va a eliminar el integrante de la solicitud. ¿Está seguro?"/>
                        </p:column>
                    </p:dataTable>
                    <br/>
                </h:form>

                <!--Modificar nombre de integrante-->
                <h:form id="frmAconDet" >
                    <p:dialog   style="background: #FFFFFF;"
                                visible="#{estanciaBean.popUp and estanciaBean.sgDetalleSolicitudEstancia != null}"
                                draggable="false" modal="true">
                        <f:facet name="header">
                            <h:panelGroup >
                                <h:outputText  value="Modificar integrante solicitud"
                                               style="float: left; padding: 4px;text-align: center; vertical-align: middle;font: 11px;color: #484848; font-weight: bold;"/>

                            </h:panelGroup>
                        </f:facet>
                        <f:facet name="body">
                            <h:panelGroup>
                                <h:panelGrid width="450px">
                                    <h:outputText value="#{estanciaBean.mensaje}" styleClass="mensaje" style="color: red;"/>
                                </h:panelGrid>
                                <h:panelGrid columns="1">
                                    <h:panelGrid columns="2" rendered="#{estanciaBean.sgDetalleSolicitudEstancia.idTipoEspecifico eq 20}">
                                        <h:outputText value="Invitado"/>
                                        <!--p:inputText value="#{estanciaBean.sgDetalleSolicitudEstancia.invitado}" size="45"/-->
                                        <p:selectOneMenu  id="userSelectI" immediate="true" 
                                                          styleClass="form-control"
                                                          value="#{estanciaBean.invitado}" 
                                                          valueChangeListener="#{estanciaBean.invitadoListener}">
                                            <f:selectItems value="#{estanciaBean.listaSelectItemInvitado}" />
                                        </p:selectOneMenu>

                                        <h:outputText value="Descripción"/>
                                        <p:inputTextarea  cols="45" value="#{estanciaBean.sgDetalleSolicitudEstancia.descripcion}"/>
                                    </h:panelGrid>
                                    <h:panelGrid columns="2" rendered="#{estanciaBean.sgDetalleSolicitudEstancia.idTipoEspecifico eq 19}">
                                        <h:outputText value="Usuario"/>
                                        <p:selectOneMenu id="userSelect" immediate="true" 
                                                         styleClass="form-control"
                                                         value="#{estanciaBean.user}" valueChangeListener="#{estanciaBean.usuarioListener}"
                                                         >
                                            <f:selectItems value="#{estanciaBean.listaUsuariosAlta}" />
                                            <f:facet name="selectInputText">
                                                <h:panelGrid>
                                                    <h:outputText id="autoCompleteUsurOp" value="#{analista.nombre}" />
                                                </h:panelGrid>
                                            </f:facet>
                                        </p:selectOneMenu> 
                                        <h:outputText value="Descripción"/>
                                        <p:inputTextarea  cols="45" value="#{estanciaBean.sgDetalleSolicitudEstancia.descripcion}"/>
                                    </h:panelGrid>
                                </h:panelGrid>
                                <br/>
                                <center>
                                    <h:panelGrid columns="2">
                                        <p:commandLink value="Modificar" styleClass="btn btn-info" actionListener="#{estanciaBean.completarModificacionPopDetalleSolicitud(event)}"/>
                                        <p:commandLink value="Cancelar" styleClass="btn btn-default" actionListener="#{estanciaBean.cerrarPopDetalleSolicitud(event)}"/>
                                    </h:panelGrid>
                                </center>
                                <br/>
                                <center><h:messages errorClass="errorMessage" infoClass="infoMessage"/></center>
                            </h:panelGroup>
                        </f:facet>
                        </<p:dialog >
                            </h:form>

                            <!--Agregar acompañantes de la solicitud-->
                            <h:form >
                                <p:dialog   style="background: #FFFFFF;" 
                                            visible="#{estanciaBean.crearPop and estanciaBean.sgDetalleSolicitudEstancia != null}"
                                            draggable="false" modal="true">
                                    <f:facet name="header">
                                        <h:panelGroup > 
                                            <h:outputText  value="Agregar integrantes"
                                                           style="float: left; padding: 4px;text-align: center; vertical-align: middle;font: 11px;color: #484848; font-weight: bold;"/>
                                        </h:panelGroup>
                                    </f:facet>
                                    <f:facet name="body">
                                        <h:panelGroup>   
                                            <center><h:messages id="msgCrearSolicitudEstancia" errorClass="errorMessage" infoClass="infoMessage"/></center>                               
                                            <h:panelGrid width="550px">
                                                <h:outputText value="#{estanciaBean.mensaje}" styleClass="mensaje" style="color: red;"/><br/>
                                            </h:panelGrid>
                                            <h:outputText value="Agregar el o los integrantes  a la solicitud" styleClass="fnegrita"/>
                                            <h:panelGrid columns="5" styleClass="bordePanelGrid" >
                                                <h:panelGrid columns="1" cellspacing="0">
                                                    <h:outputText value="Tipo integrante"/>
                                                    <p:selectOneMenu value="#{estanciaBean.idTipoEspecifico}" 
                                                                     styleClass="form-control"

                                                                     valueChangeListener="#{estanciaBean.cambiarTipoEstancia}">
                                                        <f:selectItem itemValue="-1" itemLabel="Seleccione . . ."/>
                                                        <f:selectItems value="#{estanciaBean.listaTipoEspecifico}"/>
                                                    </p:selectOneMenu>
                                                </h:panelGrid>
                                                <h:panelGrid columns="1" rendered="#{estanciaBean.idTipoEspecifico eq 20}">
                                                    <h:outputText value="Nombre"/>
                                                    <!--p:inputText value="#{estanciaBean.sgDetalleSolicitudEstancia.invitado}" size="25"/-->
                                                    <h:panelGrid columns="2">
                                                        <p:selectOneMenu id="userSelectInv" immediate="true" 
                                                                         value="#{estanciaBean.invitado}" 
                                                                         valueChangeListener="#{estanciaBean.invitadoListener}">
                                                            <f:selectItems value="#{estanciaBean.listaSelectItemInvitado}}"/>
                                                            <f:facet name="selectInputText">
                                                                <h:panelGrid columns="2">
                                                                    <h:outputText id="autoCompleteNombre" value="#{inv.nombre}"/>
                                                                    <h:outputText id="autoCompleteEmpresa" value="#{inv.sgEmpresa.nombre}"/>
                                                                </h:panelGrid>
                                                            </f:facet>
                                                        </p:selectOneMenu>         
                                                        <p:commandLink value="+" styleClass="btn btn-default" actionListener="#{catalogoBean.abrirPopupAgregarInvitado(event)}"/> 
                                                    </h:panelGrid>

                                                </h:panelGrid>                                    
                                                <h:panelGrid columns="1" cellspacing="0" rendered="#{estanciaBean.idTipoEspecifico eq 19}">
                                                    <h:outputText value="Nombre"/>
                                                    <p:selectOneMenu id="userSelectEmpl" immediate="true"
                                                                     styleClass="form-control"
                                                                     value="#{estanciaBean.user}" 
                                                                     valueChangeListener="#{estanciaBean.usuarioListener}">
                                                        <f:selectItems value="#{estanciaBean.listaUsuariosAlta}}"/>
                                                        <f:facet name="selectInputText">
                                                            <h:outputText id="autoCompleteUser" value="#{analista.nombre}"/>
                                                        </f:facet>
                                                    </p:selectOneMenu> 
                                                </h:panelGrid>
                                                <h:panelGrid columns="2" cellspacing="0" rendered="#{estanciaBean.idTipoEspecifico eq 19 || estanciaBean.idTipoEspecifico eq 20}">
                                                    <h:panelGrid columns="1" cellspacing="0">
                                                        <h:outputText value="Descripción"/>
                                                        <p:inputTextarea value="#{estanciaBean.descripcion}" cols="35"/>
                                                    </h:panelGrid>
                                                    <p:commandLink value="+" styleClass="btn btn-default" title="Agregar a lista temporal" actionListener="#{estanciaBean.agregarUsuarioLista(event)}" rendered="#{estanciaBean.usuario != null or estanciaBean.sgInvitado != null}"/>
                                                </h:panelGrid>
                                            </h:panelGrid>
                                            <br/>
                                            <h:outputText value="Integrantes  de la solicitud (Temporales)" styleClass="fnegrita"/>
                                            <p:dataTable showGridlines="true" size="small"  value="#{estanciaBean.traerListaUsuario}" var="estaDe" >
                                                <p:column>
                                                    <f:facet name="header"><h:outputText value="Nombre"/></f:facet>
                                                    <h:outputText value="#{estaDe.nombre}"/>
                                                </p:column>
                                                <p:column>
                                                    <f:facet name="header"><h:outputText value="Empresa"/></f:facet>
                                                    <h:outputText value="#{estaDe.empresa}"/>
                                                </p:column>
                                                <p:column>
                                                    <f:facet name="header"><h:outputText value="Descripción"/></f:facet>
                                                    <h:outputText value="#{estaDe.descripcion}"/>
                                                </p:column>
                                                <p:column>
                                                    <p:commandLink value="Quitar" styleClass="linkPequenio" actionListener="#{estanciaBean.quitarUsuarioLista(event)}"/>
                                                </p:column>
                                            </p:dataTable>
                                            <br/>
                                            <center>
                                                <h:panelGrid columns="2" >
                                                    <h:panelGrid columns="2" cellspacing="8" rendered="#{estanciaBean.traerListaUsuario != null}">
                                                        <p:commandLink value="#{msgs['sistema.guardar']}" styleClass="btn btn-info" actionListener="#{estanciaBean.guardarDetalleSolicitud(event)}"/>
                                                    </h:panelGrid>    
                                                    <h:panelGrid>
                                                        <p:commandLink value="#{msgs['sistema.cerrar']}" styleClass="btn btn-default" actionListener="#{estanciaBean.cerrarPopDetalleSolicitud(event)}"/>
                                                    </h:panelGrid>
                                                </h:panelGrid>                                  
                                            </center>
                                        </h:panelGroup>
                                    </f:facet>
                                    </<p:dialog >
                                        </h:form>
                                        <ui:include src="/vistas/sgl/administrar/popupsInvitado.xhtml"/>

                                        </ui:define>
                                        </ui:composition>

                                        </body>
                                        </html>
