<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
              
     
      >
    <body>
        <ui:composition template="./../../../WEB-INF/facelets/templates/templateServiciosGenerales.xhtml">
            <ui:define name="contenido">
                <h:form   >
                    <br/>
                    <p class="tituloEncabezado"> <h:outputText rendered="#{mantenimientoBean.operacionTerminarRegistro eq 'TRUE' }" value="Este vehiculo esta actualmente en mantenimiento" /></p>                        
                    <p class="tituloEncabezado"><h:outputText rendered="#{mantenimientoBean.operacionTerminarRegistro eq 'FALSE' }"  value="Registro de entrada a mantenimiento"/>                        </p>
                    <br/>

                    <h:panelGrid rendered="#{mantenimientoBean.sgMantenimiento != null}"  styleClass="bordePanelGrid">
                        <h:outputText style="color: #666666;" value="#{mantenimientoBean.sgVehiculo.sgOficina.nombre}"/>
                        <h:panelGrid columns="2" >
                            <h:outputLabel style="color: #666666;" value="Vehiculo:"/>
                            <h:outputText style="color: #666666;" value="#{mantenimientoBean.sgVehiculo.nombre}"/>
                            <h:outputLabel style="color: #666666;" value="Serie:"/>
                            <h:outputText style="color: #666666;" value="#{mantenimientoBean.sgVehiculo.serie}"/>
                            <h:outputLabel style="color: #666666;" value="Color:"/>
                            <h:outputText style="color: #666666;" value="#{mantenimientoBean.sgVehiculo.color}"/>  
                            <h:outputLabel style="color: #666666;" value="Ingreso:"/>
                            <h:outputText style="color: #666666;" value="#{mantenimientoBean.sgMantenimiento.fechaIngreso}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                            <h:outputLabel style="color: #666666;" value="KM :"/>
                            <h:outputText style="color: #666666;" value="#{mantenimientoBean.sgMantenimiento.sgKilometraje.kilometraje}"/>                                    
                            <h:outputLabel style="color: #666666;" value="Poveedor :"/>
                            <h:outputText style="color: #666666;" value="#{mantenimientoBean.sgMantenimiento.proveedor.nombre}"/>

                        </h:panelGrid>
                        <p:inputTextarea disabled="true" cols="50" rows="2" style="color: #666666;" value="#{mantenimientoBean.sgMantenimiento.observacion}"/>

                    </h:panelGrid>

                    <h:panelGrid columns="2">
                        <h:panelGrid  >                               
                            <h:panelGrid columns="2">
                                <h:panelGrid columns="2" style="text-align: end;">
                                    <p:commandLink title="Regresar al catalogo" styleClass="btn btn-default" action="#{mantenimientoBean.goToAdministrarVehiculo()}"  >
                                        <h:graphicImage url="#{msgs['sgl.ruta.imagen']}button_back.png" 
                                                          styleClass="imagenSinBorde"/>                            
                                    </p:commandLink>                        
                                </h:panelGrid>           
                                <p:commandLink value="Regresar al catalogo"  action="#{mantenimientoBean.goToAdministrarVehiculo()}" styleClass="linkPequenio" />   
                            </h:panelGrid>
                        </h:panelGrid>                        
                        <h:panelGrid rendered="#{mantenimientoBean.operacionTerminarRegistro eq 'FALSE' }" >                               
                            <h:panelGrid columns="2">
                                <h:panelGrid columns="2" style="text-align: end;">
                                    <p:commandLink title="Registrar entrada a mantenimiento" styleClass="btn btn-default" actionListener="#{mantenimientoBean.mostrarPopupEntrada(event)}"  >
                                        <h:graphicImage url="#{msgs['sgl.ruta.imagen']}button_create.png" 
                                                          styleClass="imagenSinBorde"/>                            
                                    </p:commandLink>                        
                                </h:panelGrid>           
                                <p:commandLink value="mantenimiento"  actionListener="#{mantenimientoBean.mostrarPopupEntrada(event)}" styleClass="linkPequenio" />   
                            </h:panelGrid>
                        </h:panelGrid>
                    </h:panelGrid>
                    <center>
                        <p:dataTable id="dataGridMantenimientos" 
                                     value="#{mantenimientoBean.listaMantenimientoPreventivo}"
                                     rows="8"                              
                                     var="data">                      

                            <p:column>
                                <f:facet name="header"><h:outputText value="Fecha Ingreso"/></f:facet>
                                <center>
                                    <h:outputText value="#{data['fechaIngreso']}">
                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                    </h:outputText>
                                </center>
                            </p:column>
                            <p:column>
                                <f:facet name="header"><h:outputText value="Fecha Salida"/></f:facet>
                                <center>
                                    <h:outputText value="#{data['fechaSalida']}">
                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                    </h:outputText>
                                </center>
                            </p:column>
                            <p:column>
                                <f:facet name="header"><h:outputText value="Tipo Mantenimiento"/></f:facet>
                                <h:outputText value="#{data['sgKilometraje'].sgTipoEspecifico.nombre}">                                        
                                </h:outputText>                                    
                            </p:column>                                
                            <p:column>
                                <f:facet name="header"><h:outputText value="Kilometraje"/></f:facet>
                                <h:outputText value="#{data['sgKilometraje'].kilometraje}">
                                    <!-- <f:convertNumber type="number" groupingUsed="true" /> -->
                                </h:outputText>
                            </p:column>
                            <p:column>
                                <f:facet name="header"><h:outputText value="Proveedor"/></f:facet>
                                <h:outputText value="#{data['proveedor'].nombre}"/>
                            </p:column>
                            <p:column>
                                <f:facet name="header"><h:outputText value="Importe"/></f:facet>
                                <center> <h:outputText value="#{data['importe']}">
                                        <f:convertNumber currencySymbol="$" maxFractionDigits="2" type="currency" groupingUsed="true" />
                                    </h:outputText>
                                    <h:outputText value="(#{data['moneda'].nombre})"/>
                                </center>
                            </p:column>                                
                            <p:column>
                                <f:facet name="header"><h:outputText value="Proximo kilometraje para mtto."/></f:facet>
                                <center>
                                    <h:outputText value="#{data['proxMantenimientoKilometraje']}">
                                        <!-- <f:convertNumber type="number"  groupingUsed="true" /> -->
                                    </h:outputText>
                                </center>
                            </p:column>                                
                            <p:column>
                                <f:facet name="header"><h:outputText value="Proxima fecha para mtto."/></f:facet>
                                <center>
                                    <h:outputText value="#{data['proxMantenimientoFecha']}">
                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                    </h:outputText>
                                </center>
                            </p:column>
                            <p:column>
                                <f:facet name="header"><h:outputText value="ObservaciÃ³n"/></f:facet>
                                <p:inputTextarea cols="25" disabled="true" rows="2"  value="#{data['observacion']}"/>
                            </p:column>   
                            <p:column>     
                                <h:panelGrid columns="2">
                                    <p:commandLink value="Subir comprobante" rendered="#{data['terminado'] eq 'False' and data['siAdjunto'].id == null }"
                                                     actionListener="#{mantenimientoBean.mostrarPopupSubirArchivo(event)}" styleClass="link"/>
                                    <!--  value="/ServiciosGenerales/AbrirArchivo?a=#{data['siAdjunto'].id}" -->
                                    <h:outputLink rendered="#{data['terminado'] eq 'False' and data['siAdjunto'] != null}" 
                                                    target="_blank" value="/ServiciosGenerales/AbrirArchivo?ZWZ2W=#{data['siAdjunto'].id}&amp;ZWZ3W=#{data['siAdjunto'].uuid}">
                                        <h:outputText value="Abrir" styleClass="link" rendered="#{data['terminado'] eq 'False' and data['siAdjunto'] != null}" />
                                    </h:outputLink>                                   
                                    <p:commandLink actionListener="#{mantenimientoBean.eliminarArchivo(event)}" onclick="if(!confirm('EstÃ¡ seguro de eliminar el archivo #{data['siAdjunto'].nombre}...? ')) return false;">
                                        <center>
                                            <h:outputText value="Quitar" styleClass="link" rendered="#{data['terminado'] eq 'False' and data['siAdjunto'] != null}"/>
                                        </center>
                                    </p:commandLink>
                                </h:panelGrid>
                            </p:column>
                            <p:column>                            
                                <p:commandLink rendered="#{data['terminado'] eq 'False'}" value="Modificar" actionListener="#{mantenimientoBean.mostrarPopupModificarEntrada(event)}"  styleClass="link"/>                            
                            </p:column>
                            <p:column>                            
                                <p:commandLink rendered="#{data['terminado'] eq 'False'}" value="Eliminar" actionListener="#{mantenimientoBean.eliminarRegistroEntradaMantenimiento(event)}"
                                                 onclick="if(!confirm('EstÃ¡ seguro de eliminar el registro de mantenimiento ...? ')) return false;"
                                                 styleClass="link"/>                            
                            </p:column>
                        </p:dataTable>a
                    </center>
                </h:form >
                <h:form rendered="#{not empty sesion.usuario}"   styleClass="textoIzquierda">
                    <p:dialog  header="Registrar entrada a mantenimiento " >
                        <h:panelGrid >
                            <h:panelGrid>
                                <center><h:messages errorClass="mensaje" infoClass="mensaje"/></center>  
                            </h:panelGrid> 
                            <p:selectOneRadio value="#{mantenimientoBean.seleccionRadio}"  disabled="#{mantenimientoBean.mrPopupModificarEntrada}"
                                                valueChangeListener="#{mantenimientoBean.seleccionarOperacion}"
                                                 >                            
                                <f:selectItem itemValue="Ase" itemLabel="Aseguradoras"  />
                                <f:selectItem itemValue="Pro" itemLabel="Taller de Mantenimiento" />                                
                            </p:selectOneRadio>
                        </h:panelGrid>
                        <h:panelGrid  columns="3" >                         
                            <h:outputLabel value="Proveedor :" />
                            <!-- selectedPanel="#{mantenimientoBean.seleccionRadio}"-->
                            <p:panel   >
                                <h:panelGroup id="Ase">
                                    <p:selectOneMenu value="#{mantenimientoBean.idProveedorSeleccionado}" disabled="#{mantenimientoBean.mrPopupModificarEntrada}"
                                                       >                                                                                                                                   
                                        <f:selectItem itemValue="-1" itemLabel="Seleccione..."/>
                                        <f:selectItems value="#{mantenimientoBean.listaAseguradorasItems}"/>
                                    </p:selectOneMenu>
                                </h:panelGroup>
                                <h:panelGroup id="Pro">
                                    <p:selectOneMenu  value="#{mantenimientoBean.idProveedorSeleccionado}" disabled="#{mantenimientoBean.mrPopupModificarEntrada}"
                                                        >                                                                                                          
                                        <f:selectItem itemValue="-1" itemLabel="Seleccione..."/>
                                        <f:selectItems value="#{mantenimientoBean.listaTalleresItems}"/>
                                    </p:selectOneMenu>
                                </h:panelGroup>
                            </p:panel>
                            <h:outputText/>

                        </h:panelGrid>
                        <h:panelGrid columns="2">
                            <h:outputLabel value="Tipo de mantenimiento :"/>
                            <h:panelGrid columns="2">
                                <p:selectOneMenu value="#{mantenimientoBean.idTipoMantenimientoEspecifico}" >
                                    <f:selectItem itemValue="-1" itemLabel="Seleccione..." />    
                                    <f:selectItems value="#{mantenimientoBean.listaTipoMantenimientoItems}"/>
                                </p:selectOneMenu>                                           
                            </h:panelGrid>                                                                
                            <h:outputLabel value="Kilometraje actual:"/>                           
                            <h:panelGrid columns="2">
                                <p:inputText value="#{mantenimientoBean.kilometraje}" />                                                        
                                <h:outputText style="color: #666666;" value="actual( #{mantenimientoBean.kilometrajeActualOld} )" />
                            </h:panelGrid>
                            <h:outputLabel value="Fecha de Ingreso:"/>
                            <h:panelGrid columns="2">
                                
                                <p:datePicker  id="rFechaIngreso"   
                                                      value="#{mantenimientoBean.fechaIngreso}"                                                      
                                                      required="true"
                                                      >
                                    <f:convertDateTime pattern="dd/MM/yyyy"
                                                       timeZone="America/Monterrey"/>  
                                </p:datePicker>  
                            </h:panelGrid>
                        </h:panelGrid>
                        <h:panelGrid>
                            <h:outputLabel value="Observaciones : " />
                            <p:inputTextarea value="#{mantenimientoBean.observaciones}" cols="65" rows="3">
                            </p:inputTextarea>
                        </h:panelGrid>
                        <h:panelGrid columns="2"> <!-- action="/vistas/sgl/vehiculo/administrarVehiculo"-->                                  
                            <p:commandLink  rendered="#{mantenimientoBean.mrPopupModificarEntrada eq false}" actionListener="#{mantenimientoBean.registrarEntradaMantenimiento(event)}" value="Guardar"  styleClass="btn btn-info"/>  
                            <p:commandLink  rendered="#{mantenimientoBean.mrPopupModificarEntrada  eq true}" actionListener="#{mantenimientoBean.modificarRegistroEntradaMantenimiento(event)}" value="Guardar ModificaciÃ³n"  styleClass="btn btn-info"/>                                
                            <p:commandLink value="Cancelar" actionListener="#{mantenimientoBean.ocultarPopupEntradaMantenimiento}" styleClass="btn btn-default" immediate="true"/>                                        
                        </h:panelGrid>
                    </my:panelPopup>
                </h:form>
                <!-- adjuntar archivo -->
                <h:form styleClass="textoIzquierda">
                    <p:dialog   style="background: #FFFFFF;" 
                                    visible="#{mantenimientoBean.mrSubirArchivo}"
                                    draggable="false" modal="true">
                        <f:facet name="header">
                            <h:panelGroup > 
                                <h:outputText  value="Adjuntar archivo"
                                                 style="float: left; padding: 4px;text-align: center; vertical-align: middle;font: 11px;color: #484848; font-weight: bold;"/>
                                <p:commandButton title="#{msgs['sgl.ruta.imagen']}icon_bad.png"
                                                   style="vertical-align: middle;margin: 4px;display: inline; float: right;"/>
                            </h:panelGroup>
                        </f:facet>
                        <f:facet name="body">
                            <h:panelGroup>
                                <h:panelGrid columns="5">
                                    <h:outputText value="Archivos"/>
                                    <p:fileUpload  id="fileEntryPago"
                                                   listener="#{mantenimientoBean.subirComprobanteMantenimiento}" 
                                                   />
                                    <h:commandButton value="Subir" action="#{mantenimientoBean.uploadFile}"> 
                                        <input type="hidden" name="cid" 
                                               value="#{javax.enterprise.context.conversation.id}" /> 
                                    </h:commandButton>
                                    <p:commandLink value="Cancelar" styleClass="btn btn-default" 
                                                     actionListener="#{mantenimientoBean.ocultarPopupSubirArchivo(event)}" immediate="true"/>
                                </h:panelGrid>
                            </h:panelGroup>
                        </f:facet>
                    </<p:dialog >
                </h:form>

                <h:form  rendered="#{not empty sesion.usuario}"   styleClass="textoIzquierda">
                    <p:dialog  header="Registrar salida de mantenimiento ">
                        <h:panelGrid>
                            <center><h:messages errorClass="mensaje" infoClass="mensaje"/></center>  
                        </h:panelGrid> 
                        <h:panelGrid columns="2">
                            <h:outputLabel value="Fecha de Salida :" />
                            <p:datePicker id="fechaSalida" 
                                                   
                                                 value="#{mantenimientoBean.sgMantenimiento.fechaSalida}"                                                      
                                                 required="true"
                                                 >
                                <f:convertDateTime pattern="dd/MM/yyyy"
                                                   timeZone="America/Monterrey"/>  
                            </p:datePicker>  
                            <h:outputLabel value="Importe :" />
                            <p:inputText  value="#{mantenimientoBean.sgMantenimiento.importe}"   />
                            <h:outputLabel value="Moneda :" />
                            <p:selectOneMenu value="#{mantenimientoBean.idMoneda}" >
                                <f:selectItem itemLabel="Seleccione. . ." itemValue="-1"/>
                                <f:selectItems value="#{mantenimientoBean.listaMondedaItems}"/>
                            </p:selectOneMenu>                                    
                        </h:panelGrid>
                        <h:panelGrid columns="2" rendered="#{mantenimientoBean.capturaProximoMtto eq true}" styleClass="borderPanelGrid">
                            <h:outputLabel value="Kilometraje para prox. mantenimiento :" />
                            <p:inputText id="sProxKilomentraje" value="#{mantenimientoBean.sgMantenimiento.proxMantenimientoKilometraje}"  />
                            <h:outputLabel value="Fecha para prox. mantenimiento :" />
                            <h:panelGrid columns="2">
                                <p:datePicker id="fechaProximoMantenimiento" 
                                                       
                                                     value="#{mantenimientoBean.sgMantenimiento.proxMantenimientoFecha}"                                                      
                                                     validator="#{mantenimientoBean.validaFecha}"                                                             
                                                     >
                                    <f:convertDateTime pattern="dd/MM/yyyy"
                                                       timeZone="America/Monterrey"/>  
                                </p:datePicker>     
                            </h:panelGrid>
                        </h:panelGrid>
                        <h:panelGrid columns="2">
                            <p:commandLink value="Guardar" actionListener="#{mantenimientoBean.registrarSalidaMantenimiento(event)}"  styleClass="btn btn-info"/>                                
                            <p:commandLink value="Cancelar" actionListener="#{mantenimientoBean.ocultarPopupSalida(event)}" styleClass="btn btn-default" immediate="true" />                                        
                        </h:panelGrid>
                    </my:panelPopup>
                </h:form>
                <h:panelGrid  rendered="#{empty sesion.usuario}"  styleClass="altura">
                    <ui:include src="./../../../login.xhtml"/>
                </h:panelGrid>
            </ui:define>
        </ui:composition>
    </body>
</html>
