<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html">

    <body>

        <ui:composition template="./../templates/template.xhtml">
            <ui:define name="tituloPagina">
                Asignar Requisiciones
            </ui:define>
            <ui:define name="contenido">        

                 
                <ui:include src="../../SiaWeb/Requisiciones/fragmentos/popUpProcesoAprobarRequisicion.xhtml"/>      
                <h:form id="form1">      
                    <p:panel id="pnlAutorizacion" styleClass="background-transparent" >              
                        <div class="row">
                            <div id="divOperacion" class="intput-group" style="display: none;">                                
                                <p:commandLink value="Regresar" styleClass="btn btn-default" 
                                               action="#{requisicionBean.limpiarRequisicion}"
                                               onclick="regresar('divTabla', 'divDatos', 'divOperacion', 'divAutoriza')"
                                               update="form1 frmMenu" process="@this"/>
                                <p:commandLink value="Devolver" styleClass="btn btn-default" 
                                               action="#{requisicionBean.devolverRequisicion}"
                                               title="Clic aquí para devolver la requisición..."
                                               process="@this" update="frmDev frmMenu"/>  
                                <p:selectOneMenu id="listaAnalistas" value="#{requisicionBean.idAnalista}"
                                                 
                                                 autoWidth="true" >
                                    <f:selectItem itemLabel="Analista de compras . . ." itemValue="-1"/>
                                    <f:selectItems value="#{requisicionBean.listaAnalista}" />                                      
                                </p:selectOneMenu>    
                                <ui:fragment rendered="#{requisicionBean.requisicionActual != null}">                                    
                                    <p:commandButton value="Asignar" 
                                                     styleClass="btn btn-default"
                                                     style="font-weight: bold;"
                                                     action="#{requisicionBean.asignarRequisicion}"                                                     
                                                     process="@this form1:listaAnalistas" update="form1 frmMenu"
                                                     >                                      
                                    </p:commandButton>                                 
                                </ui:fragment>                                                              
                            </div>                
                        </div>
                    </p:panel>
                    <div id="divTabla" class="container-fluid"> 
                        <div>
                            <span id="msgAsignaRequisicion" style="color: red;" class="textoRojo"></span>
                        </div>
                        <div>
                            <h:message for="msgAsignaRequisicion" style="color: red;" infoClass="infoMessage" errorClass="errorMessage" />
                        </div>
                        <div class="row">
                            <div class="col-12">
                                <div class="table table-responsive">
                                    <p:tabView id="tbAsig"
                                               tabindex="#{requisicionBean.indexTab}" onTabChange="#{requisicionBean.seleccionarTabAsignarRequisicion()}"
                                               >
                                        <p:tab title="Requisiciones" >
                                            <div class="form-inline">
                                                <div class=" form-group ">
                                                    <p:selectOneMenu  id="listaAnalistasSinInv" value="#{requisicionBean.idAnalista}">
                                                        <f:selectItem itemLabel="Analista de compras . . ." itemValue="-1"/>
                                                        <f:selectItems value="#{requisicionBean.listaAnalista}"/>
                                                    </p:selectOneMenu>  
                                                    <div class="input-group-append">                                                        
                                                        <p:commandButton value="Asignar" 
                                                                         styleClass="btn btn-default m-1 btn-sm font-weight-bold"                                                                 
                                                                         action="#{requisicionBean.asignarVariasRequisicionesSinInventario}"
                                                                         process="form1:tbAsig:dataTableAsignar form1:tbAsig:listaAnalistasSinInv @this"                                                                           
                                                                         update="form1 frmMenu"
                                                                         >                                                            
                                                        </p:commandButton>
                                                        <p:commandLink value="Devolver" styleClass="btn btn-default btn-operacion btn-sm mr-1 font-weight-bold"
                                                                       action="#{requisicionBean.inicioDevolverRequisicionesAsignar()}"
                                                                       process="@this form1:tbAsig:dataTableAsignar" update="frmDevV"/>
                                                        <p:commandLink value="Cancelar" styleClass="btn btn-default btn-operacion font-weight-bold"
                                                                       action="#{requisicionBean.inicioCancelarRequisicionesAsignar()}"
                                                                       process="@this form1:tbAsig:dataTableAsignar" update="frmCanReqV"/>
                                                    </div>
                                                </div>
                                            </div>
                                            <p:dataTable size="small" stripedRows="true" showGridlines="true"  id="dataTableAsignar" 
                                                         value="#{requisicionBean.listaRequisiciones}" 
                                                         var="currentRow"                                                             
                                                         rowKey="#{currentRow.id}"                                                          
                                                         selection="#{requisicionBean.requisicionesSeleccionadas}"
                                                         reflow="true" 
                                                         emptyMessage="Sin registros"
                                                         paginator="true"  
                                                         rows="15" 
                                                         paginatorPosition="bottom" 
                                                         >
                                                <p:column width="25" selectionMode="multiple">
                                                </p:column>
                                                <p:column width="90">
                                                    <h:outputText value="#{currentRow['consecutivo']}"/>
                                                    <f:facet name="header">
                                                        <h:outputText value="Código"/>
                                                    </f:facet>
                                                </p:column>                        
                                                <p:column>
                                                    <h:outputText value="#{currentRow['solicita']}"/>
                                                    <f:facet name="header">
                                                        <h:outputText value="Solicita"/>
                                                    </f:facet>
                                                </p:column>                        
                                                <p:column width="120">
                                                    <h:outputText value="#{currentRow['gerencia']}"/>
                                                    <f:facet name="header">
                                                        <h:outputText value="Gerencia"/>
                                                    </f:facet>
                                                </p:column>
                                                <p:column>
                                                    <h:outputText value="#{currentRow['referencia']}"/>
                                                    <f:facet name="header">
                                                        <h:outputText value="Referencia"/>
                                                    </f:facet>
                                                </p:column>
                                                <p:column >
                                                    <h:outputText value="#{currentRow['fechaSolicitada']}">
                                                        <f:convertDateTime dateStyle="default" type="date"/>
                                                    </h:outputText>
                                                    <f:facet name="header">
                                                        <h:outputText value="Solicitada"/>
                                                    </f:facet>
                                                </p:column>
                                                <p:column >
                                                    <h:outputText value="#{currentRow['fechaRequerida']}">
                                                        <f:convertDateTime dateStyle="default" type="date"/>
                                                    </h:outputText>
                                                    <f:facet name="header">
                                                        <h:outputText value="Requerida"/>
                                                    </f:facet>
                                                </p:column>
                                                <p:column >
                                                    <h:outputText value="#{currentRow['prioridad']}"/>
                                                    <f:facet name="header">
                                                        <h:outputText value="Prioridad"/>
                                                    </f:facet>
                                                </p:column>
                                                <p:column width="50">
                                                    <p:commandLink action="#{requisicionBean.seleccionarRequisicion(currentRow.id)}"
                                                                    styleClass="d-none d-md-inline d-lx-inline btn btn-link"
                                                                   title="Clic aquí para ver los items de la requisición..."
                                                                   process="@this" update="form1:tbRequi form1:lblReq form1:pnlAutorizacion">
                                                        <i class="fa fa-eye text-primary"/>
                                                    </p:commandLink>
                                                    
                                                    <p:commandLink action="#{requisicionBean.seleccionarRequisicion(currentRow.id)}"
                                                                   styleClass="d-xs-inline d-md-none d-lx-none btn btn-outline-secondary btn-block"
                                                                   title="Clic aquí para ver los items de la requisición..."
                                                                   process="@this" update="form1:tbRequi form1:lblReq form1:pnlAutorizacion">
                                                        <i class="fa fa-eye "/> Detalle
                                                    </p:commandLink>
                                                </p:column>
                                            </p:dataTable>
                                        </p:tab>
                                        <p:tab title="Con inventario (#{requisicionBean.totalReqConInventario}) ">
                                            <div class="row intput-group">
                                                <p:selectOneMenu id="listaAnalistasConInv" value="#{requisicionBean.idAnalista}">
                                                    <f:selectItem itemLabel="Analista de compras . . ." itemValue="-1"/>
                                                    <f:selectItems  value="#{requisicionBean.listaAnalista}"/>
                                                </p:selectOneMenu>  
                                                <p:commandButton value="Asignar" 
                                                                 styleClass="btn btn-default"
                                                                 style="font-weight: bold;"
                                                                 action="#{requisicionBean.asignarVariasRequisicionesConInventario()}"
                                                                 process="form1:tbAsig:dtAsiginv form1:tbAsig:listaAnalistasConInv @this"
                                                                 update="form1:tbAsig frmMenu">                                                                                                          
                                                </p:commandButton>
                                                <p:commandLink value="Devolver" styleClass="btn btn-default"
                                                               action="#{requisicionBean.inicioDevolverRequisicionesAsignar()}"
                                                               style="font-weight: bold;" process="@this form1:tbAsig:dtAsiginv" update="frmDevV frmMenu"/>
                                                <p:commandLink value="Cancelar" styleClass="btn btn-default"
                                                               action="#{requisicionBean.inicioCancelarRequisicionesAsignar()}"
                                                               style="font-weight: bold;" process="@this form1:tbAsig:dtAsiginv" update="frmCanReqV frmMenu "/>
                                            </div>
                                            <p:dataTable id="dtAsiginv" size="small" stripedRows="true" showGridlines="true"   
                                                         value="#{requisicionBean.listaRequisicionesConInventario}" 
                                                         var="currentRow" 
                                                         rowKey="#{currentRow.id}" selection="#{requisicionBean.requisicionesSeleccionadas}"
                                                         reflow="true" 
                                                         emptyMessage="Sin registros"
                                                         paginator="true"  
                                                         rows="15" 
                                                         paginatorPosition="bottom" 
                                                         >
                                                <p:column width="25" selectionMode="multiple">
                                                </p:column>
                                                <p:column width="90">
                                                    <h:outputText value="#{currentRow['consecutivo']}"/>
                                                    <f:facet name="header">
                                                        <h:outputText value="Código"/>
                                                    </f:facet>
                                                </p:column>                        
                                                <p:column>
                                                    <h:outputText value="#{currentRow['solicita']}"/>
                                                    <f:facet name="header">
                                                        <h:outputText value="Solicita"/>
                                                    </f:facet>
                                                </p:column>                        
                                                <p:column width="120">
                                                    <h:outputText value="#{currentRow['gerencia']}"/>
                                                    <f:facet name="header">
                                                        <h:outputText value="Gerencia"/>
                                                    </f:facet>
                                                </p:column>
                                                <p:column>
                                                    <h:outputText value="#{currentRow['referencia']}"/>
                                                    <f:facet name="header">
                                                        <h:outputText value="Referencia"/>
                                                    </f:facet>
                                                </p:column>
                                                <p:column>
                                                    <h:outputText value="#{currentRow['fechaSolicitada']}">
                                                        <f:convertDateTime dateStyle="default" type="date"/>
                                                    </h:outputText>
                                                    <f:facet name="header">
                                                        <h:outputText value="Solicitada"/>
                                                    </f:facet>
                                                </p:column>
                                                <p:column >
                                                    <h:outputText value="#{currentRow['fechaRequerida']}">
                                                        <f:convertDateTime dateStyle="default" type="date"/>
                                                    </h:outputText>
                                                    <f:facet name="header">
                                                        <h:outputText value="Requerida"/>
                                                    </f:facet>
                                                </p:column>
                                                <p:column >
                                                    <h:outputText value="#{currentRow['prioridad']}"/>
                                                    <f:facet name="header">
                                                        <h:outputText value="Prioridad"/>
                                                    </f:facet>
                                                </p:column>
                                                <p:column width="50">
                                                    <p:commandLink   styleClass="d-none d-md-inline d-lx-inline btn btn-link"
                                                                     action="#{requisicionBean.seleccionarRequisicion(currentRow.id)}"
                                                                   title="Clic aquí para ver los items de la requisición..."
                                                                   process="@this" update="form1:tbRequi form1:lblReq form1:pnlAutorizacion">
                                                        <i class="fa fa-eye text-primary"/>
                                                    </p:commandLink>
                                                    <p:commandLink  styleClass="d-xs-inline d-md-none d-lx-none btn btn-outline-secondary btn-block"
                                                                     action="#{requisicionBean.seleccionarRequisicion(currentRow.id)}"
                                                                   title="Clic aquí para ver los items de la requisición..."
                                                                   process="@this" update="form1:tbRequi form1:lblReq form1:pnlAutorizacion">
                                                                 <i class="fa fa-eye text-primary"/> Detalle
                                                    </p:commandLink>
                                                </p:column>
                                            </p:dataTable>
                                        </p:tab>
                                    </p:tabView>

                                </div>
                            </div>  
                        </div>   
                        <!-- aqui va el panel oculto de mas informacion de la requisición -->
                    </div>

                    <div id="divDatos" style="display: none;">
                        <div class="col-5" style="padding-top: 5px;">
                            <h:outputText value="Más información de la requisición: "/>
                            <h:outputText id="lblReq" value="#{requisicionBean.requisicionActual.consecutivo}" style="font-weight:  bold;"/>
                        </div>
                        <p:tabView id="tbRequi" activeIndex="0">
                            <p:tab title="Más Información">
                                <ui:include src="../Requisiciones/fragmentos/masInfoNoAccion.xhtml"/>
                            </p:tab>
                            <p:tab title="ETS">
                                <ui:include src="../Requisiciones/verETS.xhtml"/>
                            </p:tab>
                            <p:tab title="Estatus">
                                <ui:include src="../Requisiciones/verEstatus.xhtml"/>
                            </p:tab>
                            <p:tab title="Devoluciones">
                                <ui:include src="../Requisiciones/verDevoluciones.xhtml"/>
                            </p:tab>
                        </p:tabView>                                        
                    </div>
                </h:form>                

                <style>
                    .background-transparent .ui-panel-content {
                        background: transparent !important;
                        border : 0 !important;
                    }
                    a.ui-button {
                        margin: .5rem;
                        padding: 1px
                    }
                     a.ui-commandlink.btn-operacion {
                        margin: .2rem;
                        padding: 0px auto 0px auto;                                                
                    }
                    .ui-selectonemenu-items-wrapper{
                        /*Hace que el max-height del combo de los analistas sea auto*/
                        max-height: max-content !important;                        
                        /*background-color: rgba(100,100,100,0.9) !important;*/
                        border: 1px #F8AC48 solid  !important;
                        
                    }
                </style>
            </ui:define>            
        </ui:composition>
    </body>
</html>
