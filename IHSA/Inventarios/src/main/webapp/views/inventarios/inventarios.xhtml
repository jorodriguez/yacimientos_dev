<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ihsa="http://java.sun.com/jsf/composite/widgets"
                template="/WEB-INF/templates/crud.xhtml">

    <ui:define name="tituloPagina">
        #{msg['sia.inventarios.inventarios.modulo']}
    </ui:define>
    <ui:define name="titulo">
        #{msg['sia.inventarios.inventarios.titulo']}
        <a href="#{request.contextPath}/resources/videos/ayuda/inventarios.mp4" class="link-ayuda" target="_blank">Ayuda</a>
    </ui:define>

    <!-- onevent="mostrarDialogoAjax" -->
    <ui:define name="botones">
        <p:commandLink id="cmdNuevo" value="#{msg['sia.inventarios.inventarios.crearAlmacen']}" action="#{inventario.agregarNuevo}"
                       immediate="true" styleClass="hbutton-cr"
                       rendered="#{not roles.esEmpleadoDeAlmacen()}"
                       process="@this" update="hdTituloDialogo panelInformacion almacenComponente articuloComponente" 

                       >
        </p:commandLink>
        <h:outputText id="hdTituloDialogo" value="#{inventario.articuloBean.embedded ? articulo.unidadBean.embedded ? unidad.esNuevoElemento ? msg['sia.inventarios.catalogo.unidades.crearTitulo'] : msg['sia.inventarios.catalogo.unidades.editarTitulo'] : articulo.esNuevoElemento ? msg['sia.inventarios.articulos.crearTitulo'] : msg['sia.inventarios.articulos.editarTitulo'] : inventario.almacenBean.embedded ? almacen.esNuevoElemento ? msg['sia.inventarios.almacenes.crearTitulo'] : msg['sia.inventarios.almacenes.editarTitulo'] : inventario.esNuevoElemento ? msg['sia.inventarios.inventarios.crearTitulo'] : msg['sia.inventarios.inventarios.editarTitulo']}" styleClass="hidden"/>
        <button type="button" id="btnBuscar" data-icon="ui-icon-search">#{msg['sia.inventarios.comun.buscar']}</button>
    </ui:define>

    <ui:define name="filtros">
        <h:panelGrid columns="2" width="500px" id="panelFiltro">
            <h:outputText value="#{msg['sia.inventarios.inventarios.almacen']}:"/>
            <h:selectOneMenu id="smFiltroAlmacen" value="#{inventario.inventarioVO.almacenId}" styleClass="ui-widget ui-inputfield ui-state-default ui-state-optional">
                <f:selectItem itemLabel="#{msg['sia.inventarios.comun.seleccione']}" itemValue="#{null}" noSelectionOption="true" />
                <f:selectItems value="#{inventario.almacenes}" var="u" itemLabel="#{u.nombre}" itemValue="#{u.id}"/>
            </h:selectOneMenu>
            <h:outputText value="#{msg['sia.inventarios.inventarios.articulo']}:"/>
            <h:panelGroup>
                <h:inputText value="#{inventario.inventarioVO.articuloNombre}" id="txtFiltroArticulo"
                             styleClass="articuloAutoComplete ui-inputfield ui-textentry ui-widget ui-state-optional ui-corner-all ui-autocomplete-input"/>
                <h:inputHidden value="#{inventario.inventarioVO.articuloId}" id="hdFiltroArticuloId"/>
            </h:panelGroup>
            <h:outputText value="#{msg['sia.inventarios.inventarios.numeroUnidades']}:"/>
            <h:inputText id="txtFiltroNumeroUnidades" value="#{inventario.inventarioVO.numeroUnidades}" label="#{msg['sia.inventarios.inventarios.numeroUnidades']}" styleClass="ui-inputfield ui-textentry ui-widget ui-state-optional ui-corner-all"/>
            <h:outputText value="#{msg['sia.inventarios.inventarios.minimoUnidades']}:"/>
            <h:inputText id="txtFiltroMinimoUnidades" value="#{inventario.inventarioVO.minimoUnidades}" label="#{msg['sia.inventarios.inventarios.minimoUnidades']}" styleClass="ui-inputfield ui-textentry ui-widget ui-state-optional ui-corner-all"/>
            <h:outputText value="#{msg['sia.inventarios.inventarios.fechaUltimaRevision']}:"/>
            <p:datePicker id="dtFiltroFechaUltimaRevision"
                          value="#{inventario.inventarioVO.fechaUltimaRevision}"
                          pattern="dd/MM/yyyy"
                          />
        </h:panelGrid>
        <div class="filtro-butones">
            <p:commandLink  value="#{msg['sia.inventarios.inventarios.buscar']}" action="#{inventario.buscarInventario}" 
                            styleClass="hbutton-bu" process="@this panelFiltro" update="@form">
            </p:commandLink>
            <p:commandLink value="#{msg['sia.inventarios.comun.reestablecer']}" action="#{inventario.reestablecerTabla}" 
                           styleClass="hbutton-re" process="@this panelFiltro" update="@form">
            </p:commandLink>
        </div>
    </ui:define>
    <ui:define name="tabla">
        <p:dataTable id="tablaDatos"  value="#{inventario.inventarios}" var="i"
                     paginator="true" paginatorAlwaysVisible="true"
                     paginatorPosition="bottom" rows="15" showGridlines="true" size="small" 
                     >
            <p:column id="id" headerText="#" sortBy="#{i.id}" style="width: 5px"
                      >
                <h:outputText value="#{i.id}"/>
            </p:column>
            <p:column id="almacen" headerText="#{msg['sia.inventarios.inventarios.almacen']}" sortBy="#{i.almacenNombre}" style="width: 200px">
                <h:outputText value="#{i.almacenNombre}"/>
            </p:column>
            <p:column id="articulo" headerText="#{msg['sia.inventarios.inventarios.articulo']}" sortBy="#{i.articuloNombre}" style="width: 360px">
                <h:outputText value="#{i.articuloNombre}"/>
            </p:column>
            <p:column id="ubiArticulo" headerText="Ubicación" sortBy="#{i.ubicacion}" style="width: 80px; text-align: center;">
                <h:outputText value="#{i.ubicacion}"/>
            </p:column>
            <p:column id="numeroUnidades" headerText="Disponibles" sortBy="#{i.numeroUnidades}" style="width: 50px; text-align: center;">
                <h:outputText value="#{i.numeroUnidades}"/>
            </p:column>
            <p:column id="minimoUnidades" headerText="Mínimo" sortBy="#{i.minimoUnidades}" style="width: 50px"> 
                <h:outputText value="#{i.minimoUnidades}"/>
            </p:column>
            <p:column id="maximoDeInventario" headerText="Máximo" sortBy="#{i.maximoDeInventario}" style="width: 50px">
                <h:outputText value="#{i.maximoDeInventario}"/>
            </p:column>
            <p:column id="puntoDeReorden" headerText="#{msg['sia.inventarios.inventarios.puntoDeReorden']}" sortBy="#{i.minimoUnidades}" style="width: 50px">
                <h:outputText value="#{i.puntoDeReorden}"/>
            </p:column>
            <p:column id="fechaUltimaRevision" headerText="#{msg['sia.inventarios.inventarios.fechaUltimaRevision']}" sortBy="#{i.fechaUltimaRevision}" style="width: 300px">
                <h:outputText value="#{inventario.fechaConFormato(i.fechaUltimaRevision)}"/>
            </p:column>
            <!--rendered="#{not roles.esEmpleadoDeAlmacen()}"-->
            <p:column style="width: 105px" styleClass="icon-column" >
                <p:commandLink title="#{msg['sia.inventarios.comun.editar']}" action="#{inventario.cargarElementParaEditar(i.id)}"
                               rendered="#{not roles.esEmpleadoDeAlmacen()}"
                               process="@this" oncomplete="$(mostrarDialogoAjax).modal('show')"
                               update="frmContenido:panelInformacion">
                    Editar
                </p:commandLink>
                <p:commandLink title="#{msg['sia.inventarios.comun.eliminar']}" 
                               action="#{inventario.eliminar(i.id)}" value="Eliminar"
                               rendered="#{roles.esAdministradorDeInventarios()}"
                               process="@this" update="@form">
                </p:commandLink>
            </p:column>
            <p:ajax event="page"/>
        </p:dataTable>
    </ui:define>
    <ui:define name="datos">
        <h:panelGroup id="panelInformacion" style="display: #{not inventario.almacenBean.embedded and not inventario.articuloBean.embedded ? 'block' : 'none'}">
            <table class="table-form">
                <tr>
                    <td style="width: 150px" class="bold">#{msg['sia.inventarios.inventarios.almacen']}:<span class="required">*</span></td>
                    <td >
                        <div>
                            <h:selectOneMenu id="smAlmacen" value="#{inventario.inventarioVO.almacenId}" styleClass="ui-widget ui-inputfield ui-state-default ui-state-optional"
                                             required="true" requiredMessage="#{msg['sia.validaciones.required']}">
                                <f:selectItem itemLabel="#{msg['sia.inventarios.comun.seleccione']}" itemValue="#{null}" noSelectionOption="true" />
                                <f:selectItems value="#{inventario.almacenes}" var="a" itemLabel="#{a.nombre}" itemValue="#{a.id}"/>
                                <f:ajax event="change" render="msjAlmacen cmbRack" listener="#{inventario.seleccionarAlmacen}"/>
                            </h:selectOneMenu>
                            <p:commandLink styleClass="crear-foraneo" action="#{inventario.nuevoAlamacen}" immediate="true"
                                           >
                                <h:graphicImage library="images" name="icon-catalog-link.png"/>
                                <f:ajax onevent="fijarTituloDialogo" render="@all" />
                            </p:commandLink>
                        </div>
                        <h:message for="smAlmacen" id="msjAlmacen" styleClass="ui-widget ui-corner-all ui-state-error input-msg"/>
                    </td>
                </tr>
                <tr>
                    <td class="bold">#{msg['sia.inventarios.inventarios.articulo']}:<span class="required">*</span></td>
                    <td>
                        <div>
                            <h:inputText value="#{inventario.inventarioVO.articuloNombre}" id="txtArticulo"
                                         styleClass="articuloAutoComplete ui-inputfield ui-textentry ui-widget ui-state-optional ui-corner-all ui-autocomplete-input" style="width: 93%">
                                <f:ajax event="change" render="msjArticulo" execute="@this hdArticuloId"/>
                            </h:inputText>
                            <h:inputHidden value="#{inventario.inventarioVO.articuloId}" id="hdArticuloId" required="true" 
                                           requiredMessage="#{msg['sia.validaciones.required']}"/>
                            <!--p:commandLink styleClass="crear-foraneo" action="#{inventario.nuevoArticulo}" immediate="true">
                                <h:graphicImage library="images" name="icon-catalog-link.png"/>
                                <f:ajax onevent="fijarTituloDialogo" render="@all" />
                            </p:commandLink-->
                        </div>
                        <h:message for="hdArticuloId" id="msjArticulo" styleClass="ui-widget ui-corner-all ui-state-error input-msg"/>
                    </td>
                </tr>
                <tr>
                    <td>#{msg['sia.inventarios.inventarios.numeroUnidades']}:</td>
                    <td>
                        <h:inputText id="txtNumeroUnidades" value="#{inventario.inventarioVO.numeroUnidades}" label="#{msg['sia.inventarios.inventarios.numeroUnidades']}"
                                     styleClass="ui-inputfield ui-textentry ui-widget ui-state-optional ui-corner-all #{inventario.esNuevoElemento ? '' : 'ui-disabled'}"
                                     validatorMessage="#{msg['sia.inventarios.comun.numeroValidacion']}" readonly="#{not inventario.esNuevoElemento}"/>
                        <h:message for="txtNumeroUnidades" id="msjNumeroUnidades" styleClass="ui-widget ui-corner-all ui-state-error input-msg"/>
                    </td>
                </tr>
                <tr>
                    <td>#{msg['sia.inventarios.inventarios.minimoUnidades']}:</td>
                    <td>
                        <h:inputText id="txtMinimoUnidades" value="#{inventario.inventarioVO.minimoUnidades}" label="#{msg['sia.inventarios.inventarios.minimoUnidades']}"
                                     styleClass="ui-inputfield ui-textentry ui-widget ui-state-optional ui-corner-all"
                                     validatorMessage="#{msg['sia.inventarios.comun.numeroValidacion']}"/>
                        <h:message for="txtMinimoUnidades" id="msjMinimoUnidades" styleClass="ui-widget ui-corner-all ui-state-error input-msg"/>
                    </td>
                </tr>
                <tr>
                    <td class="bold">#{msg['sia.inventarios.inventarios.maximoDeInventario']}:<span class="required">*</span></td>
                    <td>
                        <h:inputText id="txtMaximoDeInventario" value="#{inventario.inventarioVO.maximoDeInventario}" label="#{msg['sia.inventarios.inventarios.maximoDeInventario']}"
                                     styleClass="ui-inputfield ui-textentry ui-widget ui-state-optional ui-corner-all"
                                     required="true" requiredMessage="#{msg['sia.validaciones.required']}"
                                     validatorMessage="#{msg['sia.inventarios.comun.numeroValidacion']}">
                            <f:ajax event="blur" render="msjMaximoDeInventario"/>
                        </h:inputText>
                        <h:message for="txtMaximoDeInventario" id="msjMaximoDeInventario" styleClass="ui-widget ui-corner-all ui-state-error input-msg"/>
                        <div class="almacen-user-info">
                            #{msg["sia.inventarios.inventarios.leyendaCeroRequerido"]}
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="bold">#{msg['sia.inventarios.inventarios.puntoDeReorden']}:<span class="required">*</span></td>
                    <td>
                        <h:inputText id="txtPuntoDeReorden" value="#{inventario.inventarioVO.puntoDeReorden}" label="#{msg['sia.inventarios.inventarios.puntoDeReorden']}"
                                     styleClass="ui-inputfield ui-textentry ui-widget ui-state-optional ui-corner-all"
                                     required="true" requiredMessage="#{msg['sia.validaciones.required']}"
                                     validatorMessage="#{msg['sia.inventarios.comun.numeroValidacion']}">
                            <f:ajax event="blur" render="msjPuntoDeReorden"/>
                        </h:inputText>
                        <h:message for="txtPuntoDeReorden" id="msjPuntoDeReorden" styleClass="ui-widget ui-corner-all ui-state-error input-msg"/>
                        <div class="almacen-user-info">
                            #{msg["sia.inventarios.inventarios.leyendaCeroRequerido"]}
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>#{msg['sia.inventarios.inventarios.fechaUltimaRevision']}:</td>
                    <td>
                        <p:datePicker id="dtFechaUltimaRevision"
                                      value="#{inventario.inventarioVO.fechaUltimaRevision}"
                                      pattern="dd/MM/yyyy"
                                      maxdate="#{inventario.currentDate}"/>
                    </td>
                </tr>
            </table>
            <h:panelGrid columns="4">
                <h:panelGrid columns="3">
                    <h:outputText value="Rack"/>
                    <h:selectOneMenu id="cmbRack" value="#{inventario.celdaVo.idRack}" required="true" requiredMessage="Rack">
                        <f:selectItem itemLabel="s/s" itemValue="#{null}"  noSelectionOption="true"/>
                        <f:selectItems value="#{inventario.racks}" var="rack" itemLabel="#{rack.codigo}" itemValue="#{rack.id}" />
                        <f:ajax listener="#{inventario.seleccionarRack}" execute="@this" render="cmbPiso tblCelda"/>
                    </h:selectOneMenu>
                    <h:message for="cmbRack" id="msjRack" styleClass="ui-widget ui-corner-all ui-state-error input-msg"/>
                </h:panelGrid>                
                <h:panelGrid columns="3">
                    <h:outputText value="Piso"/>
                    <h:selectOneMenu id="cmbPiso" value="#{inventario.celdaVo.idPiso}" required="true" requiredMessage="Piso">  
                        <f:selectItem itemLabel="s/s" itemValue="#{null}"  noSelectionOption="true"/>
                        <f:selectItems value="#{inventario.pisos}" var="piso" itemLabel="#{piso.celda}" itemValue="#{piso.id}"/>
                        <f:ajax listener="#{inventario.seleccionarPiso}" execute="@this" render="tblCelda"/>
                    </h:selectOneMenu> 
                    <h:message for="cmbPiso" id="msjPiso" styleClass="ui-widget ui-corner-all ui-state-error input-msg"/>
                </h:panelGrid>
                <h:panelGrid columns="3">
                    <h:outputText  value="Estante"/>
                    <h:dataTable id="tblCelda" value="#{inventario.inventarioVO.celdas}" var="celda" >
                        <h:column> 
                            <h:selectBooleanCheckbox value="#{celda.selected}" class="seleccion"/>
                        </h:column>
                        <h:column>
                            <h:outputText value="#{celda.celda}"/>
                        </h:column>
                    </h:dataTable>
                </h:panelGrid>
                <h:commandButton styleClass="hbutton" value="Agregar" 
                                 action="#{inventario.agregarUbicacion}" 
                                 onclick="return verificaSeleccion('seleccion');">
                    <f:ajax execute="panelInformacion" render="tblUbicacion" />
                </h:commandButton>                
            </h:panelGrid>
            <h:panelGroup id="panelUbicacion">
                <p:dataTable id="tblUbicacion" value="#{inventario.celdas}" var="dataCel" 
                             rowIndexVar="indice">
                    <p:column headerText="Ubicación">
                        <h:outputText value="#{dataCel.celda}"/>
                    </p:column>
                    <p:column>
                        <p:commandLink value="Quitar" action="#{inventario.eliminarCeldaTemporal(indice)}"
                                       style="color: red;" process="@this" update="frmContenido:tblUbicacion">
                            <!--f:ajax execute="@this" render="@this"/-->
                        </p:commandLink>
                    </p:column>
                </p:dataTable>
            </h:panelGroup>
            <!--  -->
            <p:commandButton styleClass="hbutton" value="#{msg['sia.inventarios.comun.guardar']}" 
                             action="#{inventario.guardarInventario}" process="@this panelInformacion panelFiltro" 
                             update="frmContenido"/>
        </h:panelGroup>
        <h:panelGroup id="almacenComponente" style="display: #{inventario.almacenBean.embedded ? 'block' : 'none'}">
            <ihsa:almacen embedded="true"></ihsa:almacen>
        </h:panelGroup>
        <h:panelGroup id="articuloComponente" style="display: #{inventario.articuloBean.embedded ? 'block' : 'none'}">
            <ihsa:articulo embedded="true"></ihsa:articulo>
        </h:panelGroup>        

    </ui:define>

    <ui:param name="confirmarEliminar" value="#{msg['sia.inventarios.inventarios.confirmarEliminar']}"/>
    <!--ui:param name="mensajePaginacion" value="{inventario.mensajePaginacion}" /-->
    <ui:param name="dialogoAncho" value="600"/>


</ui:composition>
