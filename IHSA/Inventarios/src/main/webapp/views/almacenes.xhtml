<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ihsa="http://java.sun.com/jsf/composite/widgets"
                template="/WEB-INF/templates/crud.xhtml">

    <ui:define name="tituloPagina">
        #{msg['sia.inventarios.almacenes.modulo']}
    </ui:define>

    <ui:define name="titulo">
        #{msg['sia.inventarios.almacenes.titulo']}
        <a href="#{request.contextPath}/resources/videos/ayuda/almacenes.mp4" class="link-ayuda" target="_blank">Ayuda</a>
    </ui:define>

    <ui:define name="contenido">
        <h:form id="frmAlm">
            <p:commandLink id="cmdNuevo" value="#{msg['sia.inventarios.almacenes.crearAlmacen']}" action="#{almacen.agregarNuevo}" immediate="true" styleClass="hbutton-cr"
                           rendered="#{not roles.esEmpleadoDeAlmacen()}"
                           process="@this" update="frmAlmacen" oncomplete="$(dialogoAlmacen).modal('show');">
            </p:commandLink>
            <h:panelGrid columns="2" id="panelFiltro">
                <h:panelGrid columns="6" >
                    <h:outputText value="#{msg['sia.inventarios.comun.nombre']}: "/>
                    <h:outputText value="#{msg['sia.inventarios.comun.descripcion']}:"/>
                    <h:outputText value="#{msg['sia.inventarios.almacenes.supervisor']}:"/>
                    <h:outputText value="#{msg['sia.inventarios.almacenes.responsable']} 1:"/>
                    <h:outputText value="#{msg['sia.inventarios.almacenes.responsable']} 2:"/>
                    <h:outputText value="Bloque:"/>
                    <h:inputText id="txtFiltroNombre" value="#{almacen.filtro.nombre}" styleClass="form-control"/>
                    <h:inputText id="txtFiltroDescripcion" value="#{almacen.filtro.descripcion}" styleClass="form-control"/>
                    <h:selectOneMenu id="smSupervisor" value="#{almacen.filtro.supervisorUsuarioId}" styleClass="custom-select">
                        <f:selectItem itemLabel="#{msg['sia.inventarios.comun.seleccione']}" itemValue="#{null}" noSelectionOption="true" />
                        <f:selectItems value="#{almacen.usuarios}" var="u" itemLabel="#{u.nombre}" itemValue="#{u.id}"/>
                    </h:selectOneMenu>
                    <h:selectOneMenu id="smFiltroResponsable1" value="#{almacen.filtro.responsable1UsuarioId}" styleClass="custom-select">
                        <f:selectItem itemLabel="#{msg['sia.inventarios.comun.seleccione']}" itemValue="#{null}" noSelectionOption="true" />
                        <f:selectItems value="#{almacen.usuarios}" var="u" itemLabel="#{u.nombre}" itemValue="#{u.id}"/>
                    </h:selectOneMenu>
                    <h:selectOneMenu id="smFiltroResponsable2" value="#{almacen.filtro.responsable2UsuarioId}" styleClass="custom-select">
                        <f:selectItem itemLabel="#{msg['sia.inventarios.comun.seleccione']}" itemValue="#{null}" noSelectionOption="true" />
                        <f:selectItems value="#{almacen.usuarios}" var="u" itemLabel="#{u.nombre}" itemValue="#{u.id}"/>
                    </h:selectOneMenu>
                    <h:selectOneMenu id="smFiltroCampo" value="#{almacen.filtro.idCampo}" styleClass="custom-select">
                        <f:selectItem itemLabel="- Seleccione -" itemValue="#{null}" noSelectionOption="true" />
                        <f:selectItems value="#{almacen.campos}" var="c" itemLabel="#{c.campo}" itemValue="#{c.idCampo}"/>
                    </h:selectOneMenu>
                </h:panelGrid>
                <h:panelGrid>
                    <p:commandLink  value="#{msg['sia.inventarios.almacenes.buscar']}" action="#{almacen.buscar}" styleClass="hbutton-bu"
                                    process="@this frmAlm:panelFiltro" update="frmAlm:tablaDatos">
                    </p:commandLink>
                    <p:commandLink value="#{msg['sia.inventarios.comun.reestablecer']}" action="#{almacen.reestablecer}" 
                                   styleClass="hbutton-re" process="@this" update="@form">
                    </p:commandLink>
                </h:panelGrid>
            </h:panelGrid>

            <p:dataTable id="tablaDatos" showGridlines="true" size="small"
                         value="#{almacen.lista}"
                         lazy="true"
                         var="a"
                         paginator="true"
                         paginatorPosition="bottom"
                         rows="#{almacen.tamanioPagina}">
                <p:column id="id" headerText="#{msg['sia.inventarios.almacenes.id']}" sortBy="#{a.id}" style="width: 100px">
                    <h:outputText value="#{a.id}"/>
                </p:column>
                <p:column id="nombre" headerText="#{msg['sia.inventarios.comun.nombre']}" sortBy="#{a.nombre}" style="width: 250px">
                    <h:outputText value="#{a.nombre}"/>
                </p:column>
                <p:column id="bloque" headerText="Bloque" sortBy="#{a.campo}" style="width: 300px">
                    <h:outputText value="#{a.campo}"/>
                </p:column>
                <p:column id="descripcion" headerText="#{msg['sia.inventarios.comun.descripcion']}" sortBy="#{a.descripcion}" style="width: 300px">
                    <h:outputText value="#{a.descripcion}"/>
                </p:column>
                <p:column id="supervisor" headerText="#{msg['sia.inventarios.almacenes.supervisor']}" sortBy="#{a.supervisorNombre}" style="width: 250px">
                    <h:outputText value="#{a.supervisorNombre}"/>
                </p:column>
                <p:column id="responsable1" headerText="#{msg['sia.inventarios.almacenes.responsable']} 1" sortBy="#{a.responsable1Nombre}" style="width: 250px">
                    <h:outputText value="#{a.responsable1Nombre}"/>
                </p:column>
                <p:column id="responsable2" headerText="#{msg['sia.inventarios.almacenes.responsable']} 2" sortBy="#{a.responsable2Nombre}" style="width: 250px">
                    <h:outputText value="#{a.responsable2Nombre}"/>
                </p:column>
                <p:column style="width: 80px" styleClass="icon-column" rendered="#{not roles.esEmpleadoDeAlmacen()}">
                    <p:commandLink title="#{msg['sia.inventarios.comun.editar']}" action="#{almacen.cargarElementParaEditar(a.id)}" rendered="#{not roles.esEmpleadoDeAlmacen()}"
                                   process="@this" update="frmAlmacen" oncomplete="$(dialogoAlmacen).modal('show');">
                        <i class="fa fa-pencil fa-large"></i>
                    </p:commandLink>
                    <p:commandLink  title="#{msg['sia.inventarios.comun.eliminar']}" 
                                    action="#{almacen.eliminarElemento(a.id)}" 
                                    rendered="#{roles.esAdministradorDeInventarios()}"
                                    process="@this" update="@form">
                        <i class="fa fa-times fa-large"></i>    
                    </p:commandLink>
                </p:column>
            </p:dataTable>
        </h:form>
        <!-- Dialoogo para crear almacenes-->

        <div class="modal fade" id="dialogoAlmacen" data-backdrop="static" data-keyboard="false">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">                    
                        <h4 class="modal-title">Editar Inventario</h4>
                    </div>
                    <h:form id="frmAlmacen">
                        <div class="modal-body">
                            <div class="row">
                                <h:panelGroup id="panelInformacion">
                                    <table class="table-form">
                                        <tr>
                                            <td style="width: 120px" class="bold">#{msg['sia.inventarios.comun.nombre']}:<span class="required">*</span></td>
                                            <td >
                                                <h:inputText value="#{almacen.elemento.nombre}" id="txtNombre" required="true" label="Nombre" requiredMessage="#{msg['sia.validaciones.required']}"
                                                             styleClass="form-control">
                                                    <f:ajax event="blur" render="msjNombre"/>
                                                </h:inputText>
                                                <h:message for="txtNombre" id="msjNombre" styleClass="ui-widget ui-corner-all ui-state-error input-msg"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>#{msg['sia.inventarios.comun.descripcion']}:</td>
                                            <td>
                                                <h:inputTextarea id="txtDescripcion" value="#{almacen.elemento.descripcion}" styleClass="form-control"
                                                                 rows="5" cols="50"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>#{msg['sia.inventarios.almacenes.supervisor']}:</td>
                                            <td>
                                                <h:selectOneMenu id="smSupervisor" value="#{almacen.elemento.supervisorUsuarioId}" styleClass="custom-select" style="width: 200px">
                                                    <f:selectItem itemLabel="#{msg['sia.inventarios.comun.seleccione']}" itemValue="#{null}" noSelectionOption="true" />
                                                    <f:selectItems value="#{almacen.usuarios}" var="u" itemLabel="#{u.nombre}" itemValue="#{u.id}"/>
                                                </h:selectOneMenu>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td >#{msg['sia.inventarios.almacenes.responsable']} 1:</td>
                                            <td >
                                                <h:selectOneMenu id="smResponsable1" value="#{almacen.elemento.responsable1UsuarioId}" styleClass="custom-select" style="width: 200px">
                                                    <f:selectItem itemLabel="#{msg['sia.inventarios.comun.seleccione']}" itemValue="#{null}" noSelectionOption="true" />
                                                    <f:selectItems value="#{almacen.usuarios}" var="u" itemLabel="#{u.nombre}" itemValue="#{u.id}"/>
                                                </h:selectOneMenu>
                                                <h:message for="smResponsable1" id="msjResponsable1" styleClass="ui-widget ui-corner-all ui-state-error input-msg"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>#{msg['sia.inventarios.almacenes.responsable']} 2:</td>
                                            <td>
                                                <h:selectOneMenu id="smResponsable2" value="#{almacen.elemento.responsable2UsuarioId}" styleClass="custom-select" style="width: 200px">
                                                    <f:selectItem itemLabel="#{msg['sia.inventarios.comun.seleccione']}" itemValue="#{null}" noSelectionOption="true" />
                                                    <f:selectItems value="#{almacen.usuarios}" var="u" itemLabel="#{u.nombre}" itemValue="#{u.id}"/>
                                                </h:selectOneMenu>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td></td>
                                            <td class="almacen-user-info">
                                                #{msg["sia.inventarios.almacenes.leyendaUsuarios"]}
                                            </td>
                                        </tr>
                                    </table>
                                </h:panelGroup>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <p:commandButton styleClass="hbutton" value="#{msg['sia.inventarios.comun.guardar']}" 
                                             action="#{almacen.guardarElemento}" 
                                             title="#{msg['sia.inventarios.comun.crearRegistro']}"
                                             process="@form" update="frmAlm">
                            </p:commandButton>
                            <p:commandLink value="Cancelar" 
                                           action="#{almacen.cancelar}" 
                                           immediate="true" oncomplete="$(dialogoAlmacen).modal('hide');">
                            </p:commandLink>                            
                        </div>
                    </h:form>
                </div>
            </div>
        </div>
    </ui:define>
    <ui:define name="datos">
        <!--h:panelGroup id="almacenComponente">
            <ihsa:almacen></ihsa:almacen>
        </h:panelGroup-->
    </ui:define>

    <ui:param name="confirmarEliminar" value="#{msg['sia.inventarios.almacenes.confirmarEliminar']}"/>
    <ui:param name="mensajePaginacion" value="#{almacen.mensajePaginacion}" />
    <ui:param name="dialogoAncho" value="515" />
</ui:composition>
