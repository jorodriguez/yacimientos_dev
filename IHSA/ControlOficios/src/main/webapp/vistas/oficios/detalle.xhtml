<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"      
      xmlns:p="http://primefaces.org/ui"      
      xmlns:f="http://java.sun.com/jsf/core">

    <body>
        <ui:composition template="./../../WEB-INF/template/template.xhtml">
            <ui:define name="content">
                <h:panelGroup rendered="#{empty sesion.usuario}">
                    <ui:include src="../../salir.xhtml"/>
                </h:panelGroup>
                <h:form styleClass="textoIzquierda" rendered="#{not empty sesion.usuario}" id="formOficios">

                    <div class="page-header">
                        <h3>
                            #{oficioDetalleBean.tituloPagina}
                        </h3>
                    </div>
                   

                    <!-- Mensajes con estilos de Bootstrap  -->
                    <h:message style="display: block;"
                               for=""
                               infoClass="alert alert-success"
                               warnClass="alert alert-warning"
                               errorClass="alert alert-danger"
                               fatalClass="alert alert-danger"
                               />

                    <div class="jumbotron">

                        <div class="row" style="font-weight: bold;">
                            <div class="col-sm-12">
                                <h:outputLabel class="h4" value="#{oficioDetalleBean.vo.oficioNumero} - #{oficioDetalleBean.vo.oficioAsunto}"/>
                            </div>
                        </div> <!-- row -->

                        <hr />

                        <ul id="tabs" class="nav nav-tabs" data-tabs="tabs">
                            <li class="active">
                                <a href="#divInformacionOficio" data-toggle="tab">Información</a>
                            </li>
                            <li><a href="#divAsociadoHaciaOficios" data-toggle="tab">Asociado A Oficio (<span style="color: red;">#{oficioDetalleBean.vo.asociadoHaciaOficios.size()}</span>)</a></li>
                            <!-- 
                                El oficio solo podrá estar asociado desde otros oficios cuando este oficio esté
                                en estatus Terminado. 
                            -->
                            <ui:fragment rendered="#{oficioDetalleBean.vo.estatusTerminado}">
                                <li><a href="#divAsociadoDesdeOficios" data-toggle="tab">Asociado Por Oficio (<span style="color: red;">#{oficioDetalleBean.vo.asociadoDesdeOficios.size()}</span>)</a></li>
                            </ui:fragment>
                            <ui:fragment rendered="#{oficioDetalleBean.vo.restringido}">
                                <li><a href="#divUsuariosAcceso" data-toggle="tab">Acceso a Usuarios</a></li>
                            </ui:fragment>
                            <li><a href="#divHistorialMovimientos" data-toggle="tab">Historial Movimientos</a></li>
                        </ul>

                        <p />

                        <div id="my-tab-content" class="tab-content">                            
                            <!-- ······························· INICIA TAB ······························· -->

                            <div class="tab-pane fade in active" id="divInformacionOficio">

                                <div class="row">
                                    <div class="col-sm-2">
                                        Compa&ntilde;&iacute;a
                                    </div>
                                    <div class="col-sm-6">
                                        #{oficioDetalleBean.vo.companiaNombre}
                                    </div>
                                    <div class="col-sm-2">
                                        Fecha de Oficio
                                    </div>
                                    <div class="col-sm-2">
                                        #{oficioDetalleBean.vo.oficioFechaFormato}
                                    </div>
                                </div> <!-- row -->

                                <div class="row">
                                    <div class="col-sm-2">
                                        Bloque
                                    </div>
                                    <div class="col-sm-6">
                                        #{oficioDetalleBean.vo.bloqueNombre}
                                    </div>
                                    <div class="col-sm-2">
                                        Fecha de Alta
                                    </div>
                                    <div class="col-sm-2">
                                        #{oficioDetalleBean.vo.fechaGeneroFormato}
                                    </div>
                                </div> <!-- row -->

                                <div class="row">
                                    <div class="col-sm-2">
                                        Gerencia
                                    </div>
                                    <div class="col-sm-6">
                                        #{oficioDetalleBean.vo.gerenciaNombre}
                                    </div>
                                    <div class="col-sm-2">
                                        Urgente
                                    </div>
                                    <div class="col-sm-2">
                                        <h:outputText value="#{oficioDetalleBean.vo.urgente ? 'Sí' : 'No'}" />
                                    </div>
                                </div> <!-- row -->

                                <div class="row">
                                    <div class="col-sm-2">
                                        Estatus
                                    </div>
                                    <div class="col-sm-6">
                                        <h:graphicImage 
                                            value="../../resources/imagenes/estatus_oficio/estatus_oficio_#{oficioDetalleBean.vo.tipoOficioId}_#{oficioDetalleBean.vo.estatusId}.png"
                                            title="#{oficioDetalleBean.vo.tipoOficioNombre} - #{oficioDetalleBean.vo.estatusNombre}"/>
                                    </div>
                                    <div class="col-sm-2">
                                        Seguimiento
                                    </div>
                                    <div class="col-sm-2">
                                        <h:outputText value="#{oficioDetalleBean.vo.requiereSeguimiento ? 'Sí' : 'No'}" />
                                    </div>
                                </div> <!-- row -->


                                <div class="row">
                                    <div class="col-sm-2">
                                        Registrado Por
                                    </div>
                                    <div class="col-sm-6">
                                        #{oficioDetalleBean.vo.usuarioGeneroNombre}
                                    </div>
                                    <div class="col-sm-2">
                                        Acceso
                                    </div>
                                    <div class="col-sm-2">
                                        #{oficioDetalleBean.vo.acceso}
                                    </div>
                                </div> <!-- row -->

                                <div class="row">
                                    <div class="col-sm-12">
                                    </div>
                                </div> <!-- row -->

                                <div class="row">
                                    <div class="col-sm-2">
                                        #{msgs['sistema.oficios.comun.observaciones']}
                                    </div>
                                    <div class="col-sm-10">
                                        <h:outputText value="#{oficioDetalleBean.vo.observaciones}" rendered="#{not empty oficioDetalleBean.vo.observaciones}" />
                                        <h:outputText value="No proporcionado" rendered="#{empty oficioDetalleBean.vo.observaciones}" style="font-style: italic; color: gray;" />
                                    </div>
                                </div> <!-- row -->

                                <div class="row">
                                    <div class="col-sm-12">
                                    </div>
                                </div> <!-- row -->

                                <div class="row">
                                    <div class="col-sm-2">
                                        Archivos Adjuntos
                                    </div>
                                    <div class="col-sm-10">
                                        <!--ice:dataTable rows="10" width="100%" value="{oficioDetalleBean.vo.movimientosAdjuntosActivos}" var="movimiento"-->
                                        <p:dataTable 
                                            showGridlines="false" 
                                            size="small" 
                                            rows="10"                                              
                                            value="#{oficioDetalleBean.vo.movimientosAdjuntosActivos}" 
                                            var="movimiento">

                                            <!-- Columna de archivo adjunto -->

                                            <p:column>
                                                <h:outputText 
                                                    value="#{movimiento.adjunto.nombreUUID}" 
                                                    rendered="#{movimiento.tieneAdjunto()}"/>
                                                <f:facet name="header">
                                                    <h:outputText value="Nombre de Archivo"/>
                                                </f:facet>
                                            </p:column>

                                            <!-- Columna para icono de visualizacion / descarga -->

                                            <p:column style="width:10%" rendered="#{oficioDetalleBean.permisos.verArchivoAdjuntoHistorialOficio}">

                                                <!-- Icono de vista previa -->

                                                <h:commandLink title="Vista previa"
                                                               actionListener="#{oficioDetalleBean.prepararAdjuntoVisor(event)}"
                                                               rendered="#{oficioDetalleBean.permisos.verArchivoAdjuntoHistorialOficio 
                                                                           and movimiento.tieneAdjunto()
                                                                           and movimiento.adjunto.visualizable}"
                                                               styleClass="link"
                                                               onclick="$(modalVerAdjunto).modal('show');" >
                                                    <center>
                                                        <img src="../../resources/imagenes/preview.png" border="0" />
                                                    </center>
                                                    <f:param name="adjuntoId" value="#{movimiento.adjunto.id}" />   
                                                </h:commandLink>
                                                                                       
                                            </p:column>
                                            <p:column style="width:10%" rendered="#{oficioDetalleBean.permisos.verArchivoAdjuntoHistorialOficio}">

                                                <!-- Inicia TEMPORAL 2/sep/14 - Permitir descarga -->

                                                <h:outputLink 
                                                    target="_blank" 
                                                    style="width: 10px"
                                                    rendered="#{movimiento.tieneAdjunto()
                                                        and (oficioDetalleBean.permisos.descargarArchivoAdjuntoHistorialOficio 
                                                        or oficioDetalleBean.permisos.verArchivoAdjuntoHistorialOficio)}"
                                                    value="/ControlOficios/DACOF?ZWZ2W=#{movimiento.adjunto.id}&amp;ZWZ3W=#{movimiento.adjunto.uuid}&amp;Z4BX2=#{movimiento.oficioId}&amp;4PC4WZ=0&amp;user=#{sesion.usuario.id}"
                                                    >
                                                    <center>
                                                        <p:graphicImage 
                                                            url="../../resources/imagenes/descargar.gif"  
                                                            alt="Descargar archivo" 
                                                            title="Descargar archivo" />
                                                    </center>
                                                </h:outputLink>

                                                <!-- Termina TEMPORAL 2/sep/14 - Permitir descarga -->

                                            </p:column>

                                            <!-- Inicia Edición de archivo adjunto -->

                                            <p:column style="width: 10px;" rendered="#{oficioDetalleBean.mostrarEdicionArchivos()}">

                                                <p:commandLink
                                                   style="text-align: left;"                                                   
                                                   action="#{oficioDetalleBean.editarAdjuntoAction()}"
                                                   rendered="#{oficioDetalleBean.linkEditarAdjunto.visible and movimiento.tieneAdjunto()}"
                                                   title="Editar Adjunto"                                                   
                                                   >                                        
                                                    <img src="../../resources/imagenes/editar.png" border="0" />
                                                    <f:param name="oficioId" value="#{movimiento.oficioId}"  />
                                                    <f:param name="movimientoId" value="#{movimiento.id}" />
                                                    <f:param name="oficioMovimientoId" value="#{movimiento.oficioMovimientoId}" />
                                                </p:commandLink>                                                 
                                                <f:facet name="header">
                                                    <h:outputText value="-"/>
                                                </f:facet>
                                            </p:column>

                                            <!-- Termina Edición de archivo adjunto -->

                                        </p:dataTable>
                                    </div>
                                </div> <!-- row -->

                                <hr />

                                <div class="row">
                                    <div class="col-sm-12">

                                    </div>
                                </div> <!-- row -->

                                <div class="row">
                                    <div class="col-sm-12" style="text-align: right">

                                        <!-- Boton Promover para cambiar de estatus al oficio -->
                                        <!--
                                        <p:button
                                                        outcome="#{oficioDetalleBean.botonPromover.accion.toString()}"                                                         
                                                        includeViewParams="true"                                                        
                                                        value="#{oficioDetalleBean.botonPromover.valor}ppp"
                                                        rendered="#{oficioDetalleBean.botonPromover.visible}"
                                                        title="#{oficioDetalleBean.botonPromover.titulo}"
                                                        styleClass="ui-button-raised ui-button-success"                                                        
                                                        icon="pi pi-check"
                                                        >                                                                                                                
                                                        <f:param name="oficioId" value="#{oficioDetalleBean.vo.oficioId}" />                                                        
                                        </p:button>
                                        -->
                                        <p:commandButton 
                                                        action="#{oficioDetalleBean.goToActionAndSendOficioId(oficioDetalleBean.botonPromover.accion)}"
                                                        value="#{oficioDetalleBean.botonPromover.valor}"
                                                        rendered="#{oficioDetalleBean.botonPromover.visible}"
                                                        title="#{oficioDetalleBean.botonPromover.titulo}"
                                                        styleClass="ui-button-raised ui-button-success"                                                        
                                                        icon="pi pi-check">
                                             <f:param name="oficioId" value="#{oficioDetalleBean.vo.oficioId}" />                                                        
                                        </p:commandButton>
                                        
                                        
                                        <h:outputText value="&nbsp;" />


                                        <!--<p:button
                                                        outcome="editar"                                                         
                                                        includeViewParams="true"                                                        
                                                        value="Modificar"
                                                        rendered="#{oficioDetalleBean.botonModificar.visible}"
                                                        title="Modificar oficio"
                                                        styleClass="ui-button-raised ui-button-info"
                                                        icon="fa fa-edit"
                                                        >                                                                                                                
                                                    <f:param name="oficioId" value="#{oficioDetalleBean.vo.oficioId}" />
                                          </p:button>-->
                                        <p:commandButton 
                                                        action="#{oficioDetalleBean.seleccionarEditarOficio()}"
                                                        value="Modificar"
                                                        rendered="#{oficioDetalleBean.botonModificar.visible}"
                                                        title="Modificar oficio"
                                                        styleClass="ui-button-raised ui-button-info"                                                       
                                                        icon="pi pi-check">
                                             <f:param name="oficioId" value="#{oficioDetalleBean.vo.oficioId}" />                                                        
                                        </p:commandButton>
                                        
                                        <h:outputText value="&nbsp;" />
                                                                     
                                        <!--<p:button
                                                        outcome="anular"                                                         
                                                        includeViewParams="true"                                                        
                                                        value="Anular"
                                                        rendered="#{oficioDetalleBean.botonAnular.visible}"
                                                        title="Anular oficio"
                                                        icon="pi pi-times"
                                                        styleClass="ui-button-raised ui-button-danger"
                                                        >                                                                                                                
                                                    <f:param name="oficioId" value="#{oficioDetalleBean.vo.oficioId}" />
                                          </p:button>-->
                                        <p:commandButton
                                                        action="#{oficioDetalleBean.goToActionAndSendOficioId(oficioDetalleBean.botonAnular.accion)}"                                                        
                                                        value="Anular"
                                                        rendered="#{oficioDetalleBean.botonAnular.visible}"
                                                        title="Anular oficio"
                                                        icon="pi pi-times"
                                                        styleClass="ui-button-raised ui-button-danger"
                                                        >                                                                                                                
                                                    <f:param name="oficioId" value="#{oficioDetalleBean.vo.oficioId}" />
                                        </p:commandButton>
                                        <h:outputText value="&nbsp;" />
                                       
                                        <!--<p:button
                                                        outcome="#{oficioDetalleBean.botonSeguimiento.accion.toString()}"                                                         
                                                        includeViewParams="true"                                                        
                                                        value="#{oficioDetalleBean.botonSeguimiento.valor} " 
                                                        rendered="#{oficioDetalleBean.botonSeguimiento.visible}"
                                                        title="Anular oficio"
                                                        styleClass="ui-button-raised ui-button-warning"
                                                        >                                                                                                                
                                                    <f:param name="oficioId" value="#{oficioDetalleBean.vo.oficioId}" />
                                          </p:button>-->
                                          <p:commandButton
                                                        action="#{oficioDetalleBean.goToActionAndSendOficioId(oficioDetalleBean.botonSeguimiento.accion)}"                                                        
                                                        value="#{oficioDetalleBean.botonSeguimiento.valor} " 
                                                        rendered="#{oficioDetalleBean.botonSeguimiento.visible}"                                                        
                                                        icon="pi pi-envelope"
                                                        styleClass="ui-button-raised ui-button-warning"
                                                        >                                                                                                                
                                                    <f:param name="oficioId" value="#{oficioDetalleBean.vo.oficioId}" />
                                        </p:commandButton>
                                         
                                    </div>
                                </div> <!-- row -->

                            </div> <!-- div tab-pane -->


                            <!-- ······························· INICIA TAB ······························· -->


                            <div class="tab-pane fade" id="divAsociadoHaciaOficios">

                                <p:dataTable id="dataAsociadoHaciaOficios" 
                                             showGridlines="true" 
                                             size="small" 
                                             rows="10"  
                                             value="#{oficioDetalleBean.vo.asociadoHaciaOficios}" 
                                             var="currentRow"
                                             paginator="true" paginatorPosition="both"
                                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                             currentPageReportTemplate="{startRecord}-{endRecord} de {totalRecords} registros"
                                             rowsPerPageTemplate="5,10,{ShowAll|'All'}"
                                             >

                                    <p:column>
                                        #{currentRow['oficioNumero']}
                                        <f:facet name="header">
                                            <h:outputText value="#{msgs['sistema.oficios.comun.oficio.numero']}"/>
                                        </f:facet>
                                    </p:column>
                                    <p:column>
                                        #{currentRow['oficioAsunto']}
                                        <f:facet name="header">
                                            <h:outputText value="#{msgs['sistema.oficios.comun.asunto']}"/>
                                        </f:facet>
                                    </p:column>
                                    <p:column>
                                        #{currentRow['companiaSiglas']}
                                        <f:facet name="header">
                                            <h:outputText value="#{msgs['sistema.comun.compania.nombre']}"/>
                                        </f:facet>
                                    </p:column>
                                    <p:column>
                                        #{currentRow['bloqueNombre']}
                                        <f:facet name="header">
                                            <h:outputText value="#{msgs['sistema.comun.bloque.nombre']}"/>
                                        </f:facet>
                                    </p:column>
                                    <p:column>
                                        #{currentRow['gerenciaNombre']}
                                        <f:facet name="header">
                                            <h:outputText value="#{msgs['sistema.comun.gerencia.nombre']}"/>
                                        </f:facet>
                                    </p:column>
                                    <p:column style="width: 30px" rendered="#{oficioDetalleBean.permisos.verDetalleOficio}">
                                        
                                        <p:commandLink
                                            action="#{oficioDetalleBean.seleccionarDetalleOficio()}"
                                            title="Ver detalle del oficio"
                                            >
                                            <center>
                                                <i class="fa fa-eye icono-contenido" style="font-size: 18px;"></i>                                           
                                            </center>
                                            <f:param name="oficioId" value="#{currentRow['oficioId']}" />   
                                        </p:commandLink>
                                        <!--
                                        <p:link
                                                        outcome="detalle"                                                         
                                                        includeViewParams="true"                                                                                                                
                                                        title="Ver detalle del oficio"                                               
                                                        >                                                                                                                
                                            <center>
                                                <i class="fa fa-eye icono-contenido" style="font-size: 18px;"></i>                                           
                                            </center>
                                               <f:param name="oficioId" value="#{currentRow['oficioId']}" />   
                                          </p:link>
                                        -->
                                        <!--
                                        <h:commandLink styleClass="link"
                                                       action="detalle"
                                                       title="Ver detalle del oficio"  >
                                            <center>
                                                <i class="fa fa-eye icono-contenido" style="font-size: 18px;"></i>                                           
                                            </center>

                                            <f:param name="oficioId" value="#{currentRow['oficioId']}" />   
                                        </h:commandLink>
                                        -->
                                    </p:column>
                                </p:dataTable>

                                <br></br>


                            </div> <!-- div tab-pane -->

                            <!-- ······························· INICIA TAB ······························· -->

                            <!-- 
                                El oficio solo podrá estar asociado desde otros oficios cuando este oficio esté
                                en estatus Terminado. 
                            -->
                            <ui:fragment rendered="#{oficioDetalleBean.vo.estatusTerminado}">

                                <div class="tab-pane fade" id="divAsociadoDesdeOficios">

                                    <!--ice:dataTable id="dataAsociadoDesdeOficios" 
                                                   rows="5" 
                                                   value="{oficioDetalleBean.vo.asociadoDesdeOficios}" 
                                                   var="currentRow" 
                                                   width="100%"
                                    -->
                                    <p:dataTable id="dataAsociadoDesdeOficios" 
                                                 showGridlines="true" 
                                                 size="small" 
                                                 rows="10"  
                                                 value="#{oficioDetalleBean.vo.asociadoDesdeOficios}" 
                                                 var="currentRow"
                                                 paginator="true" paginatorPosition="both"
                                                 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                 currentPageReportTemplate="{startRecord}-{endRecord} de {totalRecords} registros"
                                                 rowsPerPageTemplate="5,10,{ShowAll|'All'}"
                                                 >
                                        <p:column>
                                            #{currentRow['oficioNumero']}
                                            <f:facet name="header">
                                                <h:outputText value="#{msgs['sistema.oficios.comun.oficio.numero']}"/>
                                            </f:facet>
                                        </p:column>
                                        <p:column>
                                            #{currentRow['oficioAsunto']}
                                            <f:facet name="header">
                                                <h:outputText value="#{msgs['sistema.oficios.comun.asunto']}"/>
                                            </f:facet>
                                        </p:column>
                                        <p:column>
                                            #{currentRow['companiaSiglas']}
                                            <f:facet name="header">
                                                <h:outputText value="#{msgs['sistema.comun.compania.nombre']}"/>
                                            </f:facet>
                                        </p:column>
                                        <p:column>
                                            #{currentRow['bloqueNombre']}
                                            <f:facet name="header">
                                                <h:outputText value="#{msgs['sistema.comun.bloque.nombre']}"/>
                                            </f:facet>
                                        </p:column>
                                        <p:column>
                                            #{currentRow['gerenciaNombre']}
                                            <f:facet name="header">
                                                <h:outputText value="#{msgs['sistema.comun.gerencia.nombre']}"/>
                                            </f:facet>
                                        </p:column>
                                        <p:column style="width: 30px" rendered="#{oficioDetalleBean.permisos.verDetalleOficio}">
                                         <p:commandLink
                                            action="#{oficioDetalleBean.seleccionarDetalleOficio()}"
                                            title="Ver detalle del oficio"
                                            >
                                            <center>
                                                <i class="fa fa-eye icono-contenido" style="font-size: 18px;"></i>                                           
                                            </center>
                                            <f:param name="oficioId" value="#{currentRow['oficioId']}" />   
                                        </p:commandLink>
                                            
                                             <!--<p:link
                                                        outcome="detalle"                                                         
                                                        includeViewParams="true"                                                                                                                
                                                        title="Ver detalle del oficio" 
                                                        >                                                                                                                
                                            <center>
                                                <i class="fa fa-eye icono-contenido" style="font-size: 18px;"></i>                                                    
                                            </center>
                                               <f:param name="oficioId" value="#{currentRow['oficioId']}" />   
                                          </p:link>-->
                                            
                                            <!--<h:commandLink styleClass="link"
                                                           action="detalle"
                                                           title="Ver detalle del oficio"  >
                                                <center>
                                                    <i class="fa fa-eye icono-contenido" style="font-size: 18px;"></i>                                                    
                                                </center>

                                                <f:param name="oficioId" value="#{currentRow['oficioId']}" />   
                                            </h:commandLink>-->
                                        </p:column>
                                    </p:dataTable>

                                    <br></br>
                                 
                                </div> <!-- div tab-pane -->

                            </ui:fragment>



                            <!-- ······························· INICIA TAB ······························· -->

                            <ui:fragment rendered="#{oficioDetalleBean.vo.restringido}">
                                <div class="tab-pane fade" id="divUsuariosAcceso">

                                    <!--ice:dataTable id="dataUsuariosAcceso" 
                                                   rows="5" 
                                                   value="{oficioDetalleBean.vo.restringidoAUsuarios}" 
                                                   var="currentRow" 
                                                   width="100%"
                                    -->
                                    <p:dataTable id="dataUsuariosAcceso" 
                                                 showGridlines="true" 
                                                 size="small" 
                                                 rows="10"  
                                                 value="#{oficioDetalleBean.vo.restringidoAUsuarios}" 
                                                 var="currentRow"
                                                 paginator="true" paginatorPosition="both"
                                                 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                 currentPageReportTemplate="{startRecord}-{endRecord} de {totalRecords} registros"
                                                 rowsPerPageTemplate="5,10,{ShowAll|'All'}"
                                                 >
                                        <p:column style="width: 150px;">
                                            <h:outputText value="#{currentRow['id']}"/>
                                            <f:facet name="header">
                                                <h:outputText value="Usuario"/>
                                            </f:facet>
                                        </p:column>
                                        <p:column>
                                            <h:outputText value="#{currentRow['nombre']}"/>
                                            <f:facet name="header">
                                                <h:outputText value="Nombre Completo"/>
                                            </f:facet>
                                        </p:column>
                                    </p:dataTable>

                                    <br></br>
                                  

                                </div> <!-- div tab-pane -->
                            </ui:fragment>

                            <!-- ······························· INICIA TAB ······························· -->

                            <div class="tab-pane fade" id="divHistorialMovimientos">
                                <div style="">
                                    <!--ice:dataTable id="dataHistorialMovimientos" width="100%" rows="10" value="#{oficioDetalleBean.vo.movimientos}" var="movimiento"-->
                                    <p:dataTable id="dataHistorialMovimientos" 
                                                 showGridlines="true" 
                                                 size="small" 
                                                 rows="10"  
                                                 value="#{oficioDetalleBean.vo.movimientos}" 
                                                 var="movimiento"
                                                 paginator="true" paginatorPosition="both"
                                                 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                 currentPageReportTemplate="{startRecord}-{endRecord} de {totalRecords} registros"
                                                 rowsPerPageTemplate="5,10,{ShowAll|'All'}"
                                                 >
                                        <p:column style="width:120px; white-space: nowrap;">
                                            <h:outputText value="#{movimiento.fechaMovimiento}"/>
                                            <f:facet name="header">
                                                <h:outputText value="Fecha Movimiento"/>
                                            </f:facet>
                                        </p:column>
                                        <p:column style="white-space: nowrap">
                                            <h:outputText value="#{movimiento.nombre}"/>
                                            <f:facet name="header">
                                                <h:outputText value="Usuario"/>
                                            </f:facet>
                                        </p:column>
                                        <p:column>
                                            <h:outputText value="#{movimiento.motivo}"/>
                                            <f:facet name="header">
                                                <h:outputText value="Descripción"/>
                                            </f:facet>
                                        </p:column>


                                        <!-- Columna de archivo adjunto -->

                                        <p:column>
                                            <h:outputText 
                                                value="#{movimiento.adjunto.nombreUUID}" 
                                                rendered="#{movimiento.tieneAdjunto()}"/>

                                            <f:facet name="header">
                                                <h:outputText value="Archivo Adjunto"/>
                                            </f:facet>
                                        </p:column>

                                        <!-- Columna para icono de visualizacion / descarga -->

                                        <p:column rendered="#{oficioDetalleBean.permisos.verArchivoAdjuntoHistorialOficio}" style="width: 10px">

                                            <!-- Icono de vista previa -->

                                            <!--p:commandLink title="Vista previa"
                                                             actionListener="{oficioDetalleBean.prepararAdjuntoVisor(event)}"
                                                             rendered="{oficioDetalleBean.permisos.verArchivoAdjuntoHistorialOficio 
                                                                 and movimiento.tieneAdjunto()
                                                                 and movimiento.adjunto.visualizable}"
                                                                 styleClass="link"
                                                                 onclick="$(modalVerAdjunto).modal('show');" >
                                                <img src="./resources/imagenes/preview.png" border="0" />
                                                <f:param name="adjuntoId" value="{movimiento.adjunto.id}" />   
                                            </p:commandLink-->

                                            <!-- Icono de descarga -->

                                            <!--ice:outputLink 
                                                target="_blank" 
                                                rendered="{oficioDetalleBean.permisos.descargarArchivoAdjuntoHistorialOficio 
                                                    and movimiento.tieneAdjunto()
                                                    and !movimiento.adjunto.visualizable}"
                                                value="/ControlOficios/DACOF?ZWZ2W=#{movimiento.adjunto.id}&amp;ZWZ3W=#{movimiento.adjunto.uuid}"
                                                >
                                                <center>
                                                    <ice:graphicImage 
                                                        url="./resources/imagenes/descargar.gif"  
                                                        alt="Descargar" 
                                                        title="Descargar" />
                                                </center>
                                            </ice:outputLink-->



                                            <!-- Inicia TEMPORAL 2/sep/14 - Permitir descarga -->

                                            <h:outputLink 
                                                target="_blank" 
                                                rendered="#{
                                                movimiento.tieneAdjunto() 
                                                    and !movimiento.adjuntoEliminado
                                                    and (oficioDetalleBean.permisos.descargarArchivoAdjuntoHistorialOficio 
                                                    or oficioDetalleBean.permisos.verArchivoAdjuntoHistorialOficio)}"
                                                value="/ControlOficios/DACOF?ZWZ2W=#{movimiento.adjunto.id}&amp;ZWZ3W=#{movimiento.adjunto.uuid}
                                                &amp;Z4BX2=#{movimiento.oficioId}&amp;4PC4WZ=0&amp;user=#{sesion.usuario.id}"
                                                >
                                                <center>
                                                    <p:graphicImage 
                                                        url="../../resources/imagenes/descargar.gif"  
                                                        alt="Descargar archivo" 
                                                        title="Descargar archivo" />
                                                </center>
                                            </h:outputLink>


                                            <!-- Temporal TEMPORAL 2/sep/14 - Permitir descarga -->

                                        </p:column>

                                        <!-- Permitir modificar archivo solo si se está en modo Edición y el oficio está en estado inicial -->

                                        <p:column rendered="#{oficioDetalleBean.mostrarEdicionArchivos()}" style="width: 10px">
                                            
                                              <p:commandLink
                                                   title="Sustituir archivo"
                                                   style="text-align: left;"                                                   
                                                   action="#{oficioDetalleBean.editarAdjuntoAction()}"
                                                   rendered="#{oficioDetalleBean.linkEditarAdjunto.visible 
                                                                       and movimiento.tieneAdjunto()
                                                                       and !movimiento.adjuntoEliminado}"      
                                                   >                                        
                                                    <img src="../../resources/imagenes/editar.png" border="0" />
                                                    <f:param name="oficioId" value="#{movimiento.oficioId}" />
                                                    <f:param name="movimientoId" value="#{movimiento.id}" />
                                                    <f:param name="oficioMovimientoId" value="#{movimiento.oficioMovimientoId}" />
                                                </p:commandLink> 
                                                                                                                                    
                                            <!--<p:button title="Sustituir archivo"
                                                           outcome="editarAdjunto"
                                                           rendered="#{oficioDetalleBean.linkEditarAdjunto.visible 
                                                                       and movimiento.tieneAdjunto()
                                                                       and !movimiento.adjuntoEliminado}"
                                                           styleClass="link" >
                                                <img src="../../resources/imagenes/editar.png" border="0" />
                                                <f:param name="oficioId" value="#{movimiento.oficioId}" />
                                                <f:param name="movimientoId" value="#{movimiento.id}" />
                                                <f:param name="oficioMovimientoId" value="#{movimiento.oficioMovimientoId}" />
                                            </p:button>-->
                                            <f:facet name="header">
                                                <h:outputText value="-"/>
                                            </f:facet>
                                        </p:column>
                                    </p:dataTable>
                                </div>

                                <p></p>


                            </div> <!-- div tab-pane -->
                        </div> <!-- div tab-content -->

                        <p />

                    </div> <!-- jumbotron -->

                    <div style="text-align: right">

                        <!-- Boton Cancelar para salir de la pantalla de Detalle -->

                        <p />
                         <!-- Este boton si esta permitido ser un button debido a que solo redirecciona-->
                        <p:button value="#{oficioDetalleBean.botonCancelar.valor}" 
                                      outcome="#{oficioDetalleBean.botonCancelar.accion.toString()}"
                                      rendered="#{oficioDetalleBean.botonCancelar.visible}"
                                      title="#{oficioDetalleBean.botonCancelar.titulo}"
                                      icon="pi pi-arrow-left"
                                      styleClass="rounded-button ui-button-secondary">
                        </p:button>
                        
                    </div>

                    <!-- Modal - Visualizar archivo adjunto -->

                    <ui:fragment rendered="#{oficioDetalleBean.permisos.verArchivoAdjuntoHistorialOficio}">
                        <div class="modal fade" id="modalVerAdjunto">
                            <div class="modal-dialog" style="width: 750px;">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                            &times;
                                        </button>
                                        <h4 class="modal-title">Archivo Adjunto</h4>
                                    </div>
                                    <div class="modal-body">

                                        <p align="center">
                                            <h:outputText value="#{oficioDetalleBean.adjuntoVisor.nombreUUID}"/>

                                            <h:outputText value="-"/>

                                            <h:outputLink 
                                                target="_blank" 
                                                rendered="#{oficioDetalleBean.permisos.descargarArchivoAdjuntoHistorialOficio}"
                                                value="/ControlOficios/DACOF?ZWZ2W=#{oficioDetalleBean.adjuntoVisor.id}&amp;ZWZ3W=#{oficioDetalleBean.adjuntoVisor.uuid}
                                                &amp;Z4BX2=#{movimiento.oficioId}&amp;4PC4WZ=0&amp;user=#{sesion.usuario.id}"
                                                >
                                                <p:graphicImage 
                                                    url="../../resources/imagenes/descargar.gif"  
                                                    style="vertical-align:text-bottom;"
                                                    alt="Descargar" 
                                                    title="Descargar" />
                                            </h:outputLink>

                                        </p>

                                        <p align="center">
                                            <iframe 
                                                id="viewer" 
                                                src= "../../resources/js/Viewer.js/#../../../#{oficioDetalleBean.adjuntoVisor.urlVisorArchivoTemporal}"
                                                width="700" 
                                                height="400"
                                                allowfullscreen="true" 
                                                webkitallowfullscreen="true">
                                            </iframe>
                                        </p>

                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default btn-xs" data-dismiss="modal">
                                            Cerrar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </ui:fragment>

                    <!-- Termina modal - Visualizar archivo adjunto -->

                </h:form>
            </ui:define>
        </ui:composition>
    </body>
</html>
