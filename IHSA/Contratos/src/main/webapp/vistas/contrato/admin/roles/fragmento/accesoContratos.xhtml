<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"

                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui">
    <div class="row">
        <div class="col-8">
            <div class="card with-nav-tabs card-default">
                <div class="card-heading">
                    <div class="input-group col-12">
                        <div class="form-group">
                            <div class="col-10">
                                <h:outputLabel value="#{rolBean.usuarioRolVo.usuario}" class="control-label"/>
                            </div>
                            <div class="col-2">
                                <p:commandLink action="#{rolBean.agregarRelacionUsuarioContrato}"
                                               styleClass="btn btn-primary text-white"
                                               rendered="#{not empty rolBean.usuarioRolVo.usuario}"
                                               process="@this" update="frmRolContrato:tabViewPermisos:pnlAddConv">
                                    <i class="fa fa-link"></i>
                                </p:commandLink>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="col-12" style="display: #{rolBean.gerencias.size() gt 0 ? 'block':'none'}">
                        <span><h:outputLabel value="#{rolBean.usuarioRolVo.usuario}"/></span> tiene  acceso a los contratos de
                    </div>
                    <p:dataTable value="#{rolBean.gerencias}" var="data"
                                 rendered="#{rolBean.gerencias.size() gt 0}"
                                 size="small" showGridlines="true">
                        <p:column style="text-align: left;">
                            <h:outputText value="#{data.nombre}"/>
                        </p:column>
                    </p:dataTable>
                    <div class="col-12">
                        <span> <h:outputText value="#{rolBean.mensaje}" style="font-style: italic; margin-left: 0%;"/></span>
                    </div>
                    <p:commandLink value="Quitar Seleccionados" styleClass="btn btn-warning text-white" 
                                   title="Se quitaran todos los contratos seleccionados"
                                   disabled="#{rolBean.contratos.size() eq 0}"
                                   action="#{rolBean.quitarTodosContratoGerencia}"
                                   process="@this frmRolContrato:tabViewPermisos:dtContratos" update="frmRolContrato:tabViewPermisos:dtContratos">
                    </p:commandLink>
                    <p:dataTable id="dtContratos" value="#{rolBean.contratos}" var="data"
                                 rendered="#{rolBean.contratos.size() gt 0}"
                                 size="small" showGridlines="true"
                                 rows="10" paginator="true"  
                                 paginatorPosition="bottom" 
                                 rowIndexVar="indice">
                        <p:column width="35">
                            <h:selectBooleanCheckbox value="#{data.selected}" class="seleccion"/>
                        </p:column>
                        <p:column headerText="Número" style="text-align: left;" width="20%">
                            <h:outputText value="#{data.numero}"/>
                        </p:column>
                        <p:column headerText="Alcance" style="text-align: left;">
                            <h:outputText value="#{data.nombre}"/>
                        </p:column>
                        <p:column width="35">
                            <p:commandLink action="#{rolBean.eliminarRelacionConvUsuario(indice)}"
                                           process="@this" update="frmRolContrato:tabViewPermisos:dtContratos">
                                <i class="fa fa-trash text-danger"></i>
                            </p:commandLink>
                        </p:column>
                    </p:dataTable>
                </div>
            </div>
        </div>
        <p:panel id="pnlAddConv">
            <ui:fragment rendered="#{rolBean.agregarContrato}">
                <div class="col-8">
                    <div class="card card-default">
                        <div class="card-header">
                            <div class="input-group">
                                <p:selectOneMenu value="#{rolBean.idGerencia}" >
                                    <f:selectItem itemLabel="Seleccione la gerencia . . ." itemValue="-1"/>
                                    <f:selectItems value="#{rolBean.mapaSelect.get('gerencias')}"/>
                                    <p:ajax listener="#{rolBean.mostrarContratosPorGerencia}" update="frmRolContrato:tabViewPermisos:dtContGer"/>
                                </p:selectOneMenu>
                                <p:commandLink value="Asignar Todos" styleClass="btn btn-info text-white" title="Se asignaran todos los contratos de la gerencia seleccinada"
                                               action="#{rolBean.asignarTodosContratoGerencia}"
                                               >
                                </p:commandLink>
                            </div>
                        </div>
                        <div class="card-body">
                            <p:dataTable id="dtContGer" value="#{rolBean.listaContratos}" var="data"
                                         size="small" showGridlines="true"
                                         paginator="true"  
                                         paginatorPosition="bottom"  rowKey="#{data.id}"
                                         rows="5"  selection="#{rolBean.contratoVo}" selectionMode="single">
                                <p:ajax event="rowSelect" listener="#{rolBean.seleccionarContrato}" update="frmRolContrato:tabViewPermisos:dtContratosAdd" />
                                <p:column headerText="Número" filterBy="#{data.numero}" filterMatchMode="contains"
                                          style="text-align: left;">
                                    <h:outputText value="#{data.numero}"/>
                                </p:column>
                                <p:column headerText="Alcance" filterBy="#{data.nombre}" filterMatchMode="contains"
                                          style="text-align: left;">
                                    <h:outputText value="#{data.nombre}"/>
                                </p:column>
                            </p:dataTable>
                        </div>
                    </div>
                </div>
                <div class="col-8">
                    <div class="card card-default">
                        <div class="card-header col-12">
                            <div class="input-group">
                                <div class="col-8">
                                    <h:outputText class="card-title" value="Agregar contratos"/>
                                </div>
                                <div class="col-1">
                                    <p:commandLink action="#{rolBean.cancelarAgregarContrato}"
                                                   styleClass="btn btn-default" process="@this frmRolContrato:tabViewPermisos:dtContratosAdd" update="frmRolContrato:tabViewPermisos">
                                        <i class="fa fa-trash text-danger"></i>
                                    </p:commandLink>
                                </div>
                                <div class="col-1">
                                    <p:commandLink action="#{rolBean.agregarContratoUsuario}"
                                                   styleClass="btn btn-primary"
                                                   style="margin-left: 20px;" process="@this frmRolContrato:tabViewPermisos:dtContratosAdd" update="frmRolContrato:tabViewPermisos">
                                        <i class="fa fa-save text-white"></i>
                                    </p:commandLink>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <p:dataTable id="dtContratosAdd" value="#{rolBean.listaContratosAgregar}" var="data"
                                         size="small" showGridlines="true"
                                         rows="10" paginator="true"  
                                         paginatorPosition="bottom" 
                                         rowIndexVar="indice">
                                <p:column headerText="Número" style="text-align: left;" width="20%">
                                    <h:outputText value="#{data.numero}"/>
                                </p:column>
                                <p:column headerText="Alcance" style="text-align: left;">
                                    <h:outputText value="#{data.nombre}"/>
                                </p:column>
                                <p:column width="35">
                                    <p:commandLink action="#{rolBean.quitarContratotemporarUsuario(indice)}"
                                                   process="@this" update="frmRolContrato:tabViewPermisos:dtContratosAdd">
                                        <i class="fa fa-trash text-danger"></i>
                                    </p:commandLink>
                                </p:column>
                            </p:dataTable>
                        </div>
                    </div>
                </div>
            </ui:fragment>
        </p:panel>
    </div>
</ui:composition>