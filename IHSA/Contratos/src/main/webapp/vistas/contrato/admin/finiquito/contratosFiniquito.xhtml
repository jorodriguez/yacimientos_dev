<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <body>
        <ui:composition template="../../../../WEB-INF/template/template.xhtml">
            <ui:define name="tituloPagina">
                <h2 class="page-header"> Contratos por finiquitar</h2>
            </ui:define>
            <ui:define name="content">
                <h:form id="frmConFin">
                    <div class="row">
                        <div class="col-lg-4">
                            <label>Filtros</label>
                            <h:selectOneMenu id="cmbfiltro" value="#{contratoFiniquitoBean.idFiltro}"
                                             styleClass="form-control">
                                <f:selectItem itemLabel="Vencidos" itemValue="0"/>
                                <f:selectItem itemLabel="Por Vencer (30 días) " itemValue="1"/>
                                <f:selectItem itemLabel="Convenios con exhortos" itemValue="2"/>
                                <f:ajax listener="#{contratoFiniquitoBean.cambiarFiltro}" render="dtConvenios"/>
                            </h:selectOneMenu>
                        </div>
                    </div> 
                    <p:dataTable id="dtConvenios" value="#{contratoFiniquitoBean.contratos}" var="dataConv"
                                 rows="15" paginator="true" paginatorPosition="bottom" paginatorAlwaysVisible="true"
                                 style="font-size: 1em;" >
                        <p:column headerText="Contrato" style="text-align: left; width: 15%;"
                                  sortBy="#{dataConv.numero}" >
                            <h:outputText value="#{dataConv.numero}" />
                        </p:column>
                        <p:column headerText="Contrato" style="text-align: left; width: 300%;"
                                  sortBy="#{dataConv.nombre}"  >
                            <h:outputText value="#{dataConv.nombre}" />
                        </p:column>
                        <p:column headerText="Conv. Mod." style="text-align: center">
                            <h:outputText value="#{dataConv.numeroContratosRelacionados}" />
                        </p:column>
                        <p:column headerText="Proveedor" style="text-align: left;"
                                  sortBy="#{dataConv.nombreProveedor}" >
                            <h:outputText value="#{dataConv.nombreProveedor}" />
                        </p:column>
                        <p:column headerText="Inicio">
                            <h:outputText value="#{dataConv.fechaInicio}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Fin" sortBy="#{dataConv.fechaVencimiento}" >
                            <h:outputLabel value="#{dataConv.fechaVencimiento}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputLabel>
                        </p:column>
                        <p:column headerText="Exh. Env.">
                            <h:outputText value="#{dataConv.exhortosEnviados}" styleClass="badge"
                                          style="background-color: red" rendered="#{dataConv.exhortosEnviados gt 2}"/>
                            <h:outputText value="#{dataConv.exhortosEnviados}" styleClass="badge"
                                          style="background-color: orange" rendered="#{dataConv.exhortosEnviados eq 2}"/>
                            <h:outputText value="#{dataConv.exhortosEnviados}" 
                                          rendered="#{dataConv.exhortosEnviados lt 2}"/>
                        </p:column>
                        <p:column>
                            <p:commandLink value="Calificar" action="#{contratoFiniquitoBean.crearCalificacion(event)}"
                                           styleClass="text text-primary" style="color: #0895d6;">                                
                                <i class="fa fa-check text-primary"/>
                                <f:param name="convnum" value="#{dataConv.numero}"/>
                            </p:commandLink>
                        </p:column>
                        <p:column>
                            <p:commandLink value="Exhorto" action="#{contratoFiniquitoBean.crearExhorto(event)}"
                                           styleClass="text text-primary" style="color: #0895d6;">
                                <i class="fa fa-send text-primary"/>
                                <f:param name="convnum" value="#{dataConv.numero}"/>
                            </p:commandLink>
                        </p:column>
                    </p:dataTable>
                    <p:commandButton value="Exportar">
                        <p:dataExporter fileName="Convenio_Exhortos" target="dtConvenios" type="xls">
                        </p:dataExporter>
                    </p:commandButton>
                </h:form>
                <!--Calificar el contrato-->
                <div class="modal fade" id="dialogoCalificar" data-backdrop="static" data-keyboard="false">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">Calificar contrato</h4>
                            </div>
                            <h:form id="frmCalConv">
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="form-group">
                                                <h:outputText value="Contrato"/>
                                                <div class="col-lg-12">
                                                    <h:outputLabel value="#{contratoFiniquitoBean.contratoVo.numero}"/>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <h:outputText value="Proveedor"/>
                                                <div class="col-lg-12 ">
                                                    <h:outputLabel value="#{contratoFiniquitoBean.contratoVo.nombreProveedor}"/>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-12">
                                            <div class="form-group">
                                                <h:outputText value="Calificación:" />
                                                <div class="col-lg-12 ">
                                                    <h:inputTextarea id="txMotivo" value="#{contratoFiniquitoBean.motivo}" styleClass="form-control"
                                                                     required="true" requiredMessage="Es necesario agregar un motivo"
                                                                     rows="5"/>
                                                    <small><h:message for="txMotivo" styleClass="text-danger"/></small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <p:commandLink value="Cancelar" onclick="$(dialogoCalificar).modal('hide');"
                                                   styleClass="btn btn-default">
                                    </p:commandLink>
                                    <p:commandLink value="Guardar" class="btn btn-primary"
                                                   action="#{contratoFiniquitoBean.guardarCalificacion(event)}">			    
                                    </p:commandLink>
                                </div>
                            </h:form>
                        </div>
                    </div>
                </div>
                <!-- Exhortos -->
                <div class="modal fade" id="dialogoEnviarExhorto" data-backdrop="static" data-keyboard="false">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">Enviar exhorto</h4>
                            </div>
                            <h:form id="frmExhorto">
                                <div class="modal-body card-body">
                                    <div class="col-lg-12">
                                        <div class="form-group">
                                            <h:outputText value="Proveedor" class="col-lg-2"/>
                                            <div class="col-lg-8 ">
                                                <h:outputLabel value="#{contratoFiniquitoBean.contratoVo.nombreProveedor}"/>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-12">
                                        <div class="col-lg-6">	
                                            <!-- rowSelectListener="#{contratoFiniquitoBean.seleccionarContactoPara}" 
                                                         selectionMode="single"-->
                                            <p:dataTable value="#{contratoFiniquitoBean.representanteLegalProveedor}" var="data"
                                                         rows="5" paginatorAlwaysVisible="false" paginator="true" paginatorPosition="bottom"
                                                         style="font-size: 1em;">
                                                <f:facet name="header" >Representante(s) Legal (cp)</f:facet>
                                                <p:column headerText="Nombre" style="text-align: left;">
                                                    <h:outputText value="#{data.nombre}"/>
                                                </p:column>
                                                <p:column headerText="Puesto" style="text-align: left;">
                                                    <h:outputText value="#{data.puesto}"/>
                                                </p:column>
                                                <p:column headerText="Correo" style="text-align: left;">
                                                    <h:outputText value="#{data.correo}"/>
                                                </p:column>
                                            </p:dataTable>	
                                            <!-- rowSelectListener="#{contratoFiniquitoBean.seleccionarContactoCopia}" selectionMode="single"-->
                                            <p:dataTable value="#{contratoFiniquitoBean.contactosProveedor}" var="data"

                                                         rows="5" paginatorAlwaysVisible="false" paginator="true" paginatorPosition="bottom"
                                                         style="font-size: 0.9em;">
                                                <f:facet name="header" >Contactos (cc)</f:facet>
                                                <p:column headerText="Tipo" style="text-align: left;">
                                                    <h:outputText value="#{data.tipoContactoTxt}"/>
                                                </p:column>
                                                <p:column headerText="Nombre" style="text-align: left;">
                                                    <h:outputText value="#{data.nombre}"/>
                                                </p:column>
                                                <p:column headerText="Correo" style="text-align: left;">
                                                    <h:outputText value="#{data.correo}"/>
                                                </p:column>
                                            </p:dataTable>
                                            <div class="col-lg-12">
                                                <h:selectOneMenu value="#{contratoFiniquitoBean.idGerencia}" 
                                                                 styleClass="form-control">
                                                    <f:selectItem itemLabel="Seleccione . . ." itemValue="-1"/>
                                                    <f:selectItems value="#{contratoFiniquitoBean.gerencias}"/>
                                                    <f:ajax listener="#{contratoFiniquitoBean.traerEmpleadoPorGerencia}"
                                                            render="dtUserGer"/>
                                                </h:selectOneMenu>	
                                            </div>
                                            <!-- rowSelectListener="#{contratoFiniquitoBean.seleccionarContactoGerenciaCopia}" -->
                                            <p:dataTable id="dtUserGer" value="#{contratoFiniquitoBean.listaUsuarioGerencia}" 
                                                         var="data"  rows="5" paginator="true" paginatorPosition="bottom" paginatorAlwaysVisible="true"
                                                         selectionMode="single"

                                                         style="font-size: 1em;">
                                                <p:column headerText="Nombre (cc)" style="text-align:  left;">
                                                    <h:outputText value="#{data.nombre}" />
                                                </p:column>
                                            </p:dataTable>
                                        </div>
                                        <div class="col-lg-6">	
                                            <p:dataTable value="#{contratoFiniquitoBean.listaCorreoPara}" var="data"
                                                         style="font-size: 1em;">
                                                <f:facet name="header" >Correo para</f:facet>
                                                <p:column headerText="Nombre" style="text-align: left;">
                                                    <h:outputText value="#{data.nombre}"/>
                                                </p:column>
                                                <p:column >
                                                    <p:commandLink action="#{contratoFiniquitoBean.quitarUsuarioPara}" immediate="true">
                                                        <i class="fa fa-trash text text-danger"/>
                                                        <f:setPropertyActionListener value="#{data}" target="#{contratoFiniquitoBean.contactoProveedorVo}"/>						
                                                    </p:commandLink>
                                                </p:column>
                                            </p:dataTable>
                                            <p:dataTable value="#{contratoFiniquitoBean.listaCorreoCopia}" var="data"
                                                         style="font-size: 0.9em;">
                                                <f:facet name="header" >Correo copia</f:facet>
                                                <p:column headerText="Nombre" style="text-align: left;">
                                                    <h:outputText value="#{data.nombre}"/>
                                                </p:column>
                                                <p:column >
                                                    <p:commandLink action="#{contratoFiniquitoBean.quitarUsuarioCopia}" immediate="true">
                                                        <i class="fa fa-trash text text-danger"/>
                                                        <f:setPropertyActionListener value="#{data}" target="#{contratoFiniquitoBean.contactoProveedorVo}"/>						
                                                    </p:commandLink>
                                                </p:column>
                                            </p:dataTable>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <p:commandLink value="Cancelar" onclick="$(dialogoEnviarExhorto).modal('hide');"
                                                   styleClass="btn btn-default">
                                    </p:commandLink>
                                    <p:commandLink value="Enviar" class="btn btn-primary"
                                                   action="#{contratoFiniquitoBean.enviarExhorto(event)}">			    
                                    </p:commandLink>
                                </div>
                            </h:form>
                        </div>
                    </div>
                </div> 
            </ui:define>
        </ui:composition>
    </body>
</html>
