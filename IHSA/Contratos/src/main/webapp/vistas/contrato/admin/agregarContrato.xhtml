<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"      
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <body>
        <ui:composition template="../../../WEB-INF/template/template.xhtml">
            <ui:define name="tituloPagina">
                <h2 class="page-header">Registro de contratos</h2>
            </ui:define>
            <ui:define name="contenido">	
                <h:form id="frmContrato" >
                    <div class="row">
                        <div class="form-group col-12">    			    
                            <h:outputText class="col-12 control-label" value="Proveedor: "/>
                            <div class="col-10">
                                <p:autoComplete id="autoProv" value="#{agregarContratoBean.proveedorSeleccionado}" size="80" 
                                                completeMethod="#{agregarContratoBean.completaProveedor}"
                                                multiple="false" selectLimit="1">
                                    <p:ajax event="itemSelect" listener="#{agregarContratoBean.traerContratoMaestroPorProveedor}" 
                                            process="@this" 
                                            update="frmContrato cmbContratos"/>
                                </p:autoComplete>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group col-12">                           
                                <h:outputText class="col-3 control-label" value="Contrato relacionado: "/>
                                <div class="col-12"> 
                                    <p:selectOneMenu id="cmbContratos" value="#{agregarContratoBean.contratoVO.idContratoRelacionado}" 
                                                     styleClass="col-12">
                                        <f:selectItem itemLabel="No Aplica . . . " itemValue="0"/>
                                        <f:selectItems value="#{agregarContratoBean.listaContratos}"/>
                                    </p:selectOneMenu>
                                </div>
                            </div>
                            <div class="form-group col-12">
                                <h:outputText class="col-3 control-label" value="Clasificación: "/>
                                <div class="col-12">
                                    <p:selectOneMenu id="cmbCategoria" 
                                                     value="#{agregarContratoBean.id}" styleClass="custom-select">
                                        <f:selectItem  itemLabel="Seleccione . . . " itemValue="0" />
                                        <f:selectItems  value="#{agregarContratoBean.categoriasPrin}"/>
                                        <p:ajax event="change" process="@this" 
                                                listener="#{agregarContratoBean.cabiarClasificacion(agregarContratoBean.id)}" 
                                                update="frmContrato:cmbCat2 frmContrato:cmbCatT frmContrato:cmbClaCua frmContrato:cmbClaCin" />
                                    </p:selectOneMenu>  
                                </div>
                            </div>
                            <div class="form-group col-12"  >
                                <h:outputText class="col-3 control-label" value="SubClasificación 1: "/>
                                <div class="col-12">
                                    <p:selectOneMenu id="cmbCat2" value="#{agregarContratoBean.idS}" styleClass="custom-select"
                                                     disabled="#{agregarContratoBean.id eq 0}" >
                                        <f:selectItem itemLabel="Seleccione . . . " itemValue="0"/>
                                        <f:selectItems value="#{agregarContratoBean.categoriasSec}"/>
                                        <p:ajax event="change" process="@this" listener="#{agregarContratoBean.cabiarClasificacionDos(agregarContratoBean.idS)}" 
                                                update="frmContrato:cmbCatT frmContrato:cmbClaCua frmContrato:cmbClaCin"/>
                                    </p:selectOneMenu>  
                                </div>
                            </div>
                            <div class="form-group col-12"  >
                                <h:outputText class="col-3 control-label" value="SubClasificación 2: "/>
                                <div class="col-12">
                                    <p:selectOneMenu id="cmbCatT" value="#{agregarContratoBean.idT}" styleClass="custom-select"
                                                     disabled="#{agregarContratoBean.idS eq 0}">
                                        <f:selectItem itemLabel="Seleccione . . . " itemValue="0"/>
                                        <f:selectItems value="#{agregarContratoBean.categoriasTer}"/>
                                        <p:ajax event="change" process="@this"  listener="#{agregarContratoBean.cabiarClasificacionTres(agregarContratoBean.idT)}" 
                                                update="frmContrato:cmbClaCua frmContrato:cmbClaCin"/>
                                    </p:selectOneMenu>  
                                </div>

                            </div>
                            <div class="form-group col-12" >
                                <h:outputText class="col-3 control-label" value="SubClasificación 3: "/>
                                <div class="col-12">
                                    <p:selectOneMenu id="cmbClaCua" value="#{agregarContratoBean.idC}" styleClass="custom-select"
                                                     disabled="#{agregarContratoBean.idT eq 0}">
                                        <f:selectItem itemLabel="Seleccione . . . " itemValue="0"/>
                                        <f:selectItems value="#{agregarContratoBean.categoriasCuart}"/>
                                        <p:ajax event="change" process="@this" listener="#{agregarContratoBean.cabiarClasificacionCuatro(agregarContratoBean.idC)}" update="frmContrato:cmbClaCin"/>
                                    </p:selectOneMenu>  
                                </div>

                            </div>
                            <div class="form-group col-12"  >
                                <h:outputText class="col-3 control-label" value="SubClasificación 4: "/>
                                <div class="col-12">
                                    <p:selectOneMenu id="cmbClaCin" value="#{agregarContratoBean.idCi}" styleClass="custom-control"
                                                     disabled="#{agregarContratoBean.idC eq 0}">
                                        <f:selectItem itemLabel="Seleccione . . . " itemValue="0"/>
                                        <f:selectItems value="#{agregarContratoBean.categoriasQuin}"/>
                                    </p:selectOneMenu>  
                                </div>
                            </div>
                            <div class="form-group col-12">                           
                                <h:outputText class="col-3 control-label" value="Tipo: "/>
                                <div class="col-12">
                                    <p:selectOneMenu value="#{agregarContratoBean.contratoVO.idTipo}" styleClass="custom-select">
                                        <f:selectItems value="#{agregarContratoBean.mapaSelectItem.get('tipos')}"/>
                                    </p:selectOneMenu> 
                                </div>
                            </div>
                            <div class="form-group col-12">                           
                                <h:outputText class="col-3 control-label" value="Objetivo: "/>
                                <div class="col-12">
                                    <h:inputTextarea id="txtArea" rows="2" styleClass="form-control"						   
                                                     value="#{agregarContratoBean.contratoVO.nombre}"/>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group col-12">                           
                                <h:outputText class="col-3 control-label" value="Seleccione la gerencia: "/>
                                <div class="col-12">
                                    <p:dataTable id="dtGer" value="#{agregarContratoBean.gerencias}" var="dataGer"
                                                 showGridlines="true" size="small"  paginator="true" rows="5" paginatorPosition="bottom">
                                        <p:column width="40">
                                            <p:selectBooleanCheckbox value="#{dataGer.selected}">
                                                <p:ajax update="frmContrato:dtGerSel frmContrato:dtGer" listener="#{agregarContratoBean.addGerencia(dataGer)}"/>
                                            </p:selectBooleanCheckbox>
                                        </p:column>
                                        <p:column headerText="Gerencia">
                                            <h:outputText value="#{dataGer.nombre}"/>
                                        </p:column>
                                    </p:dataTable>
                                </div>
                            </div>                            	
                            <div class="form-group col-12">                           
                                <h:outputText class="col-3 control-label" value="Gerencias seleccionadas: "/>
                                <div class="col-12">
                                    <p:dataTable id="dtGerSel" value="#{agregarContratoBean.gerenciasSeleccionadas}" var="gerSel"
                                                 showGridlines="true" size="small"  paginator="true" rows="5" paginatorPosition="bottom">
                                        <p:column >
                                            <h:outputText value="#{gerSel.nombre}"/>
                                        </p:column>
                                        <p:column >
                                            <p:commandButton action="#{agregarContratoBean.quitarGerencia(gerSel)}"
                                                             process="@this" update="frmContrato:dtGer frmContrato:dtGerSel"
                                                             icon="fa fa-trash text-danger" />
                                        </p:column>
                                    </p:dataTable>
                                </div>
                            </div>                            	
                        </div>
                        <div class="input-group">       
                            <div class="col-2"></div>
                            <div class="col-10">
                                <p:commandLink value="Cancelar" styleClass="btn btn-default" 
                                               immediate="true" action="/vistas/contrato/admin/inicio.xhtml?faces-redirect=true"/>
                                <p:commandButton value="Guardar" styleClass="btn btn-info text-white" 
                                                 action="#{agregarContratoBean.guardarContrato}"
                                                 process="@form " update="@form"/>
                            </div>
                        </div>
                    </div>
                </h:form>
            </ui:define>
        </ui:composition>
    </body>
</html>
