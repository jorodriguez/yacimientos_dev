<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <body>

        <ui:composition template="../../../../WEB-INF/template/template.xhtml">
            <ui:define name="tituloPagina">
                <h2 class="page-header"> 
                    Reporte de contratos</h2>
            </ui:define>
            <ui:define name="contenido">
                <style>
                    .solFin{
                        background-color: red;
                    }
                </style>
                <h:form> 
                    <div class="row">
                        <div class="col-3">
                            <p:selectOneMenu id="cmbCampos" value="#{reporteContratoFiniquitoBean.campoId}" styleClass="form-control">
                                <f:selectItem itemLabel="Todos los campos. . . " itemValue="0"/>
                                <f:selectItems value="#{reporteContratoFiniquitoBean.campos}"/>
                                <p:ajax listener="#{reporteContratoFiniquitoBean.llenarContratos}"
                                        update="@form"/>
                            </p:selectOneMenu>  
                        </div>                        
                        <div class="col-4">
                            <h:outputLabel id="lblAv" value="PROMEDIO DE AVANCE PORCENTUAL: #{reporteContratoFiniquitoBean.avance} %"/>                           
                        </div>
                        <div class="col-2">
                            <h:outputLabel value="Total contratos: #{reporteContratoFiniquitoBean.contratos.size()}" />
                        </div>                          
                        <div class="col-3">
                            <p:commandLink styleClass="btn btn-default" action="#{reporteContratoFiniquitoBean.mostrarAvancesProcesoFiniquito}"
                                           value="Ver Avance" process="@this" update="frmResAvanFin">
                                <i class="fa fa-bars" />
                            </p:commandLink>
                            <p:commandLink id="btnAgregarContrato" action="#{reporteContratoFiniquitoBean.generarNuevoReporte}"
                                           styleClass="btn btn-primary text-white" value="Hacer corte de avance"
                                           process="@this" update="@form">
                            </p:commandLink>
                        </div>
                    </div>
                    <p:dataTable id="dtContratos" value="#{reporteContratoFiniquitoBean.contratos}" var="dataCon"
                                 rows="15" paginatorAlwaysVisible="true"  paginatorPosition="bottom"   paginator="true" 
                                 size="small" showGridlines="true">
                        <p:column headerText="Campo" sortBy="#{dataCon.campo}" style="text-align: left;">
                            <h:outputText value="#{dataCon.campo}"/>
                        </p:column>
                        <p:column headerText="Contratista" sortBy="#{dataCon.proveedorVo.nombre}" style="text-align: left;">
                            <h:outputText value="#{dataCon.proveedorVo.nombre}"/>
                        </p:column>
                        <p:column headerText="NÃºmero" sortBy="#{dataCon.codigo}" style="text-align: left;">
                            <h:outputText value="#{dataCon.codigo}"/>
                        </p:column>
                        <p:column headerText="Contrato" sortBy="#{dataCon.nombre}"  style="width: 20%; text-align: left;" >
                            <h:outputText value="#{dataCon.nombre}"/>
                        </p:column>
                        <p:column headerText="Venvimiento"  width="5%">
                            <h:outputText value="#{dataCon.fechaVencimiento}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Estado" >
                            <h:outputText value="#{dataCon.estado}"/>
                        </p:column>
                        <p:column headerText="Analista" style="text-align: left; height: 40px;" >
                            <h:outputText value="#{dataCon.analista}"/>
                        </p:column>
                        <p:column headerText="Exhorto" sortBy="#{dataCon.codigoExhorto}" style="text-align: left;" width="5%">
                            <h:outputText value="#{dataCon.codigoExhorto}"/>
                        </p:column>
                        <p:column sortBy="#{dataCon.solFinAvance}"  style="#{dataCon.solFinAvance gt 0 ?  'background: red;' : ''}"  width="5%">
                            <f:facet name="header" class="solFin"><p style="color: red; font-weight: bold;">SOLICITUD, 15%</p></f:facet>
                            <h:outputLabel value="#{dataCon.solFinAvance}" />
                        </p:column>
                        <p:column sortBy="#{dataCon.actaEntAvance}"  style="#{dataCon.actaEntAvance gt 0 ?  'background: red;' : ''}" width="5%">
                            <f:facet name="header" class="solFin"><p style="color: red; font-weight: bold;">ACTA E-R, 15%</p></f:facet>
                            <h:outputLabel value="#{dataCon.actaEntAvance} %" />   
                        </p:column>
                        <p:column sortBy="#{dataCon.edoCuentaAvance}" style="#{dataCon.edoCuentaAvance gt 0 ?  'background: orange;' : ''}" width="5%">
                            <f:facet name="header" class="solFin"><p style="color: orange; font-weight: bold;">EDO.CTA, 20%</p></f:facet>
                            <h:outputLabel value="#{dataCon.edoCuentaAvance} %"/>
                        </p:column>
                        <p:column sortBy="#{dataCon.validContAvance}" style="#{dataCon.validContAvance gt 0 ?  'background: orange;' : ''}" width="5%">
                            <f:facet name="header" class="solFin"><p style="color: orange; font-weight: bold;">VALID.CONT, 10%</p></f:facet>
                            <h:outputLabel value="#{dataCon.validContAvance} %"/>
                        </p:column>
                        <p:column sortBy="#{dataCon.validRhAvance}" style="#{dataCon.validRhAvance gt 0 ?  'background: yellow;' : ''}" width="5%">
                            <f:facet name="header" class="solFin"><p style="background-color: #ffff00; font-weight: bold;">VALID.RH, 15%</p></f:facet>
                            <h:outputLabel value="#{dataCon.validRhAvance} %"/>
                        </p:column>
                        <p:column sortBy="#{dataCon.totalFormas}" headerText="Suma" 
                                  style="#{dataCon.totalFormas gt 0 ?  'background: #cccccc;' : ''}" width="5%">
                            <h:outputLabel value="#{dataCon.totalFormas} %"/>
                        </p:column>
                    </p:dataTable>

                    <p:commandButton value="Exportar">
                        <p:dataExporter fileName="contratos" target="dtContratos" type="xls" />
                    </p:commandButton>
                </h:form>
                <!--  -->
                <div class="modal fade" id="dialogoResumenFiniquito" data-backdrop="static" data-keyboard="false">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">Resumen de avance de proceso de avance</h4>
                            </div>
                            <h:form id="frmResAvanFin">                                
                                <div class="modal-body">
                                    <h:message for="" errorClass="text-danger" infoClass="text-info"/>
                                    <p:tabView activeIndex="0">
                                        <p:tab title="Resumen por campo">
                                            <div class="form-group">
                                                <div class="col-4">
                                                    <p:selectOneMenu value="#{reporteContratoFiniquitoBean.campoId}"
                                                                     styleClass="form-control">
                                                        <f:selectItem itemLabel="Todos los campos . . ." itemValue="0"/>
                                                        <f:selectItems value="#{reporteContratoFiniquitoBean.campos}"/>
                                                        <p:ajax listener="#{reporteContratoFiniquitoBean.cambiarCampoHistorico}"
                                                                update="dtAvance"/>
                                                    </p:selectOneMenu>
                                                </div>    
                                            </div>
                                            <p:dataTable id="dtAvance" value="#{reporteContratoFiniquitoBean.historicoAvances}"
                                                         var="dataAv" rows="10"  paginator="true" 
                                                         paginatorPosition="bottom" showGridlines="true" size="small">
                                                <p:column headerText="Campo" style="text-align: left;" width="250">
                                                    <h:outputLabel value="#{dataAv.apCampo.nombre}"/>
                                                </p:column>
                                                <p:column headerText="Fecha" sortBy="#{dataAv.fechaGenero}" width="5%">
                                                    <h:outputLabel value="#{dataAv.fechaGenero}">
                                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                                    </h:outputLabel>
                                                </p:column>
                                                <p:column headerText="Avance">
                                                    <h:outputLabel value="#{dataAv.avance} %"/>
                                                </p:column>
                                                <p:column headerText="Diferencia">
                                                    <h:outputLabel value="#{dataAv.diferencia} %"/>
                                                </p:column>
                                                <p:column headerText="Cto. en finiquito">
                                                    <h:outputLabel value="#{dataAv.totalContabilizado}"/>
                                                </p:column>
                                            </p:dataTable>
                                            <p:commandButton value="Exportar">
                                                <p:dataExporter  fileName="avance" target="dtAvance" type="xls"/>
                                            </p:commandButton>
                                        </p:tab>
                                        <p:tab title="Avance porcentual" >
                                            <div class="col-12">
                                                <h:outputLabel id="lblAv" value="AVANCE PORCENTUAL: #{reporteContratoFiniquitoBean.avanceGlobal} %"/>                           
                                            </div>
                                            <p:dataTable id="dtAvanceGlobal" 
                                                         value="#{reporteContratoFiniquitoBean.historicoGlobalAvances}"
                                                         var="dataAvGl" >
                                                <p:column headerText="Campo" style="text-align: left;">
                                                    <h:outputLabel value="#{dataAvGl.campo}"/>
                                                </p:column>
                                                <p:column headerText="Fecha" sortBy="#{dataAvGl.fechaGenero}">
                                                    <h:outputLabel value="#{dataAvGl.fechaGenero}">
                                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                                    </h:outputLabel>
                                                </p:column>
                                                <p:column headerText="Avance">
                                                    <h:outputLabel value="#{dataAvGl.avance}"/>
                                                </p:column>
                                                <p:column headerText="Cto. en finiquito">
                                                    <h:outputLabel value="#{dataAvGl.totalContabilizado}"/>
                                                </p:column>
                                            </p:dataTable>
                                            <p:commandButton value="Exportar">
                                                <p:dataExporter  fileName="avanceGlobal" target="dtAvanceGlobal" type="xls"/>
                                            </p:commandButton>
                                        </p:tab>
                                    </p:tabView>

                                </div>
                                <div class="modal-footer">
                                    <p:commandLink value="Cerrar" onclick="$(dialogoResumenFiniquito).modal('hide');"
                                                   immediate="true"/>
                                </div>
                            </h:form>
                        </div>
                    </div>
                </div>
            </ui:define>

        </ui:composition>

    </body>
</html>
