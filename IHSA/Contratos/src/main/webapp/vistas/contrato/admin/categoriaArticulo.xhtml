<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"

      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:body>
        <ui:composition template="../../../WEB-INF/template/template.xhtml">
            <ui:define name="tituloPagina">
                <h2 class="page-header">Registro de categorías</h2>
            </ui:define>
            <ui:define name="content">	
                <h:form id="frmCategoria" rendered="#{not empty sesion.usuarioSesion}">
                    <div class="row">
                        <div class="col-lg-2">
                            <p:commandLink title="Agregar a categoría" styleClass="btn btn-primary btn-md"
                                           action="#{registroCategoriaBean.iniciarAgregarCategoria(event)}">
                                <i class="fa fa-plus"> <b>Agrgar categoría</b></i>
                            </p:commandLink>
                        </div>
                    </div>
                    <div class="row">
                        <p:dataTable var="data" value="#{registroCategoriaBean.mapaArticulo.get('articulo')}"
                                     styleClass="col col-lg-10">
                            <f:facet name="header"><b>Lista de articulos</b></f:facet>
                            <p:column>
                                <h:selectBooleanCheckbox value="#{data.selected}"/>
                            </p:column>
                            <p:column headerText="Ítem" style="text-align: left;">
                                <h:outputText value="#{data.codigo}"/>
                            </p:column>
                            <p:column headerText="Nombre" style="text-align: left;">
                                <h:outputText value="#{data.nombre}"/>
                            </p:column>
                            <p:column headerText="Unidad">
                                <h:outputText value="#{data.unidadNombre}"/>
                            </p:column>
                        </p:dataTable>
                    </div>                    
                </h:form>
                <div class="modal fade" id="dialogoAgregarCategoria" data-backdrop="static" data-keyboard="false">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <h:form id="frmCambiarArticulo">
                                <div class="modal-header">
                                    <h4 class="modal-title">Categoría donde se moverán los artículos</h4>
                                </div>
                                <div class="modal-body">
                                    <div class="card card-heading">
                                        <div class="form-group">
                                            <div class="col-lg-10">
                                                <ui:repeat value="#{registroCategoriaBean.mapaCategria.get('categoriaSeleccionada')}" var="data"
                                                           varStatus="indice">
                                                    <p:commandLink  style="padding-left: 2%;"
                                                                    action="#{registroCategoriaBean.seleccionarCategoriaCabecera(event)}"
                                                                    styleClass="text text-primary">
                                                        <i class="#{data.nombre eq 'Pricipales' ? 'fa fa-circle' : 'fa fa-arrow-right' }" ></i>
                                                        #{data.nombre} 
                                                        <f:param name="indiceCatSel" value="#{indice.index}"/>
                                                    </p:commandLink>
                                                </ui:repeat>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card card-info">
                                        <div class="card-heading">
                                            <div class="input-group col-lg-12">
                                                <div class="col-lg-10">
                                                    #{registroCategoriaBean.mapaCategria.get('categoriaSeleccionada').size()  eq 1 ? 'Pricipales' : registroCategoriaBean.categoriaVo.nombre}
                                                </div>
                                                <div class="col-lg-2">
                                                    <p:commandLink styleClass="btn btn-primary" 
                                                                   rendered="#{registroCategoriaBean.mapaCategria.get('categoriaSeleccionada').size()  gt 1}"
                                                                   action="#{registroCategoriaBean.iniciarEnlaceCategoria(event)}"
                                                                   title="Enlazar categorías">
                                                        <i class="fa fa-link"></i>
                                                    </p:commandLink>
                                                    <p:commandLink styleClass="btn btn-primary" 
                                                                   rendered="#{registroCategoriaBean.mapaCategria.get('categoriaSeleccionada').size()  eq 1}"
                                                                   action="#{registroCategoriaBean.iniciarRegistroCategoria(e)}"
                                                                   title="Registrar categoría">
                                                        <i class="fa fa-plus-circle"></i>
                                                    </p:commandLink>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <!-- rowSelectListener="#{registroCategoriaBean.seleccionarCategoria}" -->
                                            <p:dataTable value="#{registroCategoriaBean.mapaCategria.get('categoria')}" var="data"
                                                         rowStyleClass="table table-bordered table-striped"
                                                         rows="7" paginator="true"  
                                                         paginatorPosition="bottom" 
                                                         style="text-align: left;"                                                           
                                                         rowIndexVar="indice">
                                                <p:column headerText="Nombre" style="text-align: left;">
                                                    <h:outputText value="#{data.nombre}"/>
                                                </p:column>
                                                <p:column headerText="Código">
                                                    <h:outputText value="#{data.codigo}"/>
                                                </p:column>
                                                <p:column rendered="#{registroCategoriaBean.mapaCategria.get('categoriaSeleccionada').size() gt 1}">
                                                    <p:commandLink
                                                        action="#{registroCategoriaBean.eliminarCategoria(event)}">
                                                        <i class="fa fa-trash text-danger"></i>
                                                        <f:param name="idCategoria" value="#{indice}"/>
                                                    </p:commandLink>
                                                </p:column>
                                            </p:dataTable>
                                        </div>
                                    </div>  
                                    <div class="row">
                                        <p:dataTable var="data" value="#{registroCategoriaBean.mapaArticulo.get('artAgregarCat')}"
                                                     styleClass="col col-lg-12">
                                            <f:facet name="header"><b>Listade articulos</b></f:facet>
                                            <p:column headerText="Ítem" style="text-align: left;">
                                                <h:outputText value="#{data.codigo}"/>
                                            </p:column>
                                            <p:column headerText="Nombre" style="text-align: left;">
                                                <h:outputText value="#{data.nombre}"/>
                                            </p:column>
                                            <p:column headerText="Unidad">
                                                <h:outputText value="#{data.unidadNombre}"/>
                                            </p:column>
                                        </p:dataTable>
                                    </div>
                                    <ui:fragment rendered="#{not empty registroCategoriaBean.mapaCategria.get('categoriaRelacion')}">
                                        <div class="card card-info">
                                            <div class="card card-heading">
                                                <div class="form-group" >
                                                    <div align="left" class="col-lg-8">
                                                        <h:outputText class="card-title" value="Relacionar categorías ( #{registroCategoriaBean.categoriaVo.nombre} )"/>
                                                    </div>
                                                    <div align="right" class="col-lg-4">
                                                        <p:commandLink action="#{registroCategoriaBean.cancelarGuardarCategoria(e)}"
                                                                       styleClass="btn btn-default">
                                                            <i class="fa fa-remove text-danger"></i>
                                                        </p:commandLink>
                                                        <p:commandLink action="#{registroCategoriaBean.terminarGuardarCategoria(e)}"
                                                                       styleClass="btn btn-primary"
                                                                       style="margin-left: 20px;">
                                                            <i class="fa fa-floppy-o"></i>
                                                        </p:commandLink>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="card card-body">
                                                <div class="col-lg-6 col-xs-6">
                                                    <!-- rowSelectListener="#{registroCategoriaBean.seleccionarCategoriaAgregar}"> 
                                                                 selectionMode="single" -->
                                                    <p:dataTable value="#{registroCategoriaBean.mapaCategria.get('categoriaRelacion')}" var="data"
                                                                 rowStyleClass="table table-bordered table-striped"
                                                                 rows="10" paginator="true"  
                                                                 paginatorPosition="bottom" 
                                                                 style="text-align: left;">

                                                        <p:column headerText="Nombre" filterBy="#{data.nombre}" filterMatchMode="contains">
                                                            <h:outputText value="#{data.nombre}"/>
                                                        </p:column>
                                                        <p:column headerText="Código" filterBy="#{data.codigo}" filterMatchMode="contains">
                                                            <h:outputText value="#{data.codigo}"/>
                                                        </p:column>
                                                    </p:dataTable>
                                                </div>
                                                <div class="col-lg-6 col-xs-6">					
                                                    <p:dataTable value="#{registroCategoriaBean.mapaCategria.get('categoriaTemporal')}" var="data"
                                                                 rowStyleClass="table table-bordered table-striped"
                                                                 rows="10" paginator="true"  
                                                                 paginatorPosition="bottom" 
                                                                 rowIndexVar="indice" style="text-align: left;">
                                                        <f:facet name="header" >Categorías a guardar</f:facet>
                                                        <p:column headerText="Nombre">
                                                            <h:outputText value="#{data.nombre}"/>
                                                        </p:column>
                                                        <p:column>
                                                            <p:commandLink
                                                                action="#{registroCategoriaBean.eliminarCategoriaTemporal(event)}">
                                                                <i class="fa fa-trash text-danger"></i>
                                                                <f:param name="idCatTablaTemp" value="#{indice}"/>
                                                            </p:commandLink>
                                                        </p:column>
                                                    </p:dataTable>
                                                </div>
                                            </div>
                                        </div>
                                    </ui:fragment>                                    
                                </div>
                                <div class="modal-footer">
                                    <p:commandLink value="Cerrar" styleClass="btn btn-default" 
                                                   onclick="$(dialogoAgregarCategoria).modal('hide');"/>
                                    <p:commandLink value="Guardar" styleClass="btn btn-primary" 
                                                   action="#{registroCategoriaBean.agregarCategoria(event)}"/>
                                </div>
                            </h:form>
                        </div>
                    </div>
                </div>
                <!-- Registro de categoría -->
                <div class="modal fade" id="registrarCategoria" data-backdrop="static" data-keyboard="false">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">Categoría</h4>
                            </div>
                            <h:form id="frmAgregarCategoria">
                                <div class="modal-body card card-body">				    
                                    <div class="input-group col-lg-12" >
                                        <div class="form-group col-lg-12">
                                            <div class="col-lg-2">
                                                <h:outputLabel value="Categoría: " styleClass="control-label"/>
                                            </div>					    
                                            <div class="col-lg-8">
                                                <h:inputText id="txtCategoria" value="#{registroCategoriaBean.nombre}" styleClass="form-control"
                                                             required="true" requiredMessage="Es necesario agregar el nombre"/>
                                                <h:message for="txtCategoria" styleClass="text-danger"/>
                                            </div>
                                        </div>
                                        <div class="form-group col-lg-12">
                                            <div class="col-lg-2">
                                                <h:outputLabel value="Código:" styleClass="control-label"/>
                                            </div>
                                            <div class="col-lg-8">
                                                <h:inputText id="txtCodCat" value="#{registroCategoriaBean.codigo}" styleClass="form-control"
                                                             maxlength="3"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <p:commandLink value="Cerrar" styleClass="btn btn-default" 
                                                   action="#{registroCategoriaBean.cerrarRegistrarCategoria(event)}"
                                                   immediate="true"/>
                                    <p:commandLink value="Guardar" styleClass="btn btn-primary" 
                                                   action="#{registroCategoriaBean.registrarCategoria(event)}"						     
                                                   />
                                </div>
                            </h:form>
                        </div>
                    </div>
                </div>
            </ui:define>
        </ui:composition>
    </h:body>
</html>
