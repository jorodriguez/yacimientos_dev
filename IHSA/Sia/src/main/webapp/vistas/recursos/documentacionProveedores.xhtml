<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"    
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"  
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <body>
        <ui:composition template="./../../WEB-INF/facelets/templates/templateGrupos.xhtml">
            <ui:define name="contenido">
                <div id="Page">
                    <div class="row">
                        <ui:include src="./menuRecursos.xhtml" />
                    </div>
                    <div class="row"> 
                        <h:form   id="frmDoctoRh">
                            <p:dataTable size="small" stripedRows="true" showGridlines="true"  value="#{documentosProveedoresRhBean.proveedores}" var="dataDoc"
                                         paginator="true" paginatorAlwaysVisible="true"
                                         rows="15" paginatorPosition="bottom">                                
                                <p:column headerText="RFC" filterBy="#{dataDoc.rfc}"  width="20%"
                                          filterMatchMode="contains" sortBy="#{dataDoc.rfc}">
                                    <h:outputText value="#{dataDoc.rfc}"/>
                                </p:column>
                                <p:column headerText="Nombre" style="text-align: left;"  
                                          filterBy="#{dataDoc.nombre}" 
                                          filterMatchMode="contains" sortBy="#{dataDoc.nombre}">
                                    <h:outputText value="#{dataDoc.nombre}"/>
                                </p:column>
                                <p:column width="50">
                                    <p:commandLink title="Ver contratos" action="#{documentosProveedoresRhBean.verContratos(dataDoc.idProveedor, dataDoc.rfc, dataDoc.nombre)}"
                                                   process="@this" update="frmContrProveedor">
                                        <i class="fa fa-eye text-primary"/>
                                    </p:commandLink>
                                </p:column>
                            </p:dataTable>
                        </h:form>
                    </div>
                </div>
                <!-- Contratos del proveedor -->
                <div class="modal fade" id="dialogoContratosProveedor" data-backdrop="static" data-keyboard="false">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">Contratos del proveedor</h4>
                            </div>
                            <h:form id="frmContrProveedor">
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="form-group">
                                                <h:outputLabel value="Proveedor"/>
                                                <div>
                                                    <h:outputText value="#{documentosProveedoresRhBean.proveedoreVo.nombre}"
                                                                  styleClass="form-control"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <p:dataTable size="small" stripedRows="true" showGridlines="true" value="#{documentosProveedoresRhBean.contratosProveedor}"
                                                 var="dataC" rowIndexVar="index" >
                                        <p:column headerText="Número" style="text-align: left;" sortBy="#{dataC.numero}"
                                                  >
                                            <h:outputText value="#{dataC.numero}"/>
                                        </p:column>
                                        <p:column headerText="Nombre" style="text-align: left;" sortBy="#{dataC.nombre}"
                                                  >
                                            <h:outputText value="#{dataC.nombre}"/>
                                        </p:column>
                                        <p:column headerText="Inicio">
                                            <h:outputText value="#{dataC.fechaInicio}">
                                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                                            </h:outputText>
                                        </p:column>
                                        <p:column headerText="Vencimiento">
                                            <h:outputText value="#{dataC.fechaVencimiento}">
                                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                                            </h:outputText>
                                        </p:column>
                                        <p:column headerText="Monto">
                                            <h:outputText value="#{dataC.monto}">
                                                <f:convertNumber pattern="#,###.##"/>
                                            </h:outputText>
                                        </p:column>
                                        <p:column headerText="Moneda">
                                            <h:outputText value="#{dataC.moneda}"/>
                                        </p:column>
                                        <p:column >
                                            <p:commandLink action="#{documentosProveedoresRhBean.verDoctosPorContrato(index)}"
                                                           process="@this" update="frmDoctosProveedor">
                                                <i class="fa fa-eye text-primary"/>
                                            </p:commandLink>
                                        </p:column>
                                    </p:dataTable>
                                </div>
                                <div class="modal-footer">
                                    <p:commandLink value="Cerrar" onclick="$(dialogoContratosProveedor).modal('hide');" 
                                                   immediate="true"/>
                                </div>
                            </h:form>
                        </div>
                    </div>
                </div>

                <div class="modal fade" id="dialogoDoctosProveedor" data-backdrop="static" data-keyboard="false">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">Docuementos RH</h4>
                            </div>
                            <h:form id="frmDoctosProveedor">
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-lg-3">
                                            <div class="form-group">
                                                <h:outputText value="Número"/>
                                                <div> 
                                                    <h:outputLabel value="#{documentosProveedoresRhBean.contratoVo.numero}"/>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-9">
                                            <div class="form-group">
                                                <h:outputText value="Contrato"/>
                                                <div> 
                                                    <h:outputLabel value="#{documentosProveedoresRhBean.contratoVo.nombre}"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <p:tabView >
                                        <p:tab title="Documentos periodicos">
                                            <p:dataTable size="small" stripedRows="true" showGridlines="true" id="dtDoctosPerRh" 
                                                         value="#{documentosProveedoresRhBean.doctosRhPeriodicos}" var="dataPer">
                                                <p:column headerText="Documento" style="text-align: left;">
                                                    <h:outputText value="#{dataPer.documento}"/>
                                                </p:column>
                                                <p:column headerText="Descargar">
                                                    <h:outputLink target="_blank"  value="/Sia/AbrirArchivo?ZWZ2W=#{dataPer.idAdjunto}&amp;ZWZ3W=#{dataPer.uuId}"
                                                                  style="color: blue; text-decoration:  underline;"
                                                                  rendered="#{dataPer.idAdjunto gt 0}">
                                                        <h:outputText value=" Abrir"/>
                                                    </h:outputLink>
                                                </p:column>
                                                <p:column headerText="Fecha">
                                                    <h:outputLabel value="#{dataPer.fechaGenero}">
                                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                                    </h:outputLabel>
                                                </p:column>
                                                <p:column>
                                                    <p:commandLink action="#{documentosProveedoresRhBean.inicioEnviarObservacion(dataPer.id)}"
                                                                   value="Nota" styleClass="btn btn-default"
                                                                   process="@this" update="frmNotaDatosProveedor"> 
                                                    </p:commandLink>
                                                </p:column>
                                            </p:dataTable>
                                            <p:commandButton value="Exportar">
                                                <p:dataExporter fileName="DocumentosPeriodicosRh" target="dtDoctosPerRh" type="xls"/>
                                            </p:commandButton>
                                        </p:tab>
                                        <p:tab title="Documentos NO periodicos">
                                            <p:dataTable size="small" stripedRows="true" showGridlines="true" id="dtDoctosNoPer" 
                                                         value="#{documentosProveedoresRhBean.doctosRhNoPeriodicos}" var="dataNoPer">
                                                <p:column headerText="Documento" style="text-align: left;">
                                                    <h:outputText value="#{dataNoPer.documento}"/>
                                                </p:column>
                                                <p:column headerText="Descargar">
                                                    <h:outputLink target="_blank"  value="/Sia/AbrirArchivo?ZWZ2W=#{dataNoPer.idAdjunto}&amp;ZWZ3W=#{dataNoPer.uuId}"
                                                                  style="color: blue; text-decoration:  underline;"
                                                                  rendered="#{dataNoPer.idAdjunto gt 0}">
                                                        <h:outputText value=" Abrir"/>
                                                    </h:outputLink>
                                                </p:column>
                                                <p:column>
                                                    <p:commandLink action="#{documentosProveedoresRhBean.inicioEnviarObservacion(dataNoPer.id)}"
                                                                   value="Nota" styleClass="btn btn-default"
                                                                   process="@this" update="frmNotaDatosProveedor">
                                                    </p:commandLink>
                                                </p:column>
                                            </p:dataTable>
                                            <p:commandButton value="Exportar">
                                                <p:dataExporter fileName="DocumentosNoPeriodicos" target="dtDoctosNoPer" type="xls"/>
                                            </p:commandButton>
                                        </p:tab>
                                    </p:tabView>
                                </div>
                                <div class="modal-footer">
                                    <p:commandLink value="Cerrar" onclick="$(dialogoDoctosProveedor).modal('hide');" immediate="true"/>
                                </div>
                            </h:form>
                        </div>
                    </div>
                </div>
                <div class="modal fade" id="dialogoEnviarNotaDoctosProveedor" data-backdrop="static" data-keyboard="false">
                    <div class="modal-dialog" style="width: 60%;">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">Nota de docuementos RH</h4>
                            </div>
                            <h:form id="frmNotaDatosProveedor">
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="form-group">
                                                <h:outputLabel value="Documento:"/>
                                                <div >
                                                    <h:outputText value="#{documentosProveedoresRhBean.doctosRhVo.documento}"/>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <h:outputLabel value="Observación:"/>
                                                <div >
                                                    <h:inputTextarea class="form-control" value="#{documentosProveedoresRhBean.doctosRhVo.observacion}"
                                                                     required="true" requiredMessage="Es necesario agregar la observación."/>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="col-lg-6">	
                                                <p:dataTable size="small" stripedRows="true" showGridlines="true" 
                                                             value="#{documentosProveedoresRhBean.contactosProveedor}" var="dataCP"
                                                             selectionMode="single"
                                                             rowKey="#{dataCP.idContactoProveedor}" 
                                                             selection="#{documentosProveedoresRhBean.contactosProveedorVo}"
                                                             rows="5" paginatorAlwaysVisible="false" paginator="true" paginatorPosition="bottom"
                                                             style="font-size: 1em;" >
                                                    <p:ajax event="rowSelect" listener="#{documentosProveedoresRhBean.seleccionarContacto}" 
                                                            update="frmNotaDatosProveedor:dtListaCorreo"/>
                                                    <f:facet name="header" >contactos del proveedor</f:facet>
                                                    <p:column headerText="Nombre" style="text-align: left;">
                                                        <h:outputText value="#{dataCP.nombre}"/>
                                                    </p:column>
                                                    <p:column headerText="Puesto" style="text-align: left;">
                                                        <h:outputText value="#{dataCP.puesto}"/>
                                                    </p:column>
                                                    <p:column headerText="Correo" style="text-align: left;">
                                                        <h:outputText value="#{dataCP.correo}"/>
                                                    </p:column>
                                                </p:dataTable>
                                            </div>
                                            <div class="col-lg-6">	
                                                <p:dataTable id="dtListaCorreo" size="small" stripedRows="true" 
                                                             showGridlines="true" value="#{documentosProveedoresRhBean.listaCorreo}" var="datal"
                                                             style="font-size: 1em;" rowIndexVar="index">
                                                    <f:facet name="header" >Correo para</f:facet>
                                                    <p:column headerText="Nombre" style="text-align: left;">
                                                        <h:outputText value="#{datal.nombre}"/>
                                                    </p:column>
                                                    <p:column >
                                                        <p:commandLink action="#{documentosProveedoresRhBean.quitarUsuarioCorreo(index)}" 
                                                                       process="@this" update="frmNotaDatosProveedor:dtListaCorreo">
                                                            <i class="fa fa-trash text text-danger"/>
                                                        </p:commandLink>
                                                    </p:column>
                                                </p:dataTable>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <p:commandLink value="Cerrar" onclick="$(dialogoEnviarNotaDoctosProveedor).modal('hide');" 
                                                   immediate="true" styleClass="btn btn-default"/>
                                    <p:commandButton value="Enviar"  styleClass="btn btn-primary" process="@form"
                                                     update="frmDoctoRh"
                                                     action="#{documentosProveedoresRhBean.enviarObservacion}"/>
                                </div>
                            </h:form>
                        </div>
                    </div>
                </div>

            </ui:define>

        </ui:composition>

    </body>
</html>
