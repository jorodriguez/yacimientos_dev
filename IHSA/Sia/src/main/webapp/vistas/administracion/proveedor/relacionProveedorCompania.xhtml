<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"       
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      >
    <body>
        <ui:composition template="./../../../WEB-INF/facelets/templates/templateGrupos.xhtml">
            <ui:define name="tituloPagina">
                #{msgs['sia.proveedor.compania.titulo']}
            </ui:define>
            <ui:define name="contenido">
                <h:form id="frmRelPro">
                    <div class="col-lg-12 col-xs-12">
                        <p:autoComplete value="#{proveedorBean.nombreProveedor}" 
                                        size="40" forceSelection="true" minQueryLength="3"
                                        completeMethod="#{proveedorBean.completaProveedor}"
                                        placeholder="Nombre o parte del nombre del proveedor">
                            <p:ajax listener="#{proveedorBean.llenarDatosProveedor}"  update="frmRelPro:tbDatosProv"/>
                        </p:autoComplete>
                    </div>
                    <h:messages style="color: red;"/>
                    <div class="col-lg-12 col-xs-12">
                        <p:tabView id="tbDatosProv">
                            <p:tab title="Datos" >
                                <div class="input-group">
                                    <div class="col-lg-2">
                                        <p:commandLink value="Modificar datos" styleClass="btn btn-primary text-white" 
                                                       onclick="$(dialogoProveedor).modal('show');"
                                                       rendered="#{proveedorBean.proveedorVo ne null}"
                                                       process="@this" update="frmProveedor"/>
                                    </div>
                                    <div class="col-lg-2">
                                        <p:commandLink value="Enviar contraseña" styleClass="btn btn-primary text-white"
                                                       onclick="$(dialogoCambiarPassProveedor).modal('show');"
                                                       rendered="#{proveedorBean.proveedorVo ne null}"
                                                       process="@this" update="frmCambioPass"/>
                                    </div>
                                </div>

                                <h:panelGrid columns="2">
                                    <h:outputText value="Nombre"/>
                                    <h:outputLabel value="#{proveedorBean.proveedorVo.nombre}"/>
                                    <h:outputText value="País"/>
                                    <h:outputLabel value="#{proveedorBean.proveedorVo.pais}"/>
                                    <h:outputText value="Estado"/>
                                    <h:outputLabel  value="#{proveedorBean.proveedorVo.estado}"/>
                                    <h:outputText value="Ciduad"/>
                                    <h:outputLabel  value="#{proveedorBean.proveedorVo.ciudad}"/>
                                    <h:outputText value="Colonia"/>
                                    <h:outputLabel  value="#{proveedorBean.proveedorVo.colonia}"/>
                                    <h:outputText value="Calle"/>
                                    <h:outputLabel  value="#{proveedorBean.proveedorVo.calle}"/>
                                    <h:outputText value="Número"/>
                                    <h:outputLabel  value="#{proveedorBean.proveedorVo.numero}"/>
                                    <h:outputText value="Código"/>
                                    <h:outputLabel  value="#{proveedorBean.proveedorVo.codigoPostal}"/>					    
                                </h:panelGrid>
                            </p:tab>

                            <p:tab title="Compania">
                                <h:panelGrid columns="3">
                                    <h:panelGrid columns="2">
                                        <h:outputLabel value="#{msgs['presupuesto.nuevos.campoCompania']}"/>
                                        <p:selectOneMenu value="#{proveedorBean.rfcCompania}">
                                            <f:selectItems value="#{proveedorBean.empresas}"/>
                                        </p:selectOneMenu>
                                    </h:panelGrid>
                                    <h:panelGrid columns="2">
                                        <h:outputLabel value="#{msgs['sia.proveedor.referencia']} "/>
                                        <p:inputText value="#{proveedorBean.numeroReferencia}" size="10" id="numRef"/>
                                    </h:panelGrid>
                                    <p:commandLink title="#{msgs['sia.proveedor.agregar.relacion.tooltip']}" value="#{msgs['sistema.guardar']}" 
                                                   action="#{proveedorBean.agregarRelacion}"
                                                   styleClass="btn btn-info text-white">
                                    </p:commandLink>
                                </h:panelGrid>
                                <h:panelGrid id="pnlGriTitulo"  style="text-align: center;">
                                    <h:outputLabel  id="cjNombreProveedor" />
                                    <p:dataTable id="dtRelP" size="small" stripedRows="true" showGridlines="true" 
                                                 value="#{proveedorBean.lista}" var="cp" rowIndexVar="index">
                                        <p:column headerText="#{msgs['sia.proveedor.rfc']}">
                                            <h:outputLabel value="#{cp.rfcCompania}"/>
                                        </p:column>
                                        <p:column headerText="#{msgs['presupuesto.nuevos.campoCompania']}">
                                            <h:outputLabel value="#{cp.nombre}"/>
                                        </p:column>
                                        <p:column headerText="#{msgs['sia.proveedor.referencia']}">
                                            <h:inputText value="#{cp.numeroReferencia}" rendered="#{cp.editar}"/>
                                            <h:outputLabel value="#{cp.numeroReferencia}" rendered="#{cp.editar eq false}"/>
                                        </p:column>
                                        <p:column headerText="" >
                                            <p:commandLink value="#{msgs['presupuesto.nuevos.modificar']}" style="color: blue; "
                                                           action="#{proveedorBean.modificar(index)}"  process="@this" update="frmRelPro:tbDatosProv:dtRelP"
                                                           rendered="#{cp.editar eq false}">
                                            </p:commandLink>
                                            <p:panelGrid columns="2" >
                                                <p:commandLink value="#{msgs['sistema.guardar']}" style="color: blue; "
                                                               action="#{proveedorBean.guardar(index)}" 
                                                               rendered="#{cp.editar}" process="@this" update="frmRelPro:tbDatosProv:dtRelP"/> 
                                                <p:commandLink value="#{msgs['sistema.cancelar']}" style="color: blue; "
                                                               action="#{proveedorBean.cancelar(index)}"
                                                               rendered="#{cp.editar}"  process="@this" update="frmRelPro:tbDatosProv:dtRelP"/>
                                            </p:panelGrid>
                                        </p:column>
                                        <p:column >
                                            <p:commandLink value="#{msgs['sistema.eliminar']}" style="color: blue;"
                                                           action="#{proveedorBean.eliminar(cp.id)}"
                                                           process="@this" update="frmRelPro:tbDatosProv:dtRelP">
                                            </p:commandLink>
                                        </p:column>
                                    </p:dataTable>
                                </h:panelGrid>
                            </p:tab>
                            <p:tab title="Contáctos">
                                <p:commandLink title="Agregar contacto"  rendered="#{proveedorBean.idProveedor gt 0}"
                                               onclick="$(dialogoContacto).modal('show');"
                                               styleClass="btn btn-primary"
                                               update="frmAgregarConta" process="@this">
                                    <i class="fa fa-plus text-white"/>
                                </p:commandLink>
                                <p:dataTable id="dtContactos" size="small" stripedRows="true" showGridlines="true"
                                             value="#{proveedorBean.listaContacto}" var="cp">
                                    <f:facet name="header">Contactos</f:facet>
                                    <p:column headerText="Nombre">
                                        <h:inputText value="#{cp.nombre}" rendered="#{cp.editar}"/>
                                        <h:outputLabel value="#{cp.nombre}" rendered="#{cp.editar eq false}"/>
                                    </p:column>
                                    <p:column headerText="Teléfono">
                                        <h:inputText value="#{cp.telefono}" rendered="#{cp.editar}"/>
                                        <h:outputText value="#{cp.telefono}" rendered="#{cp.editar eq false}"/>
                                    </p:column>
                                    <p:column headerText="Correo">
                                        <h:inputTextarea cols="55" value="#{cp.correo}" rendered="#{cp.editar}"/>
                                        <h:outputText  value="#{cp.correo}" rendered="#{cp.editar eq false}"/>
                                    </p:column>
                                    <p:column>
                                        <p:commandLink value="#{msgs['presupuesto.nuevos.modificar']}" style="color: blue; "
                                                       action="#{proveedorBean.modificarContacto(cp.idContactoProveedor)}"
                                                       rendered="#{cp.editar eq false}" process="@this" update="frmRelPro:tbDatosProv:dtContactos">
                                        </p:commandLink>     
                                        <p:panelGrid columns="2" >
                                            <p:commandLink value="#{msgs['sistema.guardar']}" style="color: blue; "
                                                           action="#{proveedorBean.completarModificarContacto(cp.idContactoProveedor)}"                                                           
                                                           rendered="#{cp.editar}" process="@this" update="frmRelPro:tbDatosProv:dtContactos"/> 
                                            <p:commandLink value="#{msgs['sistema.cancelar']}" style="color: blue; "
                                                           action="#{proveedorBean.cancelarModificarContacto(cp.idContactoProveedor)}"
                                                           rendered="#{cp.editar}" process="@this" update="frmRelPro:tbDatosProv:dtContactos"/>
                                        </p:panelGrid>
                                    </p:column>
                                    <p:column>
                                        <p:commandLink value="#{msgs['sistema.eliminar']}" style="color: blue;"
                                                       action="#{proveedorBean.eliminarContacto(cp.idContactoProveedor)}"
                                                       process="@this" update="frmRelPro:tbDatosProv:dtContactos">
                                        </p:commandLink>
                                    </p:column>
                                </p:dataTable>

                            </p:tab>
                        </p:tabView>
                    </div>
                </h:form>
                <div class="modal fade" data-backdrop="static" id="dialogoContacto" data-keyboard="false">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">Agregar contacto</h4>
                            </div>
                            <h:form id="frmAgregarConta">
                                <div class="modal-body">
                                    <h:panelGrid columns="1">
                                        <h:outputText value="Nombre: *"/>    
                                        <p:inputText value="#{proveedorBean.contacto}" required="true" requiredMessage="Es necesario agregar el nombre"
                                                     />
                                        <h:outputText value="Teléfono: "/>    
                                        <p:inputText value="#{proveedorBean.telefono}" />
                                        <h:outputText value="Correo: *"/>    
                                        <p:inputText  id="correo" value="#{proveedorBean.correo}" required="true" requiredMessage="Es necesario agregar el correo"
                                                      />
                                    </h:panelGrid>
                                    <h:outputText value="*Si hay más de un correo, separarlo por comas." style="font-size: small; color: maroon;"/>
                                </div>
                                <div class="modal-body">
                                    <p:commandButton  id="btnGuardar"  value="Guardar"
                                                      action="#{proveedorBean.agregarContacto}"
                                                      process="@form" update="frmRelPro"/>
                                    <p:commandLink id="btnCerrar" action="#{proveedorBean.cancelarAgregarContacto}"
                                                   immediate="true" onclick="$(dialogoContacto).modal('hide');"
                                                   value="Cerrar"/>
                                </div>
                            </h:form>
                        </div>
                    </div>
                </div>
                <!-- Datos del proveedor -->
                <div class="modal fade" data-backdrop="static" id="dialogoProveedor" data-keyboard="false">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">Datos de proveedor</h4>
                            </div>
                            <h:form id="frmProveedor">
                                <div class="modal-body">
                                    <h:panelGrid columns="2" >
                                        <h:outputText value="Nombre: *"/>
                                        <p:inputText id="proveedor" value="#{proveedorBean.proveedorVo.nombre}" size="40"/>
                                        <h:outputText value="País:"/>
                                        <p:inputText  value="#{proveedorBean.proveedorVo.pais}" size="40"/>
                                        <h:outputText value="Estado:"/>
                                        <p:inputText  value="#{proveedorBean.proveedorVo.estado}" size="40"/>
                                        <h:outputText value="Ciduad:"/>
                                        <p:inputText  value="#{proveedorBean.proveedorVo.ciudad}" size="40"/>
                                        <h:outputText value="Colonia:"/>
                                        <p:inputText  value="#{proveedorBean.proveedorVo.colonia}" size="40"/>
                                        <h:outputText value="Calle:"/>
                                        <p:inputText  value="#{proveedorBean.proveedorVo.calle}" size="40"/>
                                        <h:outputText value="Número:"/>
                                        <p:inputText  value="#{proveedorBean.proveedorVo.numero}" size="40"/>
                                        <h:outputText value="Código:"/>
                                        <p:inputText  value="#{proveedorBean.proveedorVo.codigoPostal}" size="40"/>				    
                                        <h:outputText value="CCN:"/>
                                        <h:selectBooleanCheckbox value="#{proveedorBean.proveedorVo.carta}" />
                                        <h:outputText value="REPSE:"/>
                                        <h:selectBooleanCheckbox value="#{proveedorBean.proveedorVo.repse}" />
                                    </h:panelGrid>	
                                </div>
                                <div class="modal-body">		    
                                    <p:commandButton id="btnGuardar" styleClass="btn btn-info text-white" 
                                                     value="Guardar"
                                                     action="#{proveedorBean.modificarDatosProveedor}"
                                                     process="@form" update="frmRelPro:tbDatosProv"/>
                                    <p:commandLink id="btnCerrar"  value="Cerrar" immediate="true"
                                                   onclick="$(dialogoProveedor).modal('hide');"/>
                                </div>
                            </h:form>
                        </div>
                    </div>
                </div>
                <!--  -->
                <div class="modal fade" data-backdrop="static" id="dialogoCambiarPassProveedor" data-keyboard="false">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                </button>
                                <h4 class="modal-title">Enviar contraseña</h4>
                            </div>
                            <h:form id="frmCambioPass">
                                <div class="modal-body">
                                    <div class="form-row">
                                        <small><b>*La contraseña se enviará todos los contactos del proveedor.</b></small>
                                    </div>
                                    <div class="form-row">
                                        <div class="table table-responsive">
                                            <p:dataTable size="small" stripedRows="true" showGridlines="true" 
                                                         value="#{proveedorBean.listaContacto}" var="cp">
                                                <f:facet name="header">Contactos</f:facet>
                                                <p:column headerText="Nombre">
                                                    <h:outputLabel value="#{cp.nombre}"/>
                                                </p:column>
                                                <p:column headerText="Correo">
                                                    <h:outputText  value="#{cp.correo}"/>
                                                </p:column>
                                            </p:dataTable>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <p:commandLink class="btn btn-primary text-white" action="#{proveedorBean.enviarContrasenia}"
                                                   process="@form" update="frmRelPro">
                                        <b>Enviar contraseña</b>
                                    </p:commandLink>
                                    <p:commandLink class="btn btn-default" onclick="$(dialogoCambiarPassProveedor).modal('hide');"
                                                   value="Cerrar" immediate="true">                                
                                    </p:commandLink>
                                </div>
                            </h:form>
                        </div>
                    </div>
                </div>
            </ui:define>
        </ui:composition>
    </body>
</html>
