
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"    
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"  
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:my="http://www.mytags.com/schema/mytags"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" >                           

    <div class="container-fluid ">        
        <h:form>
            <div class="row mt-1">  
                <ui:repeat value="#{principalViewBean.listaOrdenes}" var="item" varStatus="varStatus" >
                    <div class="col-12 col-md-3 col-xl-3">
                        <div class="card h-100 border border-1 border-secondary " style="">
                            <div  class="card-header ps-3 pt-3 pb-0 d-flex justify-content-between align-content-center align-items-center">                                                                                    
                                <h6 data-bs-toggle="modal"                                                     
                                    data-bs-target="#modal_histo_#{item.id}">#{item.consecutivo}</h6>                                            

                                <!--<c:set var="estatus" value="#{item.idEstatus}"/>
                                <span 
                                    class="border-0 bg-transparent"
                                    data-bs-toggle="modal"                                                     
                                    data-bs-target="#modal_histo_#{item.id}">
                                    <c:choose>
                                        <c:when test="${(estatus == 40)}" > 
                                            <p:chip 
                                                label="#{item.estatus} #{item.idEstatus}" 
                                                styleClass="text-xs bg-info opacity-8" 
                                                icon="pi pi-user"/>                                                    
                                        </c:when>                                        
                                        <c:otherwise>                                                    
                                            <p:chip 
                                                label="#{item.estatus} " 
                                                styleClass="text-xs bg-success opacity-8" 
                                                />                                                    
                                        </c:otherwise>
                                    </c:choose>                                                                              
                                </span>-->

                                <p:chip 
                                    label="#{item.estatus}" 
                                    styleClass="text-xs bg-info opacity-8" 
                                    />                                                    


                            </div>

                            <hr class="horizontal dark m-0 "/>
                            <div class="card-body text-sm ps-3 p-1 ">
                                <span class="text-xs text-dark" data-bs-toggle="modal"                                                     
                                      data-bs-target="#modal_histo_#{item.id}">#{item.referencia}</span>
                            </div>                                    
                            <div class="card-body pt-1"
                                 data-bs-toggle="modal"                                                     
                                 data-bs-target="#modal_histo_#{item.id}">

                                <h6 class="text-xs ">Gerencia</h6>
                                <h6 class="text-xs text-muted text-normal ps-2">#{item.gerencia}</h6>
                                <h6 class="text-xs ">Proveedor</h6>
                                <h6 class="text-xs text-muted text-normal ps-2 ">#{item.proveedor}</h6>
                                <h6 class="text-xs ">Requisición</h6>
                                <h6 class="text-xs text-muted text-normal ps-2">#{item.consecutivoRequisicion}</h6>                                        

                                <h6 class="text-xs ">Observaciones</h6>
                                <span class="text-xs text-muted text-normal text-overflow-height">                                            
                                    #{item.siglasCompania}
                                </span>                                              
                                <!--<h6 class="text-uppercase text-body text-xs font-weight-bolder mt-4">Application</h6>-->
                            </div>
                            <!--<div class="card-footer pt-1 pb-1 d-flex justify-content-between align-content-center align-items-center">
                                <span class="text-muted text-xs"
                                      data-bs-toggle="collapse" 
                                      href="#collap_" 
                                      role="button" 
                                      aria-expanded="false" 
                                      aria-controls="collap_"
                                      >Solicitada </span>
                                <span class="text-muted text-xs">#{item.fechaSolicito} </span>                                            
                            </div>                                    
                            <div class="card-footer p-0 d-flex justify-content-center align-content-center align-items-center">                                            
                                <div class="collapse multi-collapse" id="collap_">
                                    <div class="d-flex justify-content-between align-content-center align-items-center">
                                        <span class="text-sm">#{item.revisa}</span>
                                        <span class="text-sm">#{item.fechaRevisa}</span>
                                    </div>
                                </div>
                            </div>
                            -->

                        </div>

                        <!-- modal historial -->
                        <div class="modal fade" id="modal_histo_#{item.id}" tabindex="-1" role="dialog" aria-labelledby="modal-default" aria-hidden="true">
                            <div class="modal-dialog modal- modal-dialog-centered modal-" role="document">
                                <div class="modal-content">                                               
                                    <div class="modal-body p-4">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="d-flex justify-content-md-between  ">
                                                    <h5 ><span class="text-muted"></span> #{item.consecutivo}  </h5>                                                            
                                                    <h5 class="text-muted">#{item.estatus} </h5>
                                                </div>
                                                <ul class="timeline-3 ">
                                                    <my:itemListHistorial
                                                        estatus="Solicita"
                                                        fecha="#{item.fechaSolicito}"
                                                        usuario="#{item.solicita}"
                                                        realizado="#{true}"                                                                    
                                                        />                                                                        
                                                    <my:itemListHistorial
                                                        estatus="Visto Bueno"
                                                        fecha="#{item.fechaVistoBueno}"
                                                        usuario="#{item.vistoBueno}"                                                        
                                                        realizado="#{item.fechaVistoBueno ne null}"
                                                        icono="#{item.fechaVistoBueno ne null ? 'fa fa-check':'fa fa-clock'}"
                                                        />                                                                        
                                                    <my:itemListHistorial
                                                        estatus="Revisada"
                                                        fecha="#{item.fechaRevisa}"
                                                        usuario="#{item.revisa}"
                                                        color="#{item.fechaRevisa ne null ? '':'text-muted'}"
                                                        realizado="#{item.fechaRevisa ne null}"
                                                        icono="#{item.fechaRevisa ne null ? 'fa fa-check':'fa fa-clock'}"
                                                        />                                                                        
                                                    <my:itemListHistorial
                                                        estatus="Aprueba"
                                                        fecha="#{item.fechaAprueba}"
                                                        usuario="#{item.aprueba}"
                                                        realizado="#{item.fechaAprueba ne null}"
                                                        icono="#{item.fechaAprueba ne null ? 'fa fa-check':'fa fa-clock'}"
                                                        />                                                                                                                                     
                                                    <my:itemListHistorial
                                                        estatus="Autoriza"
                                                        fecha="#{item.fechaAutoriza}"
                                                        usuario="#{item.autoriza}"
                                                        realizado="#{item.fechaAutoriza ne null}"
                                                        icono="#{item.fechaAutoriza ne null ? 'fa fa-check':'fa fa-clock'}"
                                                        />               
                                                    <c:if test="#{ordenBean.ordenActual.apCampo.cartaIntencion eq true}">    
                                                        <c:choose>
                                                            <c:when test="#{!item.esProveedorSinCarta}" >
                                                                <my:itemListHistorial
                                                                    estatus="Acepta carta"
                                                                    fecha="#{item.fechaAceptaCartaIntencion}"
                                                                    usuario="#{item.aceptaCartaIntencion}"
                                                                    realizado="#{item.fechaAceptaCartaIntencion ne null}"
                                                                    icono="#{item.fechaAceptaCartaIntencion ne null ? 'fa fa-check':'fa fa-clock'}"
                                                                    />                                                                            
                                                            </c:when>
                                                            <c:otherwise>
                                                                <!-- caso contrario -->
                                                                <my:itemListHistorial
                                                                     estatus="Acepta carta"
                                                                    fecha="NA"
                                                                    usuario="#{item.aceptaCartaIntencion}"
                                                                    realizado="#{false}"
                                                                    icono="#{'fa fa-clock'}"
                                                                    />    
                                                                
                                                                
                                                            </c:otherwise>
                                                        </c:choose>                                                      
                                                    </c:if>
                                                    
                                                    <c:if test="#{!item.esProveedorSinCarta}">    
                                                         <c:if test="#{ordenBean.ordenActual.apCampo.cartaIntencion eq true}">    
                                                              <my:itemListHistorial
                                                                    estatus="Repse"
                                                                    fecha="#{item.fechaRevisaJuridico}"
                                                                    usuario="#{item.revisaJuridico}"
                                                                    realizado="#{item.fechaRevisaJuridico ne null}"
                                                                    icono="#{item.fechaRevisaJuridico ne null ? 'fa fa-check':'fa fa-clock'}"
                                                                    />       
                                                         </c:if>
                                                    </c:if>
                                                    
                                                    

                                                </ul>
                                            </div>
                                        </div>                                                     
                                    </div>
                                    <div class="modal-footer p-1 m-1 ">                                                    
                                        <button type="button" class="btn btn-link  ml-auto" data-dismiss="modal_histo_#{item.id}">Cerrar</button>
                                    </div>

                                </div>
                            </div>
                        </div>


                    </div>
                </ui:repeat>

                <!--<div class="col-12 col-md-3 col-xl-3 " >
                    <h:outputLink value="#{sesion.sustituirArrancarModuloPorCampo(principalViewBean.rutaModuloComprasDeRequ,sesion.usuarioVo.idCampo,principalViewBean.urlSolicitarRequisicion)}"
                                  title="Crear una requisición para #{sesion.usuarioVo.campo}"  
                                  onmouseover="window.status = ' ';return true"
                                  styleClass="text-dark">
                        <div class="card h-100  border border-3 border-primary p-2 mb-2 opacity-10" style="border-style: dotted  !important;">                                    
                            <div class="card-body d-flex justify-content-center flex-fill align-self-center align-content-center align-items-center">                                                                                
                                <div class="row justify-content-md-center text-center  ">
                                    <div class="col-12">
                                        <i class="fa fa-plus fa-2x"/>                                                                                                                               
                                    </div>
                                    <div class="col-12">
                                        Crear una requisición para <span class="text-bold">#{sesion.usuarioVo.campo}</span>
                                    </div>
                                </div>                                           
                            </div>                                    
                        </div>
                    </h:outputLink>   
                </div>-->
            </div>
        </h:form>
    </div>

</ui:composition>
