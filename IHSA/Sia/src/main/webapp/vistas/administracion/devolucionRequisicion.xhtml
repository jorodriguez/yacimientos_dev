<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      >
    <body>
        <ui:composition template="./../../WEB-INF/facelets/templates/templateGrupos.xhtml">
            <ui:define name="tituloPagina">
                Reasignar requisición
            </ui:define>
            <ui:define name="contenido">
                <h:form  id="frmReasignarReq">
                    <div class="col-lg-12 col-xs-12">
                        <p:panelGrid id="pngDatos" columns="1">
                            <p:selectOneMenu value="#{devolucionRequisicion.idBloque}" >
                                <f:selectItems value="#{devolucionRequisicion.listaCampoPorUsuario}"/> 
                            </p:selectOneMenu>
                            <p:panelGrid columns="3">
                                <h:outputLabel value="Requisición"/>
                                <p:inputText value="#{devolucionRequisicion.req}" size="12" styleClass="form-control"
                                             placeholder="22xx-###"/>
                                <p:commandButton value="Buscar" 
                                                 action="#{devolucionRequisicion.buscarRequisicion}" 
                                                 styleClass="btn btn-success text-white"
                                                 process="@this frmReasignarReq:pngDatos" update="frmReasignarReq:pnlDatos"/>
                            </p:panelGrid>
                        </p:panelGrid>
                    </div>
                    <div class="col-lg-12 col-xs-12">
                        <h:messages id="msgDev" errorClass="errorMessage" infoClass="infoMessage"/>
                        <p:panelGrid columns="3" rendered="#{devolucionRequisicion.mostrar}">
                            <h:outputText value="La requisición"/>
                            <h:outputText value="#{devolucionRequisicion.req}." style="color: #0895d6; font-weight: bold;"/>
                            <h:outputText value=" No existe o no se ha creado o el sistema no la tiene."/>
                        </p:panelGrid>
                    </div>
                    <p:panel id="pnlDatos">
                        <div class="col-lg-12 col-xs-12">
                            <h:panelGroup rendered="#{devolucionRequisicion.requisicionVO != null}">                        
                                <p:panelGrid columns="1" rendered="#{devolucionRequisicion.requisicionVO.idStatus == 40 and devolucionRequisicion.dev eq 'True'}">
                                    <p:commandButton value="Click aquí para reasignar la requisición  a otro analista"
                                                     styleClass="btn btn-default" 
                                                     action="#{devolucionRequisicion.devolverSIARequisicion}"
                                                     onclick="$(dialogoReasignarReq).modal('show');"
                                                     process="@this" update="form1"/>
                                </p:panelGrid>
                                <p:panelGrid rendered="#{devolucionRequisicion.requisicionVO.idStatus != 40 or devolucionRequisicion.dev eq 'False'}" columns="3">
                                    <h:outputText value="La requición"/>
                                    <h:outputText value="#{devolucionRequisicion.requisicionVO.consecutivo}." style="color: #0895d6; font-weight: bold;"/>
                                    <h:outputText value="No puede ser reasignada."/>
                                </p:panelGrid>
                                <br/>
                                <div class="col-lg-3 col-xs-4">
                                    <label for="req2" class="col-lg-5 col-xs-3">Requisición</label>
                                    <div class="col-lg-6 col-xs-3" >
                                        <input value="#{devolucionRequisicion.requisicionVO.consecutivo}" disabled="true" class="form-control"></input>
                                    </div>
                                </div>
                                <div class="col-lg-5 col-xs-4">
                                    <label for="comp" class="col-lg-2 col-xs-3">Compañia</label>
                                    <div class="col-lg-10 col-xs-12" >
                                        <input value="#{devolucionRequisicion.requisicionVO.compania}" disabled="true" class="form-control"></input>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-xs-4">
                                    <label for="est" class="col-lg-3 col-xs-3">Estatus</label>
                                    <div class="col-lg-9 col-xs-3" >
                                        <input value="#{devolucionRequisicion.requisicionVO.estatus}" disabled="true" class="form-control"></input>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-xs-4" style="margin-top: 1%;">
                                    <label for="req3" class="col-lg-5 col-xs-3">Requiere</label>
                                    <div class="col-lg-6 col-xs-3" >
                                        <input value="#{devolucionRequisicion.requisicionVO.fechaRequerida}" disabled="true" class="form-control" ></input>
                                    </div>
                                </div>
                                <div class="col-lg-5 col-xs-4" style="margin-top: 1%">
                                    <label for="entrega" class="col-lg-2 col-xs-3">Entrega</label>
                                    <div class="col-lg-10 col-xs-10" >
                                        <input value="#{devolucionRequisicion.requisicionVO.lugarEntrega}" disabled="true" class="form-control"></input>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-xs-4" style="margin-top: 1%;">
                                    <label for="ananlista" class="col-lg-3 col-xs-3">Analista</label>
                                    <div class="col-lg-9 col-xs-9" >
                                        <input value="#{devolucionRequisicion.requisicionVO.comprador}" disabled="true" class="form-control" ></input>
                                    </div>
                                </div>
                            </h:panelGroup> 
                        </div>
                        <div class="col-lg-12 col-xs-12">
                            <hr  style="color: maroon;"/><br/>
                            <p:panelGrid columns="1" rendered="#{devolucionRequisicion.listaOrden.rowCount gt 0}">
                                <h:outputText value="Orden de compra" />
                                <p:dataTable size="small" stripedRows="true" showGridlines="true" 
                                             value="#{devolucionRequisicion.ordenesCompra}" var="oc" >
                                    <p:column >
                                        <f:facet name="header"><h:outputText value="Orden"/></f:facet>
                                        <h:outputText value="#{oc.consecutivo}"/>
                                    </p:column>
                                    <p:column >
                                        <f:facet name="header"><h:outputText value="Analista"/></f:facet>
                                        <h:outputText value="#{oc.analista.nombre}"/>
                                    </p:column>
                                    <p:column >
                                        <f:facet name="header"><h:outputText value="ProyectoOT"/></f:facet>
                                        <h:outputText value="#{oc.proyectoOt.nombre}"/>
                                    </p:column>
                                    <p:column >
                                        <f:facet name="header"><h:outputText value="Proveedor"/></f:facet>
                                        <h:outputText value="#{oc.proveedor.nombre}"/>
                                    </p:column>
                                    <p:column >
                                        <f:facet name="header"><h:outputText value="Subtotal"/></f:facet>
                                        <h:outputText value="#{oc.subtotal}"/>
                                    </p:column>
                                    <p:column >
                                        <f:facet name="header"><h:outputText value="moneda"/></f:facet>
                                        <h:outputText value="#{oc.moneda.siglas}"/>
                                    </p:column>
                                </p:dataTable>
                                <h:outputText value="Autorizaciones de Orden de compra" />
                                <p:dataTable size="small" stripedRows="true" showGridlines="true" 
                                             value="#{devolucionRequisicion.listaAuto}" var="aoc" >
                                    <p:column >
                                        <f:facet name="header"><h:outputText value="Consecutivo"/></f:facet>
                                        <h:outputText value="#{aoc.orden.consecutivo}"/>
                                    </p:column>
                                    <p:column >
                                        <f:facet name="header"><h:outputText value="Estatus"/></f:facet>
                                        <h:outputText value="#{aoc.estatus.nombre}"/>
                                    </p:column>
                                    <p:column >
                                        <f:facet name="header"><h:outputText value="Solicitó"/></f:facet>
                                        <h:outputText value="#{aoc.solicito.nombre}"/>
                                    </p:column>
                                    <p:column >
                                        <f:facet name="header"><h:outputText value="Fecha"/></f:facet>
                                        <h:outputText value="#{aoc.fechaSolicito}">
                                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column >
                                        <f:facet name="header"><h:outputText value="Hora"/></f:facet>
                                        <h:outputText value="#{aoc.horaSolicito}">
                                            <f:convertDateTime pattern="HH:mm:ss"/>
                                        </h:outputText>
                                    </p:column>
                                </p:dataTable>
                            </p:panelGrid>
                        </div>
                    </p:panel>
                </h:form>

                <!-- Modal Panel Popup Rechazo -->
                <div class="modal fade" id="dialogoReasignarReq" data-backdrop="static" data-keyboard="false">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">
                                    Reasignar requisición
                                </h4>
                            </div>
                            <h:form id="form1">
                                <div class="modal-body card card-footer">
                                    <p:panelGrid columns="2">
                                        <h:outputText value="Código: "/>
                                        <h:outputLabel value="#{devolucionRequisicion.requisicionVO.consecutivo}"/> 
                                        <h:outputText value="Motivo: "/>
                                        <p:inputTextarea value="#{devolucionRequisicion.motivo}" cols="65" styleClass="form-control"/> 
                                        <h:outputText value="Analista: "/>
                                        <p:selectOneMenu value="#{devolucionRequisicion.idAnalista}" id="listaAnalistas"
                                                         styleClass="form-control">
                                            <f:selectItems value="#{devolucionRequisicion.listaAnalista}"/> 
                                        </p:selectOneMenu>
                                    </p:panelGrid>
                                </div>
                                <div class="modal-footer">
                                    <p:commandLink value="Reasignar" action="#{devolucionRequisicion.completarDevolverSIARequisicion}" 
                                                   styleClass="btn btn-info text-white" process="@form" update="frmReasignarReq" />
                                    <p:commandLink value="Cancelar" action="#{devolucionRequisicion.cancelarDevolverSIARequisicion}" 
                                                   styleClass="btn btn-default"
                                                   onclick="$(dialogoReasignarReq).modal('hide')"
                                                   immediate="true"/>
                                </div>
                            </h:form>
                        </div>
                    </div>
                </div>
            </ui:define>
        </ui:composition>

    </body>
</html>
