<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"

      xmlns:p="http://primefaces.org/ui"

      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:my="http://www.mytags.com/schema/mytags"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <body>

        <ui:composition template="./../../WEB-INF/facelets/templates/templateSistema.xhtml">
            <ui:define name="contenido">                
                <p:panelGrid>
                    <h:messages style="color: maroon; font-size: small; font-weight: normal;"/>
                </p:panelGrid>
                <h:form id="frmProyectoOT" >
                    <center>
                        <h:outputText value="#{msgs['sia.admin.proyecto.ot.titulo']}" styleClass="tituloEncabezado"/>
                        <br/>
                    </center>   
                    <br/>

                    <p:panelGrid styleClass="bordePanelGrid" style="text-align: center;">
                        <h:outputLabel value="#{msgs['sistema.filtro']}"/>
                        <p:selectOneRadio value="#{proyectoOTBean.idApCampoActivo}"
                                          valueChangeListener="#{proyectoOTBean.cambiarValorCampo}" 

                                          layout="lineDirection" >
                            <f:selectItems value="#{proyectoOTBean.listaBloque}"/> 
                            <f:ajax event="valueChange" execute="@this" render="proyectoOTSelect"/>
                        </p:selectOneRadio>
                    </p:panelGrid>
                    <p:panelGrid columns="3" style="margin-bottom: 0px;">
                        <p:panelGrid style="margin-top: 10px;">
                            <h:outputLabel value="Proyecto OT: " />
                        </p:panelGrid>
                        <!--textChangeListener="#{proyectoOTBean.traerProyectoOtPorNombre}"-->
                        <p:autoComplete value="#{proyectoOTBean.cadena}"                                         
                                        />
                        <p:panelGrid style="margin-top: 10px;">
                            <p:commandLink value="Todos"  action="#{proyectoOTBean.llenarListaOts}" style="color: blue; text-decoration: underline; padding-top: 5px;"/>
                        </p:panelGrid>
                    </p:panelGrid>
                    <hr/>
                    <table style="padding-left:0px; margin-left: 0px; margin-top: 0px;" 
                           border="0" width="90%">
                        <tr>
                            <td>
                                <h:panelGroup style="margin-top: 0px;"> 
                                    <p:panelGrid columns="1"  style="margin-top: 0px;">                                        
                                        <my:dataGrid value="#{proyectoOTBean.traerProyectoOT}" id="dtProyectoOt" rows="10"  
                                                     showPaginator="true"                                                     
                                                     textoResultado="Mostrando del " textoPagina="página" textoDe="de">
                                            <f:facet name="header"><h:outputLabel value="Proyectos OT's"/> </f:facet>
                                            <p:column>
                                                <f:facet name="header">
                                                    <h:panelGroup>
                                                        <h:outputText value="#{msgs['generales.nombre']}"/>
                                                    </h:panelGroup>
                                                </f:facet>
                                                <h:outputText value="#{data.nombre}"/>
                                            </p:column>
                                            <p:column style="text-align: center;">
                                                <f:facet name="header"><h:outputText value="#{msgs['sia.proyecto.ot.cuenta.contable']}"/></f:facet>
                                                <h:outputText value="#{data.cuentaContable}"/>
                                            </p:column>
                                            <p:column style="text-align: center;">
                                                <f:facet name="header"><h:outputText value="#{msgs['sistema.abierto']}"/></f:facet>
                                                <h:outputText value="#{data.abierto eq 'True' ? 'Si':'No'}"/>
                                            </p:column>
                                            <p:column style="text-align: center;">
                                                <f:facet name="header"><h:outputText value="" /></f:facet>
                                                <p:commandLink value="#{msgs['sistema.abrir']}" rendered="#{data.abierto eq 'False'}" 
                                                               onclick="if (!confirm('Confirma que desea abrir el proyecto...? '))
                                                                             return false;"
                                                               title="#{msgs['sia.contrato.tooltip.abrir.proyecto']}"
                                                               action="#{proyectoOTBean.abrirProyectoOT}" styleClass="link"/>
                                                <p:commandLink value="#{msgs['sia.proyecto.ot.cerrar']}" rendered="#{data.abierto eq 'True'}" 
                                                               onclick="if (!confirm('Confirma que desea cerrar el proyecto...? '))
                                                                             return false;"
                                                               action="#{proyectoOTBean.cerrarProyectoOT}" styleClass="link"/>
                                            </p:column>
                                            <p:column>
                                                <p:commandLink value="#{msgs['sistema.seleccionar']}" rendered="#{data.abierto eq 'True'}" 
                                                               title="#{msgs['sistema.seleccionar.toottip.proyecto.ot']}"
                                                               action="#{proyectoOTBean.seleccionarProyectoOT}" 
                                                               styleClass="link"/>
                                            </p:column>
                                        </my:dataGrid>
                                    </p:panelGrid>
                                </h:panelGroup>
                            </td>
                        </tr>
                    </table>
                    <h:panelGrid columns="2">
                        <h:outputLabel value="OT: " styleClass="f11Gris"/>
                        <h:outputLabel value="#{proyectoOTBean.proyectoOtVo.nombre}"/>
                    </h:panelGrid>
                    <table style="padding-left:0px; margin-left: 0px; margin-top: 0px;" 
                           border="0" width="90%">
                        <tr>
                            <td>
                                <table align="left"  cellspacing="0" >
                                    <tr>
                                        <td  align="center" class="bordePanelGrid">
                                            <h:outputText value="#{msgs['sia.proyecto.ot.relacion.gerencia']}" styleClass="tituloEncabezado"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td align="left" class="bordePanelGrid">                                                
                                            <p:dataTable size="small" stripedRows="true" showGridlines="true" id="relGerencia" value="#{proyectoOTBean.traerRelacionProyectoGerencia}" 
                                                         var="rel" >

                                                <p:column style="text-align: center;">
                                                    <f:facet name="header"><h:outputText value="#{msgs['sia.rh.gerencia']}"/></f:facet>
                                                    <h:outputText value="#{rel.gerencia}"/>
                                                </p:column>

                                                <p:column style="text-align: center;">
                                                    <f:facet name="header"><h:outputText value="#{msgs['sistema.eliminar']}"/></f:facet>
                                                    <p:commandLink value="Eliminar" action="#{proyectoOTBean.eliminarRelacionGerencia}" styleClass="link"/>
                                                    <p:confirmDialog id="pnlConf" message="#{msgs['sia.mensaje.relacion.proyecto.ot.gerencia']}"
                                                                     header="Confirmación de operación"/>
                                                </p:column>
                                                <p:column style="text-align: center;">
                                                    <f:facet name="header"><h:outputText value="#{msgs['sistema.eliminar']}"/></f:facet>
                                                    <p:commandLink value="Seleccionar" action="#{proyectoOTBean.seleccionarGerencia}" styleClass="link"/>
                                                </p:column>
                                            </p:dataTable>

                                        </td>
                                    </tr> 
                                    <tr>
                                        <td></td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    </table>
                    <br/>
                    <h:panelGrid columns="4">
                        <h:outputText value="OT: " styleClass="f11Gris"/>
                        <h:outputLabel value="#{proyectoOTBean.proyectoOtVo.nombre}"/> 
                        <h:outputLabel value="Gerencia: " styleClass="f11Gris"/>
                        <h:outputLabel value="#{proyectoOTModel.gerenciaTarea.gerencia}"/>
                    </h:panelGrid>
                    <table style="padding-left:0px; margin-left: 0px; margin-top: 0px;" 
                           border="0" width="90%" cellspacing="0" cellpadding="0">
                        <tr>
                            <td  align="center" class="bordePanelGrid">   
                                <h:outputText value="Tipos de taraes" 
                                              styleClass="tituloEncabezado"/>
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                        </tr>
                        <tr>
                            <td align="left" class="bordePanelGrid">
                                <p:dataTable size="small" stripedRows="true" showGridlines="true" id="dtTipoObra" value="#{proyectoOTBean.traerRelacionProyectoUnidadCosto}" 
                                             var="tipoO" > 

                                    <p:column style="text-align: center;">
                                        <f:facet name="header"> <h:outputText value="Tipo de tarea"/></f:facet>
                                        <h:outputText value="#{tipoO.unidadCosto}"/>
                                    </p:column>
                                    <p:column style="text-align: center;">
                                        <p:commandLink value="#{msgs['sistema.eliminar']}" action="#{proyectoOTBean.eliminarRelacionUnidadCosto}"
                                                       />
                                        <p:confirmDialog id="panelCon" 
                                                         header="Confirmación de operación"
                                                         message="La operación va a eliminar el tipo de tarea. ¿Está seguro?" />
                                    </p:column>                                                     
                                    <p:column style="text-align: center;">
                                        <p:commandLink value="Seleccionar" action="#{proyectoOTBean.seleccionarTipoTarea}" styleClass="link"/>                                                        
                                    </p:column>                                                     
                                </p:dataTable>
                            </td>
                        </tr>
                    </table>    
                    <br/>

                    <h:panelGrid columns="6">
                        <h:outputText value="OT: " styleClass="f11Gris"/>
                        <h:outputLabel value="#{proyectoOTBean.proyectoOtVo.nombre}"/>
                        <h:outputText value="Gerencia: " styleClass="f11Gris"/>
                        <h:outputLabel value="#{proyectoOTModel.gerenciaTarea.gerencia}"/>
                        <h:outputText value="Tipo Tarea: " styleClass="f11Gris"/>
                        <h:outputLabel value="#{proyectoOTModel.unidadCostoTarea.unidadCosto}"/>
                    </h:panelGrid>

                    <table style="padding-left:0px; margin-left: 0px; margin-top: 0px;" 
                           border="0" width="90%" cellspacing="0" cellpadding="0">
                        <tr>
                            <td  align="center" class="bordePanelGrid">   
                                <h:outputText value="Tarea" styleClass="tituloEncabezado"/>
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                        </tr>
                        <tr>
                            <td align="left" class="bordePanelGrid">
                                <p:dataTable size="small" stripedRows="true" showGridlines="true" id="dtTipoObraTarea" value="#{proyectoOTBean.traerTareas}" 
                                             var="tipoO" > 
                                    <p:column style="text-align: center;">
                                        <f:facet name="header"> <h:outputText value="Código"/></f:facet>
                                        <h:outputText value="#{tipoO.codigoTarea}"/>
                                    </p:column>
                                    <p:column style="text-align: center;">
                                        <f:facet name="header"> <h:outputText value="Nombre"/></f:facet>
                                        <h:outputText value="#{tipoO.nombreTarea}"/>
                                    </p:column>
                                    <p:column style="text-align: center;">
                                        <p:commandLink value="#{msgs['sistema.eliminar']}" action="#{proyectoOTBean.eliminarTarea}" 
                                                       />
                                        <p:confirmDialog id="panelConTarea" 
                                                         header="Confirmación de operación"
                                                         message="La operación va a eliminar la tarea seleccionada. ¿Está seguro?" />
                                    </p:column>                                                     
                                </p:dataTable>
                            </td>
                        </tr>
                    </table> 
                    <br/><br/>
                </h:form>
                <h:form rendered="#{not empty sesion.usuario}" >
                    <p:dialog style="background: #FFFFFF; "
                              visible="#{proyectoOTBean.mostrarPop}"
                              draggable="false" modal="true">
                        <f:facet name="header">
                            <h:panelGroup>                                
                                <h:outputText  value="#{msgs['sia.proyecto.ot.modificar']}"
                                               style="float: left; padding: 4px;text-align: center; vertical-align: middle;font: 11px;color: #484848; font-weight: bold;"/>
                            </h:panelGroup>
                        </f:facet>
                        <f:facet name="body">
                            <h:panelGroup>
                                <p:panelGrid columns="2">
                                    <h:outputText value="#{msgs['presupuesto.nuevos.campoProyectoOt']}"/>
                                    <p:inputTextarea value="#{proyectoOTBean.proyectoOtVo.nombre}" cols="65" rows="2"/>
                                    <p:commandButton value="#{msgs['sistema.guardar']}" styleClass="btn btn-default" 
                                                     action="#{proyectoOTBean.completarModificacion}" />
                                    <p:commandButton value="#{msgs['sistema.cancelar']}" styleClass="btn btn-default" action="#{proyectoOTBean.cerrar}" title="Cerrar ventana..." immediate="true"/>

                                </p:panelGrid>
                                <h:messages style="color: maroon; font-size: x-small; font-weight: normal;"/>
                            </h:panelGroup>
                        </f:facet>
                    </p:dialog>
                        <!-- Termina popup -->
                </h:form>
                <div id="dialogoAgregarPot" style="display: none;" title="#{msgs['sia.proyecto.ot.agregar.titulo']}">
                    <h:form id="frmAgregarProyecto">
                        <p:panelGrid columns="2">
                            <h:outputText value="#{msgs['sia.bloque.nombre']} "/>    
                            <p:panelGrid columns="2">                                                       
                                <p:selectOneMenu value="#{proyectoOTBean.idApCampoActivo}">                                                           
                                    <f:selectItems value="#{proyectoOTBean.listaBloque}"/>
                                </p:selectOneMenu>
                            </p:panelGrid>
                            <p:panelGrid columns="2">
                                <h:outputText value="#{msgs['generales.nombre']} "/>    
                                <h:outputText value="*" />
                            </p:panelGrid>
                            <p:inputText id="cajaNombre" value="#{proyectoOTBean.nombreProyectoOT}" size="45"/>
                            <p:panelGrid columns="2">
                                <h:outputText value="#{msgs['sia.proyecto.ot.cuenta.contable']}"/>
                                <h:outputText value="*"/>
                            </p:panelGrid>
                            <p:inputText id="cuentaTxt" value="#{proyectoOTBean.cuentaContable}" />
                            <p:commandButton  id="btnGuardar" styleClass="btn btn-info" style="display: none;  "
                                              action="#{proyectoOTBean.guardarProyectoOT}"/>
                            <p:commandButton id="btnCerrarAltaProyectoOT" style="display: none;"
                                             action="#{proyectoOTBean.cerrarPupupAltaProyectoOt}" />
                        </p:panelGrid>
                    </h:form>
                </div>
                <div id="dialogoProyGer" style="display: none;" title="#{msgs['sia.proyecto.ot.relacion.gerencia.titulo']}">
                    <h:form id="frmProyGer">
                        <p:panelGrid columns="2">
                            <h:outputText value="#{msgs['presupuesto.nuevos.campoProyectoOt']}"/>
                            <p:inputText value="#{proyectoOTBean.proyectoOtVo.nombre}" size="45" disabled="true"/>
                            <h:outputText value="#{msgs['sia.rh.gerencia']}"/>
                            <p:selectOneMenu id="cmbGerencia" value="#{proyectoOTBean.gerencia}" style="width: 300px;">
                                <f:selectItem itemLabel="Seleccione . . ." itemValue="-1"/>
                                <f:selectItems value="#{proyectoOTBean.traerGerencia}"/>
                            </p:selectOneMenu>
                            <p:commandLink id="btnGuardarRel" 
                                           action="#{proyectoOTBean.guardarRelacionGerencia}" 
                                           style="display: none;"/>
                            <p:commandLink id="btnCerrarRel" action="#{proyectoOTBean.ocultarPanelRelGerencia}" style="display: none;"/>

                        </p:panelGrid>
                    </h:form>
                </div>

                <div id="dialogoProyectoOTTipoObra" style="display: none;" title="#{msgs['sis.proyecto.ot.relacion.tipo.obra']}">
                    <h:form id="frmProyectoOTTipoObra">
                        <h:panelGroup >
                            <p:panelGrid columns="2">
                                <h:outputText value="#{msgs['presupuesto.nuevos.campoProyectoOt']}"/>
                                <p:inputText value="#{proyectoOTBean.proyectoOtVo.nombre}" 
                                             size="55" disabled="true"/>
                                <h:outputText value="#{msgs['sia.proyecto.ot.tipo.obra']}"/>
                                <p:panelGrid columns="2">
                                    <p:selectOneMenu id="cmbTipoObra" value="#{proyectoOTBean.tipoO}" style="width: 500px;">
                                        <f:selectItem itemLabel="#{msgs['sistema.seleccione']}" itemValue="-1"/>
                                        <f:selectItems value="#{proyectoOTBean.traerTipoObra}"/>
                                    </p:selectOneMenu>
                                    <p:commandLink value="+" style="font-weight:  bold; font-size: 13px; color: #4F82DF; background-color: background;"  action="#{proyectoOTBean.mostrarAgregarTipoObra}"
                                                   onclick="return mostrarDialogoUnaCaja('dialogoAgregarObra', 'frmAgregarObra', 'btnCerrarTipoObra', 'btnGuardarTipoObra', 'obra')"/>
                                </p:panelGrid>                                           
                                <p:commandButton id="btnGuardarPTO" action="#{proyectoOTBean.guardarRelacionTipoObra}" style="display: none;"/>
                                <p:commandButton id="btnCerrarPTO" action="#{proyectoOTBean.ocultarAgregarRelProyObra}" style="display: none;"/>
                            </p:panelGrid>
                        </h:panelGroup>
                    </h:form>
                </div>

                <div id="dialogoAgregarObra" title="#{msgs['sia.proyecto.ot.agregar.titulo.tipo.obra']}" style="display: none;">
                    <h:form id="frmAgregarObra">
                        <p:panelGrid columns="2">
                            <h:outputText value="#{msgs['sia.proyecto.ot.tipo.obra']}"/>
                            <p:inputText id="obra" value="#{proyectoOTBean.nombreTipoObra}" size="45"/>
                            <p:commandLink id="btnGuardarTipoObra" action="#{proyectoOTBean.guardarTipoObra}" style="display: none;"/>
                            <p:commandLink id="btnCerrarTipoObra" action="proyectoOT" action="#{proyectoOTBean.ocultarPanelTipoObra}" style="display: none;"/>
                        </p:panelGrid>
                    </h:form>
                </div>
                <div id="dialogOK" style="display: none;" title="#{msgs['sia.mensaje.titulo.operacion.realizada']}">
                    <h:outputText value="#{msgs['sia.mensaje.operacion.realizada']}"
                                  styleClass="textoNegrita10" style="color: blue;"/><br/><br/>
                </div>
            </ui:define>
        </ui:composition>
    </body>
</html>
