<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"       
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      >
    <body>
        <ui:composition template="./../../WEB-INF/facelets/templates/templateSistema.xhtml">
            <ui:define name="contenido">
                <h:form  >
                    <br/>
                    <center>
                        <br/>
                        <h:outputText value="Devolución de Orden de compra" styleClass="tituloEncabezado"/>
                        <br/><br/>
                        <p:panelGrid columns="3">
                            <p:panelGrid columns="1">
                                <h:outputText value="Orden C/S"/>
                                <h:outputText/>
                            </p:panelGrid>
                            <p:panelGrid columns="1" >
                                <p:inputText value="#{devolverOrdenCompraBean.consecutivo}" size="10" 
                                             />
                                <h:outputText value="OC12-1234" style="font-size: x-small; float: right;"/>
                            </p:panelGrid>
                            <p:panelGrid columns="1">
                                <p:commandButton value="Búscar" styleClass="btn btn-default" 
                                                   action="#{devolverOrdenCompraBean.buscarOrden}"/>

                                <h:outputText/>
                            </p:panelGrid>
                        </p:panelGrid>
                    </center>
                    <br/>
                    <p:panelGrid columns="3" rendered="#{devolverOrdenCompraBean.mostrar}">
                        <h:outputText value="La Orden C/S"/>
                        <h:outputText value="#{devolverOrdenCompraBean.consecutivo}." style="color: #0895d6; font-weight: bold;"/>
                        <h:outputText value=" No existe o no se ha creado o el sistema no la tiene."/>
                    </p:panelGrid>
                    <br/><br/>
                    <h:panelGroup rendered="#{devolverOrdenCompraBean.orden != null}">                        
                        <p:panelGrid columns="1" rendered="#{devolverOrdenCompraBean.orden.autorizacionesOrden.estatus.id != 101}">
                            <p:commandButton value="Click aquí para regresar la OC/S  al Analista de procura" styleClass="btn btn-default" 
                                               action="#{devolverOrdenCompraBean.devolverOrdenCompra}"/>
                        </p:panelGrid>
                        <p:panelGrid columns="3" rendered="#{devolverOrdenCompraBean.orden.autorizacionesOrden.estatus.id eq 101}">
                            <h:outputText value="La Orden C/S"/>
                            <h:outputText value="#{devolverOrdenCompraBean.consecutivo}" style="color: #0895d6; font-weight:  bold;"/>
                            <h:outputText value="Esta en la bandeja del Analista de procura. "/>
                        </p:panelGrid>
                        <br/>
                        <p:panelGrid columns="4">
                            <f:facet name="header"><h:outputText value="Autorizaciones" style="color: #4F82DF; font-size: 11px; font-weight: bold;"/></f:facet>
                            <h:outputText value="Solicitada el:"/>
                            <p:inputText disabled="true" value="#{devolverOrdenCompraBean.orden.autorizacionesOrden.fechaSolicito}">
                                <f:convertDateTime dateStyle="default" type="date"/>
                            </p:inputText>
                            <h:outputText value="Por:"/>
                            <p:inputText disabled="true" size="50" value="#{devolverOrdenCompraBean.orden.autorizacionesOrden.solicito.nombre}"/>

                            <h:outputText value="Vo. Bo. el:"/>
                            <p:inputText disabled="true" value="#{devolverOrdenCompraBean.orden.autorizacionesOrden.fechaAutorizoGerencia}">
                                <f:convertDateTime dateStyle="default" type="date"/>
                            </p:inputText>
                            <h:outputText value="Por:"/>
                            <p:inputText disabled="true" size="50" value="#{devolverOrdenCompraBean.orden.autorizacionesOrden.autorizaGerencia.nombre}"/>

                            <h:outputText value="Revisada el:"/>
                            <p:inputText disabled="true" value="#{devolverOrdenCompraBean.orden.autorizacionesOrden.fechaAutorizoMpg}">
                                <f:convertDateTime dateStyle="default" type="date"/>
                            </p:inputText>
                            <h:outputText value="Por:"/>
                            <p:inputText disabled="true" size="50" value="#{devolverOrdenCompraBean.orden.autorizacionesOrden.autorizaMpg.nombre}"/>

                            <h:outputText value="Aprobada el:"/>
                            <p:inputText disabled="true" value="#{devolverOrdenCompraBean.orden.autorizacionesOrden.fechaAutorizoIhsa}">
                                <f:convertDateTime dateStyle="default" type="date"/>
                            </p:inputText>
                            <h:outputText value="Por:"/>
                            <p:inputText disabled="true" size="50" value="#{devolverOrdenCompraBean.orden.autorizacionesOrden.autorizaIhsa.nombre}"/>

                            <h:outputText value="Autorizada el:"/>
                            <p:inputText disabled="true" value="#{devolverOrdenCompraBean.orden.autorizacionesOrden.fechaAutorizoCompras}">
                                <f:convertDateTime dateStyle="default" type="date"/>
                            </p:inputText>
                            <h:outputText value="Por:"/>
                            <p:inputText disabled="true" size="50" value="#{devolverOrdenCompraBean.orden.autorizacionesOrden.autorizaCompras.nombre}"/>
                        </p:panelGrid>
                        <br/><br/>
                        <p:card >
                            <f:facet name="first">
                                <p:panelGrid columns="2">
                                    <f:facet name="header"><h:outputText value="Datos de la orden de compra" style="color: #4F82DF; font-size: 11px; font-weight: bold;"/></f:facet>
                                    <h:outputText value="Consecutivo"/>
                                    <p:inputText value="#{devolverOrdenCompraBean.orden.consecutivo}" disabled="true" size="7"/>
                                    <h:outputText value="Proyecto OT"/>
                                    <p:inputText value="#{devolverOrdenCompraBean.orden.proyectoOt.nombre}" disabled="true" size="30"/>
                                    <h:outputText value="Proveedor"/>
                                    <p:inputText value="#{devolverOrdenCompraBean.orden.proveedor.nombre}" disabled="true" size="30"/>
                                    <h:outputText value="Gerencia"/>
                                    <p:inputText value="#{devolverOrdenCompraBean.orden.gerencia.nombre}" disabled="true" size="25"/>
                                    <h:outputText value="Analista"/>
                                    <p:inputText value="#{devolverOrdenCompraBean.orden.analista.nombre}" disabled="true" size="20"/>
                                    <h:outputText value="Destino"/>
                                    <p:inputText value="#{devolverOrdenCompraBean.orden.destino}" disabled="true" size="35"/>
                                    <h:outputText value="Condción de pago"/>
                                    <p:inputTextarea cols="45" rows="2" value="#{devolverOrdenCompraBean.orden.condicionPago.nombre}" disabled="true" />
                                    <h:outputText value="Estatus"/>
                                    <p:inputText value="#{devolverOrdenCompraBean.orden.autorizacionesOrden.estatus.nombre}" size="20" disabled="true"/>
                                    <h:outputText value="Total en pesos"/>
                                    <p:inputText value="#{devolverOrdenCompraBean.orden.total}" size="10" disabled="true"/>
                                    <h:outputText value="Total dólares"/>
                                    <p:inputText value="#{devolverOrdenCompraBean.orden.totalUsd}" size="10" disabled="true">
                                        <f:convertNumber currencySymbol="$" maxFractionDigits="2" type="currency" groupingUsed="true" />
                                    </p:inputText>
                                </p:panelGrid>
                            </f:facet>
                            <f:facet name="second">
                                <p:panelGrid columns="2">
                                    <f:facet name="header"><h:outputText value="Datos de la Requisición" style="color: #4F82DF; font-size: 11px; font-weight: bold;"/></f:facet>
                                    <h:outputText value="Consecutivo"/>
                                    <p:inputText value="#{devolverOrdenCompraBean.orden.requisicion.consecutivo}" disabled="true" size="7"/>
                                    <h:outputText value="Proyecto OT"/>
                                    <p:inputText value="#{devolverOrdenCompraBean.orden.requisicion.proyectoOt.nombre}" disabled="true" size="35"/>
                                    <h:outputText value="Tipo de obra"/>
                                    <p:inputText value="#{devolverOrdenCompraBean.orden.requisicion.tipoObra.nombre}" disabled="true" size="45"/>
                                    <h:outputText value="Proveedor"/>
                                    <p:inputText value="#{devolverOrdenCompraBean.orden.requisicion.proveedor}" disabled="true" size="35"/>
                                    <h:outputText value="Monto en MN"/>
                                    <p:inputText value="$ #{devolverOrdenCompraBean.orden.requisicion.montoMn}" disabled="true" size="15"/>
                                    <h:outputText value="Monto en USD"/>
                                    <p:inputText value="$ #{devolverOrdenCompraBean.orden.requisicion.montoUsd}" disabled="true" size="15"/>
                                    <h:outputText value="Estatus"/>
                                    <p:inputText value="#{devolverOrdenCompraBean.orden.requisicion.estatus.nombre}" disabled="true"/>
                                </p:panelGrid>
                            </f:facet>
                        </p:panel>
                        <br/>

                    </h:panelGroup>
                    <br/>
                </h:form>
                <h:form rendered="#{not empty sesion.usuario}" >
                    <p:dialog style="z-index:1001; position: relative; background: #FFFFFF; "
                                    visible="#{devolverOrdenCompraBean.modal}"
                                    draggable="false" modal="true">
                        <f:facet name="header">
                            <h:panelGroup>                                
                                <h:outputText  value="Devolución de OC/S"
                                                 style="float: left; padding: 4px;text-align: center; vertical-align: middle;font: 11px;color: #484848; font-weight: bold;"/>
                                <p:commandButton action="#{devolverOrdenCompraBean.toggleModal}"
                                                   title="Cerrar ventana" type="button" alt="Cerrar"
                                                   icon="./resources/imagenes/bad.gif"
                                                   style="vertical-align: middle;margin: 4px;display: inline; float: right;"/>
                            </h:panelGroup>
                        </f:facet>
                        <f:facet name="body">
                            <h:panelGroup>
                                <p:panelGrid columns="2"> 
                                    <h:outputText value="Solicita"/>       
                                    <!--listValue="#{devolverOrdenCompraBean.listaSelect}"-->
                                    <p:autoComplete id="userSelect" immediate="true" 
                                                         value="#{devolverOrdenCompraBean.usuarioSolicita}" 
                                                         valueChangeListener="#{devolverOrdenCompraBean.usuarioListener}">
                                    <f:facet name="selectInputText">
                                        <p:panelGrid columns="2" style="margin-bottom: 2px;">
                                            <h:outputText id="autoCompleteUsurOp" value="#{userOp.nombre}" />
                                        </p:panelGrid>
                                    </f:facet>
                                </p:autoComplete> 
                                    <h:outputText value="Motivo"/>
                                    <p:inputTextarea value="#{devolverOrdenCompraBean.motivo}" cols="65" rows="3"/>
                                    <p:commandButton value="Enviar" styleClass="btn btn-default" action="#{devolverOrdenCompraBean.completarDevolucionOrden}" action="devolverOrdenCompra"/>
                                    <p:commandButton value="Cancelar" styleClass="btn btn-default" action="#{devolverOrdenCompraBean.toggleModal}" title="Cerrar ventana..." immediate="true"/>

                                </p:panelGrid>
                                <h:messages style="color: maroon; font-size: x-small; font-weight: normal;"/>
                            </h:panelGroup>
                        </f:facet>
                    </p:dialog>
                    <!-- Termina popup -->
                </h:form>
            </ui:define>
        </ui:composition>

    </body>
</html>
