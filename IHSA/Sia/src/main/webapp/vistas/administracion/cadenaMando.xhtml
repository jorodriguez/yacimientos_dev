<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      >
    <body>
        <ui:composition template="./../../WEB-INF/facelets/templates/templateGrupos.xhtml">
            <ui:define name="contenido">
                <div id="page">
                    <div class="row">
                        <h:form id="frmCad"  >
                            <div class="col-lg-12">
                                <h2 class="page-header">Cadena de aprobación de requisición</h2>
                            </div>
                            <h:outputLabel value="Campo"/>
                            <p:panelGrid columns="1" style="text-align: center;" styleClass="bordePanelGrid" >
                                <p:selectOneRadio value="#{cadenaMandoBean.idCampo}" 
                                                  valueChangeListener="#{cadenaMandoBean.cambiarValorCampo}" 
                                                  layout="lineDirection" >
                                    <f:selectItems value="#{cadenaMandoBean.listaCampo}"/> 
                                </p:selectOneRadio>
                            </p:panelGrid> 
                            <h:messages id="cadMess" style="color: maroon; font-weight:  normal; font-size: x-small;"/>
                            <br/>
                            <p:panelGrid style="text-align: center;" >
                                <p:commandLink title="Agregar" styleClass="btn btn-default" 
                                               action="#{cadenaMandoBean.agregarCadenaMando}" 
                                               process="@this" update=""                                               
                                               onclick="mostrarDialogoAgregarCadena('dialogoAgregarCad', 'frmCadAgre', 'btnCerrar', 'btnGuardar', 'autocompleteUsuarioBuscar', 'autocompleteUsuarioRev', 'autocompleteUsuarioApr');" >
                                    <i class="fa fa-plus text-primary"/>                                    
                                </p:commandLink>                                
                            </p:panelGrid>
                            <p:panelGrid  >
                                <p:dataTable size="small" stripedRows="true" showGridlines="true" id="dtCad" value="#{cadenaMandoBean.listaCadena}" var="cad" 
                                             rows="15"
                                             paginator="true"  
                                             paginatorPosition="bottom" >
                                    <f:facet name="header"><h:outputText value="Cadena de aprobación"/></f:facet>
                                    <!--p:column>
                                        <f:facet name="header">
                                            <h:selectBooleanCheckbox  class="todos" onchange="seleccionarTodo('todos', 'seleccion')"/>
                                        </f:facet>
                                        <h:selectBooleanCheckbox  class="seleccion"  value="#{cad.selected}" onclick="ejecutarBoton('frmCad', 'pru')">
                                            <f:param name="idw" value="#{cad.id}"/>
                                        </h:selectBooleanCheckbox>
                                    </p:column>
                                    <p:column>
                                        <h:outputText value="#{cad.id}"/>
                                    </p:column-->
                                    <p:column headerText="Solicita" filterBy="#{cad.solicita}" filterMatchMode="contains">
                                        <h:outputText value="#{cad.solicita}"/>
                                    </p:column>
                                    <p:column headerText="Solicita" filterBy="#{cad.revisa}" filterMatchMode="contains">
                                        <f:facet name="header"><h:outputText value="Revisa"/></f:facet>
                                        <h:outputText value="#{cad.revisa}" id="idcm"/>
                                    </p:column>
                                    <p:column headerText="Solicita" filterBy="#{cad.aprueba}" filterMatchMode="contains">
                                        <f:facet name="header"><h:outputText value="Aprueba"/></f:facet>
                                        <h:outputText value="#{cad.aprueba}"/>
                                    </p:column>
                                    <p:column>
                                        <p:commandLink value="Modificar" 
                                                       style="color: blue; text-decoration: underline;"   
                                                       onclick="mostrarDialogoModCadenas('dialogoModificarCad', 'frmCadMod', 'btnCerrar', 'btnGuardar', 'autocompleteUsuarioRev', 'autocompleteUsuarioApr');"
                                                       action="#{cadenaMandoBean.modificarCadena(cad.id)}">
                                            <f:param name="idCad" value="#{cad.id}"/>
                                        </p:commandLink>
                                    </p:column>
                                    <p:column>
                                        <p:commandLink value="Eliminar" 
                                                       style="color: blue; text-decoration: underline;"
                                                       action="#{cadenaMandoBean.eliminarCadena(cad.id)}" 
                                                       >
                                            <f:param name="idCad" value="#{cad.id}"/>
                                        </p:commandLink>
                                        <p:confirmDialog id="pnlC" header="Completar operación"
                                                         message="La operación va a eliminar la cadena de aprobación, ¿ esta seguro ?"/>
                                    </p:column>
                                </p:dataTable>                        
                            </p:panelGrid>
                            <p:panelGrid style="float: right;" rendered="#{cadenaMandoBean.listaCadena.rowCount gt 0}">
                                <p:panelGrid columns="2" style="float: right; margin-right: 20px;">                            
                                    <p:dataExporter type="xls"  target="dtCad"   fileName="CadenasAprobacion">
                                        <p:graphicImage url="./resources/imagenes/xls.png"/>
                                    </p:dataExporter>
                                </p:panelGrid>
                            </p:panelGrid>
                        </h:form>
                        <!--Agregar cadena de aprobacion-->
                        <div id="dialogoAgregarCad" style="display: none;" 
                             title="Agregar cadena de aprobación">

                            <h:form id="frmCadAgre" rendered="#{not empty usuarioBean.usuarioVO}" styleClass="textoIzquierda">
                                <!--p:panelPopup visible="#{cadenaMandoBean.modalPop}"
                                                draggable="false" modal="true">
                                    <f:facet name="header">
                                        <h:panelGroup>                                
                                            <h:outputText  value="Crear cadena mando"
                                                             style="float: left; padding: 4px;text-align: center; vertical-align: middle;font: 11px;color: #484848; font-weight: bold;"/>                                
                                        </h:panelGroup>
                                    </f:facet>
                                    <f:facet name="body"-->
                                <h:panelGroup>
                                    <p:panelGrid columns="2" >
                                        <f:facet name="header">
                                            <h:outputText value="Agregar cadena de aprobación"  styleClass="textoListaTabla"/>
                                        </f:facet>
                                        <h:outputText value="Campo:"/>
                                        <p:inputText value="#{cadenaMandoBean.campo}" disabled="true"/>
                                        <h:outputText value="Usuario"/>
                                        <h:panelGrid columns="2">
                                            <p:autoComplete id="event" value="#{cadenaMandoBean.usuario}"
                                                            completeMethod="#{cadenaMandoBean.usuarioListenerAgregarSolicita}" scrollHeight="250">
                                                <p:ajax event="itemSelect" listener="#{cadenaMandoBean.onItemSelect}" update="msgs"/>
                                            </p:autoComplete>
                                            <p:inputText id="autocompleteUsuarioBuscar" size="40"
                                                         onclick="autocompletarUsuario(this, 'hidenDesUsuarioBuscar', 'frmCadAgre');"
                                                         />
                                            <h:inputHidden id="hidenDesUsuarioBuscar" value="#{cadenaMandoBean.usuario}"/>
                                        </h:panelGrid>
                                        <h:outputText value="Revisa"/>
                                        <h:panelGrid columns="2">
                                            <p:inputText id="autocompleteUsuarioRev" size="40"
                                                         onclick="autocompletarUsuario(this, 'hidenDesUsuarioRevisa', 'frmCadAgre');"/>
                                            <h:inputHidden id="hidenDesUsuarioRevisa" value="#{cadenaMandoBean.revisa}"/>
                                        </h:panelGrid>
                                        <h:outputText value="Aprueba"/>                                    
                                        <h:panelGrid columns="2">
                                            <p:inputText id="autocompleteUsuarioApr" size="40" 
                                                         onclick="autocompletarUsuario(this, 'hidenDesUsuarioAprueba', 'frmCadAgre');"/>
                                            <h:inputHidden id="hidenDesUsuarioAprueba" value="#{cadenaMandoBean.aprueba}"/>
                                        </h:panelGrid>                                    
                                    </p:panelGrid>
                                    <br/>
                                    <center>
                                        <p:panelGrid columns="2">
                                            <p:commandLink id="btnGuardar"  value="Actualizar" style="display: none;" 
                                                           action="#{cadenaMandoBean.registroCadenaMando}"/>
                                            <p:commandLink id="btnCerrar"  value="Actualizar" style="display: none;" 
                                                           action="#{cadenaMandoBean.cancelarRegistroCadenaMando}"/>
                                        </p:panelGrid>
                                    </center>
                                    <br/>
                                    <h:messages id="messaCrearCad" infoClass="textoMensajeError"/>
                                </h:panelGroup>
                                <!-- Termina popup -->                    
                            </h:form>
                        </div>
                        <!--Inicia el pop para modificar-->       

                        <div id="dialogoModificarCad" style="display: none;" 
                             title="Modificar cadena de aprobación">
                            <h:form id="frmCadMod" rendered="#{not empty sesion.usuario}" styleClass="textoIzquierda">
                                <!--p:panelPopup visible="#{cadenaMandoBean.modalModificarPop}"
                                                draggable="false" modal="true">
                                    <f:facet name="header">
                                        <h:panelGroup>                                
                                            <h:outputText  value="Editar cadena mando"
                                                             style="float: left; padding: 4px;text-align: center; vertical-align: middle;font: 11px;color: #484848; font-weight: bold;"/>
                                        </h:panelGroup>
                                    </f:facet>
                                    <f:facet name="body"-->
                                <h:panelGroup>

                                    <p:panelGrid columns="1" rendered="#{cadenaMandoBean.cadenaAprobacionVo != null}" >
                                        <p:panelGrid columns="2">
                                            <h:outputText value="Campo"/>
                                            <p:inputText  disabled="true" value="#{cadenaMandoBean.campo}" size="35"/>
                                        </p:panelGrid>
                                        <p:panelGrid columns="2" styleClass="bordePanelGrid">
                                            <f:facet name="header"><h:outputLabel value="Actual"/></f:facet>
                                            <h:outputText value="Solicita"/>
                                            <p:inputText  disabled="true" value="#{cadenaMandoBean.cadenaAprobacionVo.solicita}" size="35"/>
                                            <h:outputText value="Revisa"/>
                                            <p:inputText  disabled="true" value="#{cadenaMandoBean.cadenaAprobacionVo.revisa}" size="35"/>
                                            <h:outputText value="Aprueba"/>
                                            <p:inputText  disabled="true" value="#{cadenaMandoBean.cadenaAprobacionVo.aprueba}" size="35"/>
                                        </p:panelGrid>
                                        <p:panelGrid columns="2" >
                                            <f:facet name="header"><h:outputLabel value="Nueva"/></f:facet>
                                            <h:outputText value="Revisa"/>
                                            <h:panelGrid columns="2">
                                                <p:inputText id="autocompleteUsuarioRev" size="40" 
                                                             onclick="autocompletarUsuario(this, 'hidenDesUsuarioRev', 'frmCadMod');" />
                                                <h:inputHidden id="hidenDesUsuarioRev" value="#{cadenaMandoBean.revisa}"/>
                                            </h:panelGrid>
                                            <h:outputText value="Aprueba"/>
                                            <h:panelGrid columns="2">
                                                <p:inputText id="autocompleteUsuarioApr" size="40" 
                                                             onclick="autocompletarUsuario(this, 'hidenDesUsuarioAprueba', 'frmCadMod');"/>
                                                <h:inputHidden id="hidenDesUsuarioAprueba" value="#{cadenaMandoBean.aprueba}"/>
                                            </h:panelGrid>
                                        </p:panelGrid>
                                    </p:panelGrid>
                                    <center>
                                        <p:panelGrid columns="2">
                                            <p:commandButton id="btnGuardar"  value="Actualizar" style="display: none;" 
                                                             action="#{cadenaMandoBean.completarModificacion}"/>
                                            <p:commandButton id="btnCerrar" value="Cancelar" style="display: none;" 
                                                             action="#{cadenaMandoBean.cancelarModificacion}"/>
                                        </p:panelGrid>
                                    </center>
                                    <h:messages id="messaCrearCad" infoClass="textoMensajeError"/>
                                </h:panelGroup>
                            </h:form>
                        </div>
                        <!--div class="modal fade" id="modalVarios" role="dialog">
                            <div class="modal-dialog">
                                <div class="modal-content card-primary">
                                    <div class="modal-header card-heading">
                                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                                        <h4 class="modal-title">Modificar o Eliminar varias Cadenas de Mando</h4>
                                    </div>
                                    <h:form id="frmVarios" styleClass="textoIzquierda">
                                        <div class="modal-body">
                                            <div class="row">
                                                <label class="col-md-2 col-xs-6">Buscar:</label>
                                                <div class="col-md-8 col-xs-9">
                                                    <p:inputText id="autocompleteUsuarioApr" size="40" 
                                                                   onclick="autocompletarUsuario(this, 'hidenSerch', 'frmVarios');"/>
                                                    <h:inputHidden id="hidenSerch" value="#{cadenaMandoBean.usuario}"/>
                                                </div>
                                                <button type="button" class="btn btn-primary" onclick="ejecutarBoton('frmVarios','serchU')">
                                                    <i class="fa fa-search" aria-hidden="true" style="color: whitesmoke"></i>
                                                </button>
                                                <p:commandLink action="#{cadenaMandoBean.traerCadenasUsuario()}" id="serchU" visible="false"/>
                                            </div>
                                            <br/>
                                            <div class="row">
                                                <div class="col-md-6 col-xs-12">
                                                    <div class="col-md-6">
                                                    <p:selectBooleanCheckbox value="#{cadenaMandoBean.revisaReq}" />
                                                    <label>Revisa</label>
                                                    </div>
                                                    <div class="col-md-6">
                                                    <p:selectBooleanCheckbox value="#{cadenaMandoBean.apruebaReq}" />
                                                    <label>Aprueba</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <p:dataTable size="small" stripedRows="true" showGridlines="true" id="dtCadMod" value="#{cadenaMandoBean.listaCadena}" var="cad" 
                                               rows="10"
                                               paginator="true"  
                                               paginatorPosition="bottom" pageCount="3">
                                                    <f:facet name="header"><h:outputText value="Cadena de aprobación"/></f:facet>
                                    <p:column headerText="Solicita" filterMatchMode="contains">
                                        <h:outputText value="#{cad.solicita}"/>
                                    </p:column>
                                    <p:column headerText="Solicita"  filterMatchMode="contains">
                                        <f:facet name="header"><h:outputText value="Revisa"/></f:facet>
                                        <h:outputText value="#{cad.revisa}" id="idcm"/>
                                    </p:column>
                                    <p:column headerText="Solicita"  filterMatchMode="contains">
                                        <f:facet name="header"><h:outputText value="Aprueba"/></f:facet>
                                        <h:outputText value="#{cad.aprueba}"/>
                                    </p:column>
                                </p:dataTable>  
                                            </div>
                                        </div>
                                    </h:form>
                                    <div class="modal-footer">
                                        <div class="col-md-12 col-xs-12" style="text-align: right">
                                                    <button type="button" class="btn btn-default">Modificar</button>
                                                    <button type="button" class="btn btn-default">Eliminar</button>
                                                </div>
                                    </div>
                                </div>
                            </div>
                        </div-->
                    </div>
                </div>
            </ui:define>
        </ui:composition>
    </body>
</html>
